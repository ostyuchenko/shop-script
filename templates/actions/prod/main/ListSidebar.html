{$_sprite_url = "`$wa_url`wa-apps/shop/img/backend/products/product/icons.svg?v=`$wa->version()`"}

{$_tooltips = []}

{$_locales = [
    "pin_menu" => _w("Pin menu")|escape,
    "unpin_menu" => _w("Unpin menu")|escape
]}

{$_menu = [
    [
        "id" => "orders",
        "name" => _w("Orders"),
        "icon" => '<i class="fas fa-inbox"></i>',
        "url" => "{$wa_app_url}?action=orders#/orders/"
    ],
    [
        "id" => "customers",
        "name" => _w("Customers"),
        "icon" => '<i class="fas fa-user-friends"></i>',
        "url" => "{$wa_app_url}?action=customers"
    ],
    [
        "id" => "catalog",
        "name" => _w("Catalog"),
        "icon" => '<i class="fas fa-tags"></i>',
        "url" => "",
        "submenu" => [
            [
                "name" => _w("Products"),
                "url" => "{$wa_app_url}products/"
            ],
            [
                "name" => _w("Categories"),
                "url" => "{$wa_app_url}products/categories/"
            ],
            [
                "name" => _w("Sets"),
                "url" => "{$wa_app_url}products/sets/"
            ],
            [
                "name" => _w("Reviews"),
                "url" => "{$wa_app_url}?action=products#/reviews/"
            ],
            [
                "name" => _w("Services"),
                "url" => "{$wa_app_url}?action=products#/services/"
            ],
            [
                "name" => _w("Stock"),
                "url" => "{$wa_app_url}?action=products#/stocks/"
            ],
            [
                "name" => _w("Product types & features"),
                "url" => "{$wa_app_url}?action=settings#/typefeat/"
            ]
        ]
    ],
    [
        "id" => "marketing",
        "name" => _w("Marketing"),
        "icon" => '<i class="fas fa-bullhorn"></i>',
        "url" => "{$wa_app_url}marketing/",
        "submenu" => [
            [
                "name" => _w("Promos on website"),
                "url" => "{$wa_app_url}marketing/"
            ],
            [
                "name" => _w("Coupons"),
                "url" => "{$wa_app_url}marketing/coupons/"
            ],
            [
                "name" => _w("Marketing costs"),
                "url" => "{$wa_app_url}marketing/costs/"
            ],
            [
                "name" => _w("A/B tests"),
                "url" => "{$wa_app_url}marketing/abtesting/"
            ],
            [
                "name" => _w("Discounts"),
                "url" => "{$wa_app_url}marketing/discounts/"
            ],
            [
                "name" => _w("Follow-ups"),
                "url" => "{$wa_app_url}marketing/followups/"
            ],
            [
                "name" => _w("Recommendations"),
                "url" => "{$wa_app_url}marketing/recommendations/"
            ],
            [
                "name" => _w("Affiliate program"),
                "url" => "{$wa_app_url}marketing/affiliate/"
            ]
        ]
    ],
    [
        "id" => "reports",
        "name" => _w("Reports"),
        "icon" => '<i class="fas fa-chart-bar"></i>',
        "url" => "{$wa_app_url}?action=reports",
        "submenu" => [
            [
                "name" => _w("Sales"),
                "url" => "{$wa_app_url}?action=reports"
            ],
            [
                "name" => _w("Customers"),
                "url" => "{$wa_app_url}?action=reports#/customers/"
            ],
            [
                "name" => _w("Cohorts"),
                "url" => "{$wa_app_url}?action=reports#/cohorts/"
            ],
            [
                "name" => _w("Products"),
                "url" => "{$wa_app_url}?action=reports#/products/"
            ]
        ]
    ],
    [
        "id" => "storefront",
        "name" => _w("Storefront"),
        "icon" => '<i class="fas fa-store"></i>',
        "url" => "{$wa_app_url}?action=storefronts",
        "submenu" => [
            [
                "name" => _w("Appearance"),
                "url" => "{$wa_app_url}?action=storefronts#"
            ],
            [
                "name" => _w("Templates"),
                "url" => "{$wa_app_url}?action=storefronts#/design/action=edit&theme=default"
            ],
            [
                "name" => _w("Settings"),
                "url" => "{$wa_app_url}?action=storefronts#/design/action=settings"
            ],
            [
                "name" => _w("Pages"),
                "url" => "{$wa_app_url}?action=storefronts#/design/pages/"
            ],
            [
                "name" => _w("Design themes"),
                "url" => "{$wa_app_url}?action=storefronts#/design/themes/"
            ]
        ]
    ],
    [
        "id" => "import",
        "name" => "{_w("Import")}/{_w("Export")}",
        "icon" => '<i class="fas fa-exchange-alt"></i>',
        "url" => "{$wa_app_url}?action=importexport"
    ],
    [
        "id" => "settings",
        "name" => _w("Settings"),
        "icon" => '<i class="fas fa-cog"></i>',
        "url" => "{$wa_app_url}?action=settings"
    ],
    [
        "id" => "plugins",
        "name" => _w("Plugins"),
        "icon" => "<svg><use xlink:href=\"{$_sprite_url}#plugins\"></use></svg>",
        "url" => "{$wa_app_url}?action=plugins"
    ]
]}

<div class="s-products-page-menu" id="js-products-page-menu" style="visibility: hidden">
    <div class="sidebar width-15rem hide-scrollbar">
        <ul class="menu s-main-menu">
            <li class="s-toggle-wrapper">
                <div class="item js-toggle-products-page-sidebar">
                    <span class="s-icon-main icon"><i class="fas fa-bars"></i></span>
                    <span class="s-name">{$_locales["unpin_menu"]}</span>
                </div>
            </li>

            {foreach $_menu as $_item}
                <li>
                    {if !empty($_item["submenu"])}
                        <div class="item js-group-toggle js-{$_item["id"]}-toggle">
                            <span class="s-icon-main icon">{$_item["icon"]}</span>
                            <span class="s-name">
                                {$_item["name"]|escape}
                                <span class="hint s-icon-toggle is-expanded"><i class="fas fa-caret-down"></i></span>
                                <span class="hint s-icon-toggle"><i class="fas fa-caret-right"></i></span>
                            </span>
                        </div>

                        <ul class="menu s-sub-menu">
                            {foreach $_item["submenu"] as $_sub_item}
                                <li>
                                    <a class="item" href="{$_sub_item["url"]|escape}">
                                        <span class="s-name">{$_sub_item["name"]|escape}</span>
                                    </a>
                                </li>
                            {/foreach}
                        </ul>
                    {else}
                        <a class="item" href="{$_item["url"]|escape}">
                            <span class="s-icon-main icon">{$_item["icon"]}</span>
                            <span class="s-name">{$_item["name"]|escape}</span>
                        </a>
                    {/if}
                </li>
            {/foreach}
        </ul>
    </div>

    <script>
        ( function($) {
            var $products_page = $("#js-products-page"),
                $product_page = $("#js-product-page");

            if ($products_page.length) {
                var ready_promise = $products_page.data("ready");
                ready_promise.done( function(controller) {
                    controller.sidebar = init();
                });
            } else if ($product_page.length) {
                var ready_promise = $product_page.data("ready");
                ready_promise.done( function(controller) {
                    init();
                });
            }

            function init() {
                return $.wa_shop_products.init.initProductsSidebar({
                    $wrapper: $("#js-products-page-menu"),
                    tooltips: {$_tooltips|json_encode},
                    locales: {$_locales|json_encode},
                    sidebar_menu_state: {if !empty($sidebar_menu_state)}true{else}false{/if},
                    urls: {
                        "sidebar_menu_state" : "{$wa_app_url}?module=backend&action=sidebarMenuSaveState"
                    }
                });
            }
        })(jQuery);
    </script>
</div>
