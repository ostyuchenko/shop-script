<div class="block double-padded s-csv-import" id="s-csvproduct-form">
    <h1>[`CSV product import`]</h1>
    <p>
        {sprintf('[`Import new products and update existing product information from a comma-separated values (CSV) file. CSV files can be created and managed using most modern spreadsheet applications such as Microsoft Excel, OpenOffice, and iWork. For detailed information about Shop-Script-supported CSV file structure, please <a href="%s" target="_blank">refer to the manual</a>.`]','[`http://www.shop-script.com/help/csv-file-structure/`]')}
        <i class="icon10 new-window"></i>
    </p>
   <form id="s-csvproduct" method="post" action="?module=csv&action=productrun">
   {$wa->csrf()}


    <div class="fields form">
        <div class="field-group">
            <h2 class="gray">1. [`Upload CSV file`]</h2>
            <div class="field">
                <div class="name">
                   [`Encoding`]
                </div>
                <div class="value">
                    <select name="encoding">
                    {foreach $encoding as $enc}<option{if $enc == 'UTF-8'} selected="selected"{/if}>{$enc|escape}</option>{/foreach}
                    </select>
                </div>
            </div>
            <div class="field">
                <div class="name">
                   [`Separator`]
                </div>
                <div class="value">
                    <select name="delimeter">
                        <option value=";" selected="selected">;</option>
                        <option value=",">,</option>
                        <option value="tab">&rarr;</option>
                    </select>
                </div>
            </div>
            <div class="field">
                <div class="name">
                [`File`]
                </div>
                <div class="value no-shift">
                    <input type="file" name="" class="fileupload">
                    <div class="js-fileupload-progress" style="display:none;">
                        <i class="icon16 loading"></i><span><!-- upload progress handler --></span>
                    </div>
                    <span class="errormsg" style="display:none;"><br><br><i class="icon10 no"></i> <span></span></span>

                    <!-- {capture name="file-info-template-js"}{literal} -->
                    {% file=o.file; %}
                    <input type="hidden" name="file" value="{%=file.name%}">
                    <i class="icon16 yes"></i>
                    <strong>{% if(file.name != file.original_name){ %}{%=file.original_name%} &rarr; {% } %}{%=file.name%}</strong><br>
                    <span class="hint">{% if(file.size != file.original_size){ %}{%=file.original_size%} &rarr; {% } %}{%=file.size%}</span>
                    {% if(file.header){ %}
                    <p><br>[`Following columns were located in the uploaded file:`]</p>
                    <ul class="menu-h hint">
                        {% for (var column in file.header){if(file.header.hasOwnProperty(column)){ %}
                        <li title="{%=column%}">{%=file.header[column]%}</li>
                        {% }} %}
                    </ul>
                    {% } %}
                    <!-- {/literal}{/capture} -->

                </div>
            </div>
        </div>
        <div class="field-group">
            <h2 class="gray">2. [`Import options`]</h2>
            <div class="field">
                <div class="name">
                   [`Identification column`]
                </div>
                <div class="value no-shift">
                    <select name="primary" class="bold">
                        <option value="name">[`Product name`]</option>
                        <option value="skus:-1:sku">[`SKU code`]</option>
                        <option value="url">[`Storefront link`]</option>
                    </select>
                    &nbsp;
                    <span class="s-csv-primary-column-helper"></span>
                    <p class="hint">[`Select the product identification column (property) which uniquely identifies each product. Based on the identification column value in the CSV file uploaded, the import routine will either update existing product info, or create a new product.`]</p>
                </div>
            </div>
        </div>


        <div class="clear-left"></div>

        <div class="field-group" id="s-csvproduct-submit">
            <div class="field">
                <div class="value submit">
                    <input type="submit" class="button green" value="[`Start import`]">
                    <div class="js-progressbar-container" style="display:none;">
                        <div class="progressbar blue float-left" style="display: none; width: 70%;">
                            <div class="progressbar-outer">
                                <div class="progressbar-inner" style="width: 0%;"></div>
                            </div>
                        </div>
                        <img style="float:left; margin-top:8px;" src="{$wa_url}wa-content/img/loading32.gif" />
                        <div class="clear"></div>
                            <span class="progressbar-description"></span>
                        <br clear="left" />
                        <br>
                        <span class="small italic">
                            [`Please do not close your browser window and do not leave this page until the entire import process is finished.`]
                        </span>
                    </div><br><br>
                    <em class="errormsg"></em>
                </div>
            </div>
        </div>


        <div class="field-group" id="s-csvproduct-report" style="display: none;">
            <div class="field">
                <div class="value"></div>
            </div>
        </div>
    </div>
</form>
</div>

<div class="clear"></div>

<script type="text/javascript" src="{$wa_app_static_url}js/tmpl.min.js"></script>
<script type="text/javascript" src="{$wa_app_static_url}js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="{$wa_app_static_url}js/jquery.fileupload.js"></script>
<script type="text/javascript" src="{$wa_app_static_url}js/csv/csvproduct.js?{$wa->version()}"></script>

{foreach $smarty.capture as $name => $template} {if strpos($name,'template-js')}
<script type="text/x-jquery-tmpl" id="{$name}">
<!-- begin {$name} {$template|replace:'</':'<\\/'} end {$name} -->
</script>
{/if} {/foreach}

<script type="text/javascript">
{literal}if(typeof($)!='undefined') {$.importexport.csv_productInit();}{/literal}
</script>