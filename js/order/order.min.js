var $jscomp={scope:{},findInternal:function(c,a,b){c instanceof String&&(c=String(c));for(var d=c.length,e=0;e<d;e++){var f=c[e];if(a.call(b,f,e,c))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,a,b,d){if(a){b=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(c){function a(a){return c.data(a,"tooltip")}function b(b){a(this).delay?m=setTimeout(e,a(this).delay):e();q=!!a(this).track;c(document.body).bind("mousemove",f);f(b)}function d(){if(!c.tooltip.blocked&&this!=k&&(this.tooltipText||a(this).bodyHandler)){k=this;v=this.tooltipText;if(a(this).bodyHandler){g.title.hide();var d=a(this).bodyHandler.call(this);d.nodeType||d.jquery?g.body.empty().append(d):g.body.html(d);g.body.show()}else if(a(this).showBody){d=v.split(a(this).showBody);g.title.html(d.shift()).show();
g.body.empty();for(var e=0,f;f=d[e];e++)0<e&&g.body.append("<br/>"),g.body.append(f);g.body.hideWhenEmpty()}else g.title.html(v).show(),g.body.hide();a(this).showURL&&c(this).url()?g.url.html(c(this).url().replace("http://","")).show():g.url.hide();g.parent.addClass(a(this).extraClass);a(this).fixPNG&&g.parent.fixPNG();b.apply(this,arguments)}}function e(){m=null;n&&c.fn.bgiframe||!a(k).fade?g.parent.show():g.parent.is(":animated")?g.parent.stop().show().fadeTo(a(k).fade,k.tOpacity):g.parent.is(":visible")?
g.parent.fadeTo(a(k).fade,k.tOpacity):g.parent.fadeIn(a(k).fade);f()}function f(b){if(!(c.tooltip.blocked||b&&"OPTION"==b.target.tagName))if(!q&&g.parent.is(":visible")&&c(document.body).unbind("mousemove",f),null==k)c(document.body).unbind("mousemove",f);else{g.parent.removeClass("viewport-right").removeClass("viewport-bottom");var d=g.parent[0].offsetLeft,e=g.parent[0].offsetTop;b&&(d=b.pageX+a(k).left,e=b.pageY+a(k).top,b="auto",a(k).positionLeft&&(b=c(window).width()-d,d="auto"),g.parent.css({left:d,
right:b,top:e}));b=c(window).scrollLeft();var h=c(window).scrollTop(),v=c(window).width(),m=c(window).height(),r=g.parent[0];b+v<r.offsetLeft+r.offsetWidth&&(d-=r.offsetWidth+20+a(k).left,g.parent.css({left:d+"px"}).addClass("viewport-right"));h+m<r.offsetTop+r.offsetHeight&&(e-=r.offsetHeight+20+a(k).top,g.parent.css({top:e+"px"}).addClass("viewport-bottom"))}}function h(b){function d(){g.parent.removeClass(e.extraClass).hide().css("opacity","")}if(!c.tooltip.blocked){m&&clearTimeout(m);k=null;var e=
a(this);n&&c.fn.bgiframe||!e.fade?d():g.parent.is(":animated")?g.parent.stop().fadeTo(e.fade,0,d):g.parent.stop().fadeOut(e.fade,d);a(this).fixPNG&&g.parent.unfixPNG()}}var g={},k,v,m,n=c.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),q=!1;c.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){c.tooltip.blocked=!c.tooltip.blocked}};c.fn.extend({tooltip:function(a){a=c.extend({},c.tooltip.defaults,a);g.parent||
(g.parent=c('<div id="'+a.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),c.fn.bgiframe&&g.parent.bgiframe(),g.title=c("h3",g.parent),g.body=c("div.body",g.parent),g.url=c("div.url",g.parent));var b=this.each(function(){c.data(this,"tooltip",a);this.tOpacity=g.parent.css("opacity");this.tooltipText=this.title;c(this).removeAttr("title");this.alt=""}).mouseover(d).mouseout(h);a.noHideOnClick||b.click(h);return b},fixPNG:n?function(){return this.each(function(){var a=
c(this).css("backgroundImage");a.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(a=RegExp.$1,c(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"}).each(function(){var a=c(this).css("position");"absolute"!=a&&"relative"!=a&&c(this).css("position","relative")}))})}:function(){return this},unfixPNG:n?function(){return this.each(function(){c(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){c(this)[c(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
!function(c){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?c(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],c):c(jQuery)}(function(c){function a(a){a=a[0];return 0<a.offsetWidth&&0<a.offsetHeight}function b(a){if(a.minTime&&(a.minTime=t(a.minTime)),a.maxTime&&(a.maxTime=t(a.maxTime)),a.durationTime&&"function"!=typeof a.durationTime&&(a.durationTime=t(a.durationTime)),"now"==a.scrollDefault)a.scrollDefault=function(){return a.roundingFunction(t(new Date),
a)};else if(a.scrollDefault&&"function"!=typeof a.scrollDefault){var b=a.scrollDefault;a.scrollDefault=function(){return a.roundingFunction(t(b),a)}}else a.minTime&&(a.scrollDefault=function(){return a.roundingFunction(a.minTime,a)});if("string"===c.type(a.timeFormat)&&a.timeFormat.match(/[gh]/)&&(a._twelveHourTime=!0),!1===a.showOnFocus&&-1!=a.showOn.indexOf("focus")&&a.showOn.splice(a.showOn.indexOf("focus"),1),0<a.disableTimeRanges.length){for(var d in a.disableTimeRanges)a.disableTimeRanges[d]=
[t(a.disableTimeRanges[d][0]),t(a.disableTimeRanges[d][1])];a.disableTimeRanges=a.disableTimeRanges.sort(function(a,c){return a[0]-c[0]});for(d=a.disableTimeRanges.length-1;0<d;d--)a.disableTimeRanges[d][0]<=a.disableTimeRanges[d-1][1]&&(a.disableTimeRanges[d-1]=[Math.min(a.disableTimeRanges[d][0],a.disableTimeRanges[d-1][0]),Math.max(a.disableTimeRanges[d][1],a.disableTimeRanges[d-1][1])],a.disableTimeRanges.splice(d,1))}return a}function d(a){var b=a.data("timepicker-settings"),d=a.data("timepicker-list");
if(d&&d.length&&(d.remove(),a.data("timepicker-list",!1)),b.useSelect)var k=d=c("<select />",{"class":"ui-timepicker-select"});else d=c("<ul />",{"class":"ui-timepicker-list"}),k=c("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),k.css({display:"none",position:"absolute"}).append(d);if(b.noneOption)if(!0===b.noneOption&&(b.noneOption=b.useSelect?"Time...":"None"),c.isArray(b.noneOption))for(var p in b.noneOption){if(parseInt(p,10)==p){var h=e(b.noneOption[p],b.useSelect);d.append(h)}}else h=
e(b.noneOption,b.useSelect),d.append(h);(b.className&&k.addClass(b.className),null===b.minTime&&null===b.durationTime||!b.showDuration)||("function"==typeof b.step?"function":b.step,k.addClass("ui-timepicker-with-duration"),k.addClass("ui-timepicker-step-"+b.step));h=b.minTime;"function"==typeof b.durationTime?h=t(b.durationTime()):null!==b.durationTime&&(h=b.durationTime);p=null!==b.minTime?b.minTime:0;var m=null!==b.maxTime?b.maxTime:p+w-1;p>m&&(m+=w);m===w-1&&"string"===c.type(b.timeFormat)&&b.show2400&&
(m=w);var r=b.disableTimeRanges,n=0,E=r.length,l=b.step;"function"!=typeof l&&(l=function(){return b.step});for(var y=0;m>=p;y++,p+=60*l(y)){var A=p,D=z(A,b);if(b.useSelect)var x=c("<option />",{value:D});else x=c("<li />"),x.addClass(43200>A%86400?"ui-timepicker-am":"ui-timepicker-pm"),x.data("time",86400>=A?A:A%86400);x.text(D);if((null!==b.minTime||null!==b.durationTime)&&b.showDuration)if(D=B(p-h,b.step),b.useSelect)x.text(x.text()+" ("+D+")");else{var G=c("<span />",{"class":"ui-timepicker-duration"});
G.text(" ("+D+")");x.append(G)}E>n&&(A>=r[n][1]&&(n+=1),r[n]&&A>=r[n][0]&&A<r[n][1]&&(b.useSelect?x.prop("disabled",!0):x.addClass("ui-timepicker-disabled")));d.append(x)}(k.data("timepicker-input",a),a.data("timepicker-list",k),b.useSelect)?(a.val()&&d.val(f(t(a.val()),b)),d.on("focus",function(){c(this).data("timepicker-input").trigger("showTimepicker")}),d.on("blur",function(){c(this).data("timepicker-input").trigger("hideTimepicker")}),d.on("change",function(){q(a,c(this).val(),"select")}),q(a,
d.val(),"initial"),a.hide().after(d)):(p=b.appendTo,"string"==typeof p?p=c(p):"function"==typeof p&&(p=p(a)),p.append(k),v(a,d),d.on("mousedown click","li",function(b){a.off("focus.timepicker");a.on("focus.timepicker-ie-hack",function(){a.off("focus.timepicker-ie-hack");a.on("focus.timepicker",u.show)});g(a)||a[0].focus();d.find("li").removeClass("ui-timepicker-selected");c(this).addClass("ui-timepicker-selected");C(a)&&(a.trigger("hideTimepicker"),d.on("mouseup.timepicker click.timepicker","li",
function(a){d.off("mouseup.timepicker click.timepicker");k.hide()}))}))}function e(a,b){var d,e,f;return"object"==typeof a?(d=a.label,e=a.className,f=a.value):"string"==typeof a?d=a:c.error("Invalid noneOption value"),b?c("<option />",{value:f,"class":e,text:d}):c("<li />",{"class":e,text:d}).data("time",String(f))}function f(a,c){return a=c.roundingFunction(a,c),null!==a?z(a,c):void 0}function h(a){a.target!=window&&(a=c(a.target),a.closest(".ui-timepicker-input").length||a.closest(".ui-timepicker-wrapper").length||
(u.hide(),c(document).unbind(".ui-timepicker"),c(window).unbind(".ui-timepicker")))}function g(a){a=a.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&a.disableTouchKeyboard}function k(a,b,d){if(!d&&0!==d)return!1;a=a.data("timepicker-settings");var e=!1;d=a.roundingFunction(d,a);return b.find("li").each(function(a,b){var f=c(b);if("number"==typeof f.data("time"))return f.data("time")==d?(e=f,!1):void 0}),e}function v(a,c){c.find("li").removeClass("ui-timepicker-selected");
var b=t(n(a),a.data("timepicker-settings"));if(null!==b&&(b=k(a,c,b))){var d=b.offset().top-c.offset().top;(d+b.outerHeight()>c.outerHeight()||0>d)&&c.scrollTop(c.scrollTop()+b.position().top-b.outerHeight());b.addClass("ui-timepicker-selected")}}function m(a,b){if(""!==this.value&&"timepicker"!=b){var d=c(this);if(!d.is(":focus")||a&&"change"==a.type){var e=d.data("timepicker-settings"),f=t(this.value,e);if(null===f)return void d.trigger("timeFormatError");var g=!1;if(null!==e.minTime&&null!==e.maxTime&&
(f<e.minTime||f>e.maxTime)&&(g=!0),c.each(e.disableTimeRanges,function(){return f>=this[0]&&f<this[1]?(g=!0,!1):void 0}),e.forceRoundTime){var k=e.roundingFunction(f,e);k!=f&&(f=k,b=null)}e=z(f,e);g?q(d,e,"error")&&d.trigger("timeRangeError"):q(d,e,b)}}}function n(a){return a.is("input")?a.val():a.data("ui-timepicker-value")}function q(a,c,b){if(a.is("input")){a.val(c);var d=a.data("timepicker-settings");d.useSelect&&"select"!=b&&"initial"!=b&&a.data("timepicker-list").val(f(t(c),d))}return a.data("ui-timepicker-value")!=
c?(a.data("ui-timepicker-value",c),"select"==b?a.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(b)&&a.trigger("changeTime"),!0):(a.trigger("selectTime"),!1)}function r(a){switch(a.keyCode){case 13:case 9:break;default:a.preventDefault()}}function E(b){var d=c(this),e=d.data("timepicker-list");if(!e||!a(e)){if(40!=b.keyCode)return!0;u.show.call(d.get(0));e=d.data("timepicker-list");g(d)||d.focus()}switch(b.keyCode){case 13:return C(d)&&(m.call(d.get(0),
{type:"change"}),u.hide.apply(this)),b.preventDefault(),!1;case 38:var f=e.find(".ui-timepicker-selected");return f.length?f.is(":first-child")||(f.removeClass("ui-timepicker-selected"),f.prev().addClass("ui-timepicker-selected"),f.prev().position().top<f.outerHeight()&&e.scrollTop(e.scrollTop()-f.outerHeight())):(e.find("li").each(function(a,b){return 0<c(b).position().top?(f=c(b),!1):void 0}),f.addClass("ui-timepicker-selected")),!1;case 40:return f=e.find(".ui-timepicker-selected"),0===f.length?
(e.find("li").each(function(a,b){return 0<c(b).position().top?(f=c(b),!1):void 0}),f.addClass("ui-timepicker-selected")):f.is(":last-child")||(f.removeClass("ui-timepicker-selected"),f.next().addClass("ui-timepicker-selected"),f.next().position().top+2*f.outerHeight()>e.outerHeight()&&e.scrollTop(e.scrollTop()+f.outerHeight())),!1;case 27:e.find("li").removeClass("ui-timepicker-selected");u.hide();break;case 9:u.hide();break;default:return!0}}function y(b){var d=c(this),e=d.data("timepicker-list"),
f=d.data("timepicker-settings");if(!e||!a(e)||f.disableTextInput)return!0;switch(b.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:f.typeaheadHighlight?v(d,e):e.hide()}}function C(a){var c=a.data("timepicker-settings"),b=null,d=a.data("timepicker-list").find(".ui-timepicker-selected");return d.hasClass("ui-timepicker-disabled")?
!1:(d.length&&(b=d.data("time")),null!==b&&("string"!=typeof b&&(b=z(b,c)),q(a,b,"select")),!0)}function B(a,c){a=Math.abs(a);var b,d,e=Math.round(a/60),f=[];return 60>e?f=[e,l.mins]:(b=Math.floor(e/60),d=e%60,30==c&&30==d&&(b+=l.decimal+5),f.push(b),f.push(1==b?l.hr:l.hrs),30!=c&&d&&(f.push(d),f.push(l.mins))),f.join(" ")}function z(a,b){if("number"!=typeof a)return null;var d=parseInt(a%60),e=parseInt(a/60%60),f=parseInt(a/3600%24),f=new Date(1970,0,2,f,e,d,0);if(isNaN(f.getTime()))return null;
if("function"===c.type(b.timeFormat))return b.timeFormat(f);for(var g="",k=0;k<b.timeFormat.length;k++)switch(d=b.timeFormat.charAt(k)){case "a":g+=11<f.getHours()?l.pm:l.am;break;case "A":g+=11<f.getHours()?l.PM:l.AM;break;case "g":d=f.getHours()%12;g+=0===d?"12":d;break;case "G":d=f.getHours();a===w&&(d=b.show2400?24:0);g+=d;break;case "h":d=f.getHours()%12;0!==d&&10>d&&(d="0"+d);g+=0===d?"12":d;break;case "H":d=f.getHours();a===w&&(d=b.show2400?24:0);g+=9<d?d:"0"+d;break;case "i":e=f.getMinutes();
g+=9<e?e:"0"+e;break;case "s":d=f.getSeconds();g+=9<d?d:"0"+d;break;case "\\":k++;g+=b.timeFormat.charAt(k);break;default:g+=d}return g}function t(a,c){if(""===a||null===a)return null;if("object"==typeof a)return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds();if("string"!=typeof a)return a;a=a.toLowerCase().replace(/[\s\.]/g,"");"a"!=a.slice(-1)&&"p"!=a.slice(-1)||(a+="m");var b="("+l.am.replace(".","")+"|"+l.pm.replace(".","")+"|"+l.AM.replace(".","")+"|"+l.PM.replace(".","")+")?",d=a.match(new RegExp("^"+
b+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+b+"$"));if(!d)return null;b=parseInt(1*d[2],10);if(24<b){if(c&&!1===c.wrapHours)return null;b%=24}var e=d[1]||d[5],f=b;12>=b&&e&&(f=e==l.pm||e==l.PM,f=12==b?f?12:0:b+(f?12:0));d=3600*f+60*(1*d[3]||0)+(1*d[4]||0);12>b&&!e&&c&&c._twelveHourTime&&c.scrollDefault&&(b=d-c.scrollDefault(),0>b&&b>=w/-2&&(d=(d+w/2)%w));return d}var w=86400,l={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},u={init:function(a){return this.each(function(){var e=
c(this),f=[],g;for(g in c.fn.timepicker.defaults)e.data(g)&&(f[g]=e.data(g));f=c.extend({},c.fn.timepicker.defaults,f,a);if(f.lang&&(l=c.extend(l,f.lang)),f=b(f),e.data("timepicker-settings",f),e.addClass("ui-timepicker-input"),f.useSelect)d(e);else{if(e.prop("autocomplete","off"),f.showOn)for(var k in f.showOn)e.on(f.showOn[k]+".timepicker",u.show);e.on("change.timepicker",m);e.on("keydown.timepicker",E);e.on("keyup.timepicker",y);f.disableTextInput&&e.on("keydown.timepicker",r);m.call(e.get(0),
null,"initial")}})},show:function(b){var e=c(this),f=e.data("timepicker-settings");if(b&&b.preventDefault(),f.useSelect)return void e.data("timepicker-list").focus();g(e)&&e.blur();b=e.data("timepicker-list");if(!e.prop("readonly")&&(b&&0!==b.length&&"function"!=typeof f.durationTime||(d(e),b=e.data("timepicker-list")),!a(b))){e.data("ui-timepicker-value",e.val());v(e,b);u.hide();b.show();var m={};f.orientation.match(/r/)?m.left=e.offset().left+e.outerWidth()-b.outerWidth()+parseInt(b.css("marginLeft").replace("px",
""),10):m.left=e.offset().left+parseInt(b.css("marginLeft").replace("px",""),10);"t"==(f.orientation.match(/t/)?"t":f.orientation.match(/b/)?"b":e.offset().top+e.outerHeight(!0)+b.outerHeight()>c(window).height()+c(window).scrollTop()?"t":"b")?(b.addClass("ui-timepicker-positioned-top"),m.top=e.offset().top-b.outerHeight()+parseInt(b.css("marginTop").replace("px",""),10)):(b.removeClass("ui-timepicker-positioned-top"),m.top=e.offset().top+e.outerHeight()+parseInt(b.css("marginTop").replace("px",""),
10));b.offset(m);m=b.find(".ui-timepicker-selected");if(!m.length){var p=t(n(e));null!==p?m=k(e,b,p):f.scrollDefault&&(m=k(e,b,f.scrollDefault()))}m&&m.length?(m=b.scrollTop()+m.position().top-m.outerHeight(),b.scrollTop(m)):b.scrollTop(0);return f.stopScrollPropagation&&c(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(a){a.preventDefault();var b=c(this).scrollTop();c(this).scrollTop(b+a.originalEvent.deltaY)}),c(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
h),c(window).on("resize.ui-timepicker",h),f.closeOnWindowScroll&&c(document).on("scroll.ui-timepicker",h),e.trigger("showTimepicker"),this}},hide:function(b){b=c(this);var d=b.data("timepicker-settings");return d&&d.useSelect&&b.blur(),c(".ui-timepicker-wrapper").each(function(){var b=c(this);if(a(b)){var d=b.data("timepicker-input"),e=d.data("timepicker-settings");e&&e.selectOnBlur&&C(d);b.hide();d.trigger("hideTimepicker")}}),this},option:function(a,e){return"string"==typeof a&&"undefined"==typeof e?
c(this).data("timepicker-settings")[a]:this.each(function(){var f=c(this),g=f.data("timepicker-settings"),k=f.data("timepicker-list");"object"==typeof a?g=c.extend(g,a):"string"==typeof a&&(g[a]=e);g=b(g);f.data("timepicker-settings",g);k&&(k.remove(),f.data("timepicker-list",!1));g.useSelect&&d(f)})},getSecondsFromMidnight:function(){return t(n(this))},getTime:function(a){var b=n(this);if(!b)return null;b=t(b);if(null===b)return null;a||(a=new Date);a=new Date(a);return a.setHours(b/3600),a.setMinutes(b%
3600/60),a.setSeconds(b%60),a.setMilliseconds(0),a},isVisible:function(){var b=this.data("timepicker-list");return!(!b||!a(b))},setTime:function(a){var b=this.data("timepicker-settings"),c=b.forceRoundTime?f(t(a),b):z(t(a),b);return a&&null===c&&b.noneOption&&(c=a),q(this,c),this.data("timepicker-list")&&v(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var a=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),a.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};c.fn.timepicker=function(a){return this.length?u[a]?this.hasClass("ui-timepicker-input")?u[a].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof a&&a?void c.error("Method "+a+" does not exist on jQuery.timepicker"):u.init.apply(this,arguments):this};c.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(a,b){if(null===a)return null;if("number"!=typeof b.step)return a;var c=a%(60*b.step);return c>=30*b.step?a+=60*b.step-c:a-=c,a==w&&b.show2400?a:a%w},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(c){var a=function(b,c,e){var d=/[^\w\-\.:]/.test(b)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+b.replace(a.regexp,a.func)+"';return _s;"):e?a.cache[b]=a(a.load(b)):a.cache[b]=a.cache[b]||a(a.load(b));return c?d(c,a):function(b){return d(b,a)}};a.cache={};a.load=function(a){var b=document.getElementById(a),c=/<\\\/(\w+)/g;if(!b&&console)throw{message:"template with id="+a+" not found"};return b?("textarea"==b.tagName.toLowerCase()?b.value:document.getElementById(a).innerHTML).replace(c,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(a,c,e,f,h,g){if(c)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[a]||"\\"+a;if(e)return"="===e?"'+_e("+f+")+'":"'+("+f+"||'')+'";if(h)return"';";if(g)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(b){return String(b||"").replace(a.encReg,function(b){return a.encMap[b]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):c.tmpl=a})(this);(function(c){c.fn.lazyLoad=function(a,b){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&g(h,f)<=e.distance){if(null!==e.hash){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(a)){this.onscroll=null;return}}e.load()}}if("stop"==a){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==a){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==a){if(e=this.data("lazyLoadSettings"))e.loading=
!0}else if("wake"==a){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==a)(e=this.data("lazyLoadSettings"))&&(e.loading||e.load());else{if("get"===a)return e=this.data("lazyLoadSettings")||{},e[b];this.data("lazyLoadSettings",c.extend({distance:50,load:function(){},container:h,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var f=c(window),h=e.container||c(this);
null===e.hash||c.isArray(e.hash)||(e.hash=[e.hash]);c.fn.lazyLoad.call(f,e.state);(function(){var a,b=setTimeout(a=function(){if(e.stopped)clearTimeout(b);else{if(null!==e.hash){var c=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(c)){clearTimeout(b);return}}e.loading?b=setTimeout(a,350):(g(h,f),g(h,f)<=e.distance?(e.load(),b=setTimeout(a,350)):(f.get(0).onscroll=d,clearTimeout(b)))}},350)})();var g="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:
function(a,b,d){a="string"===typeof a?c(a):a;d=d||0;return a.position().top+a.outerHeight()-d-(b.scrollTop()+b.height())}}}})(jQuery);(function(c){c.storage=new c.store;c.orders={options:{view:"table"},init:function(a){var b=this;b.options=a;"undefined"!=typeof c.History&&c.History.bind(function(){b.dispatch()});c.ajaxPrefilter(function(a,b,c){c.originalRequestOptions=b});c.wa.errorHandler=function(a){var b=a.originalRequestOptions||{};if(403===a.status||404===a.status){a=c(a.responseText);a=a.find(".dialog-content").length?c('<div class="block double-padded"></div>').append(a.find(".dialog-content *")):c('<div class="block double-padded"></div>').append(a.find(":not(style)"));
var d="content",b=b.url||"";if(0<b.length){var h=b.indexOf("?");-1!==h&&(b=b.substr(h+1),b=c.shop.helper.parseParams(b)||{},"order"===b.module&&"table"!==b.view&&c("#s-order").length&&(d="order"))}"order"===d?c("#s-order").empty().append(a):(c("#s-content").empty().append(a),c.order_list&&c.order_list.finit());return!1}return!0};a=window.location.hash;"#/"!==a&&a?c.wa.setHash(a):this.dispatch();this.initSearch();c(document).bind("wa.appcount",function(a,b){b=b||{};var d=parseInt(b.shop,10);c("#s-pending-orders .small").text(d?
"+"+d:"");var e=document.title.match(/\(\d+\) /);e?document.title=document.title.replace(e[0],d?"("+d+") ":""):d&&(document.title="("+d+") "+document.title)});c(function(){c("#maincontent").on("click",".s-alert-close",function(){var a=c.storage.get("shop/alerts"),b=c(this).parent();a||(a=[]);a.push(b.data("alert"));a=a.filter(function(a,b,c){return null!=a&&b==c.indexOf(a)});c.storage.set("shop/alerts",a);b.remove();return!1})});this.checkAlerts()},initSearch:function(){var a=c("#s-orders-search"),
b=[],d=null,e=function(b){switch(b.autocomplete_item_type){case "order":c.wa.setHash("#/order/"+b.id+"/");a.val(b.value);break;case "contact":c.wa.setHash("#/orders/contact_id="+b.id+"/");a.val(b.value);break;case "product":c.wa.setHash("#/orders/product_id="+b.id+"/");a.val(b.value);break;case "coupon":c.wa.setHash("#/orders/coupon_id="+b.id+"/");break;case "tracking_number":c.wa.setHash("#/orders/tracking_number="+b.value+"/");break;case "shipping":c.wa.setHash("#/orders/shipping_id="+b.id+"/");
break;case "payment":c.wa.setHash("#/orders/payment_id="+b.id+"/");break;case "city":c.wa.setHash("#/orders/city="+b.value+"/");break;case "region":c.wa.setHash("#/orders/region="+((b.value||"").split(":")[1]||"")+"/");break;case "country":c.wa.setHash("#/orders/country="+b.value+"/")}};a.unbind("keydown").bind("keydown",function(a){if(13==a.keyCode||10==a.keyCode){if(d)return!1;var f=c(this);if(!c(this).val())return location.hash="#/orders/all/",f.autocomplete("close"),!1;if(b&&c.isArray(b)&&b.length)return e(b[0]),
setTimeout(function(){f.autocomplete("close")},150),!1}});a.autocomplete({minLength:1,delay:300,html:!0,select:function(a,b){e(b.item);return!1},source:function(a,e){d&&d.abort();d=c.getJSON("?action=autocomplete&type=order",a,function(a){b=a;e(a)}).always(function(){d=null})}})},prevHash:null,hash:null,skipDispatch:0,stopDispatch:function(a){this.skipDispatch=a},forceHash:function(a){location.hash!=a&&(this.skipDispatch++,c.wa.setHash(a))},dispatch:function(a){if(0<this.skipDispatch)return this.skipDispatch--,
!1;if(void 0===a||null===a)a=window.location.hash;a=a.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);this.hash=a;var b=new c.Event("wa_before_dispatched");c(window).trigger(b);if(a)if(a=a.split("/"),a[0]){var b="",d,e=null,f=null;for(d=0;d<a.length;d++){var h=a[d];if(2>d){if(0===d)b=h;else if(parseInt(h,10)!=h&&-1==h.indexOf("="))b+=h.substr(0,1).toUpperCase()+h.substr(1);else break;"function"==typeof this[b+"Action"]&&(e=b,f=d+1)}else break}"function"!==typeof this[b+
"Action"]&&e&&(b=e,d=f);a=a.slice(d);this.preExecute(b);"function"==typeof this[b+"Action"]?(c.shop.trace("$.orders.dispatch",[b+"Action",a]),this[b+"Action"].apply(this,a)):c.shop.error("Invalid action name:",b+"Action");this.postExecute(b)}else this.preExecute(),this.defaultAction(),this.postExecute();else this.preExecute(),this.defaultAction(),this.postExecute()},back:function(){var a=c.orders.prevHash||"";location.hash=a?a+"/":""},preExecute:function(a,b){},postExecute:function(a,b){this.actionName=
a},defaultAction:function(){this.ordersAction()},couponsAction:function(){c.order_list&&c.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(a){this.load("?module=order&action=edit&id="+a,function(){c.order_list&&c.order_list.finit()})},ordersNewAction:function(a){this.load("?module=order&action=edit"+(a?"&"+a:""),function(){c.order_list&&c.order_list.finit()})},ordersAction:function(a){if("hash"===a)a={hash:Array.prototype.slice.call(arguments,1).join("/")};else{var b="";
"search"===a&&(b=Array.prototype.slice.call(arguments,1));1<arguments.length&&(a=Array.prototype.join.call(arguments,"/"));a?"all"===a&&(a=""):a="state_id=new|processing|auth|paid";a=c.shop.helper.parseParams(a||"");a.view||(a.view=c.storage.get("shop/orders/view")||this.options.view);c.storage.set("shop/orders/view",a.view);c.order_edit&&c.order_edit.slideBack();b&&(a.search=b)}"orders"===this.actionName&&c.order_list?c.order_list.dispatch(a):(c.order_list&&c.order_list.finit(),this.load("?module=orders&"+
this.buildOrdersUrlComponent(a),function(){c.order_list&&c.order_list.dispatch(a)}))},orderAction:function(a,b){b=c.shop.helper.parseParams(b||"");b.view||(b.view=c.storage.get("shop/orders/view")||this.options.view);c.storage.set("shop/orders/view",b.view);c.order_edit&&c.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(a)+"&"+this.buildOrdersUrlComponent(b),function(){var a=c("#s-content").find("h1 a.back.order-list");a.show();var b=c("#s-all-orders");b.length&&b.hasClass("selected")&&
(b=b.find("a:first"),b.length&&a.attr("href",b.attr("href")))});c.order_list&&c.order_list.finit()},buildOrdersUrlComponent:function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&"view"!==c&&(b+="&"+c+"="+a[c]);return"view="+(a.view||this.options.view)+b},load:function(a,b,d){function e(){var a=c("#s-orders-views"),b=c("#s-order, #s-orders").length;a.length&&(b?a.css("visibility","visible"):a.css("visibility","hidden"))}function f(){var a=c("#s-orders-sort"),b=c("#s-order, #s-orders").length;a.length&&
(b?a.css("visibility","visible"):a.css("visibility","hidden"))}"function"===typeof b?(d=b,b={}):b=b||{};var h=Math.random();this.random=h;var g=this;return c.get(a,function(a){if("undefined"!==typeof b.check&&!b.check||g.random==h){(b.content||c("#s-content")).removeClass("bordered-left").html(a);"function"===typeof d&&d.call(this);var k=c(window);setTimeout(function(){k.trigger("scroll")},250);e();f();c(".level2").show();c("#s-sidebar").width(200).show();g.checkAlerts()}})},checkAlerts:function(){var a=
c.storage.get("shop/alerts");c.shop.trace("checkAlerts",a);c(".s-alert").each(function(){-1==c.inArray(c(this).data("alert"),a)&&c(this).show()})}}})(jQuery);(function(c){c.order_list={id:0,options:{},container:null,$selectionMenu:null,sidebar:null,select_all_input:null,filter_params:{},filter_params_str:"",params:null,timer_id:0,lazy_load_win:null,all_printforms:null,sort:["create_datetime","desc"],xhrs:{lazy_load:null,update_load:null,printforms:null},init:function(a){this.options=a=a||{};this.filter_params=a.filter_params||{};this.filter_params_str=a.filter_params_str||"";this.container=c("#order-list");"table"==a.view&&(this.container=c("#order-list").find("tbody:first"),
this.$selectionMenu=this.options.$selectionMenu)&&(c("#mainmenu .s-level2").append(this.$selectionMenu),this.select_all_input=this.$selectionMenu.find(".s-order-list-select-all"),this.select_all_input.attr("checked",!1));this.options.all_order_state_ids=this.options.all_order_state_ids||null;this.sidebar=c("#s-sidebar");this.id=a.id||0;if(a.orders&&a.orders.length&&a.view){try{this.container.append(tmpl("template-order-list-"+this.options.view,{orders:a.orders},!0)),this.container.trigger("append_order_list",
[a.orders])}catch(d){return console&&console.log(d.stack),this}delete a.orders;delete this.options.orders}a.lazy_loading&&this.initLazyLoad(a.lazy_loading);a.counters&&this.updateCounters(a.counters);a.update_process&&a.count&&this.updateProcess("run",a.update_process);if(a.sort&&a.sort[0]){a.sort[0]=""+a.sort[0];var b=c("#s-orders-sort .s-sort").map(function(){var a=c(this).data("sort")||"";return a?a:!1}).toArray();0>b.indexOf(a.sort[0])&&(a.sort[0]=b[0]);a.sort[1]=a.sort[1]||"";a.sort[1]="desc"===
a.sort[1].toLowerCase()?"desc":"asc";this.sort=a.sort}this.initView()},initLazyLoad:function(a){var b=this,d=b.options.count,e=b.options.total_count,f=c(window);f.lazyLoad("stop");d<e&&(f.lazyLoad({container:this.options.view?b.container:f,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:["orders",""],load:function(){f.lazyLoad("sleep");c(".lazyloading-link").hide();c(".lazyloading-progress").show();var a=b.container.find(".order:last"),d=parseInt(a.attr("data-order-id"),10);if(d){var e=
function(){return c.getJSON(b.buildLoadListUrl(d),function(a){if("ok"==a.status){try{b.container.append(tmpl("template-order-list-"+b.options.view,{orders:a.data.orders,check_all:"table"==b.options.view?b.select_all_input.attr("checked"):!1})),b.container.trigger("append_order_list",[a.data.orders]),b.container.find("[data-order-id="+b.options.id+"]").length&&(b.container.find(".selected").removeClass("selected"),b.container.find("[data-order-id="+b.options.id+"]").addClass("selected"))}catch(m){console&&
console.log(m.stack);f.lazyLoad("stop");return}c(".lazyloading-progress-string").text(a.data.progress.loaded+" "+a.data.progress.of);c(".lazyloading-progress").hide();c(".lazyloading-chunk").text(a.data.progress.chunk);a.data.loaded>=a.data.total_count?(f.lazyLoad("stop"),c(".lazyloading-link").hide()):(c(".lazyloading-link").show(),f.lazyLoad("wake"))}else console&&console.log("Error when loading orders: "+a.errors),f.lazyLoad("stop")}).error(function(a){console&&(a&&a.errors?console.log("Error when loading orders: "+
a.errors):a?console.log(a):console.log("Error when loading orders"));f.lazyLoad("stop")})};null===b.xhrs.update_load?b.xhrs.lazy_load=e():b.xhrs.update_load.then(function(){b.xhrs.lazy_load=e()})}else console.log("Unkown last item"),f.lazyLoad("stop")}}),c("#s-orders").off("click",".lazyloading-link").on("click",".lazyloading-link",function(){f.lazyLoad("force");return!1}),this.lazy_load_win=f)},initView:function(){function a(a){var d=c.order_list.getSelectedOrders(),f=function(){b.$selectionMenu.addClass("s-disabled");
b.$selectionMenu.find(".js-selection-menu-loading").show();b.select_all_input.attr("disabled",!0);e(a,d,function(){b.$selectionMenu.removeClass("s-disabled");b.$selectionMenu.find(".js-selection-menu-loading").hide();b.select_all_input.removeAttr("disabled");b.select_all_input.trigger("select",!1);c.orders.dispatch()})};d.all?confirm($_("Perform action to all selected orders?"))&&f():f()}var b=this;this.initSortMenu();this.initSidebar();"table"==this.options.view&&b.$selectionMenu&&b.$selectionMenu.length&&
this.initSelecting();this.options.id&&this.loadOrder(this.options.id);var d=c("#s-orders-views");d.find("li.selected").removeClass("selected");d.find('li[data-view="'+this.options.view+'"]').addClass("selected");d.find("li a").each(function(){var a=c(this),b=c(this).parents("li:first");a.attr("href","#/orders/view="+b.attr("data-view")+(c.order_list.options.filter_params_str?"&"+c.order_list.options.filter_params_str:"")+"/")});var e=function(a,d,e){var f=function(){var a=c(window),e=c.Deferred();
if(!d.all||!b.options.lazy_loading||a.lazyLoad("get","stopped"))return e.resolve(),e;b.container.one("append_order_list.ensureOrderListChunkLoaded",function(){e.resolve()});setTimeout(function(){b.container.off("append_order_list.ensureOrderListChunkLoaded");e.resolve()},2E3);a.lazyLoad("force");return e},g=function(a){var d=c.Deferred();if(c.isEmptyObject(a.data.orders))return d.resolve(),d;b.container.one("append_order_list.updateOrderListChunk",function(){d.resolve()});setTimeout(function(){b.container.off("append_order_list.updateOrderListChunk");
d.resolve()},1E3);b.updateListItems(a.data.orders);return d},h=function(a){var d=c.Deferred(),e=function(){if(!b.container.find(".order:not(:hidden):first").length){var a='<div class="block double-padded align-center blank"><br><br><br><br><span class="gray large">'+$_("There are no orders in this view.")+'</span><div class="clear-left"></div></div></div>';c("#s-content").html(a)}},f=[],g=b.filter_params;if(!c.isEmptyObject(a.data.orders))for(var k=0,h=a.data.orders.length;k<h;k++)!c.isEmptyObject(g)&&
g.state_id&&("string"===c.type(g.state_id)&&g.state_id!==a.data.orders[k].state_id?f.push(a.data.orders[k].id):"array"===c.type(g.state_id)&&-1===g.state_id.indexOf(a.data.orders[k].state_id)&&f.push(a.data.orders[k].id));c.isEmptyObject(f)?(e(),d.resolve()):(b.hideListItems(f).done(function(){e();d.resolve()}),setTimeout(function(){d.resolve()},1E3));return d},n=function(a){var b=c.Deferred();f().done(function(){g(a).done(function(){h(a).done(function(){c.order_list.updateCounters({state_counters:a.data.state_counters,
common_counters:{pending:a.data.pending_count}});b.resolve()})})});return b},q=function(e,f){c.shop.jsonPost("?module=orders&action=performAction&id="+a+"&offset="+(e||0)+"&"+b.options.filter_params_str,d,function(a){"ok"===a.status?n(a).done(function(){a.data.offset<a.data.total_count?q(a.data.offset,f):f(a)}):f(a)})};q(0,e)};if(b.$selectionMenu)b.$selectionMenu.off("click.order_list",".js-wf-action-item").on("click.order_list",".js-wf-action-item",function(){var b=c(this),d=b.data("action-id");
if(!b.hasClass("s-disabled"))return d&&a(d),!1})},loadOrder:function(a){this.container.find(".selected").removeClass("selected");this.container.find("[data-order-id="+a+"]").addClass("selected");c("#s-order-title").find(".loading").show();c.orders.load("?module=order&id= "+a+"&"+this.filter_params_str,{content:c("#s-order")},function(){this.id=a})},getSelectedOrders:function(a){a=a||!1;var b={count:0,all:!1};if(this.select_all_input.attr("checked")){b.all=!0;var d=c.order_list.filter_params;a?(b.serialized=
[],c.isEmptyObject(d)?b.serialized.push({name:"filter_params",value:""}):c.each(d,function(a,d){c.isArray(d)?c.each(d,function(c,d){b.serialized.push({name:"filter_params["+a+"]["+c+"]",value:d})}):b.serialized.push({name:"filter_params["+a+"]",value:d})})):b.filter_params=c.isEmptyObject(d)?"":d;b.count=this.options.total_count}else a?b.serialized=c.order_list.container.find(".order.selected").map(function(){b.count+=1;return{name:"order_id[]",value:c(this).attr("data-order-id")}}).toArray():b.order_id=
c.order_list.container.find(".order.selected").map(function(){b.count+=1;return c(this).attr("data-order-id")}).toArray();return b},initSortMenu:function(){var a=c("#s-orders-sort"),b=function(b,e){var d=b[0],h=b[1],g=c('.s-sort[data-sort="'+d+'"] a',a).text();a.find(".s-current-sort").data("sort",d);a.find(".s-current-sort").data("order",h);a.find(".s-current-sort .f-text").text(g);a.find(".s-sort-order").hide().filter('[data-order="'+h+'"]').show();if(e){g=window.location.hash||"";g=g.replace(/(^[^#]*#\/*|\/$)/g,
"");g.split("/")[1]||(g="#/orders/state_id=new|processing|auth|paid");var g=g.replace(/(&*sort\[[01]\]=.*?[&\/]|&*sort\[[01]\]=.*?$)/g,""),k=0<g.indexOf("=");k&&(g=g.replace(/[\/&]$/,""));c.wa.setHash(g+((k?"&":"")+"sort[0]="+d+"&sort[1]="+h+"/"))}};b(this.sort);a.data("inited")||(a.find(".s-sort a").click(function(){var d=c(this),e=a.find(".s-current-sort").data(),f=e.sort,e=e.order;d.data("sort")===f?e="desc"===e?"asc":"desc":(f=d.data("sort"),e="desc");b([f,e],!0)}),a.data("inited",1))},initSidebar:function(){var a=
this.sidebar,b=this.options.view;a.find("li.list a").each(function(){var a=c(this),d=a.attr("href"),h=d.match(/view=((.*)&|(.*)\/|(.*))/);if(h)a.attr("href",d.replace("view="+(h[2]||h[3]||h[4]),"view="+b));else if(h=d.match(/^#\/orders\/hash\/(.*?)\/?$/))a.attr("href","#/orders/view="+b+"&hash="+encodeURIComponent(h[1])+"/");else if(h=d.match(/orders\/((.*)\/|(.*))/))h[1]?(d=h[2]||h[3],d+="&view="+b):d="view="+b,a.attr("href","#/orders/"+d+"/")});var d=a.find("li.selected").removeClass("selected");
this.filter_params.state_id?c.isArray(this.filter_params.state_id)?c("#s-pending-orders").addClass("selected"):a.find('li[data-state-id="'+this.filter_params.state_id+'"]').addClass("selected"):this.filter_params.contact_id?a.find("li[data-contact-id="+this.filter_params.contact_id+"]").addClass("selected"):this.filter_params.storefront?(d=decodeURIComponent(this.filter_params.storefront),"/"===d.slice(-1)&&(d=d.slice(0,-1)),a.find('li[data-storefront="'+d+'"]').addClass("selected")):c.order_list.filter_params_str?
a.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||d.addClass("selected"):c("#s-all-orders").addClass("selected");a.find("li.list a").unbind("click.order_list").bind("click.order_list",function(){a.find("li.selected").removeClass("selected");c(this).closest("li").addClass("selected");if(c(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==c.orders.hash){var b=c.orders.hash.replace("orders/","");c.order_list.dispatch(b,!0)}})},updateSelectionMenuActionItemsByStates:function(a){var b=
[];if("string"===typeof a)b.push(a);else if(c.isArray(a))b=[].concat(a);else return;a=this.$selectionMenu.find(".wf-actions .js-wf-action-item");a.addClass("s-disabled");var d={};a.each(function(){for(var a=c(this),e=a.data("actionId"),a=a.data("availableForStates").split(","),g=0;g<b.length;g++){var k=b[g];-1!==a.indexOf(k)&&(d[k]=d[k]||[],d[k].push(e))}});var e=c.shop.intersectArrays(c.shop.getValues(d),!0);0<e.length&&a.filter(function(){return-1<c.inArray(c(this).data("actionId"),e)}).removeClass("s-disabled")},
enableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").removeClass("s-disabled")},disableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").addClass("s-disabled")},initSelecting:function(){var a=this,b=this.container,d=this.select_all_input;a.filter_params&&a.filter_params.state_id&&d.is(":checked")&&a.updateSelectionMenuActionItemsByStates(a.filter_params.state_id);d.click(function(){c(this).trigger("select",
this.checked)});c(window).one("wa_before_dispatched",function(b){a.$selectionMenu.hide()});a.xhrs.printforms=null;var e=function(b){b=tmpl("template-order-list-printforms-menu-items",b);var c=a.$selectionMenu.find(".wf-actions");c.find(".s-printform-item,.s-printform-item-sep,.s-printform-item-button").remove();c.append(b)};c(document).keydown(function(a){16!=a.keyCode||c(a.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(a){16==a.keyCode&&
(document.body.onselectstart=null)});var f=function(){var b=c("#order-list"),e=d.attr("checked"),b=b.find(".order.selected:first").length;e||b?(a.$selectionMenu.show(),b=null,b=e?a.options.all_order_state_ids?a.options.all_order_state_ids:a.filter_params&&a.filter_params.state_id?a.filter_params.state_id:null:a.container.find(".order.selected").map(function(){return c(this).data("stateId")}).toArray(),null!==b?(b=c.shop.getUniqueValues(b),a.updateSelectionMenuActionItemsByStates(b)):a.enableAllSelectionMenuActionItems()):
a.$selectionMenu.hide()};b.off("select",".order").on("select",".order",function(a,b){(void 0!==b?b:1)?c(this).addClass("selected").find("input:first").attr("checked",!0):(c(this).removeClass("selected").find("input:first").attr("checked",!1),d.is(":checked")&&d.attr("checked",!1));f();return!1});var h=function(){a.xhrs.printforms&&a.xhrs.printforms.abort();e({printforms:[]});a.xhrs.printforms=null;d.is(":checked")&&null!==c.order_list.all_printforms?e({printforms:c.order_list.all_printforms}):a.xhrs.printforms=
c.shop.getJSON("?module=orders&action=printforms",a.getSelectedOrders(),function(b){c.isEmptyObject(b.data.printforms)||(d.is(":checked")&&(c.order_list.all_printforms=b.data.printforms),e(b.data),a.xhrs.printforms=null)})};d.unbind("select").bind("select",function(a,d){d=void 0!==d?d:!0;var e=c(this);d?(e.attr("checked",!0),b.find(".order").trigger("select",!0,!1)):(e.attr("checked",!1),b.find(".order").trigger("select",!1,!1));h()});b.off("click",".order input").on("click",".order input",function(a){var e=
a.shiftKey;a=this.checked;var g=c(this).parents(".order:first");a?g.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),g.removeClass("selected"));if(e&&a){(e=b.data("last_checked"))||(e=b.find(".order:first").trigger("select",!0));var k=g.prevAll(".selected[data-order-id="+e.attr("data-order-id")+"]"),q;if(k.length)for(q=g.prev(),e=e.get(0);q.length&&e!=q.get(0);)q.addClass("selected").find("input").attr("checked",!0),q=q.prev();else if(k=g.nextAll(".selected[data-order-id="+e.attr("data-order-id")+
"]"),k.length)for(q=g.next(),e=e.get(0);q.length&&e!=q.get(0);)q.addClass("selected").find("input").attr("checked",!0),q=q.next();b.data("last_checked")||k.length||e.trigger("selected",!1)}a&&b.data("last_checked",g);f();h()});var g=function(a,b){if(100<b.count)alert($_("Maximum of %d orders is allowed for bulk form printing.").replace("%d",100));else{var d="?module=orders&action=printformsDisplay",e=c.map(b.serialized,function(a){return a.name+"="+a.value}).join("&"),f=c.map(a,function(a){return"form[]="+
a}).join("&"),d=d+("&"+e+"&"+f),e=(""+Math.random()).slice(2);window.open(d,e)}};a.$selectionMenu.off("click.printforms").on("click.printforms",".s-printform-item-button",function(b){b.preventDefault();a.xhrs.printforms&&a.xhrs.printforms.abort();a.xhrs.printforms=null;b=a.$selectionMenu.find(".s-printform-item :checkbox").map(function(){var a=c(this);return a.is(":checked")?a.data("id"):!1}).toArray();if(b.length){var d=a.getSelectedOrders(!0);if(!(0>=d.count))return g(b,d),!1}})},updateTitle:function(a,
b){b=parseInt(b,10)||0;var d="";this.options.state_names&&(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?d=this.options.state_names[this.filter_params.state_id]:c.isArray(this.filter_params.state_id)&&(d=$_("Processing")):d=$_("All orders"));document.title=b?"("+b+") "+d+(a||""):d+a},updateCounters:function(a){var b=this.sidebar;b||(b=c("#s-sidebar"));var d=c("#s-pending-orders .small"),e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e],h;for(h in f)if(f.hasOwnProperty(h)){var g;
g="common_counters"==e?c("#s-"+h+"-orders .count"):"storefront_counters"===e?b.find("li[data-"+e.replace("_counters","")+'="'+h+'"] .count'):b.find("li[data-"+e.replace("_counters","")+"-id="+h+"] .count");var k=parseInt(g.text(),10)||0;f[h]=""+f[h];"+"==f[h].substr(0,1)?k+=parseInt(f[h].substr(1),10)||0:"-"==f[h].substr(0,1)?(k-=parseInt(f[h].substr(1),10)||0,k=0>k?0:k):k=parseInt(f[h],10)||0;g.text(k);"new"==h&&(d.text(k?"+"+k:""),c.shop.updateAppCounter(k),this.updateTitle(this.options.title_suffix,
parseInt(k,10)))}}},updateListItems:function(a){var b="template-order-list-"+this.options.view;if(document.getElementById(b)){var d=this.container;c.isArray(a)||(a=[a]);var b=c("<div></div>").append(tmpl(b,{orders:a,check_all:"table"==this.options.view?this.select_all_input.attr("checked"):!1})),e=c(".order",d);c(".order",b).each(function(){var a=c(this);e.filter("[data-order-id="+a.attr("data-order-id")+"]").replaceWith(a)});b.remove();this.container.trigger("append_order_list",[a])}},hideListItems:function(a){var b=
c.Deferred();setTimeout(function(){if(c.order_list&&c.order_list.container&&c.order_list.container.length){if(c.isArray(a))for(var d=c.order_list.container.find(".order"),e=c(),f=0;f<a.length;f++)var h=d.filter("[data-order-id="+a[f]+"]"),e=e.add(h);else var e=c.order_list.container.find(".order[data-order-id="+a+"]");var g=e.length,k=0;e.slideUp(450,function(){k++;k>=g&&b.resolve()})}},1E3);return b.promise()},dispatch:function(a,b){"string"===typeof a&&(a=c.shop.helper.parseParams(a));var d={list:function(){c.order_list.finit();
c.orders.load("?module=orders&"+c.orders.buildOrdersUrlComponent(a),function(){c.order_list.dispatch(a)})},order:function(){c.order_list.loadOrder(a.id)}};null===this.params?(this.params=a,b&&d.list()):a.id&&(b||a.id!=this.params.id)?(d.order(),this.params=a):(b||this.diff(a,this.params)||this.diff(this.params,a))&&d.list()},diff:function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&"id"!=c&&a[c]!==b[c])return!0;return!1},buildLoadListUrl:function(a,b,c){return"?module=orders&action=loadList&id="+
a+(this.filter_params_str?"&"+this.filter_params_str:"")+(b?"&lt=1":"")+(c?"&counters=1":"")+(this.options.view?"&view="+this.options.view:"")+("&sort[0]="+this.sort[0]+"&sort[1]="+this.sort[1])},updateProcess:function(a,b){a=a||"run";b=b||{};timeout=b.timeout||6E4;var d=this,e=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};e();if("run"==a){var f=function(a,b){var e=d.container.find(".order:first"),
e=parseInt(e.attr("data-order-id"),10)||0;return c.getJSON(d.buildLoadListUrl(e,!0,!0),function(e){if("ok"==e.status){c.isEmptyObject(e.data.counters)||d.updateCounters(e.data.counters);if(e.data.count)try{d.container.prepend(tmpl("template-order-list-"+d.options.view,{orders:e.data.orders,check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),c(".lazyloading-progress-string").text(e.data.progress.loaded+" "+e.data.progress.of),d.container.trigger("append_order_list",[e.data.orders])}catch(n){console&&
(console.log("Error: "+n.message),b());return}"function"===typeof a&&a(e)}else console&&console.log("Error when loading new orders: "+e.errors),"function"===typeof b&&b()}).error(function(a){console&&(a&&a.errors?console.log("Error when loading new orders: "+a.errors):console.log(["Error when loading new orders",a]));"function"===typeof b&&b()})},h=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=f(h,e):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=f(h,
e)})},timeout)};h()}},finit:function(a){a=this.xhrs;var b=this.lazy_load_win,c;for(c in a)a.hasOwnProperty(c)&&null!==a[c]&&a[c].abort();this.updateProcess("kill");b&&b.lazyLoad("stop");this.params=null}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_form:null,$storefront_selector:null,stocks:[],slide_on:!1,options:{},locales:{},init:function(c){this.options=c;c.id&&(this.id=c.id);this.container="string"===typeof c.container?$(c.container):c.container;this.form="string"===typeof c.form?$(c.form):c.form;this.$storefront_selector=$("#order-storefront");c.stocks.sort(function(a,b){return a.sort-b.sort});this.stocks=c.stocks;c.title&&(document.title=title);c.float_delimeter||(c.float_delimeter=
".");c.locales&&(this.locales=c.locales);this.float_delimeter=c.float_delimeter;this.prev_ship_method=null;this.container.trigger("order_edit_init");this.initView();this.initShippingControl();this.initDiscountControl();this.initCustomerSourceControl(c.customer_sources)},initCustomerForm:function(c){this.customer_form=new ShopBackendOrderEditorCustomerForm($("#s-order-edit-customer"),this,c)},initView:function(){var c=this,a=c.options;this.initStorefrontSelector();var b=function(a){var b=a.find(".s-orders-sku-stock-select").find("option:selected"),
c=a.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");a.find(".s-orders-stock-icon-aggregate").show();a.find(".s-orders-stock-icon").html("").hide();c=c.length?c:a;b.attr("data-icon")&&(c.find(".s-orders-stock-icon-aggregate").hide(),c.find(".s-orders-stock-icon").html(b.attr("data-icon")).show(),a.find(".s-orders-stock-icon .s-stock-left-text").show(),c.find(".s-orders-stock-icon .s-stock-left-text").hide())};$.order_edit.slide(!0,"add"==a.mode);this.container.find(".back").click(function(){$.order_edit.id?
$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.getOrderItems(this.container,!0);$(".s-order-item").each(function(){var a=$(this);b(a)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());$.order_edit.options.currency=$(this).val()});var d=a.price_edit||!1,e=$("#orders-add-autocomplete");e.autocomplete({source:"?action=autocomplete&with_counts=1",minLength:3,delay:300,select:function(a,f){$(".s-order-errors").empty();var g="?module=orders&action=getProduct&product_id="+
f.item.id+"&order_id="+$.order_edit.id+"&currency="+$.order_edit.options.currency,k=c.getStorefront();k&&(g+="&storefront="+k);$.getJSON(g,function(a){var c=$("#order-items"),c=parseInt(c.find(".s-order-item:last").attr("data-index"),10)+1||0,e=a.data.product;e.sku_id&&e.skus[e.sku_id]&&(e.skus[e.sku_id].checked=!0);$("#order-currency").length&&!$("#order-currency").attr("disabled")&&($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled",
"disabled"));e=$("#s-orders-add-row");e.before(tmpl("template-order",{data:a.data,options:{index:c,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:d}}));a=e.prev();$("#s-order-comment-edit").show();$.order_edit.updateTotal();b(a)});e.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",".s-orders-skus input[type=radio]",function(){var a=$(this),e=a.parents("tr:first"),f=a.closest("li"),h=this.value,n=e.attr("data-product-id"),
q=e.attr("data-index"),r=null;"edit"==($.order_edit.id?"edit":"add")&&(r=parseInt(a.attr("name").replace("sku[edit][",""),10));a="?module=orders&action=getProduct&product_id="+n+"&sku_id="+h+"&currency="+$.order_edit.options.currency;(h=c.getStorefront())&&(a+="&storefront="+h);$.getJSON(a,function(a){var c;c=-1!==e.find("input:first").attr("name").indexOf("add")?"add":"edit";e.find(".s-orders-services").replaceWith(tmpl("template-order-services-"+c,{services:a.data.sku.services,service_ids:a.data.service_ids,
product_id:n,options:{price_edit:d,index:q,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks}}));e.find(".s-orders-product-price").find("input").val(a.data.sku.price);e.find(".s-orders-sku-stock-place").empty();f.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+c,{sku:a.data.sku,index:q,stocks:$.order_edit.stocks,item_id:r}));b(e);$.order_edit.updateTotal()})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var a=
$(this).parents("tr.s-order-item:first");b(a)});var f=function(a,b,c){var d=a.attr("data-price");a=a.attr("data-percent-price");c&&b.val(d);b.attr("data-price",d);b.attr("data-percent-price",a)};this.container.off("change",".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var a=$(this),b=a.find("option:selected"),a=a.parents("li:first");f(b,a.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var a=$(this),b=a.find("option:selected"),
a=a.parents("li:first");f(b,a.find(".s-orders-service-price"),!1)});this.container.off("click",".s-order-item-delete").on("click",".s-order-item-delete",function(){$(this).parents("tr:first").remove();$("table#order-items").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});this.container.off("change",".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",
".s-orders-product-price input",function(){var a=$(this).parents("tr:first");$.order_edit.updateServicePriceInPercent(a);$.order_edit.updateTotal()});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);$("#payment_methods").change(function(){var a=$(this).val();$("#payment-info > div").hide();$.order_edit.updateTotal();$("#payment-custom-"+a).length&&$("#payment-custom-"+a).show()});this.container.off("keydown",
".s-orders-quantity").on("keydown",".s-orders-quantity",function(){var a=$(this),b=a.data("timer_id");b&&clearTimeout(b);a.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},450))});if(this.form&&this.form.length){var h=function(){var a=$(this);if(h.xhr)return!1;$.order_edit.showValidateErrors();$('.s-orders-services input[name^="service"][type="checkbox"]:not(:checked),.s-orders-services input.js-fake-service-selected[type="checkbox"]:not(:checked)',this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",
!0)});if(!$.order_edit.container.find(".error").length){$.order_edit.switchSubmitButton("disable");var b=function(){h.xhr=null;$.order_edit.switchSubmitButton();$(".s-orders-services input:disabled",a).attr("disabled",!1)};h.xhr=$.order_edit.id?$.order_edit.saveSubmit(b,"edit"):$.order_edit.saveSubmit(b,"add")}return!1};this.form.unbind("sumbit").bind("submit",h)}$("#subtotal").text(this.roundFloat($("#subtotal").text()));$("#total").text(this.roundFloat($("#total").text()));$("#discount").val(this.roundFloat($("#discount").val()));
$("#tax").text(this.roundFloat($("#tax").text()));this.container.trigger("order_edit_init_view")},initShippingControl:function(){var c=this;c.prev_ship_method=$("#shipping_methods").val();$("#shipping-custom").on("change",":input",function(a){$.shop.trace("#shipping-custom change",[a,this]);a.originalEvent&&$(this).data("affects-rate")&&$.order_edit.updateTotal()});c.setShippingInfo();$("#shipping_methods").change(function(){var a=$("#shipping_methods option:selected"),b=a.data("rate")||0,d=$("#shipping-rate");
d.data("shipping")&&a.val()==c.prev_ship_method||(d.val($.order_edit.formatFloat(b)),d.data("shipping",!1),c.prev_ship_method=a.val());c.setShippingInfo();$.order_edit.updateTotal()});$("#shipping-rate").change(function(){var a=$(this);if(0>a.val())return alert($.order_edit.locales.wrong_cost),a.val(0),!1;$("#shipping-rate").data("shipping",$(this).val());$.order_edit.updateTotal()});this.container.trigger("order_edit_init_shipping")},initDiscountControl:function(){function c(){0<$.order_edit.parseFloat(a.val())?
f.stop().show():f.stop().hide();var b=25;f.is(":visible")&&f.finish().fadeOut(b+=50).fadeIn(b+=50).fadeOut(b+=50).fadeIn(b+=50).fadeOut(b+=50).fadeIn(b+=50).fadeOut(b+=50).fadeIn(b+50)}var a=$("#discount"),b=$("#discount-description"),d=$("#update-discount"),e=$("#edit-discount"),f=$("#discount-tooltip-icon");f.tooltip({showURL:!1,bodyHandler:function(){return b.val()||b.data("updated-manually-msg")}});d.tooltip({showURL:!1,bodyHandler:function(){return d.data("description")||b.data("updated-manually-msg")}});
e.length?f.show():f.hide();$("#order-edit-form").on("order_total_updated",function(f,h){a.show();a.parent().find("span.js-order-discount:first").hide();e.hide();d.data("description",h.discount_description);if(h.discount){d.data("value",h.discount).data("description",h.discount_description).data("items_discount",h.items_discount);if("calculate"===d.data("discount")){b.val(d.data("description"));for(var g=d.data("items_discount")||[],k=0;k<g.length;k++)if(g[k]){var n="#order-items span.js-item-total-discount",
n=n+('[data-discount-id="'+g[k].selector+'"]'),n=$(n);n.length&&n.html(g[k].html).show()}c()}"calculate"===d.data("discount")?$.order_edit.parseFloat(h.discount)!==$.order_edit.parseFloat(a.val())&&d.click():d.show()}});var h=function(){a.show();a.parent().find("span.js-order-discount:first").hide();e.hide();$(".js-item-total-discount").hide()};e.click(function(){h();b.val("");return!1});d.click(function(){h();a.val(d.data("value")||0).change();b.val(d.data("description"));a.attr("title",b.data("edit-manually-msg"));
d.hide().data("discount","calculate");$.order_edit.updateTotal();c();return!1});a.on("change",function(){e.click();b.val("");$("#order-items .js-item-total-discount").hide();a.attr("title",null);d.show().data("discount",$(this).val());$.order_edit.updateTotal();c()});this.container.trigger("order_edit_init_discount")},initCustomerSourceControl:function(c){var a=$("#customer-source");a.autocomplete({delay:0,minLength:0,appendTo:"#order-edit-form",source:function(a,d){var b=c.filter(function(b){return b&&
b.indexOf&&0<=b.indexOf(a.term)}).slice(0,10);1==b.length&&b[0]==a.term?d([]):d(b)}}).on("focus",function(){a.autocomplete("search")})},initUpdateServicePrice:function(){this.container.find(".s-order-item").each(function(){$.order_edit.updateServicePriceInPercent($(this))})},updateServicePriceInPercent:function(c){var a=c.find(".js-order-edit-item-price").val();if("undefined"===typeof a)return null;c.find('[data-currency="%"]').each(function(){var b=$(this),c=a*(b.data("percentPrice")/100),c=$.order_edit.roundFloat(c);
b.val($.order_edit.formatFloat(c));b.attr("data-price",c)})},setShippingInfo:function(){var c=$("#shipping_methods"),a=c.children(":selected"),b=$("#shipping-rate"),d=$("#shipping-info"),e=c.val(),f=c.data("_shipping_id"),h=[];a.length?(a.data("error")&&h.push('<span class="error">'+a.data("error")+"</span>"),a.data("est_delivery")&&h.push('<span class="hint est_delivery">'+a.data("est_delivery")+"</span>"),$("#shipping-custom > div").hide(),null!==e&&(e=(""+e).replace(/\..+$/,""),$("#shipping-custom-"+
e).length&&$("#shipping-custom-"+e).show()),a.data("comment")&&h.push('<span class="hint">'+a.data("comment")+"</span>"),h?(a.data("error")?(b.addClass("error"),c.addClass("error")):b.removeClass("error"),d.html(h.join("<br>")).show()):(b.removeClass("error"),d.empty().hide())):c.addClass("error");$.shop.trace("check shipping_methods id",[f,e,a])},getOrderItems:function(c){var a=[],b=[];c.find(".s-order-item").each(function(){var c=$(this),e=c.find('input[name^="product"]').val(),f=[],h=$.order_edit.parseFloat(c.find(".s-orders-product-price input").val()),
g=$.order_edit.parseFloat(c.find("input.s-orders-quantity").val()),k=c.find("select.s-orders-sku-stock-select").val(),v=c.data("item-id"),m=c.find("input[name^=sku]:not(:radio)").add(c.find("input[name^=sku]:checked")).first().val()||0,n={product_id:e,sku_id:m,services:[]};c.find(".s-orders-services").length&&c.find(".s-orders-services input:checkbox:checked").each(function(){var a=$(this).closest("li"),b=$.order_edit.parseFloat(a.find("input.s-orders-service-price").val()),c=$(this).val(),a=a.find(':input[name^="variant["]').val();
f.push({id:c,price:b,variant_id:a});n.services.push(c)});n.services.sort();n.services=n.services.join("_");a.push({id:v,product_id:e,quantity:g,price:h,sku_id:m,services:f,stock_id:k});b.push(n)});b=this.reduceOrderContent(b);c.data("order-content",b);return a},reduceOrderContent:function(c){c.sort(function(a,b){var c=a.product_id-b.product_id;0===c&&(c=a.sku_id-b.sku_id);0===c&&(c=a.services.localeCompare(b.services));return c});return c.map(function(a){return"*"+a.product_id+":"+a.sku_id+":"+a.services}).join(";")},
updateTotal:function(){function c(){a=null;$.order_edit.realUpdateTotal()}var a=null;return function(){a?(clearTimeout(a),a=setTimeout(c,250)):a=setTimeout(c,500)}}(),realUpdateTotal:function(){var c=$.order_edit.container,a=$("#subtotal"),b=$("#total"),d=$("#tax");if(c.find(".s-order-item").length){var e=this;$.order_edit.switchSubmitButton("disable");$.order_edit.showValidateErrors();for(var f={},h=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),g=0;g<h.length;g++)f[h[g].name]=
h[g].value;f.storefront=e.getStorefront();f.items=$.order_edit.getOrderItems(c);var k=$("#update-discount").data("discount");void 0!==k&&("calculate"!==k&&(k=$.order_edit.parseFloat(k)),f.discount=k);$.order_edit.id?f.order_id=$.order_edit.id:f.currency=$("#order-edit-form input[name=currency]").val();c=$("#shipping_methods").val();h=$("#payment_methods").val();g=$("#coupon_id").val();$("#shipping-rate").data("shipping")&&(f.shipping=$("#shipping-rate").data("shipping"));f.params={shipping_id:c,coupon_id:g,
payment_id:h};f["customer[id]"]=f.contact_id=$("#s-customer-id").val();f.tax="calculate";c&&(c=parseInt(c.split(".")[0]),0<c&&$("#shipping-custom").find(">#shipping-custom-"+c+" :input").each(function(){f[this.name]=this.value}));$.ajax({type:"POST",url:"?module=order&action=total",data:f,success:function(c){if(c&&"ok"===c.status){var f=$("#shipping-rate"),g=$("#shipping_methods"),h=$.trim(g.val())||"",r=h.replace(/\W.+$/,"");c.data&&(c.data=$.order_edit.parseTotalResponse(c.data));g.empty();g.prepend('<option value=""></option>');
if(0<c.data.shipping_method_ids.length){var v=$("#shipping-custom");v.empty();var y=c.data.shipping_method_ids,C=c.data.shipping_methods,B=!1,z=!1;-1!==y.indexOf(h)&&(B=!0);B||-1===y.indexOf(Number(r))||(z=B=!0);v.find(">div.fields.form").hide();for(var t=0;t<y.length;t+=1){var w=""+y[t],l=C[w],u=w.replace(/\W.+$/,""),p=$("<option></option>");p.html(l.name).attr("value",w).data("rate",l.rate);p.data("error",l.error||void 0);p.data("est_delivery",l.est_delivery||void 0);p.data("comment",l.comment||
void 0);p.data("external",l.external||!1);g.append(p);h||0!==t||$("#shipping-rate").val($.order_edit.formatFloat(l.rate));if(r==u){if(l.custom_data)for(var F in l.custom_data)l.custom_data.hasOwnProperty(F)&&p.data(F,l.custom_data[F]);l.custom_html&&(p=v.find("#shipping-custom-"+u),p.length||(v.append('<div id="shipping-custom-'+u+'" class="fields form"></div>'),p=v.find("#shipping-custom-"+u)),p.html(l.custom_html))}if(!B&&(l=(""+w).split("."),u=h.split("."),""!==u[0]&&void 0!==l[0]&&void 0!==u[0]&&
l[0]==u[0])){h=w;g.val(h);$.order_edit.setShippingInfo();$.order_edit.realUpdateTotal();return}}g.val(h);z&&g.val(r);g.data("_shipping_id",r);$.shop.trace("set shipping_methods id",[r,h])}""!=k&&$("#discount").val(c.data.discount);f.val(c.data.shipping);$("#order-edit-form").trigger("order_total_updated",c.data);a.text(c.data.subtotal);b.text(c.data.total);d.text(c.data.tax);$.order_edit.showValidateErrors(c.data.errors);e.setShippingInfo()}$.order_edit.switchSubmitButton()},dataType:"json"})}else a.text(0),
b.text(0)},saveSubmit:function(c,a){var b=this.form,d=b.serializeArray();"calculate"===$("#update-discount").data("discount")?$(d).each(function(){"discount"==this.name&&(this.value="calculate")}):void 0===$("#update-discount").data("discount")&&(d=d.filter(function(a){return"discount"!==a.name}),0<$("#discount").val()?d.discount_description=$("#edit-discount").val():d=d.filter(function(a){return"discount_description"!==a.name}));success="add"==a?function(a){$.order_edit.container.trigger("order_edit_save_success",
{data:a.data,is_new:!0});!$.order_edit.options.embedded_version&&$.order_edit.slide(!1,!0)&&(location.href="#/orders/state_id=new&view=split&id="+a.data.order.id+"/")}:function(a){$.order_edit.container.trigger("order_edit_save_success",{data:a.data,is_new:!1});$.order_edit.options.embedded_version||$.order_edit.container.find(".back").click()};this.container.trigger("order_edit_save",d);return $.shop.jsonPost(b.attr("action"),d,success,function(b){$.shop.trace(a,b);b&&b.errors&&!$.isEmptyObject(b.errors)&&
$.order_edit.showValidateErrors(b.errors)},c)},parseTotalResponse:function(c){["total","discount","shipping","tax","subtotal"].forEach(function(a){if("number"===typeof c[a]||"string"===typeof c[a])c[a]=$.order_edit.roundFloat(parseFloat((+c[a]).toFixed(2)))});return c},roundFloat:function(c){return c?this.formatFloat(Math.round(100*c)/100):0},formatFloat:function(c){return","===this.float_delimeter?(""+c).replace(".",","):""+c},parseFloat:function(c){return c?parseFloat((""+c).replace(",",".")):0},
slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(c,a,b){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{c="undefined"===typeof c?!0:c;a="undefined"===typeof a?!1:a;var d=this.options.duration||200,e=this.options.view,f=[];return!this.slide_on&&c?(f.push($("#s-sidebar").animate({width:0},d,function(){$(this).hide()})),$(".s-level2").hide(),f.push($("#maincontent").animate({"margin-top":45},d)),f.push($("#s-content").animate({"margin-left":0},d)),f.push($("#s-orders").animate({width:0},
d,function(){$(this).hide()})),f.push($("#s-order").animate({"margin-left":0},d).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(f).done(function(){$.order_list&&$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");"function"===typeof b&&b.call(this)}),!0):this.slide_on&&!c?(f.push($("#s-order").animate({"margin-left":"table"==
e||a?200:300},d).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),f.push($("#s-orders").animate({width:300},d).show()),f.push($("#s-content").animate({"margin-left":200},d)),f.push($("#maincontent").animate({"margin-top":84},d)),$(".s-level2").show(),f.push($("#s-sidebar").animate({width:200},d).show()),this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),$.when(f).done(function(){$.order_list.lazy_load_win&&
$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof b&&b.call(this)}),!0):!1}},switchSubmitButton:function(c){var a=this.form,b=$(a).find(".s-order-items-edit td.save i.loading"),a=$(a).find("[type=submit]");"disable"===c?(b.css("display","inline-block"),a.attr("disabled",!0)):(b.css("display","none"),a.attr("disabled",!1))},showValidateErrors:function(c){var a=[];$.shop.trace("showValidateErrors",c);$("#shipping-info").find(".error").empty();$(".error").removeClass("error");$("#s-order-edit-customer .errormsg").empty();
this.customer_form&&this.customer_form.showValidateErrors(c?c.customer:{});$(".s-order-errors").empty();if(c&&c.order){if(!$.isEmptyObject(c.order.items))for(var b in c.order.items){var d=$(".s-order-item[data-index="+b+"]"),e=c.order.items[b],f;for(f in e){var h=d.find(".s-error-item-"+f);h.length?h.text(e[f]):a.push(e[f])}delete c.order.items[b]}if(!$.isEmptyObject(c.order.product)){var g=c.order.product,k;for(k in g)g.hasOwnProperty(k)&&"quantity"in g[k]&&$(".s-order-item[data-product-id="+k+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=
""+g[k].sku_id&&$(this).find("ul.s-orders-skus").length||($(this).find(".s-orders-quantity").addClass("error"),a.push(g[k].quantity))})}c.order.common&&a.push(c.order.common);c.order.discount&&($("#discount").addClass("error"),a.push(c.order.discount));a.length&&$(".s-order-errors").html(a.join("<br>"))}},getSelectedStorefront:function(c){var a=this.$storefront_selector,b=$.trim(a.val());return c?{storefront:b,data:a.find(":selected").data()}:b},getStorefrontSelector:function(){return this.$storefront_selector},
getStorefront:function(){return this.getStorefrontSelector().val()},initStorefrontSelector:function(){var c=this;c.$storefront_selector.on("change",function(){c.customer_form&&c.customer_form.isEnabled()&&c.customer_form.reloadForm()})},filterStorefrontSelector:function(c){var a=this.$storefront_selector;a.find("option").each(function(){var b=$(this),d=b.val(),e=b.data();b.show();!e.orderStorefront&&d&&c&&!e[c]&&(b.hide(),b.is(":selected")&&a.val(""))})},getPercentSymbol:function(){return"%"}};var ShopBackendCustomerForm=function(c){ShopBackendCustomerForm=function(a,b){this.options=b||{};this.$wrapper=a;this.dom_ns=this.$wrapper.attr("id");this.namespace=b.namespace||null;this.locales=b.locales;this.$wrapper.data("ShopBackendCustomerForm",this);c.contains(document,this.$wrapper.get(0))&&this.activate()};ShopBackendCustomerForm.prototype.activate=function(){this.$wrapper.off("."+this.dom_ns);this.initConfirmedCheckboxes();this.initContactTypeSelector();this.initShippingAddress();this.initBillingAddress();
this.fixStyles()};ShopBackendCustomerForm.prototype.deactivate=function(){this.$wrapper.off("."+this.dom_ns);this.unbindAll()};ShopBackendCustomerForm.prototype.getOptions=function(){return this.options||{}};ShopBackendCustomerForm.prototype.setOptions=function(a){this.options=a||{}};ShopBackendCustomerForm.prototype.getContact=function(a){var b=this.options.contact||{};return a?c.extend({},b,!0):b};ShopBackendCustomerForm.prototype.initConfirmedCheckboxes=function(){var a=this.$wrapper,b=a.find(".field-email:eq(0)"),
c=a.find(".field-phone:eq(0)"),e=a.find(".s-customer-email-confirmed-control"),a=a.find(".s-customer-phone-confirmed-control");b.find(".value").children().first().after(e);c.find(".value").children().first().after(a)};ShopBackendCustomerForm.prototype.initContactTypeSelector=function(){var a=this;a.$wrapper.on("click."+a.dom_ns,".s-order-form-contact-type-selector-wrapper :radio",function(){var b=c(this),d=a.$wrapper.find(".s-order-form-contact-type-selector-wrapper .loading"),b=c.trim(b.val());d.show();
a.reloadForm({type:b},{afterReload:function(){d.hide()}})})};ShopBackendCustomerForm.prototype.initShippingAddress=function(){var a=this,b=a.$wrapper,d=function(){return b.find(".field-address-shipping").find(".value").children()},e=function(){return".s-customer-more-shipping-addresses-control"};d().each(function(b){var d=c(this);b=0<b?a.locales.extra_shipping_address:a.locales.main_shipping_address;b=c("<span />").addClass("s-block-header bold").text(b);d.addClass("s-address-block").prepend(b)});
var f=1<d().length,h=0<d().not(":first").find(".errormsg,.error").length;f&&!h&&(d().not(":first").hide(),d().first().after(b.find(e())));b.on("click",e()+" .js-toggle-button",function(a){a.preventDefault();d().not(":first").show();b.find(e()).hide()})};ShopBackendCustomerForm.prototype.initBillingAddress=function(){var a=this,b=a.$wrapper,d=function(){return b.find(".field-address-billing").find(".value").children()},e=function(){return".s-customer-more-billing-addresses-control"};d().each(function(b){var d=
c(this);b=0<b?a.locales.extra_billing_address:a.locales.main_billing_address;b=c("<span />").addClass("s-block-header bold").text(b);d.addClass("s-address-block").prepend(b)});var f=1<d().length,h=0<d().not(":first").find(".errormsg,.error").length;f&&!h&&(d().not(":first").hide(),d().first().after(b.find(e())));b.on("click",e()+" .js-toggle-button",function(a){a.preventDefault();d().not(":first").show();b.find(e()).hide()})};ShopBackendCustomerForm.prototype.fixStyles=function(){var a=this.namespace,
b=this.$wrapper;console.log(b.find('.field-birthday input[name="'+a+'[birthday][year]"]').get(0));b.find('.field-birthday input[name="'+a+'[birthday][year]"]').css({width:"",minWidth:""})};ShopBackendCustomerForm.prototype.updateInnerHtml=function(a){var b=this.$wrapper;a=c("<div>").hide().appendTo("body").html(a);var d=a.find(".s-customer-form-wrapper"),d=ShopBackendCustomerForm.getInstance(d);this.setOptions(d.getOptions());b.html(a.children(0).html());a.remove()};ShopBackendCustomerForm.prototype.reloadForm=
function(a,b){var d=this,e=d.$wrapper;b=b||{};var f=c.extend({},a||{});f.type||(f.type=d.getContact().type);var h=e.find(".loading").show();b.beforeReload&&b.beforeReload(f);e.trigger("beforeReload",[f]);if(!a["new"]){var g=e.find(":input:not(:disabled)").serializeArray();c.each(g,function(a,b){f[b.name]=b.value})}c.post("?action=customerForm",f,function(a){d.updateInnerHtml(a);h.hide();a=d.getContact(!0);b.afterReload&&b.afterReload(a);e.trigger("afterReload",[a])})};ShopBackendCustomerForm.prototype.bind=
function(a,b){this.$wrapper.on(a+".custom"+this.dom_ns,b)};ShopBackendCustomerForm.prototype.unbindAll=function(){this.$wrapper.off(event+".custom"+this.dom_ns)};ShopBackendCustomerForm.getInstance=function(a){return a.data("ShopBackendCustomerForm")instanceof ShopBackendCustomerForm?a.data("ShopBackendCustomerForm"):null};return ShopBackendCustomerForm}(jQuery);var ShopBackendOrderEditorCustomerForm=function(c){ShopBackendOrderEditorCustomerForm=function(a,b,d){this.options=d||{};this.$wrapper=a&&0<a.length?a:c("#s-order-edit-customer");this.editor=b;this.$customer_inputs=this.$wrapper.find(":input");this.initial_values={};this.$customer_form_wrapper=this.$wrapper.find(".s-customer-form-wrapper");(this.customer_form=ShopBackendCustomerForm.getInstance(this.$customer_form_wrapper))||console.error("There is not ShopBackendCustomerForm instance");this.$autocomplete=
c("#customer-autocomplete");this.$customer_id=c("#s-customer-id");this.$new_customer_link=c("#s-order-new-customer");this.contact=d.contact||{};this.init()};ShopBackendOrderEditorCustomerForm.prototype.init=function(){this.initForm();this.rememberInitialValues();this.initAutocomplete()};ShopBackendOrderEditorCustomerForm.prototype.rememberInitialValues=function(){var a=this;a.$customer_inputs.each(function(){var b=c(this),d=b.attr("name"),e=b.val();b.is(":radio")?b.is(":checked")&&(a.initial_values[d]=
e):b.is(":checkbox")?a.initial_values[d]=b.is(":checked"):a.initial_values[d]=e})};ShopBackendOrderEditorCustomerForm.prototype.resetInputValues=function(){var a=this;a.$customer_inputs.each(function(){var b=c(this),d=b.attr("name"),e=b.val(),d=a.initial_values[d]||"";b.is(":radio")?e===d&&b.attr("checked","checked"):b.is(":checkbox")?b.is(":checked")?b.attr("checked","checked"):b.attr("checked",""):b.val()})};ShopBackendOrderEditorCustomerForm.prototype.disable=function(a){var b=this.$customer_id,
c=this.$wrapper;a="undefined"===typeof a?!0:a;b.attr("disabled",a);a?c.addClass("s-opaque"):c.removeClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isDisabled=function(){return this.$wrapper.hasClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isEnabled=function(){return!this.isDisabled()};ShopBackendOrderEditorCustomerForm.prototype.activate=function(a){var b=this.$new_customer_link,c=this.$autocomplete;"undefined"===typeof a||a?(this.disable(!1),c.val("").hide(200),
b.hide(200)):(this.disable(),c.val("").show(),b.show())};ShopBackendOrderEditorCustomerForm.prototype.focusFirstEmptyInput=function(){var a=this.$customer_inputs,b=!1;a.filter("input[type=text], textarea").each(function(){var a=c(this);if(a.is(":not(:hidden)")&&!this.value)return b=!0,a.focus(),!1});b||a.first().focus()};ShopBackendOrderEditorCustomerForm.prototype.initAutocomplete=function(){var a=this,b=function(a){return parseInt(a,10)||"+"==a.substr(0,1)||-1!==a.indexOf("(")},d=function(c){var d=
"[name="+a.inputName(b(c)?"phone":-1!==c.indexOf("@")?"email":"firstname")+"]";a.$customer_inputs.filter(d).val(c)},e="";a.$autocomplete.autocomplete({source:function(b,d){e=b.term;c.getJSON(a.options.autocomplete_url,b,function(a){(a=a||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});d(a)})},delay:300,minLength:3,select:function(b,c){var f=c.item;if(0<f.value)return a.reloadForm({id:f.value,"new":!0}),!1;if(a.editor.getSelectedStorefront())return a.reloadForm({},{afterReload:function(){d(e)}}),
!1;d(e);a.$customer_id.val(0);a.activate();setTimeout(function(){a.focusFirstEmptyInput()},200);return!1},focus:function(a,b){this.value=b.item.name;return!1}})};ShopBackendOrderEditorCustomerForm.prototype.reloadForm=function(a,b){var c=this,e=c.customer_form;b=b||{};c.disable(!0);a=a||{};e.reloadForm(a,{afterReload:function(a){c.$customer_inputs=c.$wrapper.find(":input");c.contact=a||{};c.$customer_id.val(a.id);c.activate();setTimeout(function(){c.focusFirstEmptyInput()},200);c.editor.updateTotal();
b.afterReload&&b.afterReload(a)}})};ShopBackendOrderEditorCustomerForm.prototype.initForm=function(){for(var a=this,b=a.customer_form,d=a.editor,e=a.$wrapper,f=["firstname","middlename","lastname"],h=0,g=f.length;h<g;h+=1)a.$customer_inputs.filter("[name="+a.inputName(f[h])+"]").addClass("s-error-customer-name");e.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>');a.$new_customer_link.on("click",function(){if(0<a.$customer_id.val())return!1;d.filterStorefrontSelector(a.getContact().type);
d.getSelectedStorefront()?a.reloadForm():(a.activate(),a.$customer_inputs.first().focus());return!1});0<a.getContact().id?a.activate():a.activate(!1);e.off("focus",":input").on("focus",":input",function(){a.disable(!1)});b.bind("beforeReload",function(b,c){"undefined"===typeof c.id&&(c.id=a.getContact().id);c.storefront=d.getSelectedStorefront()});b.bind("afterReload",function(a,b){d.filterStorefrontSelector(b.type)});d.filterStorefrontSelector(a.getContact().type);e.on("change",':input[name*="[address.shipping]"]',
function(a){a.originalEvent&&(c.shop.trace("Update total if customer address edit",[this,a]),d.updateTotal())});d.form.submit(function(){a.disable(!1)})};ShopBackendOrderEditorCustomerForm.prototype.showValidateErrors=function(a){a=c.extend({},a||{});if(!c.isEmptyObject(a)){var b=this.customer_form;a=c.trim(a.html);0<a.length&&b.updateInnerHtml(a)}};ShopBackendOrderEditorCustomerForm.prototype.inputName=function(a){return'"customer['+a+']"'};ShopBackendOrderEditorCustomerForm.prototype.getContact=
function(){return this.contact=this.contact||{}};return ShopBackendOrderEditorCustomerForm}(jQuery);
