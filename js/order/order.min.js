var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var l=e[g];if(!(l in d))return;d=d[l]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");
(function(a){function b(y){return a.data(y,"tooltip")}function c(y){b(this).delay?r=setTimeout(e,b(this).delay):e();x=!!b(this).track;a(document.body).bind("mousemove",g);g(y)}function d(){if(!a.tooltip.blocked&&this!=k&&(this.tooltipText||b(this).bodyHandler)){k=this;p=this.tooltipText;if(b(this).bodyHandler){h.title.hide();var y=b(this).bodyHandler.call(this);y.nodeType||y.jquery?h.body.empty().append(y):h.body.html(y);h.body.show()}else if(b(this).showBody){y=p.split(b(this).showBody);h.title.html(y.shift()).show();
h.body.empty();for(var w=0,v;v=y[w];w++)0<w&&h.body.append("<br/>"),h.body.append(v);h.body.hideWhenEmpty()}else h.title.html(p).show(),h.body.hide();b(this).showURL&&a(this).url()?h.url.html(a(this).url().replace("http://","")).show():h.url.hide();h.parent.addClass(b(this).extraClass);b(this).fixPNG&&h.parent.fixPNG();c.apply(this,arguments)}}function e(){r=null;u&&a.fn.bgiframe||!b(k).fade?h.parent.show():h.parent.is(":animated")?h.parent.stop().show().fadeTo(b(k).fade,k.tOpacity):h.parent.is(":visible")?
h.parent.fadeTo(b(k).fade,k.tOpacity):h.parent.fadeIn(b(k).fade);g()}function g(y){if(!(a.tooltip.blocked||y&&"OPTION"==y.target.tagName))if(!x&&h.parent.is(":visible")&&a(document.body).unbind("mousemove",g),null==k)a(document.body).unbind("mousemove",g);else{h.parent.removeClass("viewport-right").removeClass("viewport-bottom");var w=h.parent[0].offsetLeft,v=h.parent[0].offsetTop;y&&(w=y.pageX+b(k).left,v=y.pageY+b(k).top,y="auto",b(k).positionLeft&&(y=a(window).width()-w,w="auto"),h.parent.css({left:w,
right:y,top:v}));y=a(window).scrollLeft();var z=a(window).scrollTop(),F=a(window).width(),E=a(window).height(),A=h.parent[0];y+F<A.offsetLeft+A.offsetWidth&&(w-=A.offsetWidth+20+b(k).left,h.parent.css({left:w+"px"}).addClass("viewport-right"));z+E<A.offsetTop+A.offsetHeight&&(v-=A.offsetHeight+20+b(k).top,h.parent.css({top:v+"px"}).addClass("viewport-bottom"))}}function l(y){function w(){h.parent.removeClass(v.extraClass).hide().css("opacity","")}if(!a.tooltip.blocked){r&&clearTimeout(r);k=null;var v=
b(this);u&&a.fn.bgiframe||!v.fade?w():h.parent.is(":animated")?h.parent.stop().fadeTo(v.fade,0,w):h.parent.stop().fadeOut(v.fade,w);b(this).fixPNG&&h.parent.unfixPNG()}}var h={},k,p,r,u=a.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),x=!1;a.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){a.tooltip.blocked=!a.tooltip.blocked}};a.fn.extend({tooltip:function(y){y=a.extend({},a.tooltip.defaults,y);h.parent||
(h.parent=a('<div id="'+y.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),a.fn.bgiframe&&h.parent.bgiframe(),h.title=a("h3",h.parent),h.body=a("div.body",h.parent),h.url=a("div.url",h.parent));var w=this.each(function(){a.data(this,"tooltip",y);this.tOpacity=h.parent.css("opacity");this.tooltipText=this.title;a(this).removeAttr("title");this.alt=""}).mouseover(d).mouseout(l);y.noHideOnClick||w.click(l);return w},fixPNG:u?function(){return this.each(function(){var y=
a(this).css("backgroundImage");y.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(y=RegExp.$1,a(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+y+"')"}).each(function(){var w=a(this).css("position");"absolute"!=w&&"relative"!=w&&a(this).css("position","relative")}))})}:function(){return this},unfixPNG:u?function(){return this.each(function(){a(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){a(this)[a(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
!function(a){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?a(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(f){f=f[0];return 0<f.offsetWidth&&0<f.offsetHeight}function c(f){if(f.minTime&&(f.minTime=A(f.minTime)),f.maxTime&&(f.maxTime=A(f.maxTime)),f.durationTime&&"function"!=typeof f.durationTime&&(f.durationTime=A(f.durationTime)),"now"==f.scrollDefault)f.scrollDefault=function(){return f.roundingFunction(A(new Date),
f)};else if(f.scrollDefault&&"function"!=typeof f.scrollDefault){var n=f.scrollDefault;f.scrollDefault=function(){return f.roundingFunction(A(n),f)}}else f.minTime&&(f.scrollDefault=function(){return f.roundingFunction(f.minTime,f)});if("string"===a.type(f.timeFormat)&&f.timeFormat.match(/[gh]/)&&(f._twelveHourTime=!0),!1===f.showOnFocus&&-1!=f.showOn.indexOf("focus")&&f.showOn.splice(f.showOn.indexOf("focus"),1),0<f.disableTimeRanges.length){for(var m in f.disableTimeRanges)f.disableTimeRanges[m]=
[A(f.disableTimeRanges[m][0]),A(f.disableTimeRanges[m][1])];f.disableTimeRanges=f.disableTimeRanges.sort(function(q,t){return q[0]-t[0]});for(m=f.disableTimeRanges.length-1;0<m;m--)f.disableTimeRanges[m][0]<=f.disableTimeRanges[m-1][1]&&(f.disableTimeRanges[m-1]=[Math.min(f.disableTimeRanges[m][0],f.disableTimeRanges[m-1][0]),Math.max(f.disableTimeRanges[m][1],f.disableTimeRanges[m-1][1])],f.disableTimeRanges.splice(m,1))}return f}function d(f){var n=f.data("timepicker-settings"),m=f.data("timepicker-list");
if(m&&m.length&&(m.remove(),f.data("timepicker-list",!1)),n.useSelect)var q=m=a("<select />",{"class":"ui-timepicker-select"});else m=a("<ul />",{"class":"ui-timepicker-list"}),q=a("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),q.css({display:"none",position:"absolute"}).append(m);if(n.noneOption)if(!0===n.noneOption&&(n.noneOption=n.useSelect?"Time...":"None"),a.isArray(n.noneOption))for(var t in n.noneOption){if(parseInt(t,10)==t){var B=e(n.noneOption[t],n.useSelect);m.append(B)}}else B=
e(n.noneOption,n.useSelect),m.append(B);(n.className&&q.addClass(n.className),null===n.minTime&&null===n.durationTime||!n.showDuration)||("function"==typeof n.step?"function":n.step,q.addClass("ui-timepicker-with-duration"),q.addClass("ui-timepicker-step-"+n.step));B=n.minTime;"function"==typeof n.durationTime?B=A(n.durationTime()):null!==n.durationTime&&(B=n.durationTime);t=null!==n.minTime?n.minTime:0;var H=null!==n.maxTime?n.maxTime:t+G-1;t>H&&(H+=G);H===G-1&&"string"===a.type(n.timeFormat)&&n.show2400&&
(H=G);var L=n.disableTimeRanges,I=0,Q=L.length,N=n.step;"function"!=typeof N&&(N=function(){return n.step});for(var O=0;H>=t;O++,t+=60*N(O)){var K=t,M=E(K,n);if(n.useSelect)var J=a("<option />",{value:M});else J=a("<li />"),J.addClass(43200>K%86400?"ui-timepicker-am":"ui-timepicker-pm"),J.data("time",86400>=K?K:K%86400);J.text(M);if((null!==n.minTime||null!==n.durationTime)&&n.showDuration)if(M=F(t-B,n.step),n.useSelect)J.text(J.text()+" ("+M+")");else{var P=a("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");J.append(P)}Q>I&&(K>=L[I][1]&&(I+=1),L[I]&&K>=L[I][0]&&K<L[I][1]&&(n.useSelect?J.prop("disabled",!0):J.addClass("ui-timepicker-disabled")));m.append(J)}(q.data("timepicker-input",f),f.data("timepicker-list",q),n.useSelect)?(f.val()&&m.val(g(A(f.val()),n)),m.on("focus",function(){a(this).data("timepicker-input").trigger("showTimepicker")}),m.on("blur",function(){a(this).data("timepicker-input").trigger("hideTimepicker")}),m.on("change",function(){x(f,a(this).val(),"select")}),x(f,
m.val(),"initial"),f.hide().after(m)):(t=n.appendTo,"string"==typeof t?t=a(t):"function"==typeof t&&(t=t(f)),t.append(q),p(f,m),m.on("mousedown click","li",function(R){f.off("focus.timepicker");f.on("focus.timepicker-ie-hack",function(){f.off("focus.timepicker-ie-hack");f.on("focus.timepicker",C.show)});h(f)||f[0].focus();m.find("li").removeClass("ui-timepicker-selected");a(this).addClass("ui-timepicker-selected");z(f)&&(f.trigger("hideTimepicker"),m.on("mouseup.timepicker click.timepicker","li",
function(S){m.off("mouseup.timepicker click.timepicker");q.hide()}))}))}function e(f,n){var m,q,t;return"object"==typeof f?(m=f.label,q=f.className,t=f.value):"string"==typeof f?m=f:a.error("Invalid noneOption value"),n?a("<option />",{value:t,"class":q,text:m}):a("<li />",{"class":q,text:m}).data("time",String(t))}function g(f,n){return f=n.roundingFunction(f,n),null!==f?E(f,n):void 0}function l(f){f.target!=window&&(f=a(f.target),f.closest(".ui-timepicker-input").length||f.closest(".ui-timepicker-wrapper").length||
(C.hide(),a(document).unbind(".ui-timepicker"),a(window).unbind(".ui-timepicker")))}function h(f){f=f.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&f.disableTouchKeyboard}function k(f,n,m){if(!m&&0!==m)return!1;f=f.data("timepicker-settings");var q=!1;m=f.roundingFunction(m,f);return n.find("li").each(function(t,B){t=a(B);if("number"==typeof t.data("time"))return t.data("time")==m?(q=t,!1):void 0}),q}function p(f,n){n.find("li").removeClass("ui-timepicker-selected");
var m=A(u(f),f.data("timepicker-settings"));null!==m&&(f=k(f,n,m))&&(m=f.offset().top-n.offset().top,(m+f.outerHeight()>n.outerHeight()||0>m)&&n.scrollTop(n.scrollTop()+f.position().top-f.outerHeight()),f.addClass("ui-timepicker-selected"))}function r(f,n){if(""!==this.value&&"timepicker"!=n){var m=a(this);if(!m.is(":focus")||f&&"change"==f.type){f=m.data("timepicker-settings");var q=A(this.value,f);if(null===q)return void m.trigger("timeFormatError");var t=!1;if(null!==f.minTime&&null!==f.maxTime&&
(q<f.minTime||q>f.maxTime)&&(t=!0),a.each(f.disableTimeRanges,function(){return q>=this[0]&&q<this[1]?(t=!0,!1):void 0}),f.forceRoundTime){var B=f.roundingFunction(q,f);B!=q&&(q=B,n=null)}f=E(q,f);t?x(m,f,"error")&&m.trigger("timeRangeError"):x(m,f,n)}}}function u(f){return f.is("input")?f.val():f.data("ui-timepicker-value")}function x(f,n,m){if(f.is("input")){f.val(n);var q=f.data("timepicker-settings");q.useSelect&&"select"!=m&&"initial"!=m&&f.data("timepicker-list").val(g(A(n),q))}return f.data("ui-timepicker-value")!=
n?(f.data("ui-timepicker-value",n),"select"==m?f.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(m)&&f.trigger("changeTime"),!0):(f.trigger("selectTime"),!1)}function y(f){switch(f.keyCode){case 13:case 9:break;default:f.preventDefault()}}function w(f){var n=a(this),m=n.data("timepicker-list");if(!m||!b(m)){if(40!=f.keyCode)return!0;C.show.call(n.get(0));m=n.data("timepicker-list");h(n)||n.focus()}switch(f.keyCode){case 13:return z(n)&&(r.call(n.get(0),
{type:"change"}),C.hide.apply(this)),f.preventDefault(),!1;case 38:var q=m.find(".ui-timepicker-selected");return q.length?q.is(":first-child")||(q.removeClass("ui-timepicker-selected"),q.prev().addClass("ui-timepicker-selected"),q.prev().position().top<q.outerHeight()&&m.scrollTop(m.scrollTop()-q.outerHeight())):(m.find("li").each(function(t,B){return 0<a(B).position().top?(q=a(B),!1):void 0}),q.addClass("ui-timepicker-selected")),!1;case 40:return q=m.find(".ui-timepicker-selected"),0===q.length?
(m.find("li").each(function(t,B){return 0<a(B).position().top?(q=a(B),!1):void 0}),q.addClass("ui-timepicker-selected")):q.is(":last-child")||(q.removeClass("ui-timepicker-selected"),q.next().addClass("ui-timepicker-selected"),q.next().position().top+2*q.outerHeight()>m.outerHeight()&&m.scrollTop(m.scrollTop()+q.outerHeight())),!1;case 27:m.find("li").removeClass("ui-timepicker-selected");C.hide();break;case 9:C.hide();break;default:return!0}}function v(f){var n=a(this),m=n.data("timepicker-list"),
q=n.data("timepicker-settings");if(!m||!b(m)||q.disableTextInput)return!0;switch(f.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:q.typeaheadHighlight?p(n,m):m.hide()}}function z(f){var n=f.data("timepicker-settings"),m=null,q=f.data("timepicker-list").find(".ui-timepicker-selected");return q.hasClass("ui-timepicker-disabled")?
!1:(q.length&&(m=q.data("time")),null!==m&&("string"!=typeof m&&(m=E(m,n)),x(f,m,"select")),!0)}function F(f,n){f=Math.abs(f);var m,q;f=Math.round(f/60);var t=[];return 60>f?t=[f,D.mins]:(m=Math.floor(f/60),q=f%60,30==n&&30==q&&(m+=D.decimal+5),t.push(m),t.push(1==m?D.hr:D.hrs),30!=n&&q&&(t.push(q),t.push(D.mins))),t.join(" ")}function E(f,n){if("number"!=typeof f)return null;var m=parseInt(f%60),q=parseInt(f/60%60),t=parseInt(f/3600%24);t=new Date(1970,0,2,t,q,m,0);if(isNaN(t.getTime()))return null;
if("function"===a.type(n.timeFormat))return n.timeFormat(t);for(var B="",H=0;H<n.timeFormat.length;H++)switch(m=n.timeFormat.charAt(H)){case "a":B+=11<t.getHours()?D.pm:D.am;break;case "A":B+=11<t.getHours()?D.PM:D.AM;break;case "g":m=t.getHours()%12;B+=0===m?"12":m;break;case "G":m=t.getHours();f===G&&(m=n.show2400?24:0);B+=m;break;case "h":m=t.getHours()%12;0!==m&&10>m&&(m="0"+m);B+=0===m?"12":m;break;case "H":m=t.getHours();f===G&&(m=n.show2400?24:0);B+=9<m?m:"0"+m;break;case "i":q=t.getMinutes();
B+=9<q?q:"0"+q;break;case "s":m=t.getSeconds();B+=9<m?m:"0"+m;break;case "\\":H++;B+=n.timeFormat.charAt(H);break;default:B+=m}return B}function A(f,n){if(""===f||null===f)return null;if("object"==typeof f)return 3600*f.getHours()+60*f.getMinutes()+f.getSeconds();if("string"!=typeof f)return f;f=f.toLowerCase().replace(/[\s\.]/g,"");"a"!=f.slice(-1)&&"p"!=f.slice(-1)||(f+="m");var m="("+D.am.replace(".","")+"|"+D.pm.replace(".","")+"|"+D.AM.replace(".","")+"|"+D.PM.replace(".","")+")?",q=f.match(new RegExp("^"+
m+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+m+"$"));if(!q)return null;f=parseInt(1*q[2],10);if(24<f){if(n&&!1===n.wrapHours)return null;f%=24}m=q[1]||q[5];var t=f;12>=f&&m&&(t=m==D.pm||m==D.PM,t=12==f?t?12:0:f+(t?12:0));q=3600*t+60*(1*q[3]||0)+(1*q[4]||0);12>f&&!m&&n&&n._twelveHourTime&&n.scrollDefault&&(n=q-n.scrollDefault(),0>n&&n>=G/-2&&(q=(q+G/2)%G));return q}var G=86400,D={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},C={init:function(f){return this.each(function(){var n=
a(this),m=[],q;for(q in a.fn.timepicker.defaults)n.data(q)&&(m[q]=n.data(q));m=a.extend({},a.fn.timepicker.defaults,m,f);if(m.lang&&(D=a.extend(D,m.lang)),m=c(m),n.data("timepicker-settings",m),n.addClass("ui-timepicker-input"),m.useSelect)d(n);else{if(n.prop("autocomplete","off"),m.showOn)for(var t in m.showOn)n.on(m.showOn[t]+".timepicker",C.show);n.on("change.timepicker",r);n.on("keydown.timepicker",w);n.on("keyup.timepicker",v);m.disableTextInput&&n.on("keydown.timepicker",y);r.call(n.get(0),
null,"initial")}})},show:function(f){var n=a(this),m=n.data("timepicker-settings");if(f&&f.preventDefault(),m.useSelect)return void n.data("timepicker-list").focus();h(n)&&n.blur();f=n.data("timepicker-list");if(!n.prop("readonly")&&(f&&0!==f.length&&"function"!=typeof m.durationTime||(d(n),f=n.data("timepicker-list")),!b(f))){n.data("ui-timepicker-value",n.val());p(n,f);C.hide();f.show();var q={};m.orientation.match(/r/)?q.left=n.offset().left+n.outerWidth()-f.outerWidth()+parseInt(f.css("marginLeft").replace("px",
""),10):q.left=n.offset().left+parseInt(f.css("marginLeft").replace("px",""),10);"t"==(m.orientation.match(/t/)?"t":m.orientation.match(/b/)?"b":n.offset().top+n.outerHeight(!0)+f.outerHeight()>a(window).height()+a(window).scrollTop()?"t":"b")?(f.addClass("ui-timepicker-positioned-top"),q.top=n.offset().top-f.outerHeight()+parseInt(f.css("marginTop").replace("px",""),10)):(f.removeClass("ui-timepicker-positioned-top"),q.top=n.offset().top+n.outerHeight()+parseInt(f.css("marginTop").replace("px",""),
10));f.offset(q);q=f.find(".ui-timepicker-selected");if(!q.length){var t=A(u(n));null!==t?q=k(n,f,t):m.scrollDefault&&(q=k(n,f,m.scrollDefault()))}q&&q.length?(q=f.scrollTop()+q.position().top-q.outerHeight(),f.scrollTop(q)):f.scrollTop(0);return m.stopScrollPropagation&&a(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(B){B.preventDefault();var H=a(this).scrollTop();a(this).scrollTop(H+B.originalEvent.deltaY)}),a(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
l),a(window).on("resize.ui-timepicker",l),m.closeOnWindowScroll&&a(document).on("scroll.ui-timepicker",l),n.trigger("showTimepicker"),this}},hide:function(f){f=a(this);var n=f.data("timepicker-settings");return n&&n.useSelect&&f.blur(),a(".ui-timepicker-wrapper").each(function(){var m=a(this);if(b(m)){var q=m.data("timepicker-input"),t=q.data("timepicker-settings");t&&t.selectOnBlur&&z(q);m.hide();q.trigger("hideTimepicker")}}),this},option:function(f,n){return"string"==typeof f&&"undefined"==typeof n?
a(this).data("timepicker-settings")[f]:this.each(function(){var m=a(this),q=m.data("timepicker-settings"),t=m.data("timepicker-list");"object"==typeof f?q=a.extend(q,f):"string"==typeof f&&(q[f]=n);q=c(q);m.data("timepicker-settings",q);t&&(t.remove(),m.data("timepicker-list",!1));q.useSelect&&d(m)})},getSecondsFromMidnight:function(){return A(u(this))},getTime:function(f){var n=u(this);if(!n)return null;n=A(n);if(null===n)return null;f||(f=new Date);f=new Date(f);return f.setHours(n/3600),f.setMinutes(n%
3600/60),f.setSeconds(n%60),f.setMilliseconds(0),f},isVisible:function(){var f=this.data("timepicker-list");return!(!f||!b(f))},setTime:function(f){var n=this.data("timepicker-settings"),m=n.forceRoundTime?g(A(f),n):E(A(f),n);return f&&null===m&&n.noneOption&&(m=f),x(this,m),this.data("timepicker-list")&&p(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var f=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),f.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};a.fn.timepicker=function(f){return this.length?C[f]?this.hasClass("ui-timepicker-input")?C[f].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof f&&f?void a.error("Method "+f+" does not exist on jQuery.timepicker"):C.init.apply(this,arguments):this};a.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(f,n){if(null===f)return null;if("number"!=typeof n.step)return f;var m=f%(60*n.step);return m>=30*n.step?f+=60*n.step-m:f-=m,f==G&&n.show2400?f:f%G},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(a){var b=function(c,d,e){var g=/[^\w\-\.:]/.test(c)?new Function(b.arg+",tmpl","var _e=tmpl.encode"+b.helper+",_s='"+c.replace(b.regexp,b.func)+"';return _s;"):e?b.cache[c]=b(b.load(c)):b.cache[c]=b.cache[c]||b(b.load(c));return d?g(d,b):function(l){return g(l,b)}};b.cache={};b.load=function(c){var d=document.getElementById(c),e=/<\\\/(\w+)/g;if(!d&&console)throw{message:"template with id="+c+" not found"};return d?("textarea"==d.tagName.toLowerCase()?d.value:document.getElementById(c).innerHTML).replace(e,
"</$1"):null};b.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;b.func=function(c,d,e,g,l,h){if(d)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[c]||"\\"+c;if(e)return"="===e?"'+_e("+g+")+'":"'+("+g+"||'')+'";if(l)return"';";if(h)return"_s+='"};b.encReg=/[<>&"'\x00]/g;b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};b.encode=function(c){return String(c||"").replace(b.encReg,function(d){return b.encMap[d]||""})};b.arg="o";b.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return b}):a.tmpl=b})(this);(function(a){a.fn.lazyLoad=function(b,c){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&h(l,g)<=e.distance){if(null!==e.hash){var k=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(k)){this.onscroll=null;return}}e.load()}}if("stop"==b){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==b){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==b){if(e=this.data("lazyLoadSettings"))e.loading=
!0}else if("wake"==b){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==b)(e=this.data("lazyLoadSettings"))&&(e.loading||e.load());else{if("get"===b)return e=this.data("lazyLoadSettings")||{},e[c];this.data("lazyLoadSettings",a.extend({distance:50,load:function(){},container:l,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},b||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var g=a(window),l=e.container||a(this);
null===e.hash||a.isArray(e.hash)||(e.hash=[e.hash]);a.fn.lazyLoad.call(g,e.state);(function(){var k,p=setTimeout(k=function(){if(e.stopped)clearTimeout(p);else{if(null!==e.hash){var r=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(r)){clearTimeout(p);return}}e.loading?p=setTimeout(k,350):(h(l,g),h(l,g)<=e.distance?(e.load(),p=setTimeout(k,350)):(g.get(0).onscroll=d,clearTimeout(p)))}},350)})();var h="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:
function(k,p,r){k="string"===typeof k?a(k):k;r=r||0;return k.position().top+k.outerHeight()-r-(p.scrollTop()+p.height())}}}})(jQuery);(function(a){a.storage=new a.store;a.orders={options:{view:"table"},init:function(b){var c=this;c.options=b;"undefined"!=typeof a.History&&a.History.bind(function(){c.dispatch()});a.ajaxPrefilter(function(d,e,g){g.originalRequestOptions=e});a.wa.errorHandler=function(d){var e=d.originalRequestOptions||{};if(403===d.status||404===d.status){d=a(d.responseText);d=d.find(".dialog-content").length?a('<div class="block double-padded"></div>').append(d.find(".dialog-content *")):a('<div class="block double-padded"></div>').append(d.find(":not(style)"));
var g="content";e=e.url||"";if(0<e.length){var l=e.indexOf("?");-1!==l&&(e=e.substr(l+1),e=a.shop.helper.parseParams(e)||{},"order"===e.module&&"table"!==e.view&&a("#s-order").length&&(g="order"))}"order"===g?a("#s-order").empty().append(d):(a("#s-content").empty().append(d),a.order_list&&a.order_list.finit());return!1}return!0};b=window.location.hash;"#/"!==b&&b?a.wa.setHash(b):this.dispatch();this.initSearch();this.initDropdown();a(document).bind("wa.appcount",function(d,e){e=e||{};d=parseInt(e.shop,
10);a("#s-pending-orders .small").text(d?"+"+d:"");(e=document.title.match(/\(\d+\) /))?document.title=document.title.replace(e[0],d?"("+d+") ":""):d&&(document.title="("+d+") "+document.title)});a(function(){a("#maincontent").on("click",".s-alert-close",function(d){d.preventDefault();d=a.storage.get("shop/alerts");var e=a(this).parent();d||(d=[]);d.push(e.data("alert"));d=d.filter(function(g,l,h){return null!=g&&l==h.indexOf(g)});a.storage.set("shop/alerts",d);e.remove()})});this.checkAlerts();this.ordersNavDetach()},
initSearch:function(){var b=a("#s-orders-search"),c=[],d=null,e=function(g){switch(g.autocomplete_item_type){case "order":a.wa.setHash("#/order/"+g.id+"/");b.val(g.value);break;case "contact":a.wa.setHash("#/orders/contact_id="+g.id+"/");b.val(g.value);break;case "product":a.wa.setHash("#/orders/product_id="+g.id+"/");b.val(g.value);break;case "coupon":a.wa.setHash("#/orders/coupon_id="+g.id+"/");break;case "tracking_number":a.wa.setHash("#/orders/tracking_number="+g.value+"/");break;case "shipping":a.wa.setHash("#/orders/shipping_id="+
g.id+"/");break;case "payment":a.wa.setHash("#/orders/payment_id="+g.id+"/");break;case "city":a.wa.setHash("#/orders/city="+g.value+"/");break;case "region":a.wa.setHash("#/orders/region="+((g.value||"").split(":")[1]||"")+"/");break;case "country":a.wa.setHash("#/orders/country="+g.value+"/");break;case "item_code":a.wa.setHash("#/orders/item_code="+g.value+"/")}};b.unbind("keydown").bind("keydown",function(g){if(13==g.keyCode||10==g.keyCode){if(d)return!1;var l=a(this);if(!a(this).val())return location.hash=
"#/orders/all/",l.autocomplete("close"),!1;if(c&&a.isArray(c)&&c.length)return e(c[0]),setTimeout(function(){l.autocomplete("close")},150),!1}});b.autocomplete({minLength:1,delay:300,html:!0,select:function(g,l){e(l.item);return!1},source:function(g,l){d&&d.abort();d=a.getJSON("?action=autocomplete&type=order",g,function(h){c=h;l(h)}).always(function(){d=null})}})},initDropdown:function(){a(".js-orders-dropdown").waDropdown({ready:function(b){var c=window.location.hash;if(c){var d=decodeURIComponent(c).replace(/#\/orders\/|hash=search\/|\/$/g,
"").split("&").filter(Boolean);if(d.length){var e=b.$menu.find(".js-orders-link");e.length&&e.each(function(){var g=a(this);d.some(function(l){return l==g.data("param")})&&b.$button.html(g.html());d.some(function(l){return decodeURIComponent(g.attr("href")).includes(l)})&&b.$button.html(g.html())})}a(".js-remove-filters-link").toggleClass("hidden",!c.includes("hash=search"))}c=b.$menu.find('[href="'+c+'"]');c.length&&b.$button.html(c.html())},items:".menu > li > a",change:function(b,c,d){b=window.location.hash;
var e=a(c).data("param"),g=["storefront","sales_channel"];b.includes("hash=search")&&!e&&(e=decodeURIComponent(a(c).attr("href").replace(/#\/orders\/|\/$/g,"")));if(e){b=decodeURIComponent(b).replace(/#\/orders\/|hash=search\/|&id=\d+|\/$/g,"").split("&").filter(Boolean);var l=b.findIndex(function(p){return p.includes("state_id")});if(0<=l){var h;b[l]=null==(h=b[l])?void 0:h.replaceAll("|","||")}h=b.findIndex(function(p){return g.some(function(r){return p.includes(r)})});-1!==h&&g.some(function(p){return e.includes(p)})&&
(b[h]=e);h=$jscomp.makeIterator(e.split("="));var k=h.next().value;h=h.next().value;l=b.findIndex(function(p){return p.includes(k)});-1!==l?b[l]=k+"="+h:b.push(e);b=encodeURIComponent("/"+b.join("&"));b="/orders/"+"hash=search".concat(b);a.wa.setHash(b);a(".js-remove-filters-link").toggleClass("hidden",!1)}else location.replace(a(c).attr("href"));d.$button.html(a(c).html())}});a(".js-remove-filters-link").on("click",function(){a(".js-orders-dropdown").find(".dropdown-toggle").each(function(){var b=
a(this).data("text");b&&a(this).text(b)})})},prevHash:null,hash:null,skipDispatch:0,stopDispatch:function(b){this.skipDispatch=b},forceHash:function(b){location.hash!=b&&(this.skipDispatch++,a.wa.setHash(b))},dispatch:function(b){if(0<this.skipDispatch)return this.skipDispatch--,!1;if(void 0===b||null===b)b=window.location.hash;b=b.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);this.hash=b;var c=new a.Event("wa_before_dispatched");a(window).trigger(c);if(b)if(b=b.split("/"),
b[0]){c="";var d,e=null,g=null;for(d=0;d<b.length;d++){var l=b[d];if(2>d){if(0===d)c=l;else if(parseInt(l,10)!=l&&-1==l.indexOf("="))c+=l.substr(0,1).toUpperCase()+l.substr(1);else break;"function"==typeof this[c+"Action"]&&(e=c,g=d+1)}else break}"function"!==typeof this[c+"Action"]&&e&&(c=e,d=g);b=b.slice(d);this.preExecute(c);"function"==typeof this[c+"Action"]?(a.shop.trace("$.orders.dispatch",[c+"Action",b]),this[c+"Action"].apply(this,b)):a.shop.error("Invalid action name:",c+"Action");this.postExecute(c)}else this.preExecute(),
this.defaultAction(),this.postExecute();else this.preExecute(),this.defaultAction(),this.postExecute()},back:function(){var b=a.orders.prevHash||"";location.hash=b?b+"/":""},preExecute:function(b,c){},postExecute:function(b,c){this.actionName=b},defaultAction:function(){this.ordersAction()},couponsAction:function(){a.order_list&&a.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(b){this.load("?module=order&action=edit&id="+b,function(){a.order_list&&a.order_list.finit()})},
ordersNewAction:function(b){this.load("?module=order&action=edit"+(b?"&"+b:""),function(){a.order_list&&a.order_list.finit()})},ordersAction:function(b){if("hash"===b)b={hash:Array.prototype.slice.call(arguments,1).join("/")};else{var c="";"search"===b&&(c=Array.prototype.slice.call(arguments,1));1<arguments.length&&(b=Array.prototype.join.call(arguments,"/"));b?"all"===b&&(b=""):b="state_id=new|processing|auth|paid";b=a.shop.helper.parseParams(b||"");b.view||(b.view=a.storage.get("shop/orders/view")||
this.options.view);a.storage.set("shop/orders/view",b.view);a.order_edit&&a.order_edit.slideBack();c&&(b.search=c)}"orders"===this.actionName&&a.order_list?a.order_list.dispatch(b):(a.order_list&&a.order_list.finit(),this.load("?module=orders&"+this.buildOrdersUrlComponent(b),function(){a(window).trigger("wa_loaded",[["table"]]);a.order_list&&a.order_list.dispatch(b)}))},orderAction:function(b,c){c=a.shop.helper.parseParams(c||"");c.view||(c.view=a.storage.get("shop/orders/view")||this.options.view);
a.storage.set("shop/orders/view",c.view);a.order_edit&&a.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(b)+"&"+this.buildOrdersUrlComponent(c),function(){var d=a("#s-content").find("#s-order-title a.back.order-list");d.show();var e=a("#s-all-orders");e.length&&e.hasClass("shadowed")&&(e=e.find("a:first"),e.length&&d.attr("href",e.attr("href")))});a.order_list&&a.order_list.finit()},buildOrdersUrlComponent:function(b){var c="",d;for(d in b)b.hasOwnProperty(d)&&"view"!==d&&
(c+="&"+d+"="+b[d]);return"view="+(b.view||this.options.view)+c},load:function(b,c,d){function e(){var k=a(".js-order-view"),p=a("#s-order, #s-orders").length;k.length&&(p?k.removeClass("hidden"):k.addClass("hidden"))}function g(){var k=a(".js-orders-sort"),p=a("#s-order, #s-orders").length;k.length&&(p?k.removeClass("hidden"):k.addClass("hidden"))}"function"===typeof c?(d=c,c={}):c=c||{};var l=Math.random();this.random=l;var h=this;return a.get(b,function(k){if("undefined"!==typeof c.check&&!c.check||
h.random==l){(c.content||a("#s-content")).removeClass("bordered-left").html(k);"function"===typeof d&&d.call(this);var p=a(window);setTimeout(function(){p.trigger("scroll")},250);e();g();h.checkAlerts()}})},checkAlerts:function(){var b=a.storage.get("shop/alerts");a.shop.trace("checkAlerts",b);a(".s-alert").each(function(){-1==a.inArray(a(this).data("alert"),b)&&a(this).show()})},ordersNavDetach:function(){void 0===window.ordersNav&&(window.ordersNav=a("#s-order-nav").detach())}}})(jQuery);(function(a){a.order_list={id:0,options:{},container:null,$selectionMenu:null,$search_form:null,sidebar:null,select_all_input:null,plugin_hash:"",filter_params:{},filter_params_str:"",params:null,timer_id:0,lazy_load_win:null,all_printforms:null,sort:["create_datetime","desc"],drawer_order:"",touched:!1,xhrs:{lazy_load:null,update_load:null,printforms:null},init:function(b){this.options=b=b||{};this.plugin_hash=b.plugin_hash||"";this.filter_params=b.filter_params||{};this.filter_params_str=b.filter_params_str||
"";this.drawer_order=b.drawer_order;this.container=a("#order-list");"table"==b.view&&(this.container=a("#order-list").find("tbody:first"),this.$selectionMenu=this.options.$selectionMenu)&&(this.select_all_input=this.$selectionMenu.find(".s-order-list-select-all"),this.select_all_input.attr("checked",!1),a(".js-selection-dropdown").waDropdown());if("split"==b.view){var c=function(g){if(d.test(window.location.hash)){var l=a("#s-orders"),h=a("#s-order"),k=!0;l.hide(200,function(){l.addClass("desktop-and-tablet-only");
a(this).show()});h.removeClass("desktop-and-tablet-only");setTimeout(function(){k=!1});a(window).unbind("hashchange");h.find(".back.order-list").addClass("js-close-drawer mobile-only").show().attr("href",window.location.hash.replace(d,"")).on("click",function(){h.addClass("desktop-and-tablet-only");l.removeClass("desktop-and-tablet-only");a(window).off("hashchange");k=!0});a(window).on("hashchange",function(){k||(console.log("hashchange"),a(".js-close-drawer",h).trigger("click"))})}},d=/&id=\d+/g;
this.container.off().on("orderMobile",function(g,l){a.shop.helper.isMobile()&&a.order_list.touched&&l&&a.order_list.id&&(a.order_list.touched=!1,console.log("orderMobile",l),c(l))});this.container.on("touchstart","li[data-order-id]",function(g){a.order_list.touched=!0});this.container.on("click","li[data-order-id]",function(){if(a.order_list.touched){var g=a(this),l=a.order_list.params.id||a.order_list.id;l!=g.data("order-id")||d.test(window.location.hash)||(g=a("a.details",g).attr("href"),a.wa.setHash(g),
a(this).trigger("orderMobile",[l]))}});this.container.on("click","[data-order-id]:not(.selected) a",function(){a.skeletonLoader.repeatShow()})}this.options.all_order_state_ids=this.options.all_order_state_ids||null;this.sidebar=a("#s-sidebar");this.id=b.id||0;this.container.on("append_order_list",function(){a("#s-orders [data-wa-tooltip-content]").waTooltip()});if(b.orders&&b.orders.length&&b.view){try{"kanban"==this.options.view?this.container.html(a("#template-order-list-kanban")[0].innerHTML.replace(/<\\\//g,
"</")):this.container.append(tmpl("template-order-list-"+this.options.view,{orders:b.orders,states:b.state_names||{}},!0)),this.container.trigger("append_order_list",[b.orders])}catch(g){return a.shop.notification({class:"danger",content:"Error: "+g.message}),console&&console.log(g.stack),this}delete b.orders;delete this.options.orders}b.lazy_loading&&this.initLazyLoad(b.lazy_loading);b.counters&&this.updateCounters(b.counters);b.update_process&&b.count&&this.updateProcess("run",b.update_process);
if(b.sort&&b.sort[0]){b.sort[0]=""+b.sort[0];var e=a(".js-orders-sort .s-sort").map(function(){var g=a(this).data("sort")||"";return g?g:!1}).toArray();0>e.indexOf(b.sort[0])&&(b.sort[0]=e[0]);b.sort[1]=b.sort[1]||"";b.sort[1]="desc"===b.sort[1].toLowerCase()?"desc":"asc";this.sort=b.sort}this.ordersNavTeleport();this.initView();this.selectionMenuTeleport()},initLazyLoad:function(b){function c(){var k=d.container.find(".order:last");(k=parseInt(k.attr("data-order-id"),10))?(a(".lazyloading-link").hide(),
a(".lazyloading-progress").show(),a.getJSON(d.buildLoadListUrl(k),function(p){if("ok"==p.status){try{d.container.append(tmpl("template-order-list-"+d.options.view,{orders:p.data.orders,states:d.options.state_names||{},check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),d.container.trigger("append_order_list",[p.data.orders]),d.container.find("[data-order-id="+d.options.id+"]").length&&(d.container.find(".selected").removeClass("selected"),d.container.find("[data-order-id="+
d.options.id+"]").addClass("selected"))}catch(r){console&&console.log(r.stack);return}h&&l.unobserve(h);a(".lazyloading-progress-string").text(p.data.progress.loaded+" "+p.data.progress.of);a(".lazyloading-progress").hide();a(".lazyloading-chunk").text(p.data.progress.chunk);p.data.loaded>=p.data.total_count?a(".lazyloading-link").hide():(a(".lazyloading-link").show(),(h=d.container.find(".order:last").get(0))&&l.observe(h))}else console&&console.log("Error when loading orders: "+p.errors)}).error(function(p){console&&
(p&&p.errors?console.log("Error when loading orders: "+p.errors):p?console.log(p):console.log("Error when loading orders"))})):console.log("Unknown last item")}if("kanban"!==this.options.view){var d=this,e=d.options.count,g=d.options.total_count,l=null,h=null;b=a("#s-orders");b.on("touchstart",function(){a("body").css({overflow:"hidden"});a(this).children(".sidebar-body").css({overflow:"auto"});setTimeout(function(){a("body").css({overflow:"auto"})})});b.off("click",".lazyloading-link").on("click",
".lazyloading-link",function(){c();return!1});(function(){l=new IntersectionObserver(function(k){0>=k[0].intersectionRatio||(console&&console.log("observe:load"),e<g&&c())});(h=d.container.find(".order:last").get(0))&&l.observe(h)})()}},initView:function(){function b(l){var h=a.order_list.getSelectedOrders(),k=function(){c.$selectionMenu.addClass("disabled");c.$selectionMenu.find(".js-selection-menu-loading").show();c.select_all_input.attr("disabled",!0);g(l,h,function(){c.$selectionMenu.removeClass("disabled");
c.$selectionMenu.find(".js-selection-menu-loading").hide();c.select_all_input.removeAttr("disabled");c.select_all_input.trigger("select",!1);a.orders.dispatch()})};h.all?confirm($_("Perform action to all selected orders?"))&&k():k()}var c=this;this.initSortMenu();this.initSidebar();"table"==this.options.view&&c.$selectionMenu&&c.$selectionMenu.length&&this.initSelecting();this.options.id&&(a.order_list.touched=a.shop.helper.isMobile(),this.loadOrder(this.options.id));var d=a("#s-orders-views"),e=
a("#s-order-nav");d.find("li.selected").removeClass("selected");d.find('li[data-view="'+this.options.view+'"]').addClass("selected");e.attr("data-view-mode",this.options.view);d.find("li a").each(function(){var l=a(this),h=a(this).parents("li:first");l.attr("href","#/orders/view="+h.attr("data-view")+(a.order_list.options.filter_params_str?"&"+a.order_list.options.filter_params_str:"")+"/")});var g=function(l,h,k){var p=function(){var w=a(window),v=a.Deferred();if(!h.all||!c.options.lazy_loading||
w.lazyLoad("get","stopped"))return v.resolve(),v;c.container.one("append_order_list.ensureOrderListChunkLoaded",function(){v.resolve()});setTimeout(function(){c.container.off("append_order_list.ensureOrderListChunkLoaded");v.resolve()},2E3);w.lazyLoad("force");return v},r=function(w){var v=a.Deferred();if(a.isEmptyObject(w.data.orders))return v.resolve(),v;c.container.one("append_order_list.updateOrderListChunk",function(){v.resolve()});setTimeout(function(){c.container.off("append_order_list.updateOrderListChunk");
v.resolve()},1E3);c.updateListItems(w.data.orders);return v},u=function(w){var v=a.Deferred(),z=function(){if(!c.container.find(".order:not(:hidden):first").length){var D='<div class="block double-padded align-center blank"><br><br><br><br><span class="gray large">'+$_("There are no orders in this view.")+'</span><div class="clear-left"></div></div></div>';a("#s-content").html(D)}},F=[],E=c.filter_params;if(!a.isEmptyObject(w.data.orders))for(var A=0,G=w.data.orders.length;A<G;A++)!a.isEmptyObject(E)&&
E.state_id&&("string"===a.type(E.state_id)&&E.state_id!==w.data.orders[A].state_id?F.push(w.data.orders[A].id):"array"===a.type(E.state_id)&&-1===E.state_id.indexOf(w.data.orders[A].state_id)&&F.push(w.data.orders[A].id));a.isEmptyObject(F)?(z(),v.resolve()):(c.hideListItems(F).done(function(){z();v.resolve()}),setTimeout(function(){v.resolve()},1E3));return v},x=function(w){var v=a.Deferred();p().done(function(){r(w).done(function(){u(w).done(function(){a.order_list.updateCounters({state_counters:w.data.state_counters,
common_counters:{pending:w.data.pending_count}});v.resolve()})})});return v},y=function(w,v){a.shop.jsonPost("?module=orders&action=performAction&id="+l+"&offset="+(w||0)+"&"+c.options.filter_params_str,h,function(z){"ok"===z.status?x(z).done(function(){z.data.offset<z.data.total_count?y(z.data.offset,v):v(z)}):v(z)})};y(0,k)};if(c.$selectionMenu)c.$selectionMenu.off("click.order_list",".js-wf-action-item").on("click.order_list",".js-wf-action-item",function(){var l=a(this),h=l.data("action-id");
if(!l.hasClass("disabled"))return h&&b(h),!1})},loadOrder:function(b){if(!a.shop.helper.isMobile()||a.order_list.touched)this.container.find(".selected").removeClass("selected"),this.container.find("[data-order-id="+b+"]").addClass("selected"),a.orders.load("?module=order&id= "+b+"&"+this.filter_params_str,{content:a("#s-order")},function(){this.id=b;a(window).trigger("wa_loaded",[["split","kanban"]]);a("#order-list").trigger("orderMobile",[b])})},getSelectedOrders:function(b){b=b||!1;var c={count:0,
all:!1};if(this.select_all_input.attr("checked")){c.all=!0;var d=a.order_list.filter_params;b?(c.serialized=[],a.isEmptyObject(d)?c.serialized.push({name:"filter_params",value:""}):a.each(d,function(e,g){a.isArray(g)?a.each(g,function(l,h){c.serialized.push({name:"filter_params["+e+"]["+l+"]",value:h})}):c.serialized.push({name:"filter_params["+e+"]",value:g})})):c.filter_params=a.isEmptyObject(d)?"":d;c.count=this.options.total_count}else b?c.serialized=a.order_list.container.find(".order.selected").map(function(){c.count+=
1;return{name:"order_id[]",value:a(this).attr("data-order-id")}}).toArray():c.order_id=a.order_list.container.find(".order.selected").map(function(){c.count+=1;return a(this).attr("data-order-id")}).toArray();return c},initSortMenu:function(){var b=this,c=a(".js-orders-sort"),d=c.find(".js-sort-dropdown-skeleton");c=c.find(".js-sort-dropdown");var e;e||c.waDropdown({items:".menu > li > a",ready:function(g){e=g;g.setValue("sort",b.sort[0])},change:function(g,l,h){g=a(l);var k=h.$button.data();l=k.sort;
k=k.order;g.data("sort")===l?k="desc"===k?"asc":"desc":(l=g.data("sort"),k="desc");g.find("."+k).removeClass("hidden").siblings(".count").addClass("hidden");h.$button.find("."+k).removeClass("hidden").siblings(".count").addClass("hidden");g=$jscomp.makeIterator([l,k]);h=g.next().value;g=g.next().value;e.$button.data("sort",h);e.$button.data("order",g);l=window.location.hash||"";l=l.replace(/(^[^#]*#\/*|\/$)/g,"");l.split("/")[1]||(l="#/orders/state_id=new|processing|auth|paid");l=l.replace(/(&*sort\[[01]\]=.*?[&\/]|&*sort\[[01]\]=.*?$)/g,
"");(k=0<l.indexOf("="))&&(l=l.replace(/[\/&]$/,""));a.wa.setHash(l+((k?"&":"")+"sort[0]="+h+"&sort[1]="+g+"/"))}});c.removeClass("hidden");d.addClass("hidden")},initSidebar:function(){var b=this.sidebar,c=this.options.view;b.find(".bricks a").each(function(){var e=a(this),g=e.attr("href"),l=g.match(/view=((.*)&|(.*)\/|(.*))/);if(l)e.attr("href",g.replace("view="+(l[2]||l[3]||l[4]),"view="+c));else if(l=g.match(/^#\/orders\/hash\/(.*?)\/?$/))e.attr("href","#/orders/view="+c+"&hash="+encodeURIComponent(l[1])+
"/");else if(l=g.match(/orders\/((.*)\/|(.*))/))l[1]?(g=l[2]||l[3],g+="&view="+c):g="view="+c,e.attr("href","#/orders/"+g+"/")});var d=b.find(".selected").removeClass("selected");this.filter_params.state_id?a.isArray(this.filter_params.state_id)?a("#s-pending-orders").addClass("selected"):b.find('[data-state-id="'+this.filter_params.state_id+'"]').addClass("selected"):this.filter_params.contact_id?b.find("[data-contact-id="+this.filter_params.contact_id+"]").addClass("selected"):this.filter_params.storefront?
(d=decodeURIComponent(this.filter_params.storefront),"/"===d.slice(-1)&&(d=d.slice(0,-1)),b.find('[data-storefront="'+d+'"]').addClass("selected")):a.order_list.filter_params_str?b.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||d.addClass("selected"):a("#s-all-orders").addClass("selected");b.find(".js-orders-link").unbind("click.order_list").bind("click.order_list",function(){b.find(".selected").removeClass("selected");a(this).hasClass("brick")?a(this).addClass("selected"):
a(this).closest("li").addClass("selected");if(a(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==a.orders.hash){var e=a.orders.hash.replace("orders/","");e!==a.orders.hash&&a.orders.ordersAction.apply(a.orders,e.split("/"))}})},updateSelectionMenuActionItemsByStates:function(b){var c=[];if("string"===typeof b)c.push(b);else if(a.isArray(b))c=[].concat(b);else return;b=this.$selectionMenu.find(".wf-actions .js-wf-action-item");b.addClass("disabled");var d={};b.each(function(){var g=a(this),l=g.data("actionId");
g=g.data("availableForStates").split(",");for(var h=0;h<c.length;h++){var k=c[h];k=""+k;-1!==g.indexOf(k)&&(d[k]=d[k]||[],d[k].push(l))}});var e=a.shop.intersectArrays(a.shop.getValues(d),!0);0<e.length&&b.filter(function(){return-1<a.inArray(a(this).data("actionId"),e)}).removeClass("disabled")},enableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").removeClass("disabled")},disableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").addClass("disabled")},
initSelecting:function(){var b=this,c=this.container,d=this.select_all_input;b.filter_params&&b.filter_params.state_id&&d.is(":checked")&&b.updateSelectionMenuActionItemsByStates(b.filter_params.state_id);d.click(function(){a(this).trigger("select",this.checked)});a(window).one("wa_before_dispatched",function(k){b.$selectionMenu.hide()});b.xhrs.printforms=null;var e=function(k){k=tmpl("template-order-list-printforms-menu-items",k);var p=b.$selectionMenu.find(".wf-actions");p.find(".s-printform-item,.s-printform-item-sep,.s-printform-item-button").remove();
p.append(k)};a(document).keydown(function(k){16!=k.keyCode||a(k.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(k){16==k.keyCode&&(document.body.onselectstart=null)});var g=function(){var k=a("#order-list"),p=d.attr("checked");k=k.find(".order.selected:first").length;p||k?(b.$selectionMenu.show(),b.$search_form&&b.$search_form.hide(),k=null,k=p?b.options.all_order_state_ids?b.options.all_order_state_ids:b.filter_params&&b.filter_params.state_id?
b.filter_params.state_id:null:b.container.find(".order.selected").map(function(){return a(this).data("stateId")}).toArray(),null!==k?(k=a.shop.getUniqueValues(k),b.updateSelectionMenuActionItemsByStates(k)):b.enableAllSelectionMenuActionItems()):(b.$selectionMenu.hide(),b.$search_form&&b.$search_form.show())};c.off("select",".order").on("select",".order",function(k,p){(void 0!==p?p:1)?a(this).addClass("selected").find("input:first").attr("checked",!0).prop("checked",!0):(a(this).removeClass("selected").find("input:first").attr("checked",
!1).prop("checked",!1),d.is(":checked")&&d.attr("checked",!1).prop("checked",!1));g();return!1});var l=function(){b.xhrs.printforms&&b.xhrs.printforms.abort();e({printforms:[]});b.xhrs.printforms=null;d.is(":checked")&&null!==a.order_list.all_printforms?e({printforms:a.order_list.all_printforms}):b.xhrs.printforms=a.shop.getJSON("?module=orders&action=printforms",b.getSelectedOrders(),function(k){a.isEmptyObject(k.data.printforms)||(d.is(":checked")&&(a.order_list.all_printforms=k.data.printforms),
e(k.data),b.xhrs.printforms=null)})};d.unbind("select").bind("select",function(k,p){p=void 0!==p?p:!0;k=a(this);p?(k.attr("checked",!0),c.find(".order").trigger("select",!0,!1)):(k.attr("checked",!1),c.find(".order").trigger("select",!1,!1));l()});c.off("click",".order input").on("click",".order input",function(k){var p=k.shiftKey;k=this.checked;var r=a(this).parents(".order:first");k?r.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),r.removeClass("selected"));if(p&&k){(p=c.data("last_checked"))||
(p=c.find(".order:first").trigger("select",!0));var u=r.prevAll(".selected[data-order-id="+p.attr("data-order-id")+"]");if(u.length){var x=r.prev();for(p=p.get(0);x.length&&p!=x.get(0);)x.addClass("selected").find("input").attr("checked",!0),x=x.prev()}else if(u=r.nextAll(".selected[data-order-id="+p.attr("data-order-id")+"]"),u.length)for(x=r.next(),p=p.get(0);x.length&&p!=x.get(0);)x.addClass("selected").find("input").attr("checked",!0),x=x.next();c.data("last_checked")||u.length||p.trigger("selected",
!1)}k&&c.data("last_checked",r);g();l()});var h=function(k,p){if(100<p.count)alert($_("Maximum of %d orders is allowed for bulk form printing.").replace("%d",100));else{var r="?module=orders&action=printformsDisplay";p=a.map(p.serialized,function(u){return u.name+"="+u.value}).join("&");k=a.map(k,function(u){return"form[]="+u}).join("&");r+="&"+p+"&"+k;a.order_list.plugin_hash&&(r+="&hash="+a.order_list.plugin_hash);k=(""+Math.random()).slice(2);window.open(r,k)}};b.$selectionMenu.off("click.printforms").on("click.printforms",
".s-printform-item-button",function(k){k.preventDefault();b.xhrs.printforms&&b.xhrs.printforms.abort();b.xhrs.printforms=null;k=b.$selectionMenu.find(".s-printform-item :checkbox").map(function(){var r=a(this);return r.is(":checked")?r.data("id"):!1}).toArray();if(k.length){var p=b.getSelectedOrders(!0);if(!(0>=p.count))return h(k,p),!1}})},updateTitle:function(b,c){c=parseInt(c,10)||0;var d="";this.options.state_names&&(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?d=
this.options.state_names[this.filter_params.state_id].name:a.isArray(this.filter_params.state_id)&&(d=$_("Processing")):d=$_("All orders"));document.title=c?"("+c+") "+d+(b||""):d+b},updateCounters:function(b){var c=this.sidebar;c||(c=a("#s-sidebar"));var d=a("#s-pending-orders .small"),e;for(e in b)if(b.hasOwnProperty(e)){var g=b[e],l;for(l in g)if(g.hasOwnProperty(l)){var h="common_counters"==e?a("#s-"+l+"-orders .count"):"storefront_counters"===e?c.find("li[data-"+e.replace("_counters","")+'="'+
l+'"] .count'):c.find("li[data-"+e.replace("_counters","")+"-id="+l+"] .count");var k=parseInt(h.text(),10)||0;g[l]=""+g[l];"+"==g[l].substr(0,1)?k+=parseInt(g[l].substr(1),10)||0:"-"==g[l].substr(0,1)?(k-=parseInt(g[l].substr(1),10)||0,k=0>k?0:k):k=parseInt(g[l],10)||0;h.text(k);"new"==l&&(d.text(k?"+"+k:""),a.shop.updateAppCounter(k),this.updateTitle(this.options.title_suffix,parseInt(k,10)))}}},updateListItems:function(b){if("kanban"!==this.options.view){var c="template-order-list-"+this.options.view;
if(document.getElementById(c)){var d=this.container;a.isArray(b)||(b=[b]);c=a("<div></div>").append(tmpl(c,{orders:b,states:this.options.state_names,check_all:"table"==this.options.view?this.select_all_input.attr("checked"):!1}));var e=a(".order",d);a(".order",c).each(function(){var g=a(this);e.filter("[data-order-id="+g.attr("data-order-id")+"]").replaceWith(g)});c.remove();this.container.trigger("append_order_list",[b])}}},hideListItems:function(b){var c=a.Deferred();setTimeout(function(){if(a.order_list&&
a.order_list.container&&a.order_list.container.length){if(a.isArray(b)){var d=a.order_list.container.find(".order");l=a();for(var e=0;e<b.length;e++){var g=d.filter("[data-order-id="+b[e]+"]");l=l.add(g)}}else var l=a.order_list.container.find(".order[data-order-id="+b+"]");var h=l.length,k=0;l.slideUp(450,function(){k++;k>=h&&c.resolve()})}},1E3);return c.promise()},dispatch:function(b,c){"string"===typeof b&&(b=a.shop.helper.parseParams(b));var d={list:function(){a.order_list.finit();a.orders.load("?module=orders&"+
a.orders.buildOrdersUrlComponent(b),function(){a.order_list.dispatch(b);a(window).trigger("wa_loaded",[["table"]])})},order:function(){a.order_list.loadOrder(b.id)}};null===this.params?(this.params=b,c&&d.list()):b.id&&(c||b.id!=this.params.id)?(d.order(),this.params=b):(c||this.diff(b,this.params)||this.diff(this.params,b))&&d.list()},diff:function(b,c){for(var d in b)if(b.hasOwnProperty(d)&&"id"!=d&&b[d]!==c[d])return!0;return!1},buildLoadListUrl:function(b,c,d,e){e=void 0===e?"":e;return"?module=orders&action=loadList&id="+
b+(this.filter_params_str?"&"+this.filter_params_str:"")+(c?"&lt=1":"")+(d?"&counters=1":"")+(this.options.view?"&view="+this.options.view:"")+(""!=e?"&search=update_datetime>="+e:"")+("&sort[0]="+this.sort[0]+"&sort[1]="+this.sort[1])},updateProcess:function(b,c){b=b||"run";c=c||{};timeout=c.timeout||6E4;var d=this,e=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};e();if("run"==b){var g=function(k,
p){var r=d.container.find(".order:first");r=parseInt(r.attr("data-order-id"),10)||0;l(r);return a.getJSON(d.buildLoadListUrl(r,!0,!0),function(u){if("ok"==u.status){a.isEmptyObject(u.data.counters)||d.updateCounters(u.data.counters);if(u.data.count)try{d.container.prepend(tmpl("template-order-list-"+d.options.view,{orders:u.data.orders,states:d.options.state_names||{},check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),a(".lazyloading-progress-string").text(u.data.progress.loaded+
" "+u.data.progress.of),d.container.trigger("append_order_list",[u.data.orders])}catch(x){console&&(console.log("Error: "+x.message),p());return}"function"===typeof k&&k(u)}else console&&console.log("Error when loading new orders: "+u.errors),"function"===typeof p&&p()}).error(function(u){console&&(u&&u.errors?console.log("Error when loading new orders: "+u.errors):console.log(["Error when loading new orders",u]));"function"===typeof p&&p()})},l=function(k){var p=new Date;p.setTime(p.getTime()-timeout);
var r=p.getFullYear(),u=("0"+(p.getMonth()+1)).slice(-2),x=("0"+p.getDate()).slice(-2),y=("0"+p.getHours()).slice(-2),w=("0"+p.getMinutes()).slice(-2);p=("0"+p.getSeconds()).slice(-2);return a.getJSON(d.buildLoadListUrl(k,!1,!1,r+"-"+u+"-"+x+" "+y+":"+w+":"+p),function(v){if("ok"==v.status){var z;if(null==(z=v.data)?0:z.updated_orders.length)try{z={};for(var F=$jscomp.makeIterator(v.data.updated_orders),E=F.next();!E.done;z={$jscomp$loop$prop$order$3:z.$jscomp$loop$prop$order$3,$jscomp$loop$prop$orderElem$8:z.$jscomp$loop$prop$orderElem$8,
$jscomp$loop$prop$oldStateId$5:z.$jscomp$loop$prop$oldStateId$5,$jscomp$loop$prop$newStateId$6:z.$jscomp$loop$prop$newStateId$6,$jscomp$loop$prop$hashStateIds$7:z.$jscomp$loop$prop$hashStateIds$7},E=F.next()){z.$jscomp$loop$prop$order$3=E.value;z.$jscomp$loop$prop$orderElem$8=d.container.find("[data-order-id="+z.$jscomp$loop$prop$order$3.id+"]");var A=z.$jscomp$loop$prop$orderElem$8.hasClass("selected");if(z.$jscomp$loop$prop$orderElem$8.length){z.$jscomp$loop$prop$oldStateId$5=z.$jscomp$loop$prop$orderElem$8.data("order-state");
z.$jscomp$loop$prop$newStateId$6=z.$jscomp$loop$prop$order$3.state_id;var G=decodeURIComponent(window.location.hash),D=void 0,C=void 0,f=void 0;z.$jscomp$loop$prop$hashStateIds$7=(null==(D=/state_id=([\w|]+)/.exec(G))?void 0:null==(C=D[1])?void 0:null==(f=C.replace(/\|{1,2}/g,","))?void 0:f.split(","))||[];var n=function(m){return function(q){var t={orders:[m.$jscomp$loop$prop$order$3],states:d.options.state_names||{},check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1};m.$jscomp$loop$prop$orderElem$8.after(tmpl("template-order-list-"+
d.options.view,t)).remove();q&&d.loadOrder(m.$jscomp$loop$prop$order$3.id)}}(z);(function(m){return function(){if(m.$jscomp$loop$prop$oldStateId$5!==m.$jscomp$loop$prop$newStateId$6){if(m.$jscomp$loop$prop$hashStateIds$7.some(function(t){return m.$jscomp$loop$prop$newStateId$6.includes(t)}))return!0;var q=m.$jscomp$loop$prop$orderElem$8.next();q.length&&d.loadOrder(q.data("order-id"));m.$jscomp$loop$prop$orderElem$8.remove();return!1}return!0}})(z)()?n(A):z.$jscomp$loop$prop$orderElem$8.remove()}}d.container.trigger("append_order_list",
[v.data.updated_orders])}catch(m){console&&console.log("Error: "+m.message)}}else console&&console.log("Error when loading updated orders: "+v.errors)}).error(function(v){console&&(v&&v.errors?console.log("Error when loading updated orders: "+v.errors):console.log(["Error when loading updated orders",v]));"function"===typeof error&&error()})},h=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=g(h,e):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=g(h,e)})},
timeout)};h()}},finit:function(b){b=this.xhrs;var c=this.lazy_load_win,d;for(d in b)b.hasOwnProperty(d)&&null!==b[d]&&b[d].abort();this.updateProcess("kill");c&&c.lazyLoad("stop");this.params=null},ordersNavTeleport:function(){void 0!==window.ordersNav&&void 0!==a.orders&&(window.ordersNav.show(),"split"===this.options.view?a("#s-orders").find(".sidebar-header").prepend(window.ordersNav):a("#s-content").before(window.ordersNav),a.orders.initDropdown())},selectionMenuTeleport:function(){if(this.$selectionMenu&&
(this.$search_form=a(".js-sidebar-search-form"),this.$search_form.length)){var b=this.$selectionMenu.detach();this.$search_form.after(b)}}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_form:null,$storefront_selector:null,stocks:[],slide_on:!1,options:{},locales:{},init:function(a){this.options=a;a.id&&(this.id=a.id);this.container="string"===typeof a.container?$(a.container):a.container;this.form="string"===typeof a.form?$(a.form):a.form;this.$storefront_selector=$("#order-storefront");a.stocks.sort(function(b,c){return b.sort-c.sort});this.stocks=a.stocks;a.title&&(document.title=title);a.float_delimeter||(a.float_delimeter=
".");a.locales&&(this.locales=a.locales);this.float_delimeter=a.float_delimeter;this.prev_ship_method=null;this.container.trigger("order_edit_init");this.initView();this.initShippingControl();this.initDiscountControl();this.initCouponControl();this.initCustomerSourceControl(a.customer_sources)},initCustomerForm:function(a){this.customer_form=new ShopBackendOrderEditorCustomerForm($("#s-order-edit-customer"),this,a)},initView:function(){var a=this,b=a.options;this.initStorefrontSelector();var c=function(h){var k=
h.find(".s-orders-sku-stock-select").find("option:selected"),p=h.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");h.find(".s-orders-stock-icon-aggregate").show();h.find(".s-orders-stock-icon").html("").hide();p=p.length?p:h;k.attr("data-icon")&&(p.find(".s-orders-stock-icon-aggregate").hide(),p.find(".s-orders-stock-icon").html(k.attr("data-icon")).show(),h.find(".s-orders-stock-icon .s-stock-left-text").show(),p.find(".s-orders-stock-icon .s-stock-left-text").hide())};
$.order_edit.slide(!0,"add"==b.mode);this.container.find(".back").click(function(){$.order_edit.id?$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.getOrderItems(this.container,!0);$(".s-order-item").each(function(){var h=$(this);c(h)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());$.order_edit.options.currency=$(this).val()});var d=b.price_edit||!1,e=$("#orders-add-autocomplete");e.autocomplete({source:"?action=autocomplete&with_counts=1",
minLength:3,delay:300,select:function(h,k){$(".s-order-errors").empty();h="?module=orders&action=getProduct&product_id="+k.item.id+"&order_id="+$.order_edit.id+"&currency="+$.order_edit.options.currency;(k=a.getStorefront())&&(h+="&storefront="+k);$.getJSON(h,function(p){var r=$("#order-items"),u=parseInt(r.find(".s-order-item:last").attr("data-index"),10)+1||0;r=p.data.product;r.sku_id&&r.skus[r.sku_id]&&(r.skus[r.sku_id].checked=!0);1===$("#total.hidden").length&&($("#productless-total").addClass("hidden").prop("disabled",
!0).hide(),$("#total").removeClass("hidden").show());$("#order-currency").length&&!$("#order-currency").attr("disabled")&&($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled","disabled"));var x=$("#s-orders-add-row");x.before(tmpl("template-order",{data:p.data,options:{index:u,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:d}}));p=x.prev();u=r.skus[r.sku_id];$.order_edit.initQuantity({$wrapper:p.find("#js-quantity-section").removeAttr("id"),
denominator:r.order_multiplicity_factor,step:u.order_count_step||r.order_count_step,min:u.order_count_min||r.order_count_min});$("#s-order-comment-edit").show();$.order_edit.updateTotal();c(p)});e.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",".s-orders-skus input[type=radio]",function(){var h=$(this),k=h.parents("tr:first"),p=h.closest("li"),r=this.value,u=k.attr("data-product-id"),x=k.attr("data-index"),y=null;"edit"==($.order_edit.id?"edit":"add")&&
(y=parseInt(h.attr("name").replace("sku[edit][",""),10));h="?module=orders&action=getProduct&product_id="+u+"&sku_id="+r+"&currency="+$.order_edit.options.currency;(r=a.getStorefront())&&(h+="&storefront="+r);$.getJSON(h,function(w){var v=-1!==k.find("input:first").attr("name").indexOf("add")?"add":"edit";k.find(".s-orders-services").replaceWith(tmpl("template-order-services-"+v,{services:w.data.sku.services,service_ids:w.data.service_ids,product_id:u,options:{price_edit:d,index:x,currency:$.order_edit.options.currency,
stocks:$.order_edit.stocks}}));k.find(".s-orders-product-price").find("input").val(w.data.sku.price);k.find(".s-orders-sku-stock-place").empty();p.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+v,{sku:w.data.sku,index:x,stocks:$.order_edit.stocks,item_id:y}));var z=k.find(".js-order_count_min");if(z.length){v=w.data.sku;z=z.find(".js-value");var F=w.data.sku.order_count_min?parseFloat(w.data.sku.order_count_min):parseFloat(w.data.product.order_count_min);z.text(F);z=parseFloat(v.count);
F=k.find(".s-orders-sku-stock-select");if(F.length&&v.stock){var E=F.val();E&&v.stock[E]&&(z=parseFloat(v.stock[E]));F.data("stock",v.stock)}F=k.find(".js-quantity-field").data("controller");F.update({min:v.order_count_min?parseFloat(v.order_count_min):parseFloat(w.data.product.order_count_min),max:z});console.log(F)}c(k);$.order_edit.updateTotal()})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var h=$(this).parents("tr.s-order-item:first"),
k=h.find(".s-orders-sku-stock-select");if(k.length){var p=k.val();k=k.data("stock");if(p&&k&&k[p]){var r=h.find(".js-quantity-field").data("controller");r.update({max:parseFloat(k[p])});console.log(r)}}c(h)});var g=function(h,k,p){var r=h.attr("data-price");h=h.attr("data-percent-price");p&&k.val(r);k.attr("data-price",r);k.attr("data-percent-price",h)};this.container.off("change",".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var h=$(this),k=h.find("option:selected");
h=h.parents("li:first");g(k,h.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var h=$(this),k=h.find("option:selected");h=h.parents("li:first");g(k,h.find(".s-orders-service-price"),!1)});this.container.off("click",".s-order-item-delete").on("click",".s-order-item-delete",function(){$(this).parents("tr:first").remove();$("table#order-items").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});
this.container.off("change",".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",".s-orders-product-price input",function(){var h=$(this).parents("tr:first");$.order_edit.updateServicePriceInPercent(h);$.order_edit.updateTotal()});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);
$("#payment_methods").change(function(){$(this).val();$("#payment-info > div").hide();$.order_edit.updateTotal()});this.container.off("keydown",".s-orders-quantity").on("keydown",".s-orders-quantity",function(){var h=$(this),k=h.data("timer_id");k&&clearTimeout(k);h.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},450))});if(this.form&&this.form.length){var l=function(){var h=$(this);if(l.xhr)return!1;$.order_edit.showValidateErrors();$('.s-orders-services input[name^="service"][type="checkbox"]:not(:checked),.s-orders-services input.js-fake-service-selected[type="checkbox"]:not(:checked)',
this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",!0)});if(!$.order_edit.container.find(".error").length){$.order_edit.switchSubmitButton("disable");var k=function(){l.xhr=null;$.order_edit.switchSubmitButton();$(".s-orders-services input:disabled",h).attr("disabled",!1)};l.xhr=$.order_edit.id?$.order_edit.saveSubmit(k,"edit"):$.order_edit.saveSubmit(k,"add")}return!1};this.form.unbind("sumbit").bind("submit",l)}$("#subtotal").text(this.roundFloat($("#subtotal").text()));
$("#total").text(this.roundFloat($("#total").text()));$("#discount").val(this.roundFloat($("#discount").val()));$("#tax").text(this.roundFloat($("#tax").text()));this.container.trigger("order_edit_init_view")},initShippingControl:function(){var a=this;a.prev_ship_method=$("#shipping_methods").val();$("#shipping-custom").on("change",":input",function(b){$.shop.trace("#shipping-custom change",[b,this]);b.originalEvent&&$(this).data("affects-rate")&&$.order_edit.updateTotal()});a.setShippingInfo();$("#shipping_methods").change(function(){var b=
$("#shipping_methods option:selected"),c=b.data("rate")||0,d=$("#shipping-rate");d.data("shipping")&&b.val()==a.prev_ship_method||(d.val($.order_edit.formatFloat(c)),d.data("shipping",!1),a.prev_ship_method=b.val());a.setShippingInfo();$.order_edit.updateTotal()});$("#shipping-rate").change(function(){var b=$(this);if(0>b.val())return alert($.order_edit.locales.wrong_cost),b.val(0),!1;$("#shipping-rate").data("shipping",$(this).val());$.order_edit.updateTotal()});this.container.trigger("order_edit_init_shipping")},
initDiscountControl:function(){function a(){0<$.order_edit.parseFloat(b.val())?g.stop().show():g.stop().hide();var h=25;g.is(":visible")&&g.finish().fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+50)}var b=$("#discount"),c=$("#discount-description"),d=$("#update-discount"),e=$("#edit-discount"),g=$("#discount-tooltip-icon");g.tooltip({showURL:!1,bodyHandler:function(){return c.val()||c.data("updated-manually-msg")}});d.tooltip({showURL:!1,
bodyHandler:function(){return d.data("description")||c.data("updated-manually-msg")}});e.length?g.show():g.hide();$("#order-edit-form").on("order_total_updated",function(h,k){b.show();b.parent().find("span.js-order-discount:first").hide();e.hide();d.data("description",k.discount_description);if(k.discount){d.data("value",k.discount).data("description",k.discount_description).data("items_discount",k.items_discount);if("calculate"===d.data("discount")){c.val(d.data("description"));h=d.data("items_discount")||
[];for(var p=0;p<h.length;p++)if(h[p]){var r="#order-items span.js-item-total-discount";r+='[data-discount-id="'+h[p].selector+'"]';r=$(r);r.length&&r.html(h[p].html).show()}a()}"calculate"===d.data("discount")?$.order_edit.parseFloat(k.discount)!==$.order_edit.parseFloat(b.val())&&d.click():d.show()}});var l=function(){b.show();b.parent().find("span.js-order-discount:first").hide();e.hide();$(".js-item-total-discount").hide()};e.click(function(){l();c.val("");return!1});d.click(function(){l();b.val(d.data("value")||
0).change();c.val(d.data("description"));b.attr("title",c.data("edit-manually-msg"));d.hide().data("discount","calculate");$.order_edit.updateTotal();a();return!1});b.on("change",function(){e.click();c.val("");$("#order-items .js-item-total-discount").hide();b.attr("title",null);d.show().data("discount",$(this).val());$.order_edit.updateTotal();a()});this.container.trigger("order_edit_init_discount")},initCouponControl:function(){function a(){r.show();r.css("padding-right",$(".coupon-controls").width()+
4+"px")}var b=$("#coupon_id"),c=$("#coupon-code"),d=$(".coupon-code-label"),e=$(".js-no-coupon-text"),g=$(".js-coupon-icon"),l=$(".js-edit-coupon"),h=$(".js-close-coupon"),k=$(".js-delete-coupon"),p=$("#update-discount"),r=$("#js-coupon-invalid-msg");l.on("click",function(){$(this).add(e).add(g).add(d).hide();c.data("value",c.val());c.val("").show();h.show()});h.click(function(){c.val(c.data("value"));l.show();""===b.val()?e.show():g.add(d).show();$(this).add(c).add(r).hide()});k.click(function(){$(this).add(c).add(g).add(d).add(l).add(h).add(r).hide();
b.val("");p.click();e.add(l).show()});$(".disabled-link").click(function(u){u.preventDefault()});c.autocomplete({source:function(u,x){$.ajax({type:"POST",url:"?module=marketing&action=CouponsAutocomplete",data:{term:c.val(),products:$('input[name^="product["]').serializeArray()},success:function(y){x(y);y.length?r.hide():a()},error:function(){x([])}})},minLength:1,delay:300,select:function(u,x){x.item.data.valid?(c.val(x.item.label).hide(),b.val(x.item.value),d.html(x.item.label).show(),l.add(g).add(k).show(),
x.item.data.right?($(".s-order-edit-coupon").attr("href",$(".s-order-edit-coupon").data("href")+x.item.value),0!=x.item.value.length&&(p.click(),$(".s-order-edit-coupon").removeClass("disabled-link"))):0!=x.item.value.length&&p.click(),h.hide()):(c.val(x.item.label),a());return!1}})},initCustomerSourceControl:function(a){var b=$("#customer-source");b.autocomplete({delay:0,minLength:0,appendTo:"#order-edit-form",source:function(c,d){var e=a.filter(function(g){return g&&g.indexOf&&0<=g.indexOf(c.term)}).slice(0,
10);1==e.length&&e[0]==c.term?d([]):d(e)}}).on("focus",function(){b.autocomplete("search")})},initUpdateServicePrice:function(){this.container.find(".s-order-item").each(function(){$.order_edit.updateServicePriceInPercent($(this))})},initQuantity:function(a){function b(d,e){var g=e="string"===typeof e?e:""+e;switch(d){case "float":d=parseFloat(e);0<=d&&(g=1*d.toFixed(3));break;case "number":var l="0123456789.,".split(""),h=[],k=!1;$.each(e.split(""),function(p,r){"."===r||","===r?k||(k=!0,h.push(".")):
0<=l.indexOf(r)&&h.push(r)});g=h.join("");break;case "integer":l="0123456789".split(""),h=[],$.each(e.split(""),function(p,r){0<=l.indexOf(r)&&h.push(r)}),g=h.join("")}return g}var c=function(d){c=function(e){this.$wrapper=e.$wrapper;this.$field=this.$wrapper.find(".js-quantity-field");this.denominator="undefined"!==typeof e.denominator?b("float",e.denominator):1;this.denominator=0<this.denominator?this.denominator:1;this.min="undefined"!==typeof e.min?b("float",e.min):this.denominator;this.min=0<
this.min?this.min:1;this.max="undefined"!==typeof e.max?b("float",e.max):0;this.max=0<=this.max?this.max:0;this.step="undefined"!==typeof e.step?b("float",e.step):1;this.step=0<this.step?this.step:1;e=this.$field.val();0<parseFloat(e)||0===parseFloat(e)||(this.$field.val(this.min),e=this.min);this.value=this.validate(e);this.init()};c.prototype.init=function(){function e(l){var h="0123456789.".split(""),k=[],p=!1;l=l.replace(/,/g,".");d.each(l.split(""),function(r,u){"."===u?p||(p=!0,k.push(u)):0<=
h.indexOf(u)&&k.push(u)});return k.join("")}var g=this;g.$field.data("controller",g);g.$wrapper.data("controller",g);g.$field.on("input",function(){var l=g.$field.val();var h=e("string"===typeof l?l:""+l);h!==l&&g.$field.val(h)});g.$field.on("change",function(){g.set(g.$field.val())})};c.prototype.set=function(e,g){e=this.validate(e);this.$field.val(e);this.value=e;this.$wrapper.trigger("quantity.changed",[this.value,this])};c.prototype.validate=function(e){e="number"!==typeof e?parseFloat(e):e;e=
parseFloat(e.toFixed(3));0<e?.001>e?e=.001:this.max&&.001<this.max&&e>this.max&&(e=this.max):0!==e&&(e=.001);return b("float",e)};c.prototype.update=function(e){var g="undefined"!==typeof e.min?b("float",e.min):this.min,l="undefined"!==typeof e.max?0<=parseFloat(e.max)?b("float",e.max):0:this.max,h="undefined"!==typeof e.step?b("float",e.step):this.step;e="undefined"!==typeof e.value?this.validate(e.value):this.value;0<g&&g!==this.min&&(this.min=g);0<=l&&l!==this.max&&(this.max=l);0<h&&h!==this.step&&
(this.step=h);0<e&&e!==this.value&&(this.value=e);this.set(this.value)};return c}($);return new c(a)},updateServicePriceInPercent:function(a){var b=a.find(".js-order-edit-item-price").val();if("undefined"===typeof b)return null;a.find('[data-currency="%"]').each(function(){var c=$(this),d=b*(c.data("percentPrice")/100);d=$.order_edit.roundFloat(d);c.val($.order_edit.formatFloat(d));c.attr("data-price",d)})},setShippingInfo:function(){var a=$("#shipping_methods"),b=a.children(":selected"),c=$("#shipping-rate"),
d=$("#shipping-info"),e=a.val(),g=a.data("_shipping_id"),l=$.order_edit.checkSelectedAddressFields(),h=[];b.length?(b.data("error")&&!l&&h.push('<span class="error">'+b.data("error")+"</span>"),b.data("est_delivery")&&h.push('<span class="hint est_delivery">'+b.data("est_delivery")+"</span>"),$("#shipping-custom > div").hide(),null!==e&&(e=(""+e).replace(/\..+$/,""),$("#shipping-custom-"+e).length&&$("#shipping-custom-"+e).show()),b.data("comment")&&h.push('<span class="hint">'+b.data("comment")+
"</span>"),h?(b.data("error")&&!l?(c.addClass("error"),a.addClass("error")):(c.removeClass("error"),a.removeClass("error")),d.html(h.join("<br>")).show()):(c.removeClass("error"),d.empty().hide())):a.addClass("error");$.shop.trace("check shipping_methods id",[g,e,b])},checkSelectedAddressFields:function(){var a=$('[name="customer[address.shipping][city]"]'),b=$('[name="customer[address.shipping][region]"]');a=[{exists:0<a.length,selected:""!=a.val()},{exists:0<b.length,selected:""!=b.val()}];var c=
b=0,d;for(d in a){var e=a[d];e.exists&&b++;e.exists&&e.selected&&c++}return b==c},getOrderItems:function(a){var b=[],c=[];a.find(".s-order-item").each(function(){var d=$(this),e=d.find('input[name^="product"]').val(),g=[],l=$.order_edit.parseFloat(d.find(".s-orders-product-price input").val()),h=$.order_edit.parseFloat(d.find("input.s-orders-quantity").val()),k=d.find("select.s-orders-sku-stock-select").val(),p=d.data("item-id"),r=d.find("input[name^=sku]:not(:radio)").add(d.find("input[name^=sku]:checked")).first().val()||
0,u={product_id:e,sku_id:r,services:[]};d.find(".s-orders-services").length&&d.find(".s-orders-services input:checkbox:checked").each(function(){var x=$(this).closest("li"),y=$.order_edit.parseFloat(x.find("input.s-orders-service-price").val()),w=$(this).val();x=x.find(':input[name^="variant["]').val();g.push({id:w,price:y,variant_id:x});u.services.push(w)});u.services.sort();u.services=u.services.join("_");b.push({id:p,product_id:e,quantity:h,price:l,sku_id:r,services:g,stock_id:k});c.push(u)});
c=this.reduceOrderContent(c);a.data("order-content",c);return b},reduceOrderContent:function(a){a.sort(function(b,c){var d=b.product_id-c.product_id;0===d&&(d=b.sku_id-c.sku_id);0===d&&(d=b.services.localeCompare(c.services));return d});return a.map(function(b){return"*"+b.product_id+":"+b.sku_id+":"+b.services}).join(";")},updateTotal:function(){function a(){b=null;$.order_edit.realUpdateTotal()}var b=null;return function(){b?(clearTimeout(b),b=setTimeout(a,250)):b=setTimeout(a,500)}}(),realUpdateTotal:function(){var a=
$.order_edit.container,b=$("#subtotal"),c=$("#total"),d=$("#tax");if(a.find(".s-order-item").length){var e=this;$.order_edit.switchSubmitButton("disable");$.order_edit.showValidateErrors();for(var g={},l=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),h=0;h<l.length;h++)g[l[h].name]=l[h].value;g.storefront=e.getStorefront();g.items=$.order_edit.getOrderItems(a);var k=$("#update-discount").data("discount");void 0!==k&&("calculate"!==k&&(k=$.order_edit.parseFloat(k)),g.discount=
k);$.order_edit.id?g.order_id=$.order_edit.id:g.currency=$("#order-edit-form input[name=currency]").val();a=$("#shipping_methods").val();l=$("#payment_methods").val();h=$("#coupon_id").val();$("#shipping-rate").data("shipping")&&(g.shipping=$("#shipping-rate").data("shipping"));g.params={shipping_id:a,coupon_id:h,payment_id:l};g["customer[id]"]=g.contact_id=$("#s-customer-id").val();g.tax="calculate";a&&(a=parseInt(a.split(".")[0]),0<a&&$("#shipping-custom").find(">#shipping-custom-"+a+" :input").each(function(){g[this.name]=
this.value}));$.ajax({type:"POST",url:"?module=order&action=total",data:g,success:function(p){function r(q){var t=$("#payment_methods"),B=$("#payment-info"),H=t.val();t.html("");B.html("");t.append("<option value=''></option>");t.val("");q.length&&$.each(q,function(L,I){t.append('<option value="'+I.id+'">'+I.name+"</option>");I.id===H&&(t.val(H),I.custom_html&&$("<div />",{id:"payment-custom-"+I.id,class:"fields form"}).html(I.custom_html).appendTo(B))})}if(p&&"ok"===p.status){var u=$("#shipping-rate"),
x=$("#shipping_methods"),y=$.trim(x.val())||"",w=y.replace(/\W.+$/,"");p.data&&(p.data=$.order_edit.parseTotalResponse(p.data));x.empty();x.prepend('<option value=""></option>');if(0<p.data.shipping_method_ids.length){var v=$("#shipping-custom");v.empty();var z=p.data.shipping_method_ids,F=p.data.shipping_methods,E=!1,A=!1;-1!==z.indexOf(y)&&(E=!0);E||-1===z.indexOf(Number(w))||(A=E=!0);v.find(">div.fields.form").hide();for(var G=0;G<z.length;G+=1){var D=""+z[G],C=F[D],f=D.replace(/\W.+$/,""),n=$("<option></option>");
n.html(C.name).attr("value",D).data("rate",C.rate);n.data("error",C.error||void 0);n.data("est_delivery",C.est_delivery||void 0);n.data("comment",C.comment||void 0);n.data("external",C.external||!1);x.append(n);y||0!==G||$("#shipping-rate").val($.order_edit.formatFloat(C.rate));if(w==f){if(C.custom_data)for(var m in C.custom_data)C.custom_data.hasOwnProperty(m)&&n.data(m,C.custom_data[m]);C.custom_html&&(n=v.find("#shipping-custom-"+f),n.length||(n=v.append('<div id="shipping-custom-'+f+'" class="fields form"></div>'),
n=v.find("#shipping-custom-"+f)),n.html(C.custom_html))}if(!E&&(C=(""+D).split("."),f=y.split("."),""!==f[0]&&void 0!==C[0]&&void 0!==f[0]&&C[0]==f[0])){y=D;x.val(y);$.order_edit.setShippingInfo();$.order_edit.realUpdateTotal();return}}x.val(y);A&&x.val(w);x.data("_shipping_id",w);$.shop.trace("set shipping_methods id",[w,y])}r(p.data.payment_methods);""!=k&&$("#discount").val(p.data.discount);u.val(p.data.shipping);$("#order-edit-form").trigger("order_total_updated",p.data);b.text(p.data.subtotal);
c.text(p.data.total);d.text(p.data.tax);$.order_edit.showValidateErrors(p.data.errors);e.setShippingInfo()}$.order_edit.switchSubmitButton()},dataType:"json"})}else b.text(0),c.text(0),$.order_edit.checkSelectedAddressFields()&&($("#shipping_methods, #shipping-rate").removeClass("error"),$("#shipping-info").empty().hide())},saveSubmit:function(a,b){var c=this.form,d=c.serializeArray();"calculate"===$("#update-discount").data("discount")?$(d).each(function(){"discount"==this.name&&(this.value="calculate")}):
void 0===$("#update-discount").data("discount")&&(d=d.filter(function(g){return"discount"!==g.name}),0<$("#discount").val()?d.discount_description=$("#edit-discount").val():d=d.filter(function(g){return"discount_description"!==g.name}));success="add"==b?function(g){$.order_edit.container.trigger("order_edit_save_success",{data:g.data,is_new:!0});$.order_edit.slide(!1,!0)&&(location.href="#/orders/state_id=new&view=split&id="+g.data.order.id+"/")}:function(g){$.order_edit.container.trigger("order_edit_save_success",
{data:g.data,is_new:!1});$.order_edit.container.find(".back").click()};if(1===$("#total.hidden").length){var e=[{name:"quantity[edit][0][product]",value:1},{name:"product[edit][0]",value:0},{name:"sku[edit][0]",value:0},{name:"name[edit][0]",value:$.order_edit.locales.noproduct_item_name},{name:"item[edit][0]",value:0},{name:"currency",value:$("#order-currency").val()}];d=[].concat($jscomp.arrayFromIterable(d),$jscomp.arrayFromIterable(e))}this.container.trigger("order_edit_save",d);return $.shop.jsonPost(c.attr("action"),
d,success,function(g){$.shop.trace(b,g);g&&g.errors&&!$.isEmptyObject(g.errors)&&$.order_edit.showValidateErrors(g.errors)},a)},parseTotalResponse:function(a){["total","discount","shipping","tax","subtotal"].forEach(function(b){if("number"===typeof a[b]||"string"===typeof a[b])a[b]=$.order_edit.roundFloat(parseFloat((+a[b]).toFixed(2)))});return a},roundFloat:function(a){return a?this.formatFloat(Math.round(100*a)/100):0},formatFloat:function(a){return","===this.float_delimeter?(""+a).replace(".",
","):""+a},parseFloat:function(a){return a?parseFloat((""+a).replace(",",".")):0},slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(a,b,c){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{a="undefined"===typeof a?!0:a;b="undefined"===typeof b?!1:b;var d=this.options.duration||200,e=this.options.view,g=[];return!this.slide_on&&a?(g.push($("#s-sidebar").animate({width:0},d,function(){$(this).hide()})),$(".s-level2").hide(),g.push($("#maincontent").animate({"margin-top":45},
d)),g.push($("#s-content").animate({"margin-left":0},d)),g.push($("#s-orders").animate({width:0},d,function(){$(this).hide()})),g.push($("#s-order").animate({"margin-left":0},d).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(g).done(function(){$.order_list&&$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");
"function"===typeof c&&c.call(this)}),!0):this.slide_on&&!a?(g.push($("#s-order").animate({"margin-left":"table"==e||b?200:300},d).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),g.push($("#s-orders").animate({width:300},d).show()),g.push($("#maincontent").animate({"margin-top":84},d)),$(".s-level2").show(),g.push($("#s-sidebar").animate({width:200},d).show()),this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),
$.when(g).done(function(){$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof c&&c.call(this)}),!0):!1}},switchSubmitButton:function(a){var b=this.form,c=$(b).find(".s-order-items-edit td.save i.loading");b=$(b).find("[type=submit]");"disable"===a?(c.css("display","inline-block"),b.attr("disabled",!0)):(c.css("display","none"),b.attr("disabled",!1))},showValidateErrors:function(a){var b=[];$.shop.trace("showValidateErrors",a);$("#shipping-info").find(".error").empty();
$(".error").removeClass("error");$("#s-order-edit-customer .errormsg").empty();this.customer_form&&this.customer_form.showValidateErrors(a?a.customer:{});$(".s-order-errors").empty();if(a&&a.order){if(!$.isEmptyObject(a.order.items))for(var c in a.order.items){var d=$(".s-order-item[data-index="+c+"]"),e=a.order.items[c],g;for(g in e){var l=d.find(".s-error-item-"+g);l.length?l.text(e[g]):b.push(e[g])}delete a.order.items[c]}if(!$.isEmptyObject(a.order.product)){var h=a.order.product,k;for(k in h)h.hasOwnProperty(k)&&
"quantity"in h[k]&&$(".s-order-item[data-product-id="+k+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=""+h[k].sku_id&&$(this).find("ul.s-orders-skus").length||($(this).find(".s-orders-quantity").addClass("error"),b.push(h[k].quantity))})}a.order.common&&b.push(a.order.common);a.order.discount&&($("#discount").addClass("error"),b.push(a.order.discount));b.length&&$(".s-order-errors").html(b.join("<br>"))}},getSelectedStorefront:function(a){var b=this.$storefront_selector,
c=$.trim(b.val());return a?{storefront:c,data:b.find(":selected").data()}:c},getStorefrontSelector:function(){return this.$storefront_selector},getStorefront:function(){return this.getStorefrontSelector().val()},initStorefrontSelector:function(){var a=this;a.$storefront_selector.on("change",function(){a.customer_form&&a.customer_form.isEnabled()&&a.customer_form.reloadForm()})},filterStorefrontSelector:function(a){var b=this.$storefront_selector;b.find("option").each(function(){var c=$(this),d=c.val(),
e=c.data();c.show();!e.orderStorefront&&d&&a&&!e[a]&&(c.hide(),c.is(":selected")&&b.val(""))})},getPercentSymbol:function(){return"%"}};var ShopBackendCustomerForm=function(a){ShopBackendCustomerForm=function(b,c){this.options=c||{};this.$wrapper=b;this.dom_ns=this.$wrapper.attr("id");this.namespace=c.namespace||null;this.locales=c.locales;this.fields_config=c.fields_config||{};this.$wrapper.data("ShopBackendCustomerForm",this);a.contains(document,this.$wrapper.get(0))&&this.activate()};ShopBackendCustomerForm.prototype.activate=function(){this.$wrapper.off("."+this.dom_ns);this.initConfirmedCheckboxes();this.initContactTypeSelector();
this.initShippingAddress();this.initBillingAddress();this.initAdditionalAddressSubfields();this.fixStyles()};ShopBackendCustomerForm.prototype.deactivate=function(){this.$wrapper.off("."+this.dom_ns);this.unbindAll()};ShopBackendCustomerForm.prototype.getOptions=function(){return this.options||{}};ShopBackendCustomerForm.prototype.setOptions=function(b){this.options=b||{}};ShopBackendCustomerForm.prototype.getContact=function(b){var c=this.options.contact||{};return b?a.extend({},c,!0):c};ShopBackendCustomerForm.prototype.initConfirmedCheckboxes=
function(){var b=this.$wrapper,c=b.find(".field-email:eq(0)"),d=b.find(".field-phone:eq(0)"),e=b.find(".s-customer-email-confirmed-control");b=b.find(".s-customer-phone-confirmed-control");c.find(".value").children().first().after(e);d.find(".value").children().first().after(b)};ShopBackendCustomerForm.prototype.initContactTypeSelector=function(){var b=this;b.$wrapper.on("click."+b.dom_ns,".s-order-form-contact-type-selector-wrapper :radio",function(){var c=a(this),d=b.$wrapper.find(".s-order-form-contact-type-selector-wrapper .loading");
c=a.trim(c.val());d.show();b.reloadForm({type:c},{afterReload:function(){d.hide()}})})};ShopBackendCustomerForm.prototype.initAdditionalAddressSubfields=function(){var b=this.fields_config,c=this.$wrapper,d=function(){return".s-customer-more-address-subfields-control"},e=function(){return".s-address-block"};c.find(e()).each(function(){var g=a(this),l=g.closest(".field-address"),h="";l.hasClass("field-address-shipping")?h="shipping":l.hasClass("field-address-billing")&&(h="billing");if(h){var k=g.find(".field").hide(),
p=a(),r=0;a.each(b["address."+h].fields||{},function(u){p=k.filter(".field-address-"+u).show();r++});r!=k.length&&p.after(c.find(d()).first().clone())}});c.on("click",d(),function(){var g=a(this);g.siblings(e()).length?g.siblings(".field, input").appendTo(g.siblings(e())).show():g.closest(e()).find(".field").show();g.remove()})};ShopBackendCustomerForm.prototype.initShippingAddress=function(){var b=this,c=b.$wrapper,d=function(){return c.find(".field-address-shipping").find(".value").children()},
e=function(){return".s-customer-more-shipping-addresses-control"};d().each(function(h){var k=a(this);h=0<h?b.locales.extra_shipping_address:b.locales.main_shipping_address;h=a("<span />").addClass("s-block-header bold").text(h);k.addClass("s-address-block").prepend(h)});var g=1<d().length,l=0<d().not(":first").find(".errormsg,.error").length;g&&!l&&(d().not(":first").hide(),d().first().after(c.find(e())));c.on("click",e()+" .js-toggle-button",function(h){h.preventDefault();d().not(":first").show();
c.find(e()).hide()})};ShopBackendCustomerForm.prototype.initBillingAddress=function(){var b=this,c=b.$wrapper,d=function(){return c.find(".field-address-billing").find(".value").children()},e=function(){return".s-customer-more-billing-addresses-control"};d().each(function(h){var k=a(this);h=0<h?b.locales.extra_billing_address:b.locales.main_billing_address;h=a("<span />").addClass("s-block-header bold").text(h);k.addClass("s-address-block").prepend(h)});var g=1<d().length,l=0<d().not(":first").find(".errormsg,.error").length;
g&&!l&&(d().not(":first").hide(),d().first().after(c.find(e())));c.on("click",e()+" .js-toggle-button",function(h){h.preventDefault();d().not(":first").show();c.find(e()).hide()})};ShopBackendCustomerForm.prototype.fixStyles=function(){this.$wrapper.find('.field-birthday input[name="'+this.namespace+'[birthday][year]"]').css({width:"",minWidth:""})};ShopBackendCustomerForm.prototype.updateInnerHtml=function(b){var c=this.$wrapper;b=a("<div>").hide().appendTo("body").html(b);var d=b.find(".s-customer-form-wrapper");
d=ShopBackendCustomerForm.getInstance(d);this.setOptions(d.getOptions());c.html(b.children(0).html());b.remove()};ShopBackendCustomerForm.prototype.reloadForm=function(b,c){var d=this,e=d.$wrapper;c=c||{};var g=a.extend({},b||{});g.type||(g.type=d.getContact().type);var l=e.find(".loading").show();c.beforeReload&&c.beforeReload(g);e.trigger("beforeReload",[g]);if(!b["new"]){b=e.find(":input:not(:disabled)").serializeArray();var h=["shipping","billing"];a.each(b,function(k,p){if(p.name.indexOf(d.namespace)){k=
$jscomp.makeIterator(h);for(var r=k.next();!r.done;r=k.next()){r=r.value;var u=a('[name="'+d.namespace+"[address."+r+'][region]"]');0<u.length&&""!=u.data("country")&&(g[d.namespace+"[address."+r+"][data][country]"]=u.data("country"))}}g[p.name]=p.value})}a.post("?action=customerForm",g,function(k){d.updateInnerHtml(k);l.hide();k=d.getContact(!0);c.afterReload&&c.afterReload(k);e.trigger("afterReload",[k])})};ShopBackendCustomerForm.prototype.bind=function(b,c){this.$wrapper.on(b+".custom"+this.dom_ns,
c)};ShopBackendCustomerForm.prototype.unbindAll=function(){this.$wrapper.off(event+".custom"+this.dom_ns)};ShopBackendCustomerForm.getInstance=function(b){return b.data("ShopBackendCustomerForm")instanceof ShopBackendCustomerForm?b.data("ShopBackendCustomerForm"):null};return ShopBackendCustomerForm}(jQuery);var ShopBackendOrderEditorCustomerForm=function(a){ShopBackendOrderEditorCustomerForm=function(b,c,d){this.options=d||{};this.$wrapper=b&&0<b.length?b:a("#s-order-edit-customer");this.editor=c;this.$customer_inputs=this.$wrapper.find(":input");this.initial_values={};this.$customer_form_wrapper=this.$wrapper.find(".s-customer-form-wrapper");(this.customer_form=ShopBackendCustomerForm.getInstance(this.$customer_form_wrapper))||console.error("There is not ShopBackendCustomerForm instance");this.$autocomplete=
a("#customer-autocomplete");this.$customer_id=a("#s-customer-id");this.$new_customer_link=a("#s-order-new-customer");this.contact=d.contact||{};this.init()};ShopBackendOrderEditorCustomerForm.prototype.init=function(){this.initForm();this.rememberInitialValues();this.initAutocomplete()};ShopBackendOrderEditorCustomerForm.prototype.rememberInitialValues=function(){var b=this;b.$customer_inputs.each(function(){var c=a(this),d=c.attr("name"),e=c.val();c.is(":radio")?c.is(":checked")&&(b.initial_values[d]=
e):c.is(":checkbox")?b.initial_values[d]=c.is(":checked"):b.initial_values[d]=e})};ShopBackendOrderEditorCustomerForm.prototype.resetInputValues=function(){var b=this;b.$customer_inputs.each(function(){var c=a(this),d=c.attr("name"),e=c.val();d=b.initial_values[d]||"";c.is(":radio")?e===d&&c.attr("checked","checked"):c.is(":checkbox")?c.is(":checked")?c.attr("checked","checked"):c.attr("checked",""):c.val()})};ShopBackendOrderEditorCustomerForm.prototype.disable=function(b){var c=this.$customer_id,
d=this.$wrapper;b="undefined"===typeof b?!0:b;c.attr("disabled",b);b?d.addClass("s-opaque"):d.removeClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isDisabled=function(){return this.$wrapper.hasClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isEnabled=function(){return!this.isDisabled()};ShopBackendOrderEditorCustomerForm.prototype.activate=function(b){var c=this.$new_customer_link,d=this.$autocomplete;"undefined"===typeof b||b?(this.disable(!1),d.val("").hide(200),
c.hide(200)):(this.disable(),d.val("").show(),c.show())};ShopBackendOrderEditorCustomerForm.prototype.focusFirstEmptyInput=function(){var b=this.$customer_inputs,c=!1;b.filter("input[type=text], textarea").each(function(){var d=a(this);if(d.is(":not(:hidden)")&&!this.value)return c=!0,d.focus(),!1});c||b.first().focus()};ShopBackendOrderEditorCustomerForm.prototype.initAutocomplete=function(){var b=this,c=function(e){var g=b.inputName;var l=parseInt(e,10)||"+"==e.substr(0,1)||-1!==e.indexOf("(");
g="[name="+g.call(b,l?"phone":-1!==e.indexOf("@")?"email":"firstname")+"]";b.$customer_inputs.filter(g).val(e)},d="";b.$autocomplete.autocomplete({source:function(e,g){d=e.term;a.getJSON(b.options.autocomplete_url,e,function(l){(l=l||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});g(l)})},delay:300,minLength:3,select:function(e,g){e=g.item;if(0<e.value)return b.reloadForm({id:e.value,"new":!0}),!1;if(b.editor.getSelectedStorefront())return b.reloadForm({},{afterReload:function(){c(d)}}),
!1;c(d);b.$customer_id.val(0);b.activate();setTimeout(function(){b.focusFirstEmptyInput()},200);return!1},focus:function(e,g){this.value=g.item.name;return!1}})};ShopBackendOrderEditorCustomerForm.prototype.reloadForm=function(b,c){var d=this,e=d.customer_form;c=c||{};d.disable(!0);b=b||{};e.reloadForm(b,{afterReload:function(g){d.$customer_inputs=d.$wrapper.find(":input");d.contact=g||{};d.$customer_id.val(g.id);d.activate();setTimeout(function(){d.focusFirstEmptyInput()},200);d.editor.updateTotal();
c.afterReload&&c.afterReload(g)}})};ShopBackendOrderEditorCustomerForm.prototype.initForm=function(){for(var b=this,c=b.customer_form,d=b.editor,e=b.$wrapper,g=["firstname","middlename","lastname"],l=0,h=g.length;l<h;l+=1)b.$customer_inputs.filter("[name="+b.inputName(g[l])+"]").addClass("s-error-customer-name");e.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>');b.$new_customer_link.on("click",function(){if(0<b.$customer_id.val())return!1;d.filterStorefrontSelector(b.getContact().type);
d.getSelectedStorefront()?b.reloadForm():(b.activate(),b.$customer_inputs.first().focus());return!1});0<b.getContact().id?b.activate():b.activate(!1);e.off("focus",":input").on("focus",":input",function(){b.disable(!1)});c.bind("beforeReload",function(k,p){"undefined"===typeof p.id&&(p.id=b.getContact().id);p.storefront=d.getSelectedStorefront()});c.bind("afterReload",function(k,p){d.filterStorefrontSelector(p.type)});d.filterStorefrontSelector(b.getContact().type);e.on("change",':input[name*="[address.shipping]"]',
function(k){k.originalEvent&&(a.shop.trace("Update total if customer address edit",[this,k]),d.updateTotal())});d.form.submit(function(){b.disable(!1)})};ShopBackendOrderEditorCustomerForm.prototype.showValidateErrors=function(b){b=a.extend({},b||{});if(!a.isEmptyObject(b)){var c=this.customer_form;b=a.trim(b.html);0<b.length&&c.updateInnerHtml(b)}};ShopBackendOrderEditorCustomerForm.prototype.inputName=function(b){return'"customer['+b+']"'};ShopBackendOrderEditorCustomerForm.prototype.getContact=
function(){return this.contact=this.contact||{}};return ShopBackendOrderEditorCustomerForm}(jQuery);
//# sourceMappingURL=order.min.js.map