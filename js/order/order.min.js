(function(b){function a(v){return b.data(v,"tooltip")}function c(v){a(this).delay?q=setTimeout(e,a(this).delay):e();t=!!a(this).track;b(document.body).bind("mousemove",k);k(v)}function d(){if(!b.tooltip.blocked&&this!=h&&(this.tooltipText||a(this).bodyHandler)){h=this;l=this.tooltipText;if(a(this).bodyHandler){f.title.hide();var v=a(this).bodyHandler.call(this);v.nodeType||v.jquery?f.body.empty().append(v):f.body.html(v);f.body.show()}else if(a(this).showBody){v=l.split(a(this).showBody);f.title.html(v.shift()).show();
f.body.empty();for(var w=0,y;y=v[w];w++)0<w&&f.body.append("<br/>"),f.body.append(y);f.body.hideWhenEmpty()}else f.title.html(l).show(),f.body.hide();a(this).showURL&&b(this).url()?f.url.html(b(this).url().replace("http://","")).show():f.url.hide();f.parent.addClass(a(this).extraClass);a(this).fixPNG&&f.parent.fixPNG();c.apply(this,arguments)}}function e(){q=null;u&&b.fn.bgiframe||!a(h).fade?f.parent.show():f.parent.is(":animated")?f.parent.stop().show().fadeTo(a(h).fade,h.tOpacity):f.parent.is(":visible")?
f.parent.fadeTo(a(h).fade,h.tOpacity):f.parent.fadeIn(a(h).fade);k()}function k(v){if(!(b.tooltip.blocked||v&&"OPTION"==v.target.tagName))if(!t&&f.parent.is(":visible")&&b(document.body).unbind("mousemove",k),null==h)b(document.body).unbind("mousemove",k);else{f.parent.removeClass("viewport-right").removeClass("viewport-bottom");var w=f.parent[0].offsetLeft,y=f.parent[0].offsetTop;v&&(w=v.pageX+a(h).left,y=v.pageY+a(h).top,v="auto",a(h).positionLeft&&(v=b(window).width()-w,w="auto"),f.parent.css({left:w,
right:v,top:y}));v=b(window).scrollLeft();var D=b(window).scrollTop(),G=b(window).width(),A=b(window).height(),z=f.parent[0];v+G<z.offsetLeft+z.offsetWidth&&(w-=z.offsetWidth+20+a(h).left,f.parent.css({left:w+"px"}).addClass("viewport-right"));D+A<z.offsetTop+z.offsetHeight&&(y-=z.offsetHeight+20+a(h).top,f.parent.css({top:y+"px"}).addClass("viewport-bottom"))}}function p(v){function w(){f.parent.removeClass(y.extraClass).hide().css("opacity","")}if(!b.tooltip.blocked){q&&clearTimeout(q);h=null;var y=
a(this);u&&b.fn.bgiframe||!y.fade?w():f.parent.is(":animated")?f.parent.stop().fadeTo(y.fade,0,w):f.parent.stop().fadeOut(y.fade,w);a(this).fixPNG&&f.parent.unfixPNG()}}var f={},h,l,q,u=b.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),t=!1;b.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){b.tooltip.blocked=!b.tooltip.blocked}};b.fn.extend({tooltip:function(v){v=b.extend({},b.tooltip.defaults,v);f.parent||
(f.parent=b('<div id="'+v.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),b.fn.bgiframe&&f.parent.bgiframe(),f.title=b("h3",f.parent),f.body=b("div.body",f.parent),f.url=b("div.url",f.parent));var w=this.each(function(){b.data(this,"tooltip",v);this.tOpacity=f.parent.css("opacity");this.tooltipText=this.title;b(this).removeAttr("title");this.alt=""}).mouseover(d).mouseout(p);v.noHideOnClick||w.click(p);return w},fixPNG:u?function(){return this.each(function(){var v=
b(this).css("backgroundImage");v.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(v=RegExp.$1,b(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+v+"')"}).each(function(){var w=b(this).css("position");"absolute"!=w&&"relative"!=w&&b(this).css("position","relative")}))})}:function(){return this},unfixPNG:u?function(){return this.each(function(){b(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){b(this)[b(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
!function(b){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):b(jQuery)}(function(b){function a(g){g=g[0];return 0<g.offsetWidth&&0<g.offsetHeight}function c(g){if(g.minTime&&(g.minTime=z(g.minTime)),g.maxTime&&(g.maxTime=z(g.maxTime)),g.durationTime&&"function"!=typeof g.durationTime&&(g.durationTime=z(g.durationTime)),"now"==g.scrollDefault)g.scrollDefault=function(){return g.roundingFunction(z(new Date),
g)};else if(g.scrollDefault&&"function"!=typeof g.scrollDefault){var m=g.scrollDefault;g.scrollDefault=function(){return g.roundingFunction(z(m),g)}}else g.minTime&&(g.scrollDefault=function(){return g.roundingFunction(g.minTime,g)});if("string"===b.type(g.timeFormat)&&g.timeFormat.match(/[gh]/)&&(g._twelveHourTime=!0),!1===g.showOnFocus&&-1!=g.showOn.indexOf("focus")&&g.showOn.splice(g.showOn.indexOf("focus"),1),0<g.disableTimeRanges.length){for(var n in g.disableTimeRanges)g.disableTimeRanges[n]=
[z(g.disableTimeRanges[n][0]),z(g.disableTimeRanges[n][1])];g.disableTimeRanges=g.disableTimeRanges.sort(function(r,x){return r[0]-x[0]});for(n=g.disableTimeRanges.length-1;0<n;n--)g.disableTimeRanges[n][0]<=g.disableTimeRanges[n-1][1]&&(g.disableTimeRanges[n-1]=[Math.min(g.disableTimeRanges[n][0],g.disableTimeRanges[n-1][0]),Math.max(g.disableTimeRanges[n][1],g.disableTimeRanges[n-1][1])],g.disableTimeRanges.splice(n,1))}return g}function d(g){var m=g.data("timepicker-settings"),n=g.data("timepicker-list");
if(n&&n.length&&(n.remove(),g.data("timepicker-list",!1)),m.useSelect)var r=n=b("<select />",{"class":"ui-timepicker-select"});else n=b("<ul />",{"class":"ui-timepicker-list"}),r=b("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),r.css({display:"none",position:"absolute"}).append(n);if(m.noneOption)if(!0===m.noneOption&&(m.noneOption=m.useSelect?"Time...":"None"),b.isArray(m.noneOption))for(var x in m.noneOption){if(parseInt(x,10)==x){var C=e(m.noneOption[x],m.useSelect);n.append(C)}}else C=
e(m.noneOption,m.useSelect),n.append(C);(m.className&&r.addClass(m.className),null===m.minTime&&null===m.durationTime||!m.showDuration)||("function"==typeof m.step?"function":m.step,r.addClass("ui-timepicker-with-duration"),r.addClass("ui-timepicker-step-"+m.step));C=m.minTime;"function"==typeof m.durationTime?C=z(m.durationTime()):null!==m.durationTime&&(C=m.durationTime);x=null!==m.minTime?m.minTime:0;var H=null!==m.maxTime?m.maxTime:x+B-1;x>H&&(H+=B);H===B-1&&"string"===b.type(m.timeFormat)&&m.show2400&&
(H=B);var L=m.disableTimeRanges,I=0,Q=L.length,N=m.step;"function"!=typeof N&&(N=function(){return m.step});for(var O=0;H>=x;O++,x+=60*N(O)){var K=x,M=A(K,m);if(m.useSelect)var J=b("<option />",{value:M});else J=b("<li />"),J.addClass(43200>K%86400?"ui-timepicker-am":"ui-timepicker-pm"),J.data("time",86400>=K?K:K%86400);J.text(M);if((null!==m.minTime||null!==m.durationTime)&&m.showDuration)if(M=G(x-C,m.step),m.useSelect)J.text(J.text()+" ("+M+")");else{var P=b("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");J.append(P)}Q>I&&(K>=L[I][1]&&(I+=1),L[I]&&K>=L[I][0]&&K<L[I][1]&&(m.useSelect?J.prop("disabled",!0):J.addClass("ui-timepicker-disabled")));n.append(J)}(r.data("timepicker-input",g),g.data("timepicker-list",r),m.useSelect)?(g.val()&&n.val(k(z(g.val()),m)),n.on("focus",function(){b(this).data("timepicker-input").trigger("showTimepicker")}),n.on("blur",function(){b(this).data("timepicker-input").trigger("hideTimepicker")}),n.on("change",function(){t(g,b(this).val(),"select")}),t(g,
n.val(),"initial"),g.hide().after(n)):(x=m.appendTo,"string"==typeof x?x=b(x):"function"==typeof x&&(x=x(g)),x.append(r),l(g,n),n.on("mousedown click","li",function(R){g.off("focus.timepicker");g.on("focus.timepicker-ie-hack",function(){g.off("focus.timepicker-ie-hack");g.on("focus.timepicker",F.show)});f(g)||g[0].focus();n.find("li").removeClass("ui-timepicker-selected");b(this).addClass("ui-timepicker-selected");D(g)&&(g.trigger("hideTimepicker"),n.on("mouseup.timepicker click.timepicker","li",
function(S){n.off("mouseup.timepicker click.timepicker");r.hide()}))}))}function e(g,m){var n,r,x;return"object"==typeof g?(n=g.label,r=g.className,x=g.value):"string"==typeof g?n=g:b.error("Invalid noneOption value"),m?b("<option />",{value:x,"class":r,text:n}):b("<li />",{"class":r,text:n}).data("time",String(x))}function k(g,m){return g=m.roundingFunction(g,m),null!==g?A(g,m):void 0}function p(g){g.target!=window&&(g=b(g.target),g.closest(".ui-timepicker-input").length||g.closest(".ui-timepicker-wrapper").length||
(F.hide(),b(document).unbind(".ui-timepicker"),b(window).unbind(".ui-timepicker")))}function f(g){g=g.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&g.disableTouchKeyboard}function h(g,m,n){if(!n&&0!==n)return!1;g=g.data("timepicker-settings");var r=!1;n=g.roundingFunction(n,g);return m.find("li").each(function(x,C){x=b(C);if("number"==typeof x.data("time"))return x.data("time")==n?(r=x,!1):void 0}),r}function l(g,m){m.find("li").removeClass("ui-timepicker-selected");
var n=z(u(g),g.data("timepicker-settings"));null!==n&&(g=h(g,m,n))&&(n=g.offset().top-m.offset().top,(n+g.outerHeight()>m.outerHeight()||0>n)&&m.scrollTop(m.scrollTop()+g.position().top-g.outerHeight()),g.addClass("ui-timepicker-selected"))}function q(g,m){if(""!==this.value&&"timepicker"!=m){var n=b(this);if(!n.is(":focus")||g&&"change"==g.type){g=n.data("timepicker-settings");var r=z(this.value,g);if(null===r)return void n.trigger("timeFormatError");var x=!1;if(null!==g.minTime&&null!==g.maxTime&&
(r<g.minTime||r>g.maxTime)&&(x=!0),b.each(g.disableTimeRanges,function(){return r>=this[0]&&r<this[1]?(x=!0,!1):void 0}),g.forceRoundTime){var C=g.roundingFunction(r,g);C!=r&&(r=C,m=null)}g=A(r,g);x?t(n,g,"error")&&n.trigger("timeRangeError"):t(n,g,m)}}}function u(g){return g.is("input")?g.val():g.data("ui-timepicker-value")}function t(g,m,n){if(g.is("input")){g.val(m);var r=g.data("timepicker-settings");r.useSelect&&"select"!=n&&"initial"!=n&&g.data("timepicker-list").val(k(z(m),r))}return g.data("ui-timepicker-value")!=
m?(g.data("ui-timepicker-value",m),"select"==n?g.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(n)&&g.trigger("changeTime"),!0):(g.trigger("selectTime"),!1)}function v(g){switch(g.keyCode){case 13:case 9:break;default:g.preventDefault()}}function w(g){var m=b(this),n=m.data("timepicker-list");if(!n||!a(n)){if(40!=g.keyCode)return!0;F.show.call(m.get(0));n=m.data("timepicker-list");f(m)||m.focus()}switch(g.keyCode){case 13:return D(m)&&(q.call(m.get(0),
{type:"change"}),F.hide.apply(this)),g.preventDefault(),!1;case 38:var r=n.find(".ui-timepicker-selected");return r.length?r.is(":first-child")||(r.removeClass("ui-timepicker-selected"),r.prev().addClass("ui-timepicker-selected"),r.prev().position().top<r.outerHeight()&&n.scrollTop(n.scrollTop()-r.outerHeight())):(n.find("li").each(function(x,C){return 0<b(C).position().top?(r=b(C),!1):void 0}),r.addClass("ui-timepicker-selected")),!1;case 40:return r=n.find(".ui-timepicker-selected"),0===r.length?
(n.find("li").each(function(x,C){return 0<b(C).position().top?(r=b(C),!1):void 0}),r.addClass("ui-timepicker-selected")):r.is(":last-child")||(r.removeClass("ui-timepicker-selected"),r.next().addClass("ui-timepicker-selected"),r.next().position().top+2*r.outerHeight()>n.outerHeight()&&n.scrollTop(n.scrollTop()+r.outerHeight())),!1;case 27:n.find("li").removeClass("ui-timepicker-selected");F.hide();break;case 9:F.hide();break;default:return!0}}function y(g){var m=b(this),n=m.data("timepicker-list"),
r=m.data("timepicker-settings");if(!n||!a(n)||r.disableTextInput)return!0;switch(g.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:r.typeaheadHighlight?l(m,n):n.hide()}}function D(g){var m=g.data("timepicker-settings"),n=null,r=g.data("timepicker-list").find(".ui-timepicker-selected");return r.hasClass("ui-timepicker-disabled")?
!1:(r.length&&(n=r.data("time")),null!==n&&("string"!=typeof n&&(n=A(n,m)),t(g,n,"select")),!0)}function G(g,m){g=Math.abs(g);var n,r;g=Math.round(g/60);var x=[];return 60>g?x=[g,E.mins]:(n=Math.floor(g/60),r=g%60,30==m&&30==r&&(n+=E.decimal+5),x.push(n),x.push(1==n?E.hr:E.hrs),30!=m&&r&&(x.push(r),x.push(E.mins))),x.join(" ")}function A(g,m){if("number"!=typeof g)return null;var n=parseInt(g%60),r=parseInt(g/60%60),x=parseInt(g/3600%24);x=new Date(1970,0,2,x,r,n,0);if(isNaN(x.getTime()))return null;
if("function"===b.type(m.timeFormat))return m.timeFormat(x);for(var C="",H=0;H<m.timeFormat.length;H++)switch(n=m.timeFormat.charAt(H)){case "a":C+=11<x.getHours()?E.pm:E.am;break;case "A":C+=11<x.getHours()?E.PM:E.AM;break;case "g":n=x.getHours()%12;C+=0===n?"12":n;break;case "G":n=x.getHours();g===B&&(n=m.show2400?24:0);C+=n;break;case "h":n=x.getHours()%12;0!==n&&10>n&&(n="0"+n);C+=0===n?"12":n;break;case "H":n=x.getHours();g===B&&(n=m.show2400?24:0);C+=9<n?n:"0"+n;break;case "i":r=x.getMinutes();
C+=9<r?r:"0"+r;break;case "s":n=x.getSeconds();C+=9<n?n:"0"+n;break;case "\\":H++;C+=m.timeFormat.charAt(H);break;default:C+=n}return C}function z(g,m){if(""===g||null===g)return null;if("object"==typeof g)return 3600*g.getHours()+60*g.getMinutes()+g.getSeconds();if("string"!=typeof g)return g;g=g.toLowerCase().replace(/[\s\.]/g,"");"a"!=g.slice(-1)&&"p"!=g.slice(-1)||(g+="m");var n="("+E.am.replace(".","")+"|"+E.pm.replace(".","")+"|"+E.AM.replace(".","")+"|"+E.PM.replace(".","")+")?",r=g.match(new RegExp("^"+
n+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+n+"$"));if(!r)return null;g=parseInt(1*r[2],10);if(24<g){if(m&&!1===m.wrapHours)return null;g%=24}n=r[1]||r[5];var x=g;12>=g&&n&&(x=n==E.pm||n==E.PM,x=12==g?x?12:0:g+(x?12:0));r=3600*x+60*(1*r[3]||0)+(1*r[4]||0);12>g&&!n&&m&&m._twelveHourTime&&m.scrollDefault&&(m=r-m.scrollDefault(),0>m&&m>=B/-2&&(r=(r+B/2)%B));return r}var B=86400,E={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},F={init:function(g){return this.each(function(){var m=
b(this),n=[],r;for(r in b.fn.timepicker.defaults)m.data(r)&&(n[r]=m.data(r));n=b.extend({},b.fn.timepicker.defaults,n,g);if(n.lang&&(E=b.extend(E,n.lang)),n=c(n),m.data("timepicker-settings",n),m.addClass("ui-timepicker-input"),n.useSelect)d(m);else{if(m.prop("autocomplete","off"),n.showOn)for(var x in n.showOn)m.on(n.showOn[x]+".timepicker",F.show);m.on("change.timepicker",q);m.on("keydown.timepicker",w);m.on("keyup.timepicker",y);n.disableTextInput&&m.on("keydown.timepicker",v);q.call(m.get(0),
null,"initial")}})},show:function(g){var m=b(this),n=m.data("timepicker-settings");if(g&&g.preventDefault(),n.useSelect)return void m.data("timepicker-list").focus();f(m)&&m.blur();g=m.data("timepicker-list");if(!m.prop("readonly")&&(g&&0!==g.length&&"function"!=typeof n.durationTime||(d(m),g=m.data("timepicker-list")),!a(g))){m.data("ui-timepicker-value",m.val());l(m,g);F.hide();g.show();var r={};n.orientation.match(/r/)?r.left=m.offset().left+m.outerWidth()-g.outerWidth()+parseInt(g.css("marginLeft").replace("px",
""),10):r.left=m.offset().left+parseInt(g.css("marginLeft").replace("px",""),10);"t"==(n.orientation.match(/t/)?"t":n.orientation.match(/b/)?"b":m.offset().top+m.outerHeight(!0)+g.outerHeight()>b(window).height()+b(window).scrollTop()?"t":"b")?(g.addClass("ui-timepicker-positioned-top"),r.top=m.offset().top-g.outerHeight()+parseInt(g.css("marginTop").replace("px",""),10)):(g.removeClass("ui-timepicker-positioned-top"),r.top=m.offset().top+m.outerHeight()+parseInt(g.css("marginTop").replace("px",""),
10));g.offset(r);r=g.find(".ui-timepicker-selected");if(!r.length){var x=z(u(m));null!==x?r=h(m,g,x):n.scrollDefault&&(r=h(m,g,n.scrollDefault()))}r&&r.length?(r=g.scrollTop()+r.position().top-r.outerHeight(),g.scrollTop(r)):g.scrollTop(0);return n.stopScrollPropagation&&b(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(C){C.preventDefault();var H=b(this).scrollTop();b(this).scrollTop(H+C.originalEvent.deltaY)}),b(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
p),b(window).on("resize.ui-timepicker",p),n.closeOnWindowScroll&&b(document).on("scroll.ui-timepicker",p),m.trigger("showTimepicker"),this}},hide:function(g){g=b(this);var m=g.data("timepicker-settings");return m&&m.useSelect&&g.blur(),b(".ui-timepicker-wrapper").each(function(){var n=b(this);if(a(n)){var r=n.data("timepicker-input"),x=r.data("timepicker-settings");x&&x.selectOnBlur&&D(r);n.hide();r.trigger("hideTimepicker")}}),this},option:function(g,m){return"string"==typeof g&&"undefined"==typeof m?
b(this).data("timepicker-settings")[g]:this.each(function(){var n=b(this),r=n.data("timepicker-settings"),x=n.data("timepicker-list");"object"==typeof g?r=b.extend(r,g):"string"==typeof g&&(r[g]=m);r=c(r);n.data("timepicker-settings",r);x&&(x.remove(),n.data("timepicker-list",!1));r.useSelect&&d(n)})},getSecondsFromMidnight:function(){return z(u(this))},getTime:function(g){var m=u(this);if(!m)return null;m=z(m);if(null===m)return null;g||=new Date;g=new Date(g);return g.setHours(m/3600),g.setMinutes(m%
3600/60),g.setSeconds(m%60),g.setMilliseconds(0),g},isVisible:function(){var g=this.data("timepicker-list");return!(!g||!a(g))},setTime:function(g){var m=this.data("timepicker-settings"),n=m.forceRoundTime?k(z(g),m):A(z(g),m);return g&&null===n&&m.noneOption&&(n=g),t(this,n),this.data("timepicker-list")&&l(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var g=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),g.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};b.fn.timepicker=function(g){return this.length?F[g]?this.hasClass("ui-timepicker-input")?F[g].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof g&&g?void b.error("Method "+g+" does not exist on jQuery.timepicker"):F.init.apply(this,arguments):this};b.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(g,m){if(null===g)return null;if("number"!=typeof m.step)return g;var n=g%(60*m.step);return n>=30*m.step?g+=60*m.step-n:g-=n,g==B&&m.show2400?g:g%B},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(b){var a=function(c,d,e){var k=/[^\w\-\.:]/.test(c)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+c.replace(a.regexp,a.func)+"';return _s;"):e?a.cache[c]=a(a.load(c)):a.cache[c]=a.cache[c]||a(a.load(c));return d?k(d,a):function(p){return k(p,a)}};a.cache={};a.load=function(c){var d=document.getElementById(c),e=/<\\\/(\w+)/g;if(!d&&console)throw{message:"template with id="+c+" not found"};return d?("textarea"==d.tagName.toLowerCase()?d.value:document.getElementById(c).innerHTML).replace(e,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(c,d,e,k,p,f){if(d)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[c]||"\\"+c;if(e)return"="===e?"'+_e("+k+")+'":"'+("+k+"||'')+'";if(p)return"';";if(f)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(c){return String(c||"").replace(a.encReg,function(d){return a.encMap[d]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a,c){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&f(p,k)<=e.distance){if(null!==e.hash){var h=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(h)){this.onscroll=null;return}}e.load()}}if("stop"==a){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==a){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==a){if(e=this.data("lazyLoadSettings"))e.loading=
!0}else if("wake"==a){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==a)(e=this.data("lazyLoadSettings"))&&(e.loading||e.load());else{if("get"===a)return e=this.data("lazyLoadSettings")||{},e[c];this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:p,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var k=b(window),p=e.container||b(this);
null===e.hash||b.isArray(e.hash)||(e.hash=[e.hash]);b.fn.lazyLoad.call(k,e.state);(function(){var h,l=setTimeout(h=function(){if(e.stopped)clearTimeout(l);else{if(null!==e.hash){var q=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(q)){clearTimeout(l);return}}e.loading?l=setTimeout(h,350):(f(p,k),f(p,k)<=e.distance?(e.load(),l=setTimeout(h,350)):(k.get(0).onscroll=d,clearTimeout(l)))}},350)})();var f="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:
function(h,l,q){h="string"===typeof h?b(h):h;q=q||0;return h.position().top+h.outerHeight()-q-(l.scrollTop()+l.height())}}}})(jQuery);(function(b){b.storage=new b.store;b.orders={$wrapper:null,pre_search_hash:null,search_item_param:null,options:{view:"table"},init:function(a){var c=this;c.options=a;c.$wrapper=b("#s-content");"undefined"!=typeof b.History&&b.History.bind(function(){c.dispatch()});b.ajaxPrefilter(function(d,e,k){k.originalRequestOptions=e});b.wa.errorHandler=function(d){var e=d.originalRequestOptions||{};if(403===d.status||404===d.status){d=b(d.responseText);d=d.find(".dialog-content").length?b('<div class="block double-padded"></div>').append(d.find(".dialog-content *")):
b('<div class="block double-padded"></div>').append(d.find(":not(style)"));var k="content";e=e.url||"";if(0<e.length){var p=e.indexOf("?");-1!==p&&(e=e.substr(p+1),e=b.shop.helper.parseParams(e)||{},"order"===e.module&&"table"!==e.view&&b("#s-order").length&&(k="order"))}"order"===k?b("#s-order").empty().append(d):(b("#s-content").empty().append(d),b.order_list&&b.order_list.finit());return!1}return!0};a=window.location.hash;"#/"!==a&&a?b.wa.setHash(a):this.dispatch();this.initEventsVisibilityFilters();
this.initDropdown();b(document).bind("wa.appcount",function(d,e){e=e||{};d=parseInt(e.shop,10);(e=document.title.match(/\(\d+\) /))?document.title=document.title.replace(e[0],d?"("+d+") ":""):d&&(document.title="("+d+") "+document.title)});b(function(){b("#maincontent").on("click",".s-alert-close",function(d){d.preventDefault();d=b.storage.get("shop/alerts");var e=b(this).parent();d||=[];d.push(e.data("alert"));d=d.filter(function(k,p,f){return null!=k&&p==f.indexOf(k)});b.storage.set("shop/alerts",
d);e.remove()})});this.checkAlerts();this.ordersNavDetach();this.initWaLoading();this.$wrapper.on("wa_init_orders_nav",(d,e)=>{this.initSearch(e.filter_params_extended);"split"===e.view&&this.hasFiltersInUrl()&&this.visibilityFilters(!0)})},initEventsVisibilityFilters:function(){b(document).on("click",".js-orders-show-filters",()=>{this.visibilityFilters(!0);this.clearFilters()});b(document).on("click",".js-orders-hide-filters",()=>{this.visibilityFilters(!1);this.clearFilters()})},initSearch:function(a){var c=
this,d=b("#s-orders-search"),e=[],k=null,p=function(l){c.pre_search_hash||(c.pre_search_hash=window.location.hash,b.order_list.options&&"split"===b.order_list.options.view&&c.clearFilters());switch(l.autocomplete_item_type){case "order":c.search_item_param=null;b.wa.setHash("#/order/"+l.id+"/");d.val(l.value);break;case "contact":c.search_item_param="contact_id="+l.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");d.val(l.value);break;case "product":c.search_item_param="product_id="+l.id;b.wa.setHash("#/orders/"+
c.search_item_param+"/");d.val(l.value);break;case "coupon":c.search_item_param="coupon_id="+l.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "tracking_number":c.search_item_param="tracking_number="+l.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "shipping":c.search_item_param="shipping_id="+l.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "payment":c.search_item_param="payment_id="+l.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;
case "city":c.search_item_param="city="+l.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "region":c.search_item_param="region="+((l.value||"").split(":")[1]||"");b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "country":c.search_item_param="country="+l.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "item_code":c.search_item_param="item_code="+l.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;default:c.pre_search_hash=null}};d.unbind("keydown").bind("keydown",
function(l){if(13==l.keyCode||10==l.keyCode){if(k)return!1;var q=b(this);if(!b(this).val())return location.hash="#/orders/all/",q.autocomplete("close"),!1;if(e&&b.isArray(e)&&e.length)return p(e[0]),setTimeout(function(){q.autocomplete("close")},150),!1}});d.autocomplete({minLength:1,delay:300,html:!0,select:function(l,q){p(q.item);return!1},source:function(l,q){k&&k.abort();b.orders.waLoadingBeforeLoad();k=b.getJSON("?action=autocomplete&type=order",l,u=>{e=u;q(u);b.orders.waLoadingLoaded()}).always(()=>
{k=null})}});const f=b("#js-order-search"),h=f.find("#s-orders-search");if("object"===typeof a){let l=c.pre_search_hash||window.location.hash;for(let q in a){a=a[q];c.search_item_param=`/${q}=${a.id}`;c.pre_search_hash=l.replace(c.search_item_param,"");h.val(a.name);f.addClass("open").removeClass("hidden");break}}b(document).on("click",".js-orders-search",function(l){l.preventDefault();f.hasClass("open")?(f.addClass("close"),h.val(""),setTimeout(()=>{f.removeClass("open");f.removeClass("close");f.addClass("hidden")},
500),c.pre_search_hash&&c.search_item_param&&(b.wa.setHash(c.pre_search_hash),c.search_item_param=null,c.pre_search_hash=null)):(f.removeClass("hidden"),setTimeout(()=>{f.addClass("open");h.focus()}))})},initDropdown:function(){const a=this,c=["params.","state_id=","courier_contact_id="],d=f=>{f.$button.css({background:"var(--highlighted-blue)"})},e=f=>f&&"/"===f.slice(-1)?f.slice(0,-1):f,k=f=>f.every(h=>!c.some(l=>h.startsWith(l)));let p=!1;b(".js-orders-dropdown").waDropdown({hover:!1,items:".menu > li > a",
ready(f){var h=e(window.location.hash);if(h){let l=decodeURIComponent(h).replace(RegExp("#\\/orders\\/|hash=search\\/$","g"),"").split("&").filter(Boolean);if(l.length){if(p||k(l))return p=!0,!1;const q=f.$menu.find(".js-orders-link");q.length&&q.each(function(){const u=b(this);l.some(t=>t==u.data("param"))&&(f.$button.html(u.html()),d(f));l.some(t=>decodeURIComponent(u.attr("href")).includes(t))&&(f.$button.html(u.html()),d(f))})}b(".js-remove-filters-link").toggleClass("hidden",!h.includes("hash=search"))}h=
f.$menu.find(`[href="${h}"]`);h.length&&f.$button.html(h.html())},change(f,h,l){f=b(h);const q=["params.storefront","params.sales_channel"];var u=e(window.location.hash),t=f.data("param");h=!1;u.includes("hash=search")&&!t&&(t=decodeURIComponent(f.attr("href").replace(/#\/orders\/withoutSearch|\/$/g,"")));if(t){"string"===typeof u&&u.includes(a.search_item_param)&&(u=u.replace(a.search_item_param,""),a.pre_search_hash=a.search_item_param=null,b(".js-orders-search").trigger("click"));const w=decodeURIComponent(u).replace(RegExp("#\\/orders\\/|hash=search\\/|&id=\\d+|$",
"g"),"").split("&").filter(Boolean);h=w.findIndex(A=>"state_id=new|processing|auth|paid"===A);-1!==h&&w.splice(h,1);const [y,D]=t.split("=");u=w.findIndex(A=>A.includes(y));if(h="all"===y){let A=!1;D.split("|").forEach(z=>{w.forEach((B,E)=>{B.startsWith(z)&&(A=!0,w.splice(E,1))})});a.clearFilter(l.$wrapper);l.$before&&l.$before.parent().removeClass("selected");if(!A)return!1}else-1!==u?w[u]=y+"="+D:w.push(t),b(".js-remove-filters-link").toggleClass("hidden",!1),b(".js-order-nav-brick").each(function(){b(this).removeClass("selected")});
t=-1;"courier_contact_id"===y?t=w.findIndex(A=>A.includes("params.courier_id")):"params.courier_id"===y&&(t=w.findIndex(A=>A.includes("courier_contact_id")));-1!==t&&w.splice(t,1);w.reduceRight((A,z,B)=>{q.some(E=>z.includes(E))&&(null!==A?w.splice(B,1):A=B);return A},null);const G=[];var v=w.filter(A=>{if(RegExp("^sort\\[\\d+\\]").test(A))return!0;G.push(A);return!1});t=G.join("&");w.every(A=>c.some(z=>A.startsWith(z)))&&(t="&"+t);t=encodeURIComponent(t);u="";v.length&&(u="&"+v.join("&"));v="/orders/";
k(G)?(v+="all/",a.clearFilters()):v+=`${"hash=search"}/${t}${u}/`;b.wa.setHash(v)}else location.replace(f.attr("href"));h||(d(l),l.$button.html(f.html()))}});b(".js-remove-filters-link").on("click",()=>{this.clearFilters()})},visibilityFilters:function(a){const c=b(".js-order-nav-block-secondary");a?c.show():c.hide()},clearFilter:function(a){$btn=a.find(".dropdown-toggle").removeAttr("style");(a=$btn.data("text"))&&$btn.text(a)},clearFilters:function(){b(".js-orders-dropdown").each((a,c)=>{this.clearFilter(b(c))});
b(".js-remove-filters-link").addClass("hidden")},prevHash:null,hash:null,skipDispatch:0,stopDispatch:function(a){this.skipDispatch=a},forceHash:function(a){location.hash!=a&&(this.skipDispatch++,b.wa.setHash(a))},dispatch:function(a){if(0<this.skipDispatch)return this.skipDispatch--,!1;if(void 0===a||null===a)a=window.location.hash;a=a.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);this.hash=a;var c=new b.Event("wa_before_dispatched");b(window).trigger(c);if(a)if(a=a.split("/"),
a[0]){c="";var d,e=null,k=null;for(d=0;d<a.length;d++){var p=a[d];if(2>d){if(0===d)c=p;else if(parseInt(p,10)!=p&&-1==p.indexOf("="))c+=p.substr(0,1).toUpperCase()+p.substr(1);else break;"function"==typeof this[c+"Action"]&&(e=c,k=d+1)}else break}"function"!==typeof this[c+"Action"]&&e&&(c=e,d=k);a=a.slice(d);this.preExecute(c);"function"==typeof this[c+"Action"]?(b.shop.trace("$.orders.dispatch",[c+"Action",a]),this[c+"Action"].apply(this,a)):b.shop.error("Invalid action name:",c+"Action");this.postExecute(c)}else this.preExecute(),
this.defaultAction(),this.postExecute();else this.preExecute(),this.defaultAction(),this.postExecute()},back:function(){var a=b.orders.prevHash||"";location.hash=a?a+"/":""},preExecute:function(a,c){},postExecute:function(a,c){this.actionName=a},defaultAction:function(){this.ordersAction()},couponsAction:function(){b.order_list&&b.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(a){this.load("?module=order&action=edit&id="+a,function(){b.order_list&&b.order_list.finit()})},
ordersNewAction:function(a){this.load("?module=order&action=edit"+(a?"&"+a:""),function(){b.order_list&&b.order_list.finit()})},ordersAction:function(a){let c=!0;if("hash"===a)a={hash:Array.prototype.slice.call(arguments,1).join("/")};else{var d="";"search"===a&&(d=Array.prototype.slice.call(arguments,1));1<arguments.length&&(a=Array.prototype.join.call(arguments,"/"));if(!a)a="state_id=new|processing|auth|paid";else if("all"===a||"all&view=split"===a)a="";a=b.shop.helper.parseParams(a||"");a.view||
(a.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",a.view);b.order_edit&&b.order_edit.slideBack();d&&(a.search=d)}c=a&&"new|processing|auth|paid"!==a.state_id;"orders"===this.actionName&&b.order_list?b.order_list.dispatch(a):(b.order_list&&b.order_list.finit(),this.load("?module=orders&"+this.buildOrdersUrlComponent(a),()=>{b(window).trigger("wa_loaded",[["table"]]);b.order_list&&b.order_list.dispatch(a);this.visibilityFilters(c)}))},orderAction:function(a,
c){c=b.shop.helper.parseParams(c||"");c.view||(c.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",c.view);b.order_edit&&b.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(a)+"&"+this.buildOrdersUrlComponent(c),function(){var d=b("#s-content").find("#s-order-title a.back.order-list");d.show();var e=b("#s-all-orders");e.length&&e.hasClass("shadowed")&&(e=e.find("a:first"),e.length&&d.attr("href",e.attr("href")))});b.order_list&&b.order_list.finit()},
buildOrdersUrlComponent:function(a){var c="",d;for(d in a)a.hasOwnProperty(d)&&"view"!==d&&(c+="&"+d+"="+a[d]);return"view="+(a.view||this.options.view)+c},load:function(a,c,d){function e(){const f=b(".js-orders-sort"),h=b("#s-order-nav").length;f.length&&(h?f.removeClass("hidden"):f.addClass("hidden"))}"function"===typeof c?(d=c,c={}):c=c||{};var k=Math.random();this.random=k;var p=this;return b.ajax({method:"GET",url:a,global:!1,cache:!1,xhr:function(){var f=new window.XMLHttpRequest;f.addEventListener("progress",
function(h){p.$wrapper.trigger("wa_loading.wa_loading",h)},!1);f.addEventListener("abort",function(h){p.$wrapper.trigger("wa_abort.wa_loading")},!1);return f}}).done(function(f){if("undefined"!==typeof c.check&&!c.check||p.random==k){(c.content||b("#s-content")).removeClass("bordered-left").html(f);"function"===typeof d&&d.call(this);var h=b(window);setTimeout(function(){h.trigger("scroll")},250);e();p.checkAlerts();p.waLoadingLoaded()}}).fail(function(f){f.responseText&&console.error(f.responseText);
p.$wrapper.trigger("wa_load_fail.wa_loading")})},checkAlerts(){var a=b.storage.get("shop/alerts");b.shop.trace("checkAlerts",a);b(".s-alert").each(function(){-1==b.inArray(b(this).data("alert"),a)&&b(this).show()})},ordersNavDetach(){void 0===window.ordersNav&&(window.ordersNav=b("#s-order-nav").detach())},initWaLoading(){const a=b.waLoading(),c=b("#wa");this.$wrapper.on("wa_before_load.wa_loading",function(){a.show();a.animate(1E4,95,!1);c.addClass("is-locked")}).on("wa_loading.wa_loading",function(d,
e){a.set(e.loaded/e.total*100)}).on("wa_abort.wa_loading",function(){a.abort();c.removeClass("is-locked")}).on("wa_loaded.wa_loading",function(){a.done();c.removeClass("is-locked")})},waLoadingBeforeLoad(){this.$wrapper.trigger("wa_before_load.wa_loading")},waLoadingLoaded(){this.$wrapper.trigger("wa_loaded.wa_loading",[["waLoading"]])},hasFiltersInUrl(){return window.location.hash?window.location.hash.includes("hash=search"):!1}}})(jQuery);(function(b){b.order_list={id:0,options:{},container:null,$selectionMenu:null,$search_form:null,sidebar:null,select_all_input:null,plugin_hash:"",filter_params:{},filter_params_str:"",filter_params_extended:[],params:null,timer_id:0,lazy_load_win:null,all_printforms:null,sort:["create_datetime","desc"],xhrs:{lazy_load:null,update_load:null,printforms:null},init:function(a){this.options=a=a||{};this.plugin_hash=a.plugin_hash||"";this.filter_params=a.filter_params||{};this.filter_params_str=a.filter_params_str||
"";this.container=b("#order-list");"table"==a.view&&(this.container=b("#order-list").find("tbody:first"),this.$selectionMenu=this.options.$selectionMenu)&&(this.select_all_input=this.$selectionMenu.find(".s-order-list-select-all"),this.select_all_input.attr("checked",!1),b(".js-selection-dropdown").waDropdown({hide:!1}));if("split"==a.view){const d=b("#s-orders"),e=b("#s-order"),k=p=>{p=e.find(".back.order-list");p.addClass("js-order-hide mobile-only").show().attr("href","javascript:void(0);");p.off().on("click",
function(){e.addClass("desktop-and-tablet-only");d.removeClass("desktop-and-tablet-only");b(window).off("hashchange")});setTimeout(function(){});b(window).unbind("hashchange");b(window).on("hashchange",function(){})};this.container.off().on("wa_order_mobile_loaded",function(p,f){b.order_list.isMobile()&&f&&b.order_list.id&&k(f)});this.container.on("click","li[data-order-id]",function(p){b("#skeleton_split").removeClass("desktop-and-tablet-only");e.removeClass("desktop-and-tablet-only");d.addClass("desktop-and-tablet-only");
const f=b(this),h=(b.order_list.params?b.order_list.params.id:null)||b.order_list.id;h==f.data("order-id")&&(p.preventDefault(),k(h))});this.container.on("click","[data-order-id]:not(.selected) a",function(){b.skeletonLoader.repeatShow()})}this.options.all_order_state_ids=this.options.all_order_state_ids||null;this.sidebar=b("#s-sidebar");this.id=a.id||0;this.container.on("append_order_list",function(){b("#s-orders [data-wa-tooltip-content]").waTooltip()});if(a.orders&&a.orders.length&&a.view){try{this.container.append(tmpl("template-order-list-"+
this.options.view,{orders:a.orders,states:a.state_names||{},state_counters:a.state_counters||{},state_icons:a.state_icons||{}},!0)),this.container.trigger("append_order_list",[a.orders])}catch(d){if(b("#template-order-list-kanban").length)return b.shop.notification({class:"danger",content:`Error: ${d.message}`}),console&&console.log(d.stack),this;b.storage.set("shop/orders/view","table")}delete a.orders;delete this.options.orders}a.lazy_loading&&this.initLazyLoad(a.lazy_loading);a.counters&&this.updateCounters(a.counters);
a.update_process&&this.updateProcess("run",a.update_process);var c=b("#s-order-nav");RegExp("order\\/\\d+").test(b.orders.hash)?c.addClass("hidden"):(c.removeClass("hidden"),this.ordersNavTeleport(),this.selectionMenuTeleport(),a.sort&&a.sort[0]&&(a.sort[0]=""+a.sort[0],c=b(".js-orders-sort .s-sort").map(function(){var d=b(this).data("sort")||"";return d?d:!1}).toArray(),0>c.indexOf(a.sort[0])&&(a.sort[0]=c[0]),a.sort[1]=a.sort[1]||"",a.sort[1]="desc"===a.sort[1].toLowerCase()?"desc":"asc",this.sort=
a.sort),this.initSortMenu(),b.orders.$wrapper.trigger("wa_init_orders_nav",[a]));a.total_processing&&this.updateTotalProcessing(a.total_processing);this.initView()},initLazyLoad:function(a){function c(){var h=d.container.find(".order:last");if(h=parseInt(h.attr("data-order-id"),10))b(".lazyloading-link").hide(),b(".lazyloading-progress").show(),b.getJSON(d.buildLoadListUrl(h),function(l){if("ok"==l.status){try{d.container.append(tmpl("template-order-list-"+d.options.view,{orders:l.data.orders,states:d.options.state_names||
{},state_counters:d.options.state_counters||{},state_icons:d.options.state_icons||{},check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),d.container.trigger("append_order_list",[l.data.orders]),d.container.find("[data-order-id="+d.options.id+"]").length&&(d.container.find(".selected").removeClass("selected"),d.container.find("[data-order-id="+d.options.id+"]").addClass("selected"))}catch(q){console&&console.log(q.stack);return}f&&p.unobserve(f);b(".lazyloading-progress-string").text(l.data.progress.loaded+
" "+l.data.progress.of);b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(l.data.progress.chunk);l.data.loaded>=l.data.total_count?b(".lazyloading-link").hide():(b(".lazyloading-link").show(),(f=d.container.find(".order:last").get(0))&&p.observe(f))}else console&&console.log("Error when loading orders: "+l.errors)}).error(function(l){console&&(l&&l.errors?console.log("Error when loading orders: "+l.errors):l?console.log(l):console.log("Error when loading orders"))})}if("kanban"!==this.options.view){var d=
this,e=d.options.count,k=d.options.total_count,p=null,f=null;a=b("#s-orders");a.on("touchstart",function(){b("body").css({overflow:"hidden"});b(this).children(".sidebar-body").css({overflow:"overlay"});setTimeout(()=>{b("body").css({overflow:"auto"})})});a.off("click",".lazyloading-link").on("click",".lazyloading-link",function(){c();return!1});(function(){p=new IntersectionObserver(h=>{0>=h[0].intersectionRatio||e<k&&c()});(f=d.container.find(".order:last").get(0))&&p.observe(f)})()}},initView:function(){function a(p){var f=
b.order_list.getSelectedOrders(),h=function(){c.$selectionMenu.addClass("disabled");c.$selectionMenu.find(".js-selection-menu-loading").show();c.select_all_input.attr("disabled",!0);k(p,f,function(){c.$selectionMenu.removeClass("disabled");c.$selectionMenu.find(".js-selection-menu-loading").hide();c.select_all_input.removeAttr("disabled");c.select_all_input.trigger("select",!1);b.orders.dispatch()})};f.all?confirm($_("Perform action to all selected orders?"))&&h():h()}var c=this;this.initSidebar();
"table"==this.options.view&&c.$selectionMenu&&c.$selectionMenu.length&&this.initSelecting();this.options.id&&this.loadOrder(this.options.id);var d=b("#s-orders-views"),e=b("#s-order-nav");d.find("li.selected").removeClass("selected");d.find('li[data-view="'+this.options.view+'"]').addClass("selected");e.attr("data-view-mode",this.options.view);d.find("li a").each(function(){var p=b(this),f=b(this).parents("li:first");p.attr("href","#/orders/view="+f.attr("data-view")+(b.order_list.options.filter_params_str?
"&"+b.order_list.options.filter_params_str:"")+"/")});var k=function(p,f,h){var l=function(){var w=b(window),y=b.Deferred();if(!f.all||!c.options.lazy_loading||w.lazyLoad("get","stopped"))return y.resolve(),y;c.container.one("append_order_list.ensureOrderListChunkLoaded",function(){y.resolve()});setTimeout(function(){c.container.off("append_order_list.ensureOrderListChunkLoaded");y.resolve()},2E3);w.lazyLoad("force");return y},q=function(w){var y=b.Deferred();if(b.isEmptyObject(w.data.orders))return y.resolve(),
y;c.container.one("append_order_list.updateOrderListChunk",function(){y.resolve()});setTimeout(function(){c.container.off("append_order_list.updateOrderListChunk");y.resolve()},1E3);c.updateListItems(w.data.orders);return y},u=function(w){var y=b.Deferred(),D=function(){if(!c.container.find(".order:not(:hidden):first").length){var E='<div class="block double-padded align-center blank"><br><br><br><br><span class="gray large">'+$_("There are no orders in this view.")+'</span><div class="clear-left"></div></div></div>';
b("#s-content").html(E)}},G=[],A=c.filter_params;if(!b.isEmptyObject(w.data.orders))for(var z=0,B=w.data.orders.length;z<B;z++)!b.isEmptyObject(A)&&A.state_id&&("string"===b.type(A.state_id)&&A.state_id!==w.data.orders[z].state_id?G.push(w.data.orders[z].id):"array"===b.type(A.state_id)&&-1===A.state_id.indexOf(w.data.orders[z].state_id)&&G.push(w.data.orders[z].id));b.isEmptyObject(G)?(D(),y.resolve()):(c.hideListItems(G).done(function(){D();y.resolve()}),setTimeout(function(){y.resolve()},1E3));
return y},t=function(w){var y=b.Deferred();l().done(function(){q(w).done(function(){u(w).done(function(){b.order_list.updateCounters({state_counters:w.data.state_counters,common_counters:{pending:w.data.pending_counters}});y.resolve()})})});return y},v=function(w,y){b.shop.jsonPost("?module=orders&action=performAction&id="+p+"&offset="+(w||0)+"&"+c.options.filter_params_str,f,function(D){"ok"===D.status?t(D).done(function(){D.data.offset<D.data.total_count?v(D.data.offset,y):y(D)}):y(D)})};v(0,h)};
if(c.$selectionMenu)c.$selectionMenu.off("click.order_list",".js-wf-action-item").on("click.order_list",".js-wf-action-item",function(){var p=b(this),f=p.data("action-id");if(!p.hasClass("disabled"))return f&&a(f),!1})},loadOrder:function(a){this.container.find(".selected").removeClass("selected");this.container.find("[data-order-id="+a+"]").addClass("selected");b.orders.load("?module=order&id= "+a+"&"+this.filter_params_str,{content:b("#s-order")},function(){this.id=a;b(window).trigger("wa_loaded",
[["split","kanban"]]);b("#order-list").trigger("wa_order_mobile_loaded",[a])})},getSelectedOrders:function(a){a=a||!1;var c={count:0,all:!1};if(this.select_all_input.attr("checked")){c.all=!0;var d=b.order_list.filter_params;a?(c.serialized=[],b.isEmptyObject(d)?c.serialized.push({name:"filter_params",value:""}):b.each(d,function(e,k){b.isArray(k)?b.each(k,function(p,f){c.serialized.push({name:"filter_params["+e+"]["+p+"]",value:f})}):c.serialized.push({name:"filter_params["+e+"]",value:k})})):c.filter_params=
b.isEmptyObject(d)?"":d;c.count=this.options.total_count}else a?c.serialized=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return{name:"order_id[]",value:b(this).attr("data-order-id")}}).toArray():c.order_id=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return b(this).attr("data-order-id")}).toArray();return c},initSortMenu:function(){const a=this;var c=b(".js-orders-sort");const d=c.find(".js-sort-dropdown-skeleton");c=c.find(".js-sort-dropdown");
let e;e||c.waDropdown({hover:!1,items:".menu > li > a",ready(k){e=k;const p=a.sort[0]?a.sort[0]:"create_datetime",f=a.sort[1]?a.sort[1]:"desc";e.$button.data("sort")||(k.$wrapper.find(".count").addClass("hidden"),k.$button.find(`.${f}`).removeClass("hidden"),k.$menu.find(`a[data-sort="${p}"]`).find(`.${f}`).removeClass("hidden"));e.$button.data("sort",p);e.$button.data("order",f)},change(k,p,f){k=b(p);var h=f.$button.data();p=h.sort;h=h.order;k.data("sort")===p?h="desc"===h?"asc":"desc":(p=k.data("sort"),
h="desc");f.$menu.find(".count").addClass("hidden");k.find(`.${h}`).removeClass("hidden");f.$button.find(`.${h}`).removeClass("hidden").siblings(".count").addClass("hidden");{const [l,q]=[p,h];e.$button.data("sort",l).data("order",q);f=window.location.hash||"";f=f.replace(/(^[^#]*#\/*|\/$)/g,"");f.split("/")[1]||(f="#/orders/state_id=new|processing|auth|paid");f=f.replace(/(&*sort\[[01]\]=.*?[&\/]|&*sort\[[01]\]=.*?$)/g,"");(k=0<f.indexOf("=")||f.includes("all"))&&(f=f.replace(/[\/&]$/,""));b.wa.setHash(f+
((k?"&":"")+"sort[0]="+l+"&sort[1]="+q+"/"))}}});c.removeClass("hidden");d.addClass("hidden")},initSidebar:function(){var a=b("#s-order-nav"),c=a.find(".selected").removeClass("selected");this.filter_params.state_id?b.isArray(this.filter_params.state_id)?(b("#s-pending-orders").addClass("selected"),b(".js-pending-orders").parent().addClass("selected")):a.find('[data-state-id="'+this.filter_params.state_id+'"]').addClass("selected"):this.filter_params.contact_id?a.find("[data-contact-id="+this.filter_params.contact_id+
"]").addClass("selected"):this.filter_params.storefront?(c=decodeURIComponent(this.filter_params.storefront),"/"===c.slice(-1)&&(c=c.slice(0,-1)),a.find('[data-storefront="'+c+'"]').addClass("selected")):b.order_list.filter_params_str?a.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||c.addClass("selected"):b("#s-all-orders").addClass("selected");a.find(".js-orders-link").unbind("click.order_list").bind("click.order_list",function(){a.find(".selected").removeClass("selected");
b(this).hasClass("brick")?b(this).addClass("selected"):b(this).closest("li").addClass("selected");if(b(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==b.orders.hash){var d=b.orders.hash.replace("orders/","");d!==b.orders.hash&&b.orders.ordersAction.apply(b.orders,d.split("/"))}})},updateSelectionMenuActionItemsByStates:function(a){var c=[];if("string"===typeof a)c.push(a);else if(b.isArray(a))c=[].concat(a);else return;a=this.$selectionMenu.find(".wf-actions .js-wf-action-item");a.addClass("disabled");
var d={};a.each(function(){var k=b(this),p=k.data("actionId");k=k.data("availableForStates").split(",");for(var f=0;f<c.length;f++){var h=c[f];h=""+h;-1!==k.indexOf(h)&&(d[h]=d[h]||[],d[h].push(p))}});var e=b.shop.intersectArrays(b.shop.getValues(d),!0);0<e.length&&a.filter(function(){return-1<b.inArray(b(this).data("actionId"),e)}).removeClass("disabled")},enableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").removeClass("disabled")},disableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").addClass("disabled")},
initSelecting:function(){var a=this,c=this.container,d=this.select_all_input;a.filter_params&&a.filter_params.state_id&&d.is(":checked")&&a.updateSelectionMenuActionItemsByStates(a.filter_params.state_id);d.click(function(){b(this).trigger("select",this.checked)});b(window).one("wa_before_dispatched",function(h){a.$selectionMenu.hide()});a.xhrs.printforms=null;var e=function(h){h=tmpl("template-order-list-printforms-menu-items",h);var l=a.$selectionMenu.find(".wf-actions");l.find(".s-printform-item,.s-printform-item-sep,.s-printform-item-button").remove();
l.append(h)};b(document).keydown(function(h){16!=h.keyCode||b(h.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(h){16==h.keyCode&&(document.body.onselectstart=null)});var k=function(){var h=b("#order-list"),l=d.attr("checked");h=h.find(".order.selected:first").length;l||h?(a.$selectionMenu.show(),a.$search_form&&a.$search_form.hide(),h=null,h=l?a.options.all_order_state_ids?a.options.all_order_state_ids:a.filter_params&&a.filter_params.state_id?
a.filter_params.state_id:null:a.container.find(".order.selected").map(function(){return b(this).data("stateId")}).toArray(),null!==h?(h=b.shop.getUniqueValues(h),a.updateSelectionMenuActionItemsByStates(h)):a.enableAllSelectionMenuActionItems()):(a.$selectionMenu.hide(),a.$search_form&&a.$search_form.show())};c.off("select",".order").on("select",".order",function(h,l){(void 0!==l?l:1)?b(this).addClass("selected").find("input:first").attr("checked",!0).prop("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",
!1).prop("checked",!1),d.is(":checked")&&d.attr("checked",!1).prop("checked",!1));k();return!1});var p=function(){a.xhrs.printforms&&a.xhrs.printforms.abort();e({printforms:[]});a.xhrs.printforms=null;d.is(":checked")&&null!==b.order_list.all_printforms?e({printforms:b.order_list.all_printforms}):a.xhrs.printforms=b.shop.getJSON("?module=orders&action=printforms",a.getSelectedOrders(),function(h){b.isEmptyObject(h.data.printforms)||(d.is(":checked")&&(b.order_list.all_printforms=h.data.printforms),
e(h.data),a.xhrs.printforms=null)})};d.unbind("select").bind("select",function(h,l){l=void 0!==l?l:!0;h=b(this);l?(h.attr("checked",!0),c.find(".order").trigger("select",!0,!1)):(h.attr("checked",!1),c.find(".order").trigger("select",!1,!1));p()});c.off("click",".order input").on("click",".order input",function(h){var l=h.shiftKey;h=this.checked;var q=b(this).parents(".order:first");h?q.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),q.removeClass("selected"));if(l&&h){(l=c.data("last_checked"))||
(l=c.find(".order:first").trigger("select",!0));var u=q.prevAll(".selected[data-order-id="+l.attr("data-order-id")+"]");if(u.length){var t=q.prev();for(l=l.get(0);t.length&&l!=t.get(0);)t.addClass("selected").find("input").attr("checked",!0),t=t.prev()}else if(u=q.nextAll(".selected[data-order-id="+l.attr("data-order-id")+"]"),u.length)for(t=q.next(),l=l.get(0);t.length&&l!=t.get(0);)t.addClass("selected").find("input").attr("checked",!0),t=t.next();c.data("last_checked")||u.length||l.trigger("selected",
!1)}h&&c.data("last_checked",q);k();p()});var f=function(h,l){if(100<l.count)alert($_("Maximum of %d orders is allowed for bulk form printing.").replace("%d",100));else{var q="?module=orders&action=printformsDisplay";l=b.map(l.serialized,function(u){return u.name+"="+u.value}).join("&");h=b.map(h,function(u){return"form[]="+u}).join("&");q+="&"+l+"&"+h;b.order_list.plugin_hash&&(q+="&hash="+b.order_list.plugin_hash);h=(""+Math.random()).slice(2);window.open(q,h)}};a.$selectionMenu.off("click.printforms").on("click.printforms",
".s-printform-item-button",function(h){h.preventDefault();a.xhrs.printforms&&a.xhrs.printforms.abort();a.xhrs.printforms=null;h=a.$selectionMenu.find(".s-printform-item :checkbox").map(function(){var q=b(this);return q.is(":checked")?q.data("id"):!1}).toArray();if(h.length){var l=a.getSelectedOrders(!0);if(!(0>=l.count))return f(h,l),!1}})},updateTitle:function(a,c){c=parseInt(c,10)||0;var d="";this.options.state_names&&(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?d=
this.options.state_names[this.filter_params.state_id].name:b.isArray(this.filter_params.state_id)&&(d=$_("Processing")):d=$_("All orders"));document.title=c?"("+c+") "+d+(a||""):d+a},updateCounters:function(a){if("kanban"===this.options.view){var c=b(".s-kanban__list__count");for(var d in a.state_counters)a.state_counters.hasOwnProperty(d)&&c.filter(`[data-status-id="${d}"]`).text(a.state_counters[d])}else for(c in(d=this.sidebar)||(d=b("#s-sidebar")),a.total_processing&&this.updateTotalProcessing(a.total_processing),
a)if(a.hasOwnProperty(c)){var e=a[c],k;for(k in e)if(e.hasOwnProperty(k)){var p="common_counters"==c?b(".js-"+k+"-orders"):"storefront_counters"===c?d.find("li[data-"+c.replace("_counters","")+'="'+k+'"] .count'):d.find("li[data-"+c.replace("_counters","")+"-id="+k+"] .count");var f=parseInt(p.text(),10)||0;e[k]=""+e[k];"+"==e[k].substr(0,1)?f+=parseInt(e[k].substr(1),10)||0:"-"==e[k].substr(0,1)?(f-=parseInt(e[k].substr(1),10)||0,f=0>f?0:f):f=parseInt(e[k],10)||0;p.text(f);"new"==k&&(b.shop.updateAppCounter(f),
this.updateTitle(this.options.title_suffix,parseInt(f,10)),b(document).find(".js-new-order-counter").text(`+${f}`))}}},updateListItems:function(a){var c="template-order-list-"+this.options.view;if(document.getElementById(c)){var d=this.container;b.isArray(a)||(a=[a]);c=b("<div></div>").append(tmpl(c,{orders:a,states:this.options.state_names,state_counters:this.options.state_counters||{},state_icons:this.options.state_icons||{},check_all:"table"==this.options.view?this.select_all_input.attr("checked"):
!1}));var e=b(".order",d);b(".order",c).each(function(){var k=b(this);e.filter("[data-order-id="+k.attr("data-order-id")+"]").replaceWith(k)});c.remove();this.container.trigger("append_order_list",[a])}},updateTotalProcessing:function(a){a&&b(".js-total_processing-orders").html(a.replace(",","."))},hideListItems:function(a){var c=b.Deferred();setTimeout(function(){if(b.order_list&&b.order_list.container&&b.order_list.container.length){if(b.isArray(a)){var d=b.order_list.container.find(".order");p=
b();for(var e=0;e<a.length;e++){var k=d.filter("[data-order-id="+a[e]+"]");p=p.add(k)}}else var p=b.order_list.container.find(".order[data-order-id="+a+"]");var f=p.length,h=0;p.slideUp(450,function(){h++;h>=f&&c.resolve()})}},1E3);return c.promise()},dispatch:function(a,c){"string"===typeof a&&(a=b.shop.helper.parseParams(a));var d={list:function(){b.orders.waLoadingBeforeLoad();b.order_list.finit();b.orders.load("?module=orders&"+b.orders.buildOrdersUrlComponent(a),function(){b.order_list.dispatch(a);
b(window).trigger("wa_loaded",[["table"]])})},order:function(){b.order_list.loadOrder(a.id)}};null===this.params?(this.params=a,c&&d.list()):a.id&&(c||a.id!=this.params.id)?(d.order(),this.params=a):(c||this.diff(a,this.params)||this.diff(this.params,a))&&d.list()},diff:function(a,c){for(var d in a)if(a.hasOwnProperty(d)&&"id"!=d&&a[d]!==c[d])return!0;return!1},buildLoadListUrl:function(a,c,d,e=null,k=null,p=null){e&&this.filter_params_str&&this.filter_params_str.includes("hash")&&(this.filter_params_str+=
encodeURIComponent(`&update_datetime>=${e}`),e=null);k=k||this.sort;return`?module=orders&action=loadList${p?`&state_id=${p}`:""}&id=${a}`+(this.filter_params_str?"&"+this.filter_params_str:"")+(c?"&lt=1":"")+(d?"&counters=1":"")+(this.options.view?"&view="+this.options.view:"")+(e?"&search=update_datetime>="+e:"")+("&sort[0]="+k[0]+"&sort[1]="+k[1])},updateProcess:function(a,c){a=a||"run";c=c||{};timeout=c.timeout||6E4;var d=this,e=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=
null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};e();if("run"==a){var k=function(l,q){var u=d.container.find(".order:first");u=parseInt(u.attr("data-order-id"),10)||0;const t=f(c.last_update_datetime);if(d.options?.view&&"kanban"===d.options.view){u=0;const v=Array.from(document.querySelectorAll("#order-list [data-order-id]")).map(w=>w.getAttribute("data-order-id"));v.length&&(u=Math.max(...v))}return b.getJSON(d.buildLoadListUrl(u,!0,!0,t),function(v){if("ok"==
v.status){p(v);b.isEmptyObject(v.data.counters)||d.updateCounters(v.data.counters);if(v.data.count)try{if("kanban"===d.options.view){const w=d.container.find('[data-kanban-list-status-id="new"]');w.length&&(v.data.orders.reverse(),v.data.orders.forEach(y=>w.prepend(tmpl("template-order-list-kanban-card",{order:y,state:"new",state_name:d.options?.state_names["new"]?.name||"",state_color:d.options?.state_names["new"]?.options?.style?.color||""}))))}else d.container.prepend(tmpl("template-order-list-"+
d.options.view,{orders:v.data.orders,states:d.options.state_names||{},state_counters:d.options.state_counters||{},state_icons:d.options.state_icons||{},check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),b(".lazyloading-progress-string").text(v.data.progress.loaded+" "+v.data.progress.of),d.container.trigger("append_order_list",[v.data.orders])}catch(w){console&&(console.log("Error: "+w.message),q());return}"function"===typeof l&&l(v)}else console&&console.log("Error when loading new orders: "+
v.errors),"function"===typeof q&&q()}).error(function(v){console&&(v&&v.errors?console.log("Error when loading new orders: "+v.errors):console.log(["Error when loading new orders",v]));"function"===typeof q&&q()})},p=l=>{if(!b.isEmptyObject(l.data.updated_orders))try{const q=[];for(const u of l.data.updated_orders){const t=d.container.find(`[data-order-id=${u.id}]`),v=t.hasClass("selected");if(t.length){const w=t.data("state-id"),y=u.state_id,D=decodeURIComponent(window.location.hash),G=/state_id=([\w|]+)/.exec(D)?.[1]?.replace(/\|{1,2}/g,
",")?.split(",")||[],A=z=>{const B={states:d.options.state_names||{}};let E="";"kanban"===d.options.view?(E="-card",u.order_icon=u.contact.photo_50x50,B.order=u,B.state=y,B.state_name=B.states[B.state]?.name,B.state_color=B.states[B.state]?.options.style.color||"#fff",B.isUpdated=!0):(B.orders=[u],B.state_counters=d.options.state_counters||{},B.state_icons=d.options.state_icons||{},B.check_all="table"==d.options.view?d.select_all_input.attr("checked"):!1);t.after(tmpl(`template-order-list-${d.options.view}${E}`,
B)).remove();z&&d.loadOrder(u.id)};if((()=>{if(w!==y){if(G.some(B=>y.includes(B))||"kanban"===this.options.view)return!0;const z=t.next();z.length&&d.loadOrder(z.data("order-id"));t.remove();return!1}return!0})()){if(A(v),w!==y){const z=d.container.find(`[data-order-id="${u.id}"]`),B=d.container.find(`[data-kanban-list-status-id="${y}"]`);z.slideToggle("normal",function(){b(this).prependTo(B).slideToggle("normal")})}}else t.remove();q.push(u.update_datetime)}}f(q.sort()[q.length-1]);d.container.trigger("append_order_list",
[l.data.updated_orders])}catch(q){console&&console.log("Error: "+q.message)}},f=l=>{function q(t){return t.toISOString().replace("T"," ").substring(0,19)}l||(l=new Date,l.setDate(l.getDate()-1),l=q(l));l=new Date(`${l}Z`);const u=q(l);l.setTime(l.getTime()+timeout);c.last_update_datetime=q(l);return u},h=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=k(h,e):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=k(h,e)})},timeout)};h()}},finit:function(a){a=this.xhrs;
var c=this.lazy_load_win,d;for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&a[d].abort();this.updateProcess("kill");c&&c.lazyLoad("stop");this.params=null},ordersNavTeleport(){const a=window.ordersNav;void 0!==a&&void 0!==b.orders&&(a.show(),"split"===this.options.view?b("#s-orders").find(".sidebar-header").prepend(a):b("#s-content").before(a),b.orders.initDropdown())},selectionMenuTeleport(){if(this.$selectionMenu&&(this.$search_form=b(".js-sidebar-search-form"),this.$search_form.length)){const a=this.$selectionMenu.detach();
this.$search_form.after(a)}},isMobile(){return b("#js-media-mobile").is(":visible")}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_form:null,$storefront_selector:null,stocks:[],slide_on:!1,options:{},locales:{},init:function(b){this.options=b;b.id&&(this.id=b.id);this.container="string"===typeof b.container?$(b.container):b.container;this.form="string"===typeof b.form?$(b.form):b.form;this.$storefront_selector=$("#order-storefront");b.stocks.sort(function(a,c){return a.sort-c.sort});this.stocks=b.stocks;b.title&&(document.title=title);b.float_delimeter||(b.float_delimeter=
".");b.locales&&(this.locales=b.locales);this.float_delimeter=b.float_delimeter;this.prev_ship_method=null;this.container.trigger("order_edit_init");this.initView();this.initShippingControl();this.initDiscountControl();this.initCouponControl();this.initCustomerSourceControl(b.customer_sources)},initCustomerForm:function(b){this.customer_form=new ShopBackendOrderEditorCustomerForm($("#s-order-edit-customer"),this,b)},initView:function(){var b=this,a=b.options;this.initStorefrontSelector();var c=function(f){var h=
f.find(".s-orders-sku-stock-select").find("option:selected"),l=f.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");f.find(".s-orders-stock-icon-aggregate").show();f.find(".s-orders-stock-icon").html("").hide();l=l.length?l:f;h.attr("data-icon")&&(l.find(".s-orders-stock-icon-aggregate").hide(),l.find(".s-orders-stock-icon").html(h.attr("data-icon")).show(),f.find(".s-orders-stock-icon .s-stock-left-text").show(),l.find(".s-orders-stock-icon .s-stock-left-text").hide())};
$.order_edit.slide(!0,"add"==a.mode);this.container.find(".back").click(function(){$.order_edit.id?$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.getOrderItems(this.container,!0);$(".s-order-item").each(function(){var f=$(this);c(f)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());$.order_edit.options.currency=$(this).val()});var d=a.price_edit||!1,e=$("#orders-add-autocomplete");e.autocomplete({source:"?action=autocomplete&with_counts=1",
minLength:3,delay:300,select:function(f,h){$(".s-order-errors").empty();f="?module=orders&action=getProduct&product_id="+h.item.id+"&order_id="+$.order_edit.id+"&currency="+$.order_edit.options.currency;(h=b.getStorefront())&&(f+="&storefront="+h);$.getJSON(f,function(l){var q=$("#order-items"),u=parseInt(q.find(".s-order-item:last").attr("data-index"),10)+1||0;q=l.data.product;q.sku_id&&q.skus[q.sku_id]&&(q.skus[q.sku_id].checked=!0);1===$("#subtotal.hidden").length&&($("#productless-subtotal").addClass("hidden").prop("disabled",
!0).hide(),$("#subtotal").removeClass("hidden").show());$("#order-currency").length&&!$("#order-currency").attr("disabled")&&($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled","disabled"));var t=$("#s-orders-add-row");t.before(tmpl("template-order",{data:l.data,options:{index:u,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:d}}));l=t.prev();u=q.skus[q.sku_id];$.order_edit.initQuantity({$wrapper:l.find("#js-quantity-section").removeAttr("id"),
denominator:q.order_multiplicity_factor,step:u.order_count_step||q.order_count_step,min:u.order_count_min||q.order_count_min});$("#s-order-comment-edit").show();$.order_edit.updateTotal();c(l)});e.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",".s-orders-skus input[type=radio]",function(){var f=$(this),h=f.parents("tr:first"),l=f.closest("li"),q=this.value,u=h.attr("data-product-id"),t=h.attr("data-index"),v=null;"edit"==($.order_edit.id?"edit":"add")&&
(v=parseInt(f.attr("name").replace("sku[edit][",""),10));f="?module=orders&action=getProduct&product_id="+u+"&sku_id="+q+"&currency="+$.order_edit.options.currency;(q=b.getStorefront())&&(f+="&storefront="+q);$.getJSON(f,function(w){var y=-1!==h.find("input:first").attr("name").indexOf("add")?"add":"edit";h.find(".s-orders-services").replaceWith(tmpl("template-order-services-"+y,{services:w.data.sku.services,service_ids:w.data.service_ids,product_id:u,options:{price_edit:d,index:t,currency:$.order_edit.options.currency,
stocks:$.order_edit.stocks}}));h.find(".s-orders-product-price").find("input").val(w.data.sku.price);h.find(".s-orders-sku-stock-place").empty();l.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+y,{sku:w.data.sku,index:t,stocks:$.order_edit.stocks,item_id:v}));var D=h.find(".js-order_count_min");if(D.length){y=w.data.sku;D=D.find(".js-value");var G=w.data.sku.order_count_min?parseFloat(w.data.sku.order_count_min):parseFloat(w.data.product.order_count_min);D.text(G);D=parseFloat(y.count);
G=h.find(".s-orders-sku-stock-select");if(G.length&&y.stock){var A=G.val();A&&y.stock[A]&&(D=parseFloat(y.stock[A]));G.data("stock",y.stock)}G=h.find(".js-quantity-field").data("controller");G.update({min:y.order_count_min?parseFloat(y.order_count_min):parseFloat(w.data.product.order_count_min),max:D});console.log(G)}c(h);$.order_edit.updateTotal()})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var f=$(this).parents("tr.s-order-item:first"),
h=f.find(".s-orders-sku-stock-select");if(h.length){var l=h.val();h=h.data("stock");if(l&&h&&h[l]){var q=f.find(".js-quantity-field").data("controller");q.update({max:parseFloat(h[l])});console.log(q)}}c(f)});var k=function(f,h,l){var q=f.attr("data-price");f=f.attr("data-percent-price");l&&h.val(q);h.attr("data-price",q);h.attr("data-percent-price",f)};this.container.off("change",".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var f=$(this),h=f.find("option:selected");
f=f.parents("li:first");k(h,f.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var f=$(this),h=f.find("option:selected");f=f.parents("li:first");k(h,f.find(".s-orders-service-price"),!1)});this.container.off("click",".s-order-item-delete").on("click",".s-order-item-delete",function(){$(this).parents("tr:first").remove();$("table#order-items").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});
this.container.off("change",".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",".s-orders-product-price input",function(){var f=$(this).parents("tr:first");$.order_edit.updateServicePriceInPercent(f);$.order_edit.updateTotal()});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);
$("#payment_methods").change(function(){$(this).val();$("#payment-info > div").hide();$.order_edit.updateTotal()});$("#productless-subtotal").on("change",function(){$.order_edit.updateTotal()});this.container.off("keydown",".s-orders-quantity").on("keydown",".s-orders-quantity",function(){var f=$(this),h=f.data("timer_id");h&&clearTimeout(h);f.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},450))});if(this.form&&this.form.length){var p=function(){var f=$(this);if(p.xhr)return!1;
$.order_edit.showValidateErrors();$('.s-orders-services input[name^="service"][type="checkbox"]:not(:checked),.s-orders-services input.js-fake-service-selected[type="checkbox"]:not(:checked)',this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",!0)});if(!$.order_edit.container.find(".error").length){$.order_edit.switchSubmitButton("disable");var h=function(){p.xhr=null;$.order_edit.switchSubmitButton();$(".s-orders-services input:disabled",f).attr("disabled",!1)};p.xhr=
$.order_edit.id?$.order_edit.saveSubmit(h,"edit"):$.order_edit.saveSubmit(h,"add")}return!1};this.form.unbind("sumbit").bind("submit",p)}$("#subtotal").text(this.roundFloat($("#subtotal").text()));$("#total").text(this.roundFloat($("#total").text()));$("#discount").val(this.roundFloat($("#discount").val()));$("#tax").text(this.roundFloat($("#tax").text()));this.container.trigger("order_edit_init_view")},initShippingControl:function(){var b=this;b.prev_ship_method=$("#shipping_methods").val();$("#shipping-custom").on("change",
":input",function(a){$.shop.trace("#shipping-custom change",[a,this]);a.originalEvent&&$(this).data("affects-rate")&&$.order_edit.updateTotal()});b.setShippingInfo();$("#shipping_methods").change(function(){var a=$("#shipping_methods option:selected"),c=a.data("rate")||0,d=$("#shipping-rate");d.data("shipping")&&a.val()==b.prev_ship_method||(d.val($.order_edit.formatFloat(c)),d.data("shipping",!1),b.prev_ship_method=a.val());b.setShippingInfo();$.order_edit.updateTotal()});$("#shipping-rate").change(function(){var a=
$(this);if(0>a.val())return alert($.order_edit.locales.wrong_cost),a.val(0),!1;$("#shipping-rate").data("shipping",$(this).val());$.order_edit.updateTotal()});this.container.trigger("order_edit_init_shipping")},initDiscountControl:function(){function b(){0<$.order_edit.parseFloat(a.val())?k.stop().show():k.stop().hide();var f=25;k.is(":visible")&&k.finish().fadeOut(f+=50).fadeIn(f+=50).fadeOut(f+=50).fadeIn(f+=50).fadeOut(f+=50).fadeIn(f+=50).fadeOut(f+=50).fadeIn(f+50)}var a=$("#discount"),c=$("#discount-description"),
d=$("#update-discount"),e=$("#edit-discount"),k=$("#discount-tooltip-icon");k.tooltip({showURL:!1,bodyHandler:function(){return c.val()||c.data("updated-manually-msg")}});d.tooltip({showURL:!1,bodyHandler:function(){return d.data("description")||c.data("updated-manually-msg")}});e.length?k.show():k.hide();$("#order-edit-form").on("order_total_updated",function(f,h){a.show();a.parent().find("span.js-order-discount:first").hide();e.hide();d.data("description",h.discount_description);if(h.discount){d.data("value",
h.discount).data("description",h.discount_description).data("items_discount",h.items_discount);if("calculate"===d.data("discount")){c.val(d.data("description"));f=d.data("items_discount")||[];for(var l=0;l<f.length;l++)if(f[l]){var q="#order-items span.js-item-total-discount";q+='[data-discount-id="'+f[l].selector+'"]';q=$(q);q.length&&q.html(f[l].html).show()}b()}"calculate"===d.data("discount")?$.order_edit.parseFloat(h.discount)!==$.order_edit.parseFloat(a.val())&&d.click():d.show()}});var p=function(){a.show();
a.parent().find("span.js-order-discount:first").hide();e.hide();$(".js-item-total-discount").hide()};e.click(function(){p();c.val("");return!1});d.click(function(){p();a.val(d.data("value")||0).change();c.val(d.data("description"));a.attr("title",c.data("edit-manually-msg"));d.hide().data("discount","calculate");$.order_edit.updateTotal();b();return!1});a.on("change",function(){e.click();c.val("");$("#order-items .js-item-total-discount").hide();a.attr("title",null);d.show().data("discount",$(this).val());
$.order_edit.updateTotal();b()});this.container.trigger("order_edit_init_discount")},initCouponControl:function(){function b(){q.show();q.css("padding-right",$(".coupon-controls").width()+4+"px")}var a=$("#coupon_id"),c=$("#coupon-code"),d=$(".coupon-code-label"),e=$(".js-no-coupon-text"),k=$(".js-coupon-icon"),p=$(".js-edit-coupon"),f=$(".js-close-coupon"),h=$(".js-delete-coupon"),l=$("#update-discount"),q=$("#js-coupon-invalid-msg");p.on("click",function(){$(this).add(e).add(k).add(d).hide();c.data("value",
c.val());c.val("").show();f.show()});f.click(function(){c.val(c.data("value"));p.show();""===a.val()?e.show():k.add(d).show();$(this).add(c).add(q).hide()});h.click(function(){$(this).add(c).add(k).add(d).add(p).add(f).add(q).hide();a.val("");l.click();e.add(p).show()});$(".disabled-link").click(function(u){u.preventDefault()});c.autocomplete({source:function(u,t){$.ajax({type:"POST",url:"?module=marketing&action=CouponsAutocomplete",data:{term:c.val(),products:$('input[name^="product["]').serializeArray()},
success:function(v){t(v);v.length?q.hide():b()},error:function(){t([])}})},minLength:1,delay:300,select:function(u,t){t.item.data.valid?(c.val(t.item.label).hide(),a.val(t.item.value),d.html(t.item.label).show(),p.add(k).add(h).show(),t.item.data.right?($(".s-order-edit-coupon").attr("href",$(".s-order-edit-coupon").data("href")+t.item.value),0!=t.item.value.length&&(l.click(),$(".s-order-edit-coupon").removeClass("disabled-link"))):0!=t.item.value.length&&l.click(),f.hide()):(c.val(t.item.label),
b());return!1}})},initCustomerSourceControl:function(b){var a=$("#customer-source");a.autocomplete({delay:0,minLength:0,appendTo:"#order-edit-form",source:function(c,d){var e=b.filter(function(k){return k&&k.indexOf&&0<=k.indexOf(c.term)}).slice(0,10);1==e.length&&e[0]==c.term?d([]):d(e)}}).on("focus",function(){a.autocomplete("search")})},initUpdateServicePrice:function(){this.container.find(".s-order-item").each(function(){$.order_edit.updateServicePriceInPercent($(this))})},initQuantity:function(b){function a(d,
e){var k=e="string"===typeof e?e:""+e;switch(d){case "float":d=parseFloat(e);0<=d&&(k=1*d.toFixed(3));break;case "number":var p="0123456789.,".split(""),f=[],h=!1;$.each(e.split(""),function(l,q){"."===q||","===q?h||(h=!0,f.push(".")):0<=p.indexOf(q)&&f.push(q)});k=f.join("");break;case "integer":p="0123456789".split(""),f=[],$.each(e.split(""),function(l,q){0<=p.indexOf(q)&&f.push(q)}),k=f.join("")}return k}var c=function(d){c=function(e){this.$wrapper=e.$wrapper;this.$field=this.$wrapper.find(".js-quantity-field");
this.denominator="undefined"!==typeof e.denominator?a("float",e.denominator):1;this.denominator=0<this.denominator?this.denominator:1;this.min="undefined"!==typeof e.min?a("float",e.min):this.denominator;this.min=0<this.min?this.min:1;this.max="undefined"!==typeof e.max?a("float",e.max):0;this.max=0<=this.max?this.max:0;this.step="undefined"!==typeof e.step?a("float",e.step):1;this.step=0<this.step?this.step:1;e=this.$field.val();0<parseFloat(e)||0===parseFloat(e)||(this.$field.val(this.min),e=this.min);
this.value=this.validate(e);this.init()};c.prototype.init=function(){function e(p){var f="0123456789.".split(""),h=[],l=!1;p=p.replace(/,/g,".");d.each(p.split(""),function(q,u){"."===u?l||(l=!0,h.push(u)):0<=f.indexOf(u)&&h.push(u)});return h.join("")}var k=this;k.$field.data("controller",k);k.$wrapper.data("controller",k);k.$field.on("input",function(){var p=k.$field.val();var f=e("string"===typeof p?p:""+p);f!==p&&k.$field.val(f)});k.$field.on("change",function(){k.set(k.$field.val())})};c.prototype.set=
function(e,k){e=this.validate(e);this.$field.val(e);this.value=e;this.$wrapper.trigger("quantity.changed",[this.value,this])};c.prototype.validate=function(e){e="number"!==typeof e?parseFloat(e):e;e=parseFloat(e.toFixed(3));0<e?.001>e?e=.001:this.max&&.001<this.max&&e>this.max&&(e=this.max):0!==e&&(e=.001);return a("float",e)};c.prototype.update=function(e){var k="undefined"!==typeof e.min?a("float",e.min):this.min,p="undefined"!==typeof e.max?0<=parseFloat(e.max)?a("float",e.max):0:this.max,f="undefined"!==
typeof e.step?a("float",e.step):this.step;e="undefined"!==typeof e.value?this.validate(e.value):this.value;0<k&&k!==this.min&&(this.min=k);0<=p&&p!==this.max&&(this.max=p);0<f&&f!==this.step&&(this.step=f);0<e&&e!==this.value&&(this.value=e);this.set(this.value)};return c}($);return new c(b)},updateServicePriceInPercent:function(b){var a=b.find(".js-order-edit-item-price").val();if("undefined"===typeof a)return null;b.find('[data-currency="%"]').each(function(){var c=$(this),d=a*(c.data("percentPrice")/
100);d=$.order_edit.roundFloat(d);c.val($.order_edit.formatFloat(d));c.attr("data-price",d)})},setShippingInfo:function(){var b=$("#shipping_methods"),a=b.children(":selected"),c=$("#shipping-rate"),d=$("#shipping-info"),e=b.val(),k=b.data("_shipping_id"),p=$.order_edit.checkSelectedAddressFields(),f=[];a.length?(a.data("error")&&!p&&f.push('<span class="error">'+a.data("error")+"</span>"),a.data("est_delivery")&&f.push('<span class="hint est_delivery">'+a.data("est_delivery")+"</span>"),$("#shipping-custom > div").hide(),
null!==e&&(e=(""+e).replace(/\..+$/,""),$("#shipping-custom-"+e).length&&$("#shipping-custom-"+e).show()),a.data("comment")&&f.push('<span class="hint">'+a.data("comment")+"</span>"),f?(a.data("error")&&!p?(c.addClass("error"),b.addClass("error")):(c.removeClass("error"),b.removeClass("error")),d.html(f.join("<br>")).show()):(c.removeClass("error"),d.empty().hide())):b.addClass("error");$.shop.trace("check shipping_methods id",[k,e,a])},checkSelectedAddressFields:function(){var b=$('[name="customer[address.shipping][city]"]'),
a=$('[name="customer[address.shipping][region]"]');b=[{exists:0<b.length,selected:""!=b.val()},{exists:0<a.length,selected:""!=a.val()}];var c=a=0,d;for(d in b){var e=b[d];e.exists&&a++;e.exists&&e.selected&&c++}return a==c},getOrderItems:function(b){var a=[],c=[];b.find(".s-order-item").each(function(){var d=$(this),e=d.find('input[name^="product"]').val(),k=[],p=$.order_edit.parseFloat(d.find(".s-orders-product-price input").val()),f=$.order_edit.parseFloat(d.find("input.s-orders-quantity").val()),
h=d.find("select.s-orders-sku-stock-select").val(),l=d.data("item-id"),q=d.find("input[name^=sku]:not(:radio)").add(d.find("input[name^=sku]:checked")).first().val()||0,u={product_id:e,sku_id:q,services:[]};d.find(".s-orders-services").length&&d.find(".s-orders-services input:checkbox:checked").each(function(){var t=$(this).closest("li"),v=$.order_edit.parseFloat(t.find("input.s-orders-service-price").val()),w=$(this).val();t=t.find(':input[name^="variant["]').val();k.push({id:w,price:v,variant_id:t});
u.services.push(w)});u.services.sort();u.services=u.services.join("_");a.push({id:l,product_id:e,quantity:f,price:p,sku_id:q,services:k,stock_id:h});c.push(u)});c=this.reduceOrderContent(c);b.data("order-content",c);return a},reduceOrderContent:function(b){b.sort(function(a,c){var d=a.product_id-c.product_id;0===d&&(d=a.sku_id-c.sku_id);0===d&&(d=a.services.localeCompare(c.services));return d});return b.map(function(a){return"*"+a.product_id+":"+a.sku_id+":"+a.services}).join(";")},updateTotal:function(){function b(){a=
null;$.order_edit.realUpdateTotal()}var a=null;return function(){a?(clearTimeout(a),a=setTimeout(b,250)):a=setTimeout(b,500)}}(),realUpdateTotal:function(){var b=$.order_edit.container,a=$("#subtotal"),c=$("#total"),d=$("#tax");if(b.find(".s-order-item").length){var e=this;$.order_edit.switchSubmitButton("disable");$.order_edit.showValidateErrors();for(var k={},p=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),f=0;f<p.length;f++)k[p[f].name]=p[f].value;k.storefront=e.getStorefront();
1===$("#subtotal.hidden").length?k.items=[{quantity:1,price:$("#productless-subtotal").val()}]:k.items=$.order_edit.getOrderItems(b);var h=$("#update-discount").data("discount");void 0!==h&&("calculate"!==h&&(h=$.order_edit.parseFloat(h)),k.discount=h);$.order_edit.id?k.order_id=$.order_edit.id:k.currency=$("#order-edit-form input[name=currency]").val();b=$("#shipping_methods").val();p=$("#payment_methods").val();f=$("#coupon_id").val();$("#shipping-rate").data("shipping")&&(k.shipping=$("#shipping-rate").data("shipping"));
k.params={shipping_id:b,coupon_id:f,payment_id:p};k["customer[id]"]=k.contact_id=$("#s-customer-id").val();k.tax="calculate";b&&(b=parseInt(b.split(".")[0]),0<b&&$("#shipping-custom").find(">#shipping-custom-"+b+" :input").each(function(){k[this.name]=this.value}));$.ajax({type:"POST",url:"?module=order&action=total",data:k,success:function(l){function q(r){var x=$("#payment_methods"),C=$("#payment-info"),H=x.val();x.html("");C.html("");x.append("<option value=''></option>");x.val("");r.length&&$.each(r,
function(L,I){x.append('<option value="'+I.id+'">'+I.name+"</option>");I.id===H&&(x.val(H),I.custom_html&&$("<div />",{id:"payment-custom-"+I.id,class:"fields form"}).html(I.custom_html).appendTo(C))})}if(l&&"ok"===l.status){var u=$("#shipping-rate"),t=$("#shipping_methods"),v=$.trim(t.val())||"",w=v.replace(/\W.+$/,"");l.data&&(l.data=$.order_edit.parseTotalResponse(l.data));t.empty();t.prepend('<option value=""></option>');if(0<l.data.shipping_method_ids.length){var y=$("#shipping-custom");y.empty();
var D=l.data.shipping_method_ids,G=l.data.shipping_methods,A=!1,z=!1;-1!==D.indexOf(v)&&(A=!0);A||-1===D.indexOf(Number(w))||(z=A=!0);y.find(">div.fields.form").hide();for(var B=0;B<D.length;B+=1){var E=""+D[B],F=G[E],g=E.replace(/\W.+$/,""),m=$("<option></option>");m.html(F.name).attr("value",E).data("rate",F.rate);m.data("error",F.error||void 0);m.data("est_delivery",F.est_delivery||void 0);m.data("comment",F.comment||void 0);m.data("external",F.external||!1);t.append(m);v||0!==B||$("#shipping-rate").val($.order_edit.formatFloat(F.rate));
if(w==g){if(F.custom_data)for(var n in F.custom_data)F.custom_data.hasOwnProperty(n)&&m.data(n,F.custom_data[n]);F.custom_html&&(m=y.find("#shipping-custom-"+g),m.length||(m=y.append('<div id="shipping-custom-'+g+'" class="fields form"></div>'),m=y.find("#shipping-custom-"+g)),m.html(F.custom_html))}if(!A&&(F=(""+E).split("."),g=v.split("."),""!==g[0]&&void 0!==F[0]&&void 0!==g[0]&&F[0]==g[0])){v=E;t.val(v);$.order_edit.setShippingInfo();$.order_edit.realUpdateTotal();return}}t.val(v);z&&t.val(w);
t.data("_shipping_id",w);$.shop.trace("set shipping_methods id",[w,v])}q(l.data.payment_methods);""!=h&&$("#discount").val(l.data.discount);u.val(l.data.shipping);$("#order-edit-form").trigger("order_total_updated",l.data);a.text(l.data.subtotal);c.text(l.data.total);d.text(l.data.tax);$.order_edit.showValidateErrors(l.data.errors);e.setShippingInfo()}$.order_edit.switchSubmitButton()},dataType:"json"})}else a.text(0),c.text(0),$.order_edit.checkSelectedAddressFields()&&($("#shipping_methods, #shipping-rate").removeClass("error"),
$("#shipping-info").empty().hide())},saveSubmit:function(b,a){var c=this.form,d=c.serializeArray();"calculate"===$("#update-discount").data("discount")?$(d).each(function(){"discount"==this.name&&(this.value="calculate")}):void 0===$("#update-discount").data("discount")&&(d=d.filter(function(k){return"discount"!==k.name}),0<$("#discount").val()?d.discount_description=$("#edit-discount").val():d=d.filter(function(k){return"discount_description"!==k.name}));success="add"==a?function(k){$.order_edit.container.trigger("order_edit_save_success",
{data:k.data,is_new:!0});$.order_edit.slide(!1,!0)&&(location.href="#/orders/state_id=new&view=split&id="+k.data.order.id+"/")}:function(k){$.order_edit.container.trigger("order_edit_save_success",{data:k.data,is_new:!1});$.order_edit.container.find(".back").click()};if(1===$("#subtotal.hidden").length){var e=[{name:"quantity[edit][0][product]",value:1},{name:"product[edit][0]",value:0},{name:"sku[edit][0]",value:0},{name:"name[edit][0]",value:$.order_edit.locales.noproduct_item_name},{name:"item[edit][0]",
value:0},{name:"currency",value:$("#order-currency").val()}];d=[...d,...e]}this.container.trigger("order_edit_save",d);return $.shop.jsonPost(c.attr("action"),d,success,function(k){$.shop.trace(a,k);k&&k.errors&&!$.isEmptyObject(k.errors)&&$.order_edit.showValidateErrors(k.errors)},b)},parseTotalResponse:function(b){["total","discount","shipping","tax","subtotal"].forEach(function(a){if("number"===typeof b[a]||"string"===typeof b[a])b[a]=$.order_edit.roundFloat(parseFloat((+b[a]).toFixed(2)))});return b},
roundFloat:function(b){return b?this.formatFloat(Math.round(100*b)/100):0},formatFloat:function(b){return","===this.float_delimeter?(""+b).replace(".",","):""+b},parseFloat:function(b){return b?parseFloat((""+b).replace(",",".")):0},slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(b,a,c){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{b="undefined"===typeof b?!0:b;a="undefined"===typeof a?!1:a;var d=this.options.duration||200,e=this.options.view,k=[];
return!this.slide_on&&b?(k.push($("#s-sidebar").animate({width:0},d,function(){$(this).hide()})),$(".s-level2").hide(),k.push($("#maincontent").animate({"margin-top":45},d)),k.push($("#s-content").animate({"margin-left":0},d)),k.push($("#s-orders").animate({width:0},d,function(){$(this).hide()})),k.push($("#s-order").animate({"margin-left":0},d).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=
!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(k).done(function(){$.order_list&&$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");"function"===typeof c&&c.call(this)}),!0):this.slide_on&&!b?(k.push($("#s-order").animate({"margin-left":"table"==e||a?200:300},d).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),k.push($("#s-orders").animate({width:300},d).show()),k.push($("#maincontent").animate({"margin-top":84},
d)),$(".s-level2").show(),k.push($("#s-sidebar").animate({width:200},d).show()),this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),$.when(k).done(function(){$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof c&&c.call(this)}),!0):!1}},switchSubmitButton:function(b){var a=this.form,c=$(a).find(".s-order-items-edit td.save i.loading");a=$(a).find("[type=submit]");"disable"===b?(c.css("display","inline-block"),a.attr("disabled",!0)):
(c.css("display","none"),a.attr("disabled",!1))},showValidateErrors:function(b){var a=[];$.shop.trace("showValidateErrors",b);$("#shipping-info").find(".error").empty();$(".error").removeClass("error");$("#s-order-edit-customer .errormsg").empty();this.customer_form&&this.customer_form.showValidateErrors(b?b.customer:{});$(".s-order-errors").empty();if(b&&b.order){if(!$.isEmptyObject(b.order.items))for(var c in b.order.items){var d=$(".s-order-item[data-index="+c+"]"),e=b.order.items[c],k;for(k in e){var p=
d.find(".s-error-item-"+k);p.length?p.text(e[k]):a.push(e[k])}delete b.order.items[c]}if(!$.isEmptyObject(b.order.product)){var f=b.order.product,h;for(h in f)f.hasOwnProperty(h)&&"quantity"in f[h]&&$(".s-order-item[data-product-id="+h+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=""+f[h].sku_id&&$(this).find("ul.s-orders-skus").length||($(this).find(".s-orders-quantity").addClass("error"),a.push(f[h].quantity))})}b.order.common&&a.push(b.order.common);b.order.discount&&
($("#discount").addClass("error"),a.push(b.order.discount));a.length&&$(".s-order-errors").html(a.join("<br>"))}},getSelectedStorefront:function(b){var a=this.$storefront_selector,c=$.trim(a.val());return b?{storefront:c,data:a.find(":selected").data()}:c},getStorefrontSelector:function(){return this.$storefront_selector},getStorefront:function(){return this.getStorefrontSelector().val()},initStorefrontSelector:function(){var b=this;b.$storefront_selector.on("change",function(){b.customer_form&&b.customer_form.isEnabled()&&
b.customer_form.reloadForm()})},filterStorefrontSelector:function(b){var a=this.$storefront_selector;a.find("option").each(function(){var c=$(this),d=c.val(),e=c.data();c.show();!e.orderStorefront&&d&&b&&!e[b]&&(c.hide(),c.is(":selected")&&a.val(""))})},getPercentSymbol:function(){return"%"}};var ShopBackendCustomerForm=function(b){ShopBackendCustomerForm=function(a,c){this.options=c||{};this.$wrapper=a;this.dom_ns=this.$wrapper.attr("id");this.namespace=c.namespace||null;this.locales=c.locales;this.fields_config=c.fields_config||{};this.$wrapper.data("ShopBackendCustomerForm",this);b.contains(document,this.$wrapper.get(0))&&this.activate()};ShopBackendCustomerForm.prototype.activate=function(){this.$wrapper.off("."+this.dom_ns);this.initConfirmedCheckboxes();this.initContactTypeSelector();
this.initShippingAddress();this.initBillingAddress();this.initAdditionalAddressSubfields();this.fixStyles()};ShopBackendCustomerForm.prototype.deactivate=function(){this.$wrapper.off("."+this.dom_ns);this.unbindAll()};ShopBackendCustomerForm.prototype.getOptions=function(){return this.options||{}};ShopBackendCustomerForm.prototype.setOptions=function(a){this.options=a||{}};ShopBackendCustomerForm.prototype.getContact=function(a){var c=this.options.contact||{};return a?b.extend({},c,!0):c};ShopBackendCustomerForm.prototype.initConfirmedCheckboxes=
function(){var a=this.$wrapper,c=a.find(".field-email:eq(0)"),d=a.find(".field-phone:eq(0)"),e=a.find(".s-customer-email-confirmed-control");a=a.find(".s-customer-phone-confirmed-control");c.find(".value").children().first().after(e);d.find(".value").children().first().after(a)};ShopBackendCustomerForm.prototype.initContactTypeSelector=function(){var a=this;a.$wrapper.on("click."+a.dom_ns,".s-order-form-contact-type-selector-wrapper :radio",function(){var c=b(this),d=a.$wrapper.find(".s-order-form-contact-type-selector-wrapper .loading");
c=b.trim(c.val());d.show();a.reloadForm({type:c},{afterReload:function(){d.hide()}})})};ShopBackendCustomerForm.prototype.initAdditionalAddressSubfields=function(){var a=this.fields_config,c=this.$wrapper,d=function(){return".s-customer-more-address-subfields-control"},e=function(){return".s-address-block"};c.find(e()).each(function(){var k=b(this),p=k.closest(".field-address"),f="";p.hasClass("field-address-shipping")?f="shipping":p.hasClass("field-address-billing")&&(f="billing");if(f){var h=k.find(".field").hide(),
l=b(),q=0;b.each(a["address."+f].fields||{},function(u){l=h.filter(".field-address-"+u).show();q++});q!=h.length&&l.after(c.find(d()).first().clone())}});c.on("click",d(),function(){var k=b(this);k.siblings(e()).length?k.siblings(".field, input").appendTo(k.siblings(e())).show():k.closest(e()).find(".field").show();k.remove()})};ShopBackendCustomerForm.prototype.initShippingAddress=function(){var a=this,c=a.$wrapper,d=function(){return c.find(".field-address-shipping").find(".value").children()},
e=function(){return".s-customer-more-shipping-addresses-control"};d().each(function(f){var h=b(this);f=0<f?a.locales.extra_shipping_address:a.locales.main_shipping_address;f=b("<span />").addClass("s-block-header bold").text(f);h.addClass("s-address-block").prepend(f)});var k=1<d().length,p=0<d().not(":first").find(".errormsg,.error").length;k&&!p&&(d().not(":first").hide(),d().first().after(c.find(e())));c.on("click",e()+" .js-toggle-button",function(f){f.preventDefault();d().not(":first").show();
c.find(e()).hide()})};ShopBackendCustomerForm.prototype.initBillingAddress=function(){var a=this,c=a.$wrapper,d=function(){return c.find(".field-address-billing").find(".value").children()},e=function(){return".s-customer-more-billing-addresses-control"};d().each(function(f){var h=b(this);f=0<f?a.locales.extra_billing_address:a.locales.main_billing_address;f=b("<span />").addClass("s-block-header bold").text(f);h.addClass("s-address-block").prepend(f)});var k=1<d().length,p=0<d().not(":first").find(".errormsg,.error").length;
k&&!p&&(d().not(":first").hide(),d().first().after(c.find(e())));c.on("click",e()+" .js-toggle-button",function(f){f.preventDefault();d().not(":first").show();c.find(e()).hide()})};ShopBackendCustomerForm.prototype.fixStyles=function(){this.$wrapper.find('.field-birthday input[name="'+this.namespace+'[birthday][year]"]').css({width:"",minWidth:""})};ShopBackendCustomerForm.prototype.updateInnerHtml=function(a){var c=this.$wrapper;a=b("<div>").hide().appendTo("body").html(a);var d=a.find(".s-customer-form-wrapper");
d=ShopBackendCustomerForm.getInstance(d);this.setOptions(d.getOptions());c.html(a.children(0).html());a.remove()};ShopBackendCustomerForm.prototype.reloadForm=function(a,c){var d=this,e=d.$wrapper;c=c||{};var k=b.extend({},a||{});k.type||(k.type=d.getContact().type);var p=e.find(".loading").show();c.beforeReload&&c.beforeReload(k);e.trigger("beforeReload",[k]);if(!a["new"]){a=e.find(":input:not(:disabled)").serializeArray();var f=["shipping","billing"];b.each(a,function(h,l){if(l.name.indexOf(d.namespace))for(var q of f)h=
b('[name="'+d.namespace+"[address."+q+'][region]"]'),0<h.length&&""!=h.data("country")&&(k[d.namespace+"[address."+q+"][data][country]"]=h.data("country"));k[l.name]=l.value})}b.post("?action=customerForm",k,function(h){d.updateInnerHtml(h);p.hide();h=d.getContact(!0);c.afterReload&&c.afterReload(h);e.trigger("afterReload",[h])})};ShopBackendCustomerForm.prototype.bind=function(a,c){this.$wrapper.on(a+".custom"+this.dom_ns,c)};ShopBackendCustomerForm.prototype.unbindAll=function(){this.$wrapper.off(event+
".custom"+this.dom_ns)};ShopBackendCustomerForm.getInstance=function(a){return a.data("ShopBackendCustomerForm")instanceof ShopBackendCustomerForm?a.data("ShopBackendCustomerForm"):null};return ShopBackendCustomerForm}(jQuery);var ShopBackendOrderEditorCustomerForm=function(b){ShopBackendOrderEditorCustomerForm=function(a,c,d){this.options=d||{};this.$wrapper=a&&0<a.length?a:b("#s-order-edit-customer");this.editor=c;this.$customer_inputs=this.$wrapper.find(":input");this.initial_values={};this.$customer_form_wrapper=this.$wrapper.find(".s-customer-form-wrapper");(this.customer_form=ShopBackendCustomerForm.getInstance(this.$customer_form_wrapper))||console.error("There is not ShopBackendCustomerForm instance");this.$autocomplete=
b("#customer-autocomplete");this.$customer_id=b("#s-customer-id");this.$new_customer_link=b("#s-order-new-customer");this.contact=d.contact||{};this.init()};ShopBackendOrderEditorCustomerForm.prototype.init=function(){this.initForm();this.rememberInitialValues();this.initAutocomplete()};ShopBackendOrderEditorCustomerForm.prototype.rememberInitialValues=function(){var a=this;a.$customer_inputs.each(function(){var c=b(this),d=c.attr("name"),e=c.val();c.is(":radio")?c.is(":checked")&&(a.initial_values[d]=
e):c.is(":checkbox")?a.initial_values[d]=c.is(":checked"):a.initial_values[d]=e})};ShopBackendOrderEditorCustomerForm.prototype.resetInputValues=function(){var a=this;a.$customer_inputs.each(function(){var c=b(this),d=c.attr("name"),e=c.val();d=a.initial_values[d]||"";c.is(":radio")?e===d&&c.attr("checked","checked"):c.is(":checkbox")?c.is(":checked")?c.attr("checked","checked"):c.attr("checked",""):c.val()})};ShopBackendOrderEditorCustomerForm.prototype.disable=function(a){var c=this.$customer_id,
d=this.$wrapper;a="undefined"===typeof a?!0:a;c.attr("disabled",a);a?d.addClass("s-opaque"):d.removeClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isDisabled=function(){return this.$wrapper.hasClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isEnabled=function(){return!this.isDisabled()};ShopBackendOrderEditorCustomerForm.prototype.activate=function(a){var c=this.$new_customer_link,d=this.$autocomplete;"undefined"===typeof a||a?(this.disable(!1),d.val("").hide(200),
c.hide(200)):(this.disable(),d.val("").show(),c.show())};ShopBackendOrderEditorCustomerForm.prototype.focusFirstEmptyInput=function(){var a=this.$customer_inputs,c=!1;a.filter("input[type=text], textarea").each(function(){var d=b(this);if(d.is(":not(:hidden)")&&!this.value)return c=!0,d.focus(),!1});c||a.first().focus()};ShopBackendOrderEditorCustomerForm.prototype.initAutocomplete=function(){var a=this,c=function(e){var k=a.inputName;var p=parseInt(e,10)||"+"==e.substr(0,1)||-1!==e.indexOf("(");
k="[name="+k.call(a,p?"phone":-1!==e.indexOf("@")?"email":"firstname")+"]";a.$customer_inputs.filter(k).val(e)},d="";a.$autocomplete.autocomplete({source:function(e,k){d=e.term;b.getJSON(a.options.autocomplete_url,e,function(p){(p=p||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});k(p)})},delay:300,minLength:3,select:function(e,k){e=k.item;if(0<e.value)return a.reloadForm({id:e.value,"new":!0}),!1;if(a.editor.getSelectedStorefront())return a.reloadForm({},{afterReload:function(){c(d)}}),
!1;c(d);a.$customer_id.val(0);a.activate();setTimeout(function(){a.focusFirstEmptyInput()},200);return!1},focus:function(e,k){this.value=k.item.name;return!1}})};ShopBackendOrderEditorCustomerForm.prototype.reloadForm=function(a,c){var d=this,e=d.customer_form;c=c||{};d.disable(!0);a=a||{};e.reloadForm(a,{afterReload:function(k){d.$customer_inputs=d.$wrapper.find(":input");d.contact=k||{};d.$customer_id.val(k.id);d.activate();setTimeout(function(){d.focusFirstEmptyInput()},200);d.editor.updateTotal();
c.afterReload&&c.afterReload(k)}})};ShopBackendOrderEditorCustomerForm.prototype.initForm=function(){for(var a=this,c=a.customer_form,d=a.editor,e=a.$wrapper,k=["firstname","middlename","lastname"],p=0,f=k.length;p<f;p+=1)a.$customer_inputs.filter("[name="+a.inputName(k[p])+"]").addClass("s-error-customer-name");e.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>');a.$new_customer_link.on("click",function(){if(0<a.$customer_id.val())return!1;d.filterStorefrontSelector(a.getContact().type);
d.getSelectedStorefront()?a.reloadForm():(a.activate(),a.$customer_inputs.first().focus());return!1});0<a.getContact().id?a.activate():a.activate(!1);e.off("focus",":input").on("focus",":input",function(){a.disable(!1)});c.bind("beforeReload",function(h,l){"undefined"===typeof l.id&&(l.id=a.getContact().id);l.storefront=d.getSelectedStorefront()});c.bind("afterReload",function(h,l){d.filterStorefrontSelector(l.type)});d.filterStorefrontSelector(a.getContact().type);e.on("change",':input[name*="[address.shipping]"]',
function(h){h.originalEvent&&(b.shop.trace("Update total if customer address edit",[this,h]),d.updateTotal())});d.form.submit(function(){a.disable(!1)})};ShopBackendOrderEditorCustomerForm.prototype.showValidateErrors=function(a){a=b.extend({},a||{});if(!b.isEmptyObject(a)){var c=this.customer_form;a=b.trim(a.html);0<a.length&&c.updateInnerHtml(a)}};ShopBackendOrderEditorCustomerForm.prototype.inputName=function(a){return'"customer['+a+']"'};ShopBackendOrderEditorCustomerForm.prototype.getContact=
function(){return this.contact=this.contact||{}};return ShopBackendOrderEditorCustomerForm}(jQuery);
//# sourceMappingURL=order.min.js.map