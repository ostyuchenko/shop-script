(function(b){function a(a){return b.data(a,"tooltip")}function c(c){a(this).delay?n=setTimeout(g,a(this).delay):g();u=!!a(this).track;b(document.body).bind("mousemove",e);e(c)}function d(){if(!b.tooltip.blocked&&this!=l&&(this.tooltipText||a(this).bodyHandler)){l=this;k=this.tooltipText;if(a(this).bodyHandler){h.title.hide();var e=a(this).bodyHandler.call(this);e.nodeType||e.jquery?h.body.empty().append(e):h.body.html(e);h.body.show()}else if(a(this).showBody){e=k.split(a(this).showBody);h.title.html(e.shift()).show();
h.body.empty();for(var d=0,f;f=e[d];d++)0<d&&h.body.append("<br/>"),h.body.append(f);h.body.hideWhenEmpty()}else h.title.html(k).show(),h.body.hide();a(this).showURL&&b(this).url()?h.url.html(b(this).url().replace("http://","")).show():h.url.hide();h.parent.addClass(a(this).extraClass);a(this).fixPNG&&h.parent.fixPNG();c.apply(this,arguments)}}function g(){n=null;m&&b.fn.bgiframe||!a(l).fade?h.parent.show():h.parent.is(":animated")?h.parent.stop().show().fadeTo(a(l).fade,l.tOpacity):h.parent.is(":visible")?
h.parent.fadeTo(a(l).fade,l.tOpacity):h.parent.fadeIn(a(l).fade);e()}function e(c){if(!(b.tooltip.blocked||c&&"OPTION"==c.target.tagName))if(!u&&h.parent.is(":visible")&&b(document.body).unbind("mousemove",e),null==l)b(document.body).unbind("mousemove",e);else{h.parent.removeClass("viewport-right").removeClass("viewport-bottom");var d=h.parent[0].offsetLeft,f=h.parent[0].offsetTop;c&&(d=c.pageX+a(l).left,f=c.pageY+a(l).top,c="auto",a(l).positionLeft&&(c=b(window).width()-d,d="auto"),h.parent.css({left:d,
right:c,top:f}));c=b(window).scrollLeft();var g=b(window).scrollTop(),k=b(window).width(),n=b(window).height(),m=h.parent[0];c+k<m.offsetLeft+m.offsetWidth&&(d-=m.offsetWidth+20+a(l).left,h.parent.css({left:d+"px"}).addClass("viewport-right"));g+n<m.offsetTop+m.offsetHeight&&(f-=m.offsetHeight+20+a(l).top,h.parent.css({top:f+"px"}).addClass("viewport-bottom"))}}function f(e){function c(){h.parent.removeClass(d.extraClass).hide().css("opacity","")}if(!b.tooltip.blocked){n&&clearTimeout(n);l=null;var d=
a(this);m&&b.fn.bgiframe||!d.fade?c():h.parent.is(":animated")?h.parent.stop().fadeTo(d.fade,0,c):h.parent.stop().fadeOut(d.fade,c);a(this).fixPNG&&h.parent.unfixPNG()}}var h={},l,k,n,m=b.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),u=!1;b.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){b.tooltip.blocked=!b.tooltip.blocked}};b.fn.extend({tooltip:function(a){a=b.extend({},b.tooltip.defaults,a);h.parent||
(h.parent=b('<div id="'+a.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),b.fn.bgiframe&&h.parent.bgiframe(),h.title=b("h3",h.parent),h.body=b("div.body",h.parent),h.url=b("div.url",h.parent));var e=this.each(function(){b.data(this,"tooltip",a);this.tOpacity=h.parent.css("opacity");this.tooltipText=this.title;b(this).removeAttr("title");this.alt=""}).mouseover(d).mouseout(f);a.noHideOnClick||e.click(f);return e},fixPNG:m?function(){return this.each(function(){var a=
b(this).css("backgroundImage");a.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(a=RegExp.$1,b(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"}).each(function(){var a=b(this).css("position");"absolute"!=a&&"relative"!=a&&b(this).css("position","relative")}))})}:function(){return this},unfixPNG:m?function(){return this.each(function(){b(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){b(this)[b(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);(function(b){var a=function(b,d,g){var e=/[^\w\-\.:]/.test(b)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+b.replace(a.regexp,a.func)+"';return _s;"):g?a.cache[b]=a(a.load(b)):a.cache[b]=a.cache[b]||a(a.load(b));return d?e(d,a):function(b){return e(b,a)}};a.cache={};a.load=function(a){var b=document.getElementById(a),g=/<\\\/(\w+)/g;if(!b&&console)throw{message:"template with id="+a+" not found"};return b?("textarea"==b.tagName.toLowerCase()?b.value:document.getElementById(a).innerHTML).replace(g,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(b,a,g,e,f,h){if(a)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[b]||"\\"+b;if(g)return"="===g?"'+_e("+e+")+'":"'+("+e+"||'')+'";if(f)return"';";if(h)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(b){return String(b||"").replace(a.encReg,function(b){return a.encMap[b]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a,c){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&l(h,f)<=e.distance){if(null!==e.hash){var b=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(b)){this.onscroll=null;return}}e.load()}}function g(){var b=setTimeout(function(){if(e.stopped)clearTimeout(b);else{if(null!==e.hash){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(a)){clearTimeout(b);return}}e.loading?b=setTimeout(arguments.callee,
350):(l(h,f),l(h,f)<=e.distance?(e.load(),b=setTimeout(arguments.callee,350)):(f.get(0).onscroll=d,clearTimeout(b)))}},350)}if("stop"==a){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==a){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==a){if(e=this.data("lazyLoadSettings"))e.loading=!0}else if("wake"==a){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==a)(e=this.data("lazyLoadSettings"))&&
(e.loading||e.load());else{this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:h,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var f=this,h=e.container;null===e.hash||b.isArray(e.hash)||(e.hash=[e.hash]);b.fn.lazyLoad.call(f,e.state);g();var l="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:function(a,e,c){a="string"===typeof a?
b(a):a;c=c||0;return a.position().top+a.outerHeight()-c-(e.scrollTop()+e.height())}}}})(jQuery);(function(b){b.storage=new b.store;b.orders={options:{view:"table"},init:function(a){var c=this;c.options=a;"undefined"!=typeof b.History&&b.History.bind(function(){c.dispatch()});b.wa.errorHandler=function(a){return 403===a.status||404===a.status?(a=b(a.responseText),a=a.find(".dialog-content").length?b('<div class="block double-padded"></div>').append(a.find(".dialog-content *")):b('<div class="block double-padded"></div>').append(a.find(":not(style)")),b("#s-content").empty().append(a),b.orders.onPageNotFound(),
!1):!0};a=window.location.hash;"#/"!==a&&a?b.wa.setHash(a):this.dispatch();this.initSearch();b(document).bind("wa.appcount",function(a,c){var e=parseInt(c.shop,10);b("#s-pending-orders .small").text(e?"+"+e:"");var f=document.title.match(/\(\d+\) /);f?document.title=document.title.replace(f[0],e?"("+e+") ":""):e&&(document.title="("+e+") "+document.title)})},onPageNotFound:function(){b.order_list&&b.order_list.finit()},initSearch:function(){var a=b("#s-orders-search"),c=[],d=function(c){switch(c.autocomplete_item_type){case "order":b.wa.setHash("#/order/"+
c.id+"/");a.val(c.value);break;case "contact":b.wa.setHash("#/orders/contact_id="+c.id+"/");a.val(c.value);break;case "product":b.wa.setHash("#/orders/product_id="+c.id+"/");a.val(c.value);break;case "coupon":b.wa.setHash("#/orders/coupon_id="+c.id+"/");break;case "tracking_number":b.wa.setHash("#/orders/tracking_number="+c.value+"/");break;case "shipping":b.wa.setHash("#/orders/shipping_id="+c.id+"/");break;case "payment":b.wa.setHash("#/orders/payment_id="+c.id+"/");break;case "city":b.wa.setHash("#/orders/city="+
c.value+"/");break;case "region":b.wa.setHash("#/orders/region="+((c.value||"").split(":")[1]||"")+"/");break;case "country":b.wa.setHash("#/orders/country="+c.value+"/")}};a.unbind("keydown").bind("keydown",function(a){if(13==a.keyCode||10==a.keyCode){var e=b(this);if(!b(this).val())return location.hash="#/orders/all/",e.autocomplete("close"),!1;if(c&&b.isArray(c)&&c.length)return d(c[0]),setTimeout(function(){e.autocomplete("close")},150),!1}});a.autocomplete({minLength:1,delay:300,html:!0,select:function(a,
b){d(b.item);return!1},source:function(a,e){b.getJSON("?action=autocomplete&type=order",a,function(a){c=a;e(a)})}})},prevHash:null,hash:null,skipDispatch:0,stopDispatch:function(a){this.skipDispatch=a},dispatch:function(a){if(0<this.skipDispatch)return this.skipDispatch--,!1;if(void 0===a||null===a)a=window.location.hash;a=a.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);if(this.hash=a)if(a=a.split("/"),a[0]){for(var c="",d=a.length,g=null,e=null,d=0;d<a.length;d++){var f=
a[d];if(2>d){if(0===d)c=f;else if(parseInt(f,10)!=f&&-1==f.indexOf("="))c+=f.substr(0,1).toUpperCase()+f.substr(1);else break;"function"==typeof this[c+"Action"]&&(g=c,e=d+1)}else break}"function"!==typeof this[c+"Action"]&&g&&(c=g,d=e);a=a.slice(d);this.preExecute(c);"function"==typeof this[c+"Action"]?(b.shop.trace("$.orders.dispatch",[c+"Action",a]),this[c+"Action"].apply(this,a)):b.shop.error("Invalid action name:",c+"Action");this.postExecute(c)}else this.preExecute(),this.defaultAction(),this.postExecute();
else this.preExecute(),this.defaultAction(),this.postExecute()},back:function(){var a=b.orders.prevHash||"";location.hash=a?a+"/":""},preExecute:function(a,b){},postExecute:function(a,b){this.actionName=a},defaultAction:function(){this.ordersAction()},couponsAction:function(){b.order_list&&b.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(a){this.load("?module=order&action=edit&id="+a,function(){b.order_list&&b.order_list.finit()})},ordersNewAction:function(){this.load("?module=order&action=edit",
function(){b.order_list&&b.order_list.finit()})},ordersAction:function(a){if("hash"===a)a={hash:Array.prototype.slice.call(arguments,1).join("/")};else{var c="";"search"===a&&(c=Array.prototype.slice.call(arguments,1));1<arguments.length&&(a=Array.prototype.join.call(arguments,"/"));a?"all"===a&&(a=""):a="state_id=new|processing|paid";a=b.shop.helper.parseParams(a||"");a.view||(a.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",a.view);b.order_edit&&b.order_edit.slideBack();
c&&(a.search=c)}"orders"===this.actionName&&b.order_list?b.order_list.dispatch(a):(b.order_list&&b.order_list.finit(),this.load("?module=orders&"+this.buildOrdersUrlComponent(a),function(){b.order_list&&b.order_list.dispatch(a)}))},orderAction:function(a,c){c=b.shop.helper.parseParams(c||"");c.view||(c.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",c.view);b.order_edit&&b.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(a)+"&"+this.buildOrdersUrlComponent(c),
function(){b("#s-content").find("h1 .back.order-list").show()});b.order_list&&b.order_list.finit()},buildOrdersUrlComponent:function(a){var b="",d;for(d in a)a.hasOwnProperty(d)&&"view"!==d&&(b+="&"+d+"="+a[d]);return"view="+(a.view||this.options.view)+b},load:function(a,c,d){function g(){var a=b("#s-orders-views"),e=b("#s-order, #s-orders").length;a.length&&(e?a.css("visibility","visible"):a.css("visibility","hidden"))}function e(){var a=b("#mainmenu .s-orders-selection-menu");a.length&&a.remove()}
"function"===typeof c?(d=c,c={}):c=c||{};var f=Math.random();this.random=f;var h=this;return b.get(a,function(a){if("undefined"!==typeof c.check&&!c.check||h.random==f){(c.content||b("#s-content")).removeClass("bordered-left").html(a);"function"===typeof d&&d.call(this);var k=b(window);setTimeout(function(){k.trigger("scroll")},250);g();e();b(".level2").show();b("#s-sidebar").width(200).show()}})}}})(jQuery);(function(b){b.order_list={id:0,options:{},container:null,$selectionMenu:null,sidebar:null,select_all_input:null,filter_params:{},filter_params_str:"",params:null,timer_id:0,lazy_load_win:null,xhrs:{lazy_load:null,update_load:null},init:function(a){this.options=a=a||{};this.filter_params=a.filter_params||{};this.filter_params_str=a.filter_params_str||"";this.container=b("#order-list");"table"==a.view&&(this.select_all_input=this.container.find(".s-select-all"),this.container=b("#order-list").find("tbody:first"));
this.sidebar=b("#s-sidebar");this.id=a.id||0;if(a.orders&&a.orders.length&&a.view){try{this.container.append(tmpl("template-order-list-"+this.options.view,{orders:a.orders},!0)),this.container.trigger("append_order_list",[a.orders])}catch(c){return console&&console.log(c.stack),this}delete a.orders;delete this.options.orders}a.lazy_loading&&this.initLazyLoad(a.lazy_loading);a.counters&&this.updateCounters(a.counters);a.update_process&&a.count&&this.updateProcess("run",a.update_process);this.initView()},
initLazyLoad:function(a){var c=this,d=c.options.count,g=c.options.total_count,e=b(window);e.lazyLoad("stop");d<g&&(e.lazyLoad({container:this.options.view?c.container:e,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:["orders",""],load:function(){e.lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();var a=c.container.find(".order:last"),d=parseInt(a.attr("data-order-id"),10);if(d){var g=function(){return b.getJSON(c.buildLoadListUrl(d),function(a){if("ok"==
a.status){try{c.container.append(tmpl("template-order-list-"+c.options.view,{orders:a.data.orders,check_all:"table"==c.options.view?c.select_all_input.attr("checked"):!1})),c.container.trigger("append_order_list",[a.data.orders]),c.container.find("[data-order-id="+c.options.id+"]").length&&(c.container.find(".selected").removeClass("selected"),c.container.find("[data-order-id="+c.options.id+"]").addClass("selected"))}catch(d){console&&console.log(d.stack);e.lazyLoad("stop");return}b(".lazyloading-progress-string").text(a.data.progress.loaded+
" "+a.data.progress.of);b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(a.data.progress.chunk);a.data.loaded>=a.data.total_count?(e.lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),e.lazyLoad("wake"))}else console&&console.log("Error when loading orders: "+a.errors),e.lazyLoad("stop")}).error(function(a){console&&(a&&a.errors?console.log("Error when loading orders: "+a.errors):a?console.log(a):console.log("Error when loading orders"));e.lazyLoad("stop")})};
null===c.xhrs.update_load?c.xhrs.lazy_load=g():c.xhrs.update_load.then(function(){c.xhrs.lazy_load=g()})}else console.log("Unkown last item"),e.lazyLoad("stop")}}),b("#s-orders").off("click",".lazyloading-link").on("click",".lazyloading-link",function(){e.lazyLoad("force");return!1}),this.lazy_load_win=e)},initView:function(){function a(a){var e=b.order_list.getSelectedOrders();e.order_id?d(a,e):confirm($_("Perform action to all selected orders?"))&&d(a,e)}this.initSidebar();"table"==this.options.view&&
this.initSelecting();this.options.id&&this.loadOrder(this.options.id);var c=b("#s-orders-views");c.find("li.selected").removeClass("selected");c.find("li[data-view="+this.options.view+"]").addClass("selected");c.find("li a").each(function(){var a=b(this),e=b(this).parents("li:first");a.attr("href","#/orders/view="+e.attr("data-view")+(b.order_list.options.filter_params_str?"&"+b.order_list.options.filter_params_str:"")+"/")});var d=function(a,e){var c=function(a,e){b.order_list.updateCounters({state_counters:a.data.state_counters,
common_counters:{pending:a.data.pending_count}});b.isEmptyObject(a.data.orders)||b.order_list.updateListItems(a.data.orders);b.order_list.select_all_input.trigger("select",!1);var c=[],d=b.order_list.filter_params;if(!b.isEmptyObject(a.data.orders))for(var f=0,h=a.data.orders.length;f<h;f++)!b.isEmptyObject(d)&&d.state_id&&("string"===b.type(d.state_id)&&d.state_id!==a.data.orders[f].state_id?c.push(a.data.orders[f].id):"array"===b.type(d.state_id)&&-1!==d.state_id.indexOf(a.data.orders[f].state_id)&&
c.push(a.data.orders[f].id));b.isEmptyObject(c)||b.order_list.hideListItems(c).done(function(){if(!b.order_list.container.find(".order:not(:hidden):first").length){var a='<div class="block double-padded align-center blank"><br><br><br><br><span class="gray large">'+$_("There are no orders in this view.")+'</span><div class="clear-left"></div></div></div>';b("#s-content").html(a)}});e instanceof Function&&e(a)},d=function(l,k){b.shop.jsonPost("?module=orders&action=performAction&id="+a+"&offset="+
(l||0)+"&"+b.order_list.options.filter_params_str,e,function(a){"ok"==a.status?a.data.offset<a.data.total_count?d(a.data.offset,c):c(a,k):c(a,k)})};d(0,function(){b.orders.dispatch()})};b("#order-list").find(".wf-actions a").click(function(){var c=b(this).data("action-id");c&&a(c);return!1});if(this.$selectionMenu)this.$selectionMenu.on("click","a",function(){var c=b(this).data("action-id");c&&a(c);return!1})},loadOrder:function(a){this.container.find(".selected").removeClass("selected");this.container.find("[data-order-id="+
a+"]").addClass("selected");b("#s-order-title").find(".loading").show();b.orders.load("?module=order&id= "+a+"&"+this.filter_params_str,{content:b("#s-order")},function(){this.id=a})},getSelectedOrders:function(a){a=a||!1;var c={count:0};if(this.select_all_input.attr("checked")){var d=b.order_list.filter_params;if(a)if(c.serialized=[],b.isEmptyObject(d))c.serialized.push({name:"filter_params",value:""});else{a=0;for(var g=hash.length;a<g;a+=1)c.serialized.push({name:"filter_params[]",value:d[a]})}else c.filter_params=
b.isEmptyObject(d)?"":d;c.count=this.options.total_count}else a?c.serialized=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return{name:"order_id[]",value:b(this).attr("data-order-id")}}).toArray():c.order_id=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return b(this).attr("data-order-id")}).toArray();return c},initSidebar:function(){var a=this.sidebar,c=this.options.view;a.find("li.list a").each(function(){var a=b(this),e=a.attr("href"),d=e.match(/view=((.*)&|(.*)\/|(.*))/);
d?a.attr("href",e.replace("view="+(d[2]||d[3]||d[4]),"view="+c)):(d=e.match(/^#\/orders\/hash\/(.*?)\/?$/))?a.attr("href","#/orders/view="+c+"&hash="+encodeURIComponent(d[1])+"/"):(d=e.match(/orders\/((.*)\/|(.*))/),e="",d&&(d[1]?(e=d[2]||d[3],e+="&view="+c):e="view="+c,a.attr("href","#/orders/"+e+"/")))});var d=a.find("li.selected").removeClass("selected");this.filter_params.state_id?b.isArray(this.filter_params.state_id)?b("#s-pending-orders").addClass("selected"):a.find('li[data-state-id="'+this.filter_params.state_id+
'"]').addClass("selected"):this.filter_params.contact_id?a.find("li[data-contact-id="+this.filter_params.contact_id+"]").addClass("selected"):this.filter_params.storefront?(d=decodeURIComponent(this.filter_params.storefront),"/"===d.slice(-1)&&(d=d.slice(0,-1)),a.find('li[data-storefront="'+d+'"]').addClass("selected")):b.order_list.filter_params_str?a.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||d.addClass("selected"):b("#s-all-orders").addClass("selected");
a.find("li.list a").unbind("click.order_list").bind("click.order_list",function(){a.find("li.selected").removeClass("selected");b(this).closest("li").addClass("selected");if(b(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==b.orders.hash){var c=b.orders.hash.replace("orders/","");b.order_list.dispatch(c,!0)}})},initSelecting:function(){var a=this,c=this.container,d=this.select_all_input;d.click(function(){b(this).trigger("select",this.checked)});a.$selectionMenu.on("click","input:checkbox",function(){var a=
b(this)[0].checked;d.trigger("select",a)});d.click(function(){b(this).trigger("select",this.checked)});b(document).keydown(function(a){16==a.keyCode&&(document.body.onselectstart=function(){return!1})}).keyup(function(a){16==a.keyCode&&(document.body.onselectstart=null)});var g=function(){if(b.order_list.filter_params&&!b.order_list.filter_params.length){var c=b("#order-list"),f=c.find(".s-with-selected"),h=d.attr("checked"),c=c.find(".order.selected:first").length;h||c?(f.show(),a.$selectionMenu.show()):
(f.hide(),a.$selectionMenu.hide())}};c.off("select",".order").on("select",".order",function(a,c){(void 0!==c?c:1)?b(this).addClass("selected").find("input:first").attr("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",!1),d.is(":checked")&&d.attr("checked",!1));g();return!1});d.unbind("select").bind("select",function(a,d){console.log(d);d=void 0!==d?d:!0;var h=b(this);d?(h.attr("checked",!0),c.find(".order").trigger("select",!0,!1)):(h.attr("checked",!1),c.find(".order").trigger("select",
!1,!1))});c.off("click",".order input").on("click",".order input",function(a){var f=a.shiftKey;a=this.checked;var h=b(this).parents(".order:first");a?h.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),h.removeClass("selected"));if(f&&a){(f=c.data("last_checked"))||(f=c.find(".order:first").trigger("select",!0));var l=h.prevAll(".selected[data-order-id="+f.attr("data-order-id")+"]"),k;if(l.length)for(k=h.prev(),f=f.get(0);k.length&&f!=k.get(0);)k.addClass("selected").find("input").attr("checked",
!0),k=k.prev();else if(l=h.nextAll(".selected[data-order-id="+f.attr("data-order-id")+"]"),l.length)for(k=h.next(),f=f.get(0);k.length&&f!=k.get(0);)k.addClass("selected").find("input").attr("checked",!0),k=k.next();c.data("last_checked")||l.length||f.trigger("selected",!1)}a&&c.data("last_checked",h);g()})},updateTitle:function(a,c){c=parseInt(c,10)||0;var d="";this.options.state_names&&(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?d=this.options.state_names[this.filter_params.state_id]:
b.isArray(this.filter_params.state_id)&&(d=$_("Processing")):d=$_("All orders"));document.title=c?"("+c+") "+d+(a||""):d+a},updateCounters:function(a){var c=this.sidebar;c||(c=b("#s-sidebar"));var d=b("#s-pending-orders .small"),g;for(g in a)if(a.hasOwnProperty(g)){var e=a[g],f;for(f in e)if(e.hasOwnProperty(f)){var h;h="common_counters"==g?b("#s-"+f+"-orders .count"):"storefront_counters"!==g?c.find("li[data-"+g.replace("_counters","")+"-id="+f+"] .count"):c.find("li[data-"+g.replace("_counters",
"")+'="'+f+'"] .count');var l=parseInt(h.text(),10)||0,k=0;e[f]=""+e[f];"+"==e[f].substr(0,1)?k=l+(parseInt(e[f].substr(1),10)||0):"-"==e[f].substr(0,1)?(k=l-(parseInt(e[f].substr(1),10)||0),k=0>k?0:k):k=parseInt(e[f],10)||0;h.text(k);"new"==f&&(d.text(k?"+"+k:""),b.shop.updateAppCounter(k),this.updateTitle(this.options.title_suffix,parseInt(k,10)))}}},updateListItems:function(a){var c="template-order-list-"+this.options.view;if(document.getElementById(c)){var d=this.container;b.isArray(a)||(a=[a]);
var c=b("<div></div>").append(tmpl(c,{orders:a,check_all:"table"==this.options.view?this.select_all_input.attr("checked"):!1})),g=b(".order",d);b(".order",c).each(function(){var a=b(this);g.filter("[data-order-id="+a.attr("data-order-id")+"]").replaceWith(a)});c.remove();this.container.trigger("append_order_list",[a])}},hideListItems:function(a){var c=b.Deferred();setTimeout(function(){if(b.order_list&&b.order_list.container&&b.order_list.container.length){if(b.isArray(a))for(var d=b.order_list.container.find(".order"),
g=b(),e=0;e<a.length;e++)var f=d.filter("[data-order-id="+a[e]+"]"),g=g.add(f);else var g=b.order_list.container.find(".order[data-order-id="+a+"]");var h=g.length,l=0;g.slideUp(450,function(){l++;l>=h&&c.resolve()})}},1E3);return c.promise()},dispatch:function(a,c){"string"===typeof a&&(a=b.shop.helper.parseParams(a));var d={list:function(){b.order_list.finit();b.orders.load("?module=orders&"+b.orders.buildOrdersUrlComponent(a),function(){b.order_list.dispatch(a)})},order:function(){b.order_list.loadOrder(a.id)}};
null===this.params?(this.params=a,c&&d.list()):a.id&&(c||a.id!=this.params.id)?(d.order(),this.params=a):(c||this.diff(a,this.params)||this.diff(this.params,a))&&d.list()},diff:function(a,b){for(var d in a)if(a.hasOwnProperty(d)&&"id"!=d&&a[d]!==b[d])return!0;return!1},buildLoadListUrl:function(a,b,d){return"?module=orders&action=loadList&id="+a+(this.filter_params_str?"&"+this.filter_params_str:"")+(b?"&lt=1":"")+(d?"&counters=1":"")+(this.options.view?"&view="+this.options.view:"")},updateProcess:function(a,
c){a=a||"run";c=c||{};timeout=c.timeout||6E4;var d=this,g=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};g();if("run"==a){var e=function(a,c){var e=d.container.find(".order:first"),e=parseInt(e.attr("data-order-id"),10)||0;return b.getJSON(d.buildLoadListUrl(e,!0,!0),function(e){if("ok"==e.status){b.isEmptyObject(e.data.counters)||d.updateCounters(e.data.counters);if(e.data.count)try{d.container.prepend(tmpl("template-order-list-"+
d.options.view,{orders:e.data.orders,check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),b(".lazyloading-progress-string").text(e.data.progress.loaded+" "+e.data.progress.of),d.container.trigger("append_order_list",[e.data.orders])}catch(f){console&&(console.log("Error: "+f.message),c());return}"function"===typeof a&&a(e)}else console&&console.log("Error when loading new orders: "+e.errors),"function"===typeof c&&c()}).error(function(a){console&&(a&&a.errors?console.log("Error when loading new orders: "+
a.errors):console.log(["Error when loading new orders",a]));"function"===typeof c&&c()})},f=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=e(f,g):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=e(f,g)})},timeout)};f()}},finit:function(a){a=this.xhrs;var b=this.lazy_load_win,d;for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&a[d].abort();this.updateProcess("kill");b&&b.lazyLoad("stop");this.params=null},initSelectionMenu:function(a){var c=this;c.$selectionMenu=
a.$selectionMenu;var d=b("#mainmenu .s-level2");setTimeout(function(){d.length&&d.append(c.$selectionMenu)},4)}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_fields:null,customer_inputs:null,stocks:[],slide_on:!1,options:{},init:function(b){this.options=b;b.id&&(this.id=b.id);this.container="string"===typeof b.container?$(b.container):b.container;this.form="string"===typeof b.form?$(b.form):b.form;this.customer_fields=$("#s-order-edit-customer");this.customer_inputs=this.customer_fields.find(":input");b.stocks.sort(function(a,b){return a.sort-b.sort});this.stocks=b.stocks;b.title&&(document.title=title);
b.float_delimeter||(b.float_delimeter=".");this.float_delimeter=b.float_delimeter;this.initView()},initView:function(){var b=this.options;this.initCustomerForm(this.id?"edit":"add");var a=function(a){var b=a.find(".s-orders-sku-stock-select").find("option:selected"),c=a.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");a.find(".s-orders-stock-icon-aggregate").show();a.find(".s-orders-stock-icon").html("").hide();c=c.length?c:a;b.attr("data-icon")&&(c.find(".s-orders-stock-icon-aggregate").hide(),
c.find(".s-orders-stock-icon").html(b.attr("data-icon")).show(),a.find(".s-orders-stock-icon .s-stock-left-text").show(),c.find(".s-orders-stock-icon .s-stock-left-text").hide())};$.order_edit.slide(!0,"add"==b.mode);this.container.find(".back").click(function(){$.order_edit.id?$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.updateTotal(!1);$(".s-order-item").each(function(){var b=$(this);a(b)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());
$.order_edit.options.currency=$(this).val()});var c=b.price_edit||!1,d=$("#orders-add-autocomplete");d.autocomplete({source:"?action=autocomplete&with_counts=1",minLength:3,delay:300,select:function(b,f){$(".s-order-errors").empty();$.getJSON("?module=orders&action=getProduct&product_id="+f.item.id+($.order_edit.id?"&order_id="+$.order_edit.id:"&currency="+$.order_edit.options.currency),function(b){var e=$("#order-items"),e=parseInt(e.find(".s-order-item:last").attr("data-index"),10)+1||1,d=b.data.product;
d.sku_id&&d.skus[d.sku_id]&&(d.skus[d.sku_id].checked=!0);$("#order-currency").length&&!$("#order-currency").attr("disabled")&&($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled","disabled"));d=$("#s-orders-add-row");d.before(tmpl("template-order",{data:b.data,options:{index:e,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:c}}));b=d.prev();$("#s-order-comment-edit").show();
$.order_edit.updateTotal();a(b)});d.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",".s-orders-skus input[type=radio]",function(){var b=$(this),d=b.parents("tr:first"),h=b.closest("li"),g=this.value,k=d.attr("data-product-id"),n=d.attr("data-index"),m=null;"edit"==($.order_edit.id?"edit":"add")&&(m=parseInt(b.attr("name").replace("sku[edit][",""),10));$.getJSON("?module=orders&action=getProduct&product_id="+k+"&sku_id="+g+($.order_edit.id?"&order_id="+
$.order_edit.id:"&currency="+$.order_edit.options.currency),function(b){d.find(".s-orders-services").replaceWith(tmpl("template-order-services",{services:b.data.sku.services,service_ids:b.data.service_ids,product_id:k,options:{price_edit:c,index:n,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks}}));d.find(".s-orders-product-price").find("input").val(b.data.sku.price);var e;e=-1!==d.find("input:first").attr("name").indexOf("add")?"add":"edit";d.find(".s-orders-sku-stock-place").empty();
h.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+e,{sku:b.data.sku,index:n,stocks:$.order_edit.stocks,item_id:m}));a(d);$.order_edit.updateTotal(d)})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var b=$(this).parents("tr.s-order-item:first");a(b)});var g=function(a,b,c){var d=a.attr("data-price");a=a.attr("data-percent-price");c&&b.val(d);b.attr("data-price",d);b.attr("data-percent-price",a)};this.container.off("change",
".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var a=$(this),b=a.find("option:selected"),a=a.parents("li:first");g(b,a.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var a=$(this),b=a.find("option:selected"),a=a.parents("li:first");g(b,a.find(".s-orders-service-price"),!1)});this.container.off("click",".s-order-item-delete").on("click",".s-order-item-delete",function(){var a=$(this);a.parents("tr:first").remove();
a.parents("table:first").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});this.container.off("change",".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",".s-orders-product-price input",function(){var a=$.order_edit.parseFloat($(this).val());$.order_edit.container.find(".s-orders-service-price").each(function(){var b=$(this);
if("%"===b.data("currency")&&b.attr("data-price")===b.val()){var c=a*(b.data("percentPrice")/100);b.val($.order_edit.formatFloat(c));b.attr("data-price",c)}});$.order_edit.updateTotal.apply(this)});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);$(".s-order-customer-details").on("change","input[type=text],select",function(){$(this).attr("name").indexOf("address")&&$.order_edit.updateTotal()});
$("#shipping_methods").change(function(a){var b=$(this).children(":selected"),c=b.data("rate")||0;$("#shipping-rate").val($.order_edit.formatFloat(c));c=[];b.data("error")&&c.push('<span class="error">'+b.data("error")+"</span>");b.data("est_delivery")&&c.push('<span class="hint est_delivery">'+b.data("est_delivery")+"</span>");b.data("comment")&&c.push('<span class="hint">'+b.data("comment")+"</span>");c?(b.data("error")?$("#shipping-rate").addClass("error"):$("#shipping-rate").removeClass("error"),
$("#shipping-info").html(c.join("<br>")).show()):($("#shipping-rate").removeClass("error"),$("#shipping-info").empty().hide());$.order_edit.updateTotal(!1);b.data("external")&&!a.triggered_by_updateTotal&&$.order_edit.updateTotal()});$("#payment_methods").change(function(){var a=$(this).val();$("#payment-info > div").hide();$("#payment-custom-"+a).length&&$("#payment-custom-"+a).show()});$("#discount,#shipping-rate").change(function(){$.order_edit.updateTotal(!1)});this.container.off("keydown",".s-orders-quantity").on("keydown",
".s-orders-quantity",function(){var a=$(this),b=a.data("timer_id");b&&clearTimeout(b);a.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},450))});this.form&&this.form.length&&this.form.unbind("sumbit").bind("submit",function(){$.order_edit.showValidateErrors();$(".s-orders-services input[name^=service]:not(:checked)",this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",!0)});$.order_edit.container.find(".error").length||($(".s-order-items-edit td.save i.loading").css("display",
"inline-block"),$.order_edit.id?$.order_edit.editSubmit():$.order_edit.addSubmit());return!1});this.initDiscountControl()},initDiscountControl:function(){function b(){0<a.val()?g.stop().show():g.stop().hide()}var a=$("#discount"),c=$("#discount-description"),d=$("#update-discount"),g=$("#discount-tooltip-icon");$(document).tooltip;g.tooltip({bodyHandler:function(){return c.val()||c.data("updated-manually-msg")}});d.tooltip({bodyHandler:function(){return d.data("description")||c.data("updated-manually-msg")}});
g.hide();$("#order-edit-form").on("order_total_updated",function(b,c){c.discount&&(d.data("value",c.discount).data("description",c.discount_description),d.data("just-recalculated")?c.discount+""!=a.val()&&d.click():d.show())});d.click(function(){c.val(d.data("description")||"");a.val(d.data("value")||0).change();d.hide().data("just-recalculated",!0);b();g.is(":visible")&&g.fadeOut(50,function(){g.fadeIn(50,function(){g.fadeOut(50,function(){g.fadeIn(50,function(){g.fadeOut(50,function(){g.fadeIn(50,
function(){g.fadeOut(50,function(){g.fadeIn(50,function(){})})})})})})})});return!1});a.on("keyup",function(){c.val("");d.show().data("just-recalculated",!1);b()})},updateTotal:function(b){b=void 0===b?!0:b;var a=$.order_edit.container;if(a.find(".s-order-item").length){for(var c=0,d=$("#discount"),g={},e=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),f=0;f<e.length;f++)g[e[f].name]=e[f].value;g.items=[];a.find(".s-order-item").each(function(){var a=$(this),b=a.find('input[name^="product"]').val(),
d=[],e=$.order_edit.parseFloat(a.find(".s-orders-product-price input").val()),f=$.order_edit.parseFloat(a.find("input.s-orders-quantity").val());c+=e*f;a.find(".s-orders-services").length&&a.find(".s-orders-services input:checkbox:checked").each(function(){var a=$(this).closest("li"),a=$.order_edit.parseFloat(a.find("input.s-orders-service-price").val());d.push({id:$(this).val(),price:a});c+=a*f});a=a.find("input[name^=sku]:not(:radio)").add(a.find("input[name^=sku]:checked")).first().val()||0;g.items.push({product_id:b,
quantity:f,price:e,sku_id:a,services:d})});g.subtotal=c;a=$.order_edit.parseFloat(d.val()||0);g.discount=a;$.order_edit.id?g.order_id=$.order_edit.id:g.currency=$("#order-edit-form input[name=currency]").val();g.shipping_id=($("#shipping_methods").val()||"").split(".")[0];g["customer[id]"]=$("#s-customer-id").val();b&&$.post("?module=order&action=total",g,function(a){if("ok"==a.status){var b=$("#shipping_methods"),c=b.val();b.empty();for(var d=a.data.shipping_method_ids,e=a.data.shipping_methods,
f=-1!==d.indexOf(c),r=0;r<d.length;r+=1){var t=d[r],p=e[t],q=$("<option></option>");q.html(p.name).attr("value",t).data("rate",p.rate);q.data("error",p.error||void 0);q.data("est_delivery",p.est_delivery||void 0);q.data("comment",p.comment||void 0);q.data("external",p.external||!1);b.append(q);f||(p=(""+t).split("."),q=c.split("."),void 0!==p[0]&&void 0!==q[0]&&p[0]==q[0]&&(f=!0,c=t))}f&&(b.val(c),c+="",e[c].external&&g.shipping_id!=c.split(".")[0]||b.trigger($.Event("change",{triggered_by_updateTotal:1})));
$("#order-edit-form").trigger("order_total_updated",a.data)}},"json");$("#subtotal").text($.order_edit.formatFloat(Math.round(100*c)/100));b=$.order_edit.parseFloat($("#shipping-rate").val().replace(",","."))||0;b=c+b;0>a?(a=0,d.val("")):(0>b-a&&(a=b),d.val($.order_edit.formatFloat(Math.round(100*a)/100)));d=b-a;$("#total").text($.order_edit.formatFloat(Math.round(100*d)/100))}else $("#subtotal").text(0),$("#total").text(0)},editSubmit:function(){var b=this.form;$.shop.jsonPost(b.attr("action"),b.serialize(),
function(a){$.order_edit.container.find(".back").click()},function(a){$.shop.trace("editSubmit",a);$(".s-order-items-edit td.save i.loading").hide();if(a&&a.errors&&!$.isEmptyObject(a.errors))return $.order_edit.showValidateErrors(a.errors),$(".s-orders-services input:disabled",this.form).attr("disabled",!1),!1})},addSubmit:function(){var b=this.form;$.shop.trace("addSubmit",$(b));$.shop.jsonPost(b.attr("action"),b.serialize(),function(a){$.order_edit.slide(!1,!0)&&(location.href="#/orders/state_id=new&view=split&id="+
a.data.order.id+"/")},function(a){$.shop.trace("addSubmit",a);$(".s-order-items-edit td.save i.loading").hide();if(a&&a.errors&&!$.isEmptyObject(a.errors))return $.order_edit.showValidateErrors(a.errors),$(".s-orders-services input:disabled",this.form).attr("disabled",!1),!1})},formatFloat:function(b){return","===this.float_delimeter?(""+b).replace(".",","):""+b},parseFloat:function(b){return b?parseFloat((""+b).replace(",",".")):0},slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(b,
a,c){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{b="undefined"===typeof b?!0:b;a="undefined"===typeof a?!1:a;var d=this.options.duration||200,g=this.options.view,e=[];return!this.slide_on&&b?(e.push($("#s-sidebar").animate({width:0},d,function(){$(this).hide()})),$(".s-level2").hide(),e.push($("#maincontent").animate({"margin-top":45},d)),e.push($("#s-content").animate({"margin-left":0},d)),e.push($("#s-orders").animate({width:0},d,function(){$(this).hide()})),e.push($("#s-order").animate({"margin-left":0},
d).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(e).done(function(){$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");"function"===typeof c&&c.call(this)}),!0):this.slide_on&&!b?(e.push($("#s-order").animate({"margin-left":"table"==g||a?200:300},d).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),
e.push($("#s-orders").animate({width:300},d).show()),e.push($("#s-content").animate({"margin-left":200},d)),e.push($("#maincontent").animate({"margin-top":84},d)),$(".s-level2").show(),e.push($("#s-sidebar").animate({width:200},d).show()),this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),$.when(e).done(function(){$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof c&&c.call(this)}),!0):!1}},showValidateErrors:function(b){$(".error").removeClass("error");
$("#s-order-edit-customer .errormsg").empty();if(b&&b.customer){var a=b.customer;$.order_edit.customer_fields.find(".field-group:first").html(a.html);delete a.html;for(var c in a)$.order_edit.customer_fields.find(".s-error-customer-"+c).each(function(){var b=$(this);"EM"==this.tagName?b.text(a[c]):b.addClass("error")})}var d=[];$(".s-order-errors").empty();if(b&&b.order){if(!$.isEmptyObject(b.order.items))for(var g in b.order.items){var e=$(".s-order-item[data-index="+g+"]"),a=b.order.items[g];for(c in a)e.find(".s-error-item-"+
c).text(a[c]);delete b.order.items[g]}if(!$.isEmptyObject(b.order.product)){var f=b.order.product,h;for(h in f)f.hasOwnProperty(h)&&"quantity"in f[h]&&$(".s-order-item[data-product-id="+h+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=""+f[h].sku_id&&$(this).find("ul.s-orders-skus").length||($(this).find(".s-orders-quantity").addClass("error"),d.push(f[h].quantity))})}b.order.common&&d.push(b.order.common);d.length&&$(".s-order-errors").html(d.join("<br>"))}},bindValidateErrorPlaceholders:function(){for(var b=
["firstname","middlename","lastname"],a=0,c=b.length;a<c;a+=1)$.order_edit.customer_inputs.filter("[name="+$.order_edit.inputName(b[a])+"]").addClass("s-error-customer-name");$.order_edit.customer_fields.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>')},initCustomerForm:function(b){b="undefined"===typeof b?"add":b;$.order_edit.bindValidateErrorPlaceholders();if("add"===b){var a=$("#customer-autocomplete"),c=function(a){a="undefined"===typeof a?!0:a;$("#s-customer-id").attr("disabled",
a);a?$("#s-order-edit-customer").addClass("s-opaque"):$("#s-order-edit-customer").removeClass("s-opaque")},d=function(b){"undefined"===typeof b||b?(c(!1),a.val("").hide(200)):(c(),e(),a.val("").show())},g=function(a){return parseInt(a,10)||"+"==a.substr(0,1)||-1!==a.indexOf("(")},e=function(){var a={};$.order_edit.customer_inputs.each(function(){var b=$(this);a[b.attr("name")]=b.val()});return function(){$.order_edit.customer_inputs.each(function(){var b=$(this);b.val(a[b.attr("name")]||"")})}};d(!1);
$.order_edit.customer_fields.off("focus",":input").on("focus",":input",function(){c(!1)});$("#s-order-new-customer").click(function(){e();d();$.order_edit.customer_inputs.first().focus();$("#s-customer-id").val(0);return!1});var f="";a.autocomplete({source:function(a,b){f=a.term;$.getJSON($.order_edit.options.autocomplete_url,a,function(a){(a=a||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});b(a)})},delay:300,minLength:3,select:function(a,b){var c=b.item,e=function(){var a=!1;
$.order_edit.customer_inputs.filter("input[type=text], textarea").each(function(){var b=$(this);if(b.is(":not(:hidden)")&&!this.value)return a=!0,b.focus(),!1});a||$.order_edit.customer_inputs.first().focus()};if(c.value)$.get("?action=contactForm&id="+c.value,function(a){$.order_edit.customer_fields.find(".field-group:first").html(a);$.order_edit.customer_inputs=$.order_edit.customer_fields.find(":input");$("#s-customer-id").val(c.value);d();setTimeout(function(){e()},200)});else{var m="[name="+
$.order_edit.inputName(g(f)?"phone":-1!==f.indexOf("@")?"email":"firstname")+"]";$.order_edit.customer_inputs.filter(m).val(f);$("#s-customer-id").val(0);d();setTimeout(function(){e()},200)}return!1},focus:function(a,b){this.value=b.item.name;return!1}});$("#order-add-form").submit(function(){c(!1)})}},inputName:function(b){return'"customer['+b+']"'},getPercentSymbol:function(){return"%"}};
//# sourceMappingURL=order.min.js.map