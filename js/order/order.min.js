var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};
$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var d=b.length,f=0;f<d;f++){var g=b[f];if(a.call(c,g,f,b))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){if(b==Array.prototype||b==Object.prototype)return b;b[a]=c.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<b.length;++a){var c=b[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,a){var c=$jscomp.propertyToPolyfillSymbol[a];if(null==c)return b[a];c=b[c];return void 0!==c?c:b[a]};
$jscomp.polyfill=function(b,a,c,d){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,a,c,d):$jscomp.polyfillUnisolated(b,a,c,d))};$jscomp.polyfillUnisolated=function(b,a,c,d){c=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var f=b[d];if(!(f in c))return;c=c[f]}b=b[b.length-1];d=c[b];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(b,a,c,d){var f=b.split(".");b=1===f.length;d=f[0];d=!b&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<f.length-1;g++){var n=f[g];if(!(n in d))return;d=d[n]}f=f[f.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[f]:null;a=a(c);null!=a&&(b?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:a}):a!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+c+"$"+f),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
(function(b){function a(u){return b.data(u,"tooltip")}function c(u){a(this).delay?r=setTimeout(f,a(this).delay):f();x=!!a(this).track;b(document.body).bind("mousemove",g);g(u)}function d(){if(!b.tooltip.blocked&&this!=k&&(this.tooltipText||a(this).bodyHandler)){k=this;p=this.tooltipText;if(a(this).bodyHandler){h.title.hide();var u=a(this).bodyHandler.call(this);u.nodeType||u.jquery?h.body.empty().append(u):h.body.html(u);h.body.show()}else if(a(this).showBody){u=p.split(a(this).showBody);h.title.html(u.shift()).show();
h.body.empty();for(var v=0,z;z=u[v];v++)0<v&&h.body.append("<br/>"),h.body.append(z);h.body.hideWhenEmpty()}else h.title.html(p).show(),h.body.hide();a(this).showURL&&b(this).url()?h.url.html(b(this).url().replace("http://","")).show():h.url.hide();h.parent.addClass(a(this).extraClass);a(this).fixPNG&&h.parent.fixPNG();c.apply(this,arguments)}}function f(){r=null;w&&b.fn.bgiframe||!a(k).fade?h.parent.show():h.parent.is(":animated")?h.parent.stop().show().fadeTo(a(k).fade,k.tOpacity):h.parent.is(":visible")?
h.parent.fadeTo(a(k).fade,k.tOpacity):h.parent.fadeIn(a(k).fade);g()}function g(u){if(!(b.tooltip.blocked||u&&"OPTION"==u.target.tagName))if(!x&&h.parent.is(":visible")&&b(document.body).unbind("mousemove",g),null==k)b(document.body).unbind("mousemove",g);else{h.parent.removeClass("viewport-right").removeClass("viewport-bottom");var v=h.parent[0].offsetLeft,z=h.parent[0].offsetTop;u&&(v=u.pageX+a(k).left,z=u.pageY+a(k).top,u="auto",a(k).positionLeft&&(u=b(window).width()-v,v="auto"),h.parent.css({left:v,
right:u,top:z}));u=b(window).scrollLeft();var H=b(window).scrollTop(),F=b(window).width(),E=b(window).height(),B=h.parent[0];u+F<B.offsetLeft+B.offsetWidth&&(v-=B.offsetWidth+20+a(k).left,h.parent.css({left:v+"px"}).addClass("viewport-right"));H+E<B.offsetTop+B.offsetHeight&&(z-=B.offsetHeight+20+a(k).top,h.parent.css({top:z+"px"}).addClass("viewport-bottom"))}}function n(u){function v(){h.parent.removeClass(z.extraClass).hide().css("opacity","")}if(!b.tooltip.blocked){r&&clearTimeout(r);k=null;var z=
a(this);w&&b.fn.bgiframe||!z.fade?v():h.parent.is(":animated")?h.parent.stop().fadeTo(z.fade,0,v):h.parent.stop().fadeOut(z.fade,v);a(this).fixPNG&&h.parent.unfixPNG()}}var h={},k,p,r,w=b.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),x=!1;b.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){b.tooltip.blocked=!b.tooltip.blocked}};b.fn.extend({tooltip:function(u){u=b.extend({},b.tooltip.defaults,u);h.parent||
(h.parent=b('<div id="'+u.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),b.fn.bgiframe&&h.parent.bgiframe(),h.title=b("h3",h.parent),h.body=b("div.body",h.parent),h.url=b("div.url",h.parent));var v=this.each(function(){b.data(this,"tooltip",u);this.tOpacity=h.parent.css("opacity");this.tooltipText=this.title;b(this).removeAttr("title");this.alt=""}).mouseover(d).mouseout(n);u.noHideOnClick||v.click(n);return v},fixPNG:w?function(){return this.each(function(){var u=
b(this).css("backgroundImage");u.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(u=RegExp.$1,b(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+u+"')"}).each(function(){var v=b(this).css("position");"absolute"!=v&&"relative"!=v&&b(this).css("position","relative")}))})}:function(){return this},unfixPNG:w?function(){return this.each(function(){b(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){b(this)[b(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
!function(b){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):b(jQuery)}(function(b){function a(e){e=e[0];return 0<e.offsetWidth&&0<e.offsetHeight}function c(e){if(e.minTime&&(e.minTime=B(e.minTime)),e.maxTime&&(e.maxTime=B(e.maxTime)),e.durationTime&&"function"!=typeof e.durationTime&&(e.durationTime=B(e.durationTime)),"now"==e.scrollDefault)e.scrollDefault=function(){return e.roundingFunction(B(new Date),
e)};else if(e.scrollDefault&&"function"!=typeof e.scrollDefault){var l=e.scrollDefault;e.scrollDefault=function(){return e.roundingFunction(B(l),e)}}else e.minTime&&(e.scrollDefault=function(){return e.roundingFunction(e.minTime,e)});if("string"===b.type(e.timeFormat)&&e.timeFormat.match(/[gh]/)&&(e._twelveHourTime=!0),!1===e.showOnFocus&&-1!=e.showOn.indexOf("focus")&&e.showOn.splice(e.showOn.indexOf("focus"),1),0<e.disableTimeRanges.length){for(var m in e.disableTimeRanges)e.disableTimeRanges[m]=
[B(e.disableTimeRanges[m][0]),B(e.disableTimeRanges[m][1])];e.disableTimeRanges=e.disableTimeRanges.sort(function(q,t){return q[0]-t[0]});for(m=e.disableTimeRanges.length-1;0<m;m--)e.disableTimeRanges[m][0]<=e.disableTimeRanges[m-1][1]&&(e.disableTimeRanges[m-1]=[Math.min(e.disableTimeRanges[m][0],e.disableTimeRanges[m-1][0]),Math.max(e.disableTimeRanges[m][1],e.disableTimeRanges[m-1][1])],e.disableTimeRanges.splice(m,1))}return e}function d(e){var l=e.data("timepicker-settings"),m=e.data("timepicker-list");
if(m&&m.length&&(m.remove(),e.data("timepicker-list",!1)),l.useSelect)var q=m=b("<select />",{"class":"ui-timepicker-select"});else m=b("<ul />",{"class":"ui-timepicker-list"}),q=b("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),q.css({display:"none",position:"absolute"}).append(m);if(l.noneOption)if(!0===l.noneOption&&(l.noneOption=l.useSelect?"Time...":"None"),b.isArray(l.noneOption))for(var t in l.noneOption){if(parseInt(t,10)==t){var A=f(l.noneOption[t],l.useSelect);m.append(A)}}else A=
f(l.noneOption,l.useSelect),m.append(A);(l.className&&q.addClass(l.className),null===l.minTime&&null===l.durationTime||!l.showDuration)||("function"==typeof l.step?"function":l.step,q.addClass("ui-timepicker-with-duration"),q.addClass("ui-timepicker-step-"+l.step));A=l.minTime;"function"==typeof l.durationTime?A=B(l.durationTime()):null!==l.durationTime&&(A=l.durationTime);t=null!==l.minTime?l.minTime:0;var G=null!==l.maxTime?l.maxTime:t+D-1;t>G&&(G+=D);G===D-1&&"string"===b.type(l.timeFormat)&&l.show2400&&
(G=D);var L=l.disableTimeRanges,K=0,Q=L.length,N=l.step;"function"!=typeof N&&(N=function(){return l.step});for(var O=0;G>=t;O++,t+=60*N(O)){var J=t,M=E(J,l);if(l.useSelect)var I=b("<option />",{value:M});else I=b("<li />"),I.addClass(43200>J%86400?"ui-timepicker-am":"ui-timepicker-pm"),I.data("time",86400>=J?J:J%86400);I.text(M);if((null!==l.minTime||null!==l.durationTime)&&l.showDuration)if(M=F(t-A,l.step),l.useSelect)I.text(I.text()+" ("+M+")");else{var P=b("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");I.append(P)}Q>K&&(J>=L[K][1]&&(K+=1),L[K]&&J>=L[K][0]&&J<L[K][1]&&(l.useSelect?I.prop("disabled",!0):I.addClass("ui-timepicker-disabled")));m.append(I)}(q.data("timepicker-input",e),e.data("timepicker-list",q),l.useSelect)?(e.val()&&m.val(g(B(e.val()),l)),m.on("focus",function(){b(this).data("timepicker-input").trigger("showTimepicker")}),m.on("blur",function(){b(this).data("timepicker-input").trigger("hideTimepicker")}),m.on("change",function(){x(e,b(this).val(),"select")}),x(e,
m.val(),"initial"),e.hide().after(m)):(t=l.appendTo,"string"==typeof t?t=b(t):"function"==typeof t&&(t=t(e)),t.append(q),p(e,m),m.on("mousedown click","li",function(R){e.off("focus.timepicker");e.on("focus.timepicker-ie-hack",function(){e.off("focus.timepicker-ie-hack");e.on("focus.timepicker",C.show)});h(e)||e[0].focus();m.find("li").removeClass("ui-timepicker-selected");b(this).addClass("ui-timepicker-selected");H(e)&&(e.trigger("hideTimepicker"),m.on("mouseup.timepicker click.timepicker","li",
function(S){m.off("mouseup.timepicker click.timepicker");q.hide()}))}))}function f(e,l){var m,q,t;return"object"==typeof e?(m=e.label,q=e.className,t=e.value):"string"==typeof e?m=e:b.error("Invalid noneOption value"),l?b("<option />",{value:t,"class":q,text:m}):b("<li />",{"class":q,text:m}).data("time",String(t))}function g(e,l){return e=l.roundingFunction(e,l),null!==e?E(e,l):void 0}function n(e){e.target!=window&&(e=b(e.target),e.closest(".ui-timepicker-input").length||e.closest(".ui-timepicker-wrapper").length||
(C.hide(),b(document).unbind(".ui-timepicker"),b(window).unbind(".ui-timepicker")))}function h(e){e=e.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&e.disableTouchKeyboard}function k(e,l,m){if(!m&&0!==m)return!1;e=e.data("timepicker-settings");var q=!1;m=e.roundingFunction(m,e);return l.find("li").each(function(t,A){t=b(A);if("number"==typeof t.data("time"))return t.data("time")==m?(q=t,!1):void 0}),q}function p(e,l){l.find("li").removeClass("ui-timepicker-selected");
var m=B(w(e),e.data("timepicker-settings"));null!==m&&(e=k(e,l,m))&&(m=e.offset().top-l.offset().top,(m+e.outerHeight()>l.outerHeight()||0>m)&&l.scrollTop(l.scrollTop()+e.position().top-e.outerHeight()),e.addClass("ui-timepicker-selected"))}function r(e,l){if(""!==this.value&&"timepicker"!=l){var m=b(this);if(!m.is(":focus")||e&&"change"==e.type){e=m.data("timepicker-settings");var q=B(this.value,e);if(null===q)return void m.trigger("timeFormatError");var t=!1;if(null!==e.minTime&&null!==e.maxTime&&
(q<e.minTime||q>e.maxTime)&&(t=!0),b.each(e.disableTimeRanges,function(){return q>=this[0]&&q<this[1]?(t=!0,!1):void 0}),e.forceRoundTime){var A=e.roundingFunction(q,e);A!=q&&(q=A,l=null)}e=E(q,e);t?x(m,e,"error")&&m.trigger("timeRangeError"):x(m,e,l)}}}function w(e){return e.is("input")?e.val():e.data("ui-timepicker-value")}function x(e,l,m){if(e.is("input")){e.val(l);var q=e.data("timepicker-settings");q.useSelect&&"select"!=m&&"initial"!=m&&e.data("timepicker-list").val(g(B(l),q))}return e.data("ui-timepicker-value")!=
l?(e.data("ui-timepicker-value",l),"select"==m?e.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(m)&&e.trigger("changeTime"),!0):(e.trigger("selectTime"),!1)}function u(e){switch(e.keyCode){case 13:case 9:break;default:e.preventDefault()}}function v(e){var l=b(this),m=l.data("timepicker-list");if(!m||!a(m)){if(40!=e.keyCode)return!0;C.show.call(l.get(0));m=l.data("timepicker-list");h(l)||l.focus()}switch(e.keyCode){case 13:return H(l)&&(r.call(l.get(0),
{type:"change"}),C.hide.apply(this)),e.preventDefault(),!1;case 38:var q=m.find(".ui-timepicker-selected");return q.length?q.is(":first-child")||(q.removeClass("ui-timepicker-selected"),q.prev().addClass("ui-timepicker-selected"),q.prev().position().top<q.outerHeight()&&m.scrollTop(m.scrollTop()-q.outerHeight())):(m.find("li").each(function(t,A){return 0<b(A).position().top?(q=b(A),!1):void 0}),q.addClass("ui-timepicker-selected")),!1;case 40:return q=m.find(".ui-timepicker-selected"),0===q.length?
(m.find("li").each(function(t,A){return 0<b(A).position().top?(q=b(A),!1):void 0}),q.addClass("ui-timepicker-selected")):q.is(":last-child")||(q.removeClass("ui-timepicker-selected"),q.next().addClass("ui-timepicker-selected"),q.next().position().top+2*q.outerHeight()>m.outerHeight()&&m.scrollTop(m.scrollTop()+q.outerHeight())),!1;case 27:m.find("li").removeClass("ui-timepicker-selected");C.hide();break;case 9:C.hide();break;default:return!0}}function z(e){var l=b(this),m=l.data("timepicker-list"),
q=l.data("timepicker-settings");if(!m||!a(m)||q.disableTextInput)return!0;switch(e.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:q.typeaheadHighlight?p(l,m):m.hide()}}function H(e){var l=e.data("timepicker-settings"),m=null,q=e.data("timepicker-list").find(".ui-timepicker-selected");return q.hasClass("ui-timepicker-disabled")?
!1:(q.length&&(m=q.data("time")),null!==m&&("string"!=typeof m&&(m=E(m,l)),x(e,m,"select")),!0)}function F(e,l){e=Math.abs(e);var m,q;e=Math.round(e/60);var t=[];return 60>e?t=[e,y.mins]:(m=Math.floor(e/60),q=e%60,30==l&&30==q&&(m+=y.decimal+5),t.push(m),t.push(1==m?y.hr:y.hrs),30!=l&&q&&(t.push(q),t.push(y.mins))),t.join(" ")}function E(e,l){if("number"!=typeof e)return null;var m=parseInt(e%60),q=parseInt(e/60%60),t=parseInt(e/3600%24);t=new Date(1970,0,2,t,q,m,0);if(isNaN(t.getTime()))return null;
if("function"===b.type(l.timeFormat))return l.timeFormat(t);for(var A="",G=0;G<l.timeFormat.length;G++)switch(m=l.timeFormat.charAt(G)){case "a":A+=11<t.getHours()?y.pm:y.am;break;case "A":A+=11<t.getHours()?y.PM:y.AM;break;case "g":m=t.getHours()%12;A+=0===m?"12":m;break;case "G":m=t.getHours();e===D&&(m=l.show2400?24:0);A+=m;break;case "h":m=t.getHours()%12;0!==m&&10>m&&(m="0"+m);A+=0===m?"12":m;break;case "H":m=t.getHours();e===D&&(m=l.show2400?24:0);A+=9<m?m:"0"+m;break;case "i":q=t.getMinutes();
A+=9<q?q:"0"+q;break;case "s":m=t.getSeconds();A+=9<m?m:"0"+m;break;case "\\":G++;A+=l.timeFormat.charAt(G);break;default:A+=m}return A}function B(e,l){if(""===e||null===e)return null;if("object"==typeof e)return 3600*e.getHours()+60*e.getMinutes()+e.getSeconds();if("string"!=typeof e)return e;e=e.toLowerCase().replace(/[\s\.]/g,"");"a"!=e.slice(-1)&&"p"!=e.slice(-1)||(e+="m");var m="("+y.am.replace(".","")+"|"+y.pm.replace(".","")+"|"+y.AM.replace(".","")+"|"+y.PM.replace(".","")+")?",q=e.match(new RegExp("^"+
m+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+m+"$"));if(!q)return null;e=parseInt(1*q[2],10);if(24<e){if(l&&!1===l.wrapHours)return null;e%=24}m=q[1]||q[5];var t=e;12>=e&&m&&(t=m==y.pm||m==y.PM,t=12==e?t?12:0:e+(t?12:0));q=3600*t+60*(1*q[3]||0)+(1*q[4]||0);12>e&&!m&&l&&l._twelveHourTime&&l.scrollDefault&&(l=q-l.scrollDefault(),0>l&&l>=D/-2&&(q=(q+D/2)%D));return q}var D=86400,y={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},C={init:function(e){return this.each(function(){var l=
b(this),m=[],q;for(q in b.fn.timepicker.defaults)l.data(q)&&(m[q]=l.data(q));m=b.extend({},b.fn.timepicker.defaults,m,e);if(m.lang&&(y=b.extend(y,m.lang)),m=c(m),l.data("timepicker-settings",m),l.addClass("ui-timepicker-input"),m.useSelect)d(l);else{if(l.prop("autocomplete","off"),m.showOn)for(var t in m.showOn)l.on(m.showOn[t]+".timepicker",C.show);l.on("change.timepicker",r);l.on("keydown.timepicker",v);l.on("keyup.timepicker",z);m.disableTextInput&&l.on("keydown.timepicker",u);r.call(l.get(0),
null,"initial")}})},show:function(e){var l=b(this),m=l.data("timepicker-settings");if(e&&e.preventDefault(),m.useSelect)return void l.data("timepicker-list").focus();h(l)&&l.blur();e=l.data("timepicker-list");if(!l.prop("readonly")&&(e&&0!==e.length&&"function"!=typeof m.durationTime||(d(l),e=l.data("timepicker-list")),!a(e))){l.data("ui-timepicker-value",l.val());p(l,e);C.hide();e.show();var q={};m.orientation.match(/r/)?q.left=l.offset().left+l.outerWidth()-e.outerWidth()+parseInt(e.css("marginLeft").replace("px",
""),10):q.left=l.offset().left+parseInt(e.css("marginLeft").replace("px",""),10);"t"==(m.orientation.match(/t/)?"t":m.orientation.match(/b/)?"b":l.offset().top+l.outerHeight(!0)+e.outerHeight()>b(window).height()+b(window).scrollTop()?"t":"b")?(e.addClass("ui-timepicker-positioned-top"),q.top=l.offset().top-e.outerHeight()+parseInt(e.css("marginTop").replace("px",""),10)):(e.removeClass("ui-timepicker-positioned-top"),q.top=l.offset().top+l.outerHeight()+parseInt(e.css("marginTop").replace("px",""),
10));e.offset(q);q=e.find(".ui-timepicker-selected");if(!q.length){var t=B(w(l));null!==t?q=k(l,e,t):m.scrollDefault&&(q=k(l,e,m.scrollDefault()))}q&&q.length?(q=e.scrollTop()+q.position().top-q.outerHeight(),e.scrollTop(q)):e.scrollTop(0);return m.stopScrollPropagation&&b(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(A){A.preventDefault();var G=b(this).scrollTop();b(this).scrollTop(G+A.originalEvent.deltaY)}),b(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
n),b(window).on("resize.ui-timepicker",n),m.closeOnWindowScroll&&b(document).on("scroll.ui-timepicker",n),l.trigger("showTimepicker"),this}},hide:function(e){e=b(this);var l=e.data("timepicker-settings");return l&&l.useSelect&&e.blur(),b(".ui-timepicker-wrapper").each(function(){var m=b(this);if(a(m)){var q=m.data("timepicker-input"),t=q.data("timepicker-settings");t&&t.selectOnBlur&&H(q);m.hide();q.trigger("hideTimepicker")}}),this},option:function(e,l){return"string"==typeof e&&"undefined"==typeof l?
b(this).data("timepicker-settings")[e]:this.each(function(){var m=b(this),q=m.data("timepicker-settings"),t=m.data("timepicker-list");"object"==typeof e?q=b.extend(q,e):"string"==typeof e&&(q[e]=l);q=c(q);m.data("timepicker-settings",q);t&&(t.remove(),m.data("timepicker-list",!1));q.useSelect&&d(m)})},getSecondsFromMidnight:function(){return B(w(this))},getTime:function(e){var l=w(this);if(!l)return null;l=B(l);if(null===l)return null;e||(e=new Date);e=new Date(e);return e.setHours(l/3600),e.setMinutes(l%
3600/60),e.setSeconds(l%60),e.setMilliseconds(0),e},isVisible:function(){var e=this.data("timepicker-list");return!(!e||!a(e))},setTime:function(e){var l=this.data("timepicker-settings"),m=l.forceRoundTime?g(B(e),l):E(B(e),l);return e&&null===m&&l.noneOption&&(m=e),x(this,m),this.data("timepicker-list")&&p(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var e=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),e.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};b.fn.timepicker=function(e){return this.length?C[e]?this.hasClass("ui-timepicker-input")?C[e].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof e&&e?void b.error("Method "+e+" does not exist on jQuery.timepicker"):C.init.apply(this,arguments):this};b.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(e,l){if(null===e)return null;if("number"!=typeof l.step)return e;var m=e%(60*l.step);return m>=30*l.step?e+=60*l.step-m:e-=m,e==D&&l.show2400?e:e%D},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(b){var a=function(c,d,f){var g=/[^\w\-\.:]/.test(c)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+c.replace(a.regexp,a.func)+"';return _s;"):f?a.cache[c]=a(a.load(c)):a.cache[c]=a.cache[c]||a(a.load(c));return d?g(d,a):function(n){return g(n,a)}};a.cache={};a.load=function(c){var d=document.getElementById(c),f=/<\\\/(\w+)/g;if(!d&&console)throw{message:"template with id="+c+" not found"};return d?("textarea"==d.tagName.toLowerCase()?d.value:document.getElementById(c).innerHTML).replace(f,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(c,d,f,g,n,h){if(d)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[c]||"\\"+c;if(f)return"="===f?"'+_e("+g+")+'":"'+("+g+"||'')+'";if(n)return"';";if(h)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(c){return String(c||"").replace(a.encReg,function(d){return a.encMap[d]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a,c){function d(){if(f.stopped)this.onscroll=null;else if(!f.stopped&&!f.loading&&h(n,g)<=f.distance){if(null!==f.hash){var k=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===f.hash.indexOf(k)){this.onscroll=null;return}}f.load()}}if("stop"==a){var f=this.data("lazyLoadSettings");f&&(f.stopped=!0)}else if("reload"==a){if(f=this.data("lazyLoadSettings"))f.stopped=!1,f.loading=!1,this.get(0).onscroll=null,this.lazyLoad(f)}else if("sleep"==a){if(f=this.data("lazyLoadSettings"))f.loading=
!0}else if("wake"==a){if(f=this.data("lazyLoadSettings"))f.loading=!1}else if("force"==a)(f=this.data("lazyLoadSettings"))&&(f.loading||f.load());else{if("get"===a)return f=this.data("lazyLoadSettings")||{},f[c];this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:n,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));f=this.data("lazyLoadSettings");f.loading=!1;f.stopped=!1;var g=b(window),n=f.container||b(this);
null===f.hash||b.isArray(f.hash)||(f.hash=[f.hash]);b.fn.lazyLoad.call(g,f.state);(function(){var k,p=setTimeout(k=function(){if(f.stopped)clearTimeout(p);else{if(null!==f.hash){var r=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===f.hash.indexOf(r)){clearTimeout(p);return}}f.loading?p=setTimeout(k,350):(h(n,g),h(n,g)<=f.distance?(f.load(),p=setTimeout(k,350)):(g.get(0).onscroll=d,clearTimeout(p)))}},350)})();var h="function"===typeof f.distanceBetweenBottoms?f.distanceBetweenBottoms:
function(k,p,r){k="string"===typeof k?b(k):k;r=r||0;return k.position().top+k.outerHeight()-r-(p.scrollTop()+p.height())}}}})(jQuery);(function(b){b.storage=new b.store;b.orders={options:{view:"table"},init:function(a){var c=this;c.options=a;"undefined"!=typeof b.History&&b.History.bind(function(){c.dispatch()});b.ajaxPrefilter(function(d,f,g){g.originalRequestOptions=f});b.wa.errorHandler=function(d){var f=d.originalRequestOptions||{};if(403===d.status||404===d.status){d=b(d.responseText);d=d.find(".dialog-content").length?b('<div class="block double-padded"></div>').append(d.find(".dialog-content *")):b('<div class="block double-padded"></div>').append(d.find(":not(style)"));
var g="content";f=f.url||"";if(0<f.length){var n=f.indexOf("?");-1!==n&&(f=f.substr(n+1),f=b.shop.helper.parseParams(f)||{},"order"===f.module&&"table"!==f.view&&b("#s-order").length&&(g="order"))}"order"===g?b("#s-order").empty().append(d):(b("#s-content").empty().append(d),b.order_list&&b.order_list.finit());return!1}return!0};a=window.location.hash;"#/"!==a&&a?b.wa.setHash(a):this.dispatch();this.initSearch();b(document).bind("wa.appcount",function(d,f){f=f||{};d=parseInt(f.shop,10);b("#s-pending-orders .small").text(d?
"+"+d:"");(f=document.title.match(/\(\d+\) /))?document.title=document.title.replace(f[0],d?"("+d+") ":""):d&&(document.title="("+d+") "+document.title)});b(function(){b("#maincontent").on("click",".s-alert-close",function(){var d=b.storage.get("shop/alerts"),f=b(this).parent();d||(d=[]);d.push(f.data("alert"));d=d.filter(function(g,n,h){return null!=g&&n==h.indexOf(g)});b.storage.set("shop/alerts",d);f.remove();return!1})});this.checkAlerts()},initSearch:function(){var a=b("#s-orders-search"),c=
[],d=null,f=function(g){switch(g.autocomplete_item_type){case "order":b.wa.setHash("#/order/"+g.id+"/");a.val(g.value);break;case "contact":b.wa.setHash("#/orders/contact_id="+g.id+"/");a.val(g.value);break;case "product":b.wa.setHash("#/orders/product_id="+g.id+"/");a.val(g.value);break;case "coupon":b.wa.setHash("#/orders/coupon_id="+g.id+"/");break;case "tracking_number":b.wa.setHash("#/orders/tracking_number="+g.value+"/");break;case "shipping":b.wa.setHash("#/orders/shipping_id="+g.id+"/");break;
case "payment":b.wa.setHash("#/orders/payment_id="+g.id+"/");break;case "city":b.wa.setHash("#/orders/city="+g.value+"/");break;case "region":b.wa.setHash("#/orders/region="+((g.value||"").split(":")[1]||"")+"/");break;case "country":b.wa.setHash("#/orders/country="+g.value+"/");break;case "item_code":b.wa.setHash("#/orders/item_code="+g.value+"/")}};a.unbind("keydown").bind("keydown",function(g){if(13==g.keyCode||10==g.keyCode){if(d)return!1;var n=b(this);if(!b(this).val())return location.hash="#/orders/all/",
n.autocomplete("close"),!1;if(c&&b.isArray(c)&&c.length)return f(c[0]),setTimeout(function(){n.autocomplete("close")},150),!1}});a.autocomplete({minLength:1,delay:300,html:!0,select:function(g,n){f(n.item);return!1},source:function(g,n){d&&d.abort();d=b.getJSON("?action=autocomplete&type=order",g,function(h){c=h;n(h)}).always(function(){d=null})}})},prevHash:null,hash:null,skipDispatch:0,stopDispatch:function(a){this.skipDispatch=a},forceHash:function(a){location.hash!=a&&(this.skipDispatch++,b.wa.setHash(a))},
dispatch:function(a){if(0<this.skipDispatch)return this.skipDispatch--,!1;if(void 0===a||null===a)a=window.location.hash;a=a.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);this.hash=a;var c=new b.Event("wa_before_dispatched");b(window).trigger(c);if(a)if(a=a.split("/"),a[0]){c="";var d,f=null,g=null;for(d=0;d<a.length;d++){var n=a[d];if(2>d){if(0===d)c=n;else if(parseInt(n,10)!=n&&-1==n.indexOf("="))c+=n.substr(0,1).toUpperCase()+n.substr(1);else break;"function"==typeof this[c+
"Action"]&&(f=c,g=d+1)}else break}"function"!==typeof this[c+"Action"]&&f&&(c=f,d=g);a=a.slice(d);this.preExecute(c);"function"==typeof this[c+"Action"]?(b.shop.trace("$.orders.dispatch",[c+"Action",a]),this[c+"Action"].apply(this,a)):b.shop.error("Invalid action name:",c+"Action");this.postExecute(c)}else this.preExecute(),this.defaultAction(),this.postExecute();else this.preExecute(),this.defaultAction(),this.postExecute()},back:function(){var a=b.orders.prevHash||"";location.hash=a?a+"/":""},preExecute:function(a,
c){},postExecute:function(a,c){this.actionName=a},defaultAction:function(){this.ordersAction()},couponsAction:function(){b.order_list&&b.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(a){this.load("?module=order&action=edit&id="+a,function(){b.order_list&&b.order_list.finit()})},ordersNewAction:function(a){this.load("?module=order&action=edit"+(a?"&"+a:""),function(){b.order_list&&b.order_list.finit()})},ordersAction:function(a){if("hash"===a)a={hash:Array.prototype.slice.call(arguments,
1).join("/")};else{var c="";"search"===a&&(c=Array.prototype.slice.call(arguments,1));1<arguments.length&&(a=Array.prototype.join.call(arguments,"/"));a?"all"===a&&(a=""):a="state_id=new|processing|auth|paid";a=b.shop.helper.parseParams(a||"");a.view||(a.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",a.view);b.order_edit&&b.order_edit.slideBack();c&&(a.search=c)}"orders"===this.actionName&&b.order_list?b.order_list.dispatch(a):(b.order_list&&b.order_list.finit(),
this.load("?module=orders&"+this.buildOrdersUrlComponent(a),function(){b.order_list&&b.order_list.dispatch(a)}))},orderAction:function(a,c){c=b.shop.helper.parseParams(c||"");c.view||(c.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",c.view);b.order_edit&&b.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(a)+"&"+this.buildOrdersUrlComponent(c),function(){var d=b("#s-content").find("h1 a.back.order-list");d.show();var f=b("#s-all-orders");
f.length&&f.hasClass("selected")&&(f=f.find("a:first"),f.length&&d.attr("href",f.attr("href")))});b.order_list&&b.order_list.finit()},buildOrdersUrlComponent:function(a){var c="",d;for(d in a)a.hasOwnProperty(d)&&"view"!==d&&(c+="&"+d+"="+a[d]);return"view="+(a.view||this.options.view)+c},load:function(a,c,d){function f(){var k=b("#s-orders-views"),p=b("#s-order, #s-orders").length;k.length&&(p?k.css("visibility","visible"):k.css("visibility","hidden"))}function g(){var k=b("#s-orders-sort"),p=b("#s-order, #s-orders").length;
k.length&&(p?k.css("visibility","visible"):k.css("visibility","hidden"))}"function"===typeof c?(d=c,c={}):c=c||{};var n=Math.random();this.random=n;var h=this;return b.get(a,function(k){if("undefined"!==typeof c.check&&!c.check||h.random==n){(c.content||b("#s-content")).removeClass("bordered-left").html(k);"function"===typeof d&&d.call(this);var p=b(window);setTimeout(function(){p.trigger("scroll")},250);f();g();b(".level2").show();b("#s-sidebar").width(200).show();h.checkAlerts()}})},checkAlerts:function(){var a=
b.storage.get("shop/alerts");b.shop.trace("checkAlerts",a);b(".s-alert").each(function(){-1==b.inArray(b(this).data("alert"),a)&&b(this).show()})}}})(jQuery);(function(b){b.order_list={id:0,options:{},container:null,$selectionMenu:null,sidebar:null,select_all_input:null,filter_params:{},filter_params_str:"",params:null,timer_id:0,lazy_load_win:null,all_printforms:null,sort:["create_datetime","desc"],xhrs:{lazy_load:null,update_load:null,printforms:null},init:function(a){this.options=a=a||{};this.filter_params=a.filter_params||{};this.filter_params_str=a.filter_params_str||"";this.container=b("#order-list");"table"==a.view&&(this.container=b("#order-list").find("tbody:first"),
this.$selectionMenu=this.options.$selectionMenu)&&(b("#mainmenu .s-level2").append(this.$selectionMenu),this.select_all_input=this.$selectionMenu.find(".s-order-list-select-all"),this.select_all_input.attr("checked",!1));this.options.all_order_state_ids=this.options.all_order_state_ids||null;this.sidebar=b("#s-sidebar");this.id=a.id||0;if(a.orders&&a.orders.length&&a.view){try{this.container.append(tmpl("template-order-list-"+this.options.view,{orders:a.orders},!0)),this.container.trigger("append_order_list",
[a.orders])}catch(d){return console&&console.log(d.stack),this}delete a.orders;delete this.options.orders}a.lazy_loading&&this.initLazyLoad(a.lazy_loading);a.counters&&this.updateCounters(a.counters);a.update_process&&a.count&&this.updateProcess("run",a.update_process);if(a.sort&&a.sort[0]){a.sort[0]=""+a.sort[0];var c=b("#s-orders-sort .s-sort").map(function(){var d=b(this).data("sort")||"";return d?d:!1}).toArray();0>c.indexOf(a.sort[0])&&(a.sort[0]=c[0]);a.sort[1]=a.sort[1]||"";a.sort[1]="desc"===
a.sort[1].toLowerCase()?"desc":"asc";this.sort=a.sort}this.initView()},initLazyLoad:function(a){var c=this,d=c.options.count,f=c.options.total_count,g=b(window);g.lazyLoad("stop");d<f&&(g.lazyLoad({container:this.options.view?c.container:g,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:["orders",""],load:function(){g.lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();var n=c.container.find(".order:last"),h=parseInt(n.attr("data-order-id"),10);if(h){var k=
function(){return b.getJSON(c.buildLoadListUrl(h),function(p){if("ok"==p.status){try{c.container.append(tmpl("template-order-list-"+c.options.view,{orders:p.data.orders,check_all:"table"==c.options.view?c.select_all_input.attr("checked"):!1})),c.container.trigger("append_order_list",[p.data.orders]),c.container.find("[data-order-id="+c.options.id+"]").length&&(c.container.find(".selected").removeClass("selected"),c.container.find("[data-order-id="+c.options.id+"]").addClass("selected"))}catch(r){console&&
console.log(r.stack);g.lazyLoad("stop");return}b(".lazyloading-progress-string").text(p.data.progress.loaded+" "+p.data.progress.of);b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(p.data.progress.chunk);p.data.loaded>=p.data.total_count?(g.lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),g.lazyLoad("wake"))}else console&&console.log("Error when loading orders: "+p.errors),g.lazyLoad("stop")}).error(function(p){console&&(p&&p.errors?console.log("Error when loading orders: "+
p.errors):p?console.log(p):console.log("Error when loading orders"));g.lazyLoad("stop")})};null===c.xhrs.update_load?c.xhrs.lazy_load=k():c.xhrs.update_load.then(function(){c.xhrs.lazy_load=k()})}else console.log("Unkown last item"),g.lazyLoad("stop")}}),b("#s-orders").off("click",".lazyloading-link").on("click",".lazyloading-link",function(){g.lazyLoad("force");return!1}),this.lazy_load_win=g)},initView:function(){function a(g){var n=b.order_list.getSelectedOrders(),h=function(){c.$selectionMenu.addClass("s-disabled");
c.$selectionMenu.find(".js-selection-menu-loading").show();c.select_all_input.attr("disabled",!0);f(g,n,function(){c.$selectionMenu.removeClass("s-disabled");c.$selectionMenu.find(".js-selection-menu-loading").hide();c.select_all_input.removeAttr("disabled");c.select_all_input.trigger("select",!1);b.orders.dispatch()})};n.all?confirm($_("Perform action to all selected orders?"))&&h():h()}var c=this;this.initSortMenu();this.initSidebar();"table"==this.options.view&&c.$selectionMenu&&c.$selectionMenu.length&&
this.initSelecting();this.options.id&&this.loadOrder(this.options.id);var d=b("#s-orders-views");d.find("li.selected").removeClass("selected");d.find('li[data-view="'+this.options.view+'"]').addClass("selected");d.find("li a").each(function(){var g=b(this),n=b(this).parents("li:first");g.attr("href","#/orders/view="+n.attr("data-view")+(b.order_list.options.filter_params_str?"&"+b.order_list.options.filter_params_str:"")+"/")});var f=function(g,n,h){var k=function(){var u=b(window),v=b.Deferred();
if(!n.all||!c.options.lazy_loading||u.lazyLoad("get","stopped"))return v.resolve(),v;c.container.one("append_order_list.ensureOrderListChunkLoaded",function(){v.resolve()});setTimeout(function(){c.container.off("append_order_list.ensureOrderListChunkLoaded");v.resolve()},2E3);u.lazyLoad("force");return v},p=function(u){var v=b.Deferred();if(b.isEmptyObject(u.data.orders))return v.resolve(),v;c.container.one("append_order_list.updateOrderListChunk",function(){v.resolve()});setTimeout(function(){c.container.off("append_order_list.updateOrderListChunk");
v.resolve()},1E3);c.updateListItems(u.data.orders);return v},r=function(u){var v=b.Deferred(),z=function(){if(!c.container.find(".order:not(:hidden):first").length){var D='<div class="block double-padded align-center blank"><br><br><br><br><span class="gray large">'+$_("There are no orders in this view.")+'</span><div class="clear-left"></div></div></div>';b("#s-content").html(D)}},H=[],F=c.filter_params;if(!b.isEmptyObject(u.data.orders))for(var E=0,B=u.data.orders.length;E<B;E++)!b.isEmptyObject(F)&&
F.state_id&&("string"===b.type(F.state_id)&&F.state_id!==u.data.orders[E].state_id?H.push(u.data.orders[E].id):"array"===b.type(F.state_id)&&-1===F.state_id.indexOf(u.data.orders[E].state_id)&&H.push(u.data.orders[E].id));b.isEmptyObject(H)?(z(),v.resolve()):(c.hideListItems(H).done(function(){z();v.resolve()}),setTimeout(function(){v.resolve()},1E3));return v},w=function(u){var v=b.Deferred();k().done(function(){p(u).done(function(){r(u).done(function(){b.order_list.updateCounters({state_counters:u.data.state_counters,
common_counters:{pending:u.data.pending_count}});v.resolve()})})});return v},x=function(u,v){b.shop.jsonPost("?module=orders&action=performAction&id="+g+"&offset="+(u||0)+"&"+c.options.filter_params_str,n,function(z){"ok"===z.status?w(z).done(function(){z.data.offset<z.data.total_count?x(z.data.offset,v):v(z)}):v(z)})};x(0,h)};if(c.$selectionMenu)c.$selectionMenu.off("click.order_list",".js-wf-action-item").on("click.order_list",".js-wf-action-item",function(){var g=b(this),n=g.data("action-id");
if(!g.hasClass("s-disabled"))return n&&a(n),!1})},loadOrder:function(a){this.container.find(".selected").removeClass("selected");this.container.find("[data-order-id="+a+"]").addClass("selected");b("#s-order-title").find(".loading").show();b.orders.load("?module=order&id= "+a+"&"+this.filter_params_str,{content:b("#s-order")},function(){this.id=a})},getSelectedOrders:function(a){a=a||!1;var c={count:0,all:!1};if(this.select_all_input.attr("checked")){c.all=!0;var d=b.order_list.filter_params;a?(c.serialized=
[],b.isEmptyObject(d)?c.serialized.push({name:"filter_params",value:""}):b.each(d,function(f,g){b.isArray(g)?b.each(g,function(n,h){c.serialized.push({name:"filter_params["+f+"]["+n+"]",value:h})}):c.serialized.push({name:"filter_params["+f+"]",value:g})})):c.filter_params=b.isEmptyObject(d)?"":d;c.count=this.options.total_count}else a?c.serialized=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return{name:"order_id[]",value:b(this).attr("data-order-id")}}).toArray():c.order_id=
b.order_list.container.find(".order.selected").map(function(){c.count+=1;return b(this).attr("data-order-id")}).toArray();return c},initSortMenu:function(){var a=b("#s-orders-sort"),c=function(d,f){var g=d[0];d=d[1];var n=b('.s-sort[data-sort="'+g+'"] a',a).text();a.find(".s-current-sort").data("sort",g);a.find(".s-current-sort").data("order",d);a.find(".s-current-sort .f-text").text(n);a.find(".s-sort-order").hide().filter('[data-order="'+d+'"]').show();f&&(f=window.location.hash||"",f=f.replace(/(^[^#]*#\/*|\/$)/g,
""),f.split("/")[1]||(f="#/orders/state_id=new|processing|auth|paid"),f=f.replace(/(&*sort\[[01]\]=.*?[&\/]|&*sort\[[01]\]=.*?$)/g,""),(n=0<f.indexOf("="))&&(f=f.replace(/[\/&]$/,"")),b.wa.setHash(f+((n?"&":"")+"sort[0]="+g+"&sort[1]="+d+"/")))};c(this.sort);a.data("inited")||(a.find(".s-sort a").click(function(){var d=b(this),f=a.find(".s-current-sort").data(),g=f.sort;f=f.order;d.data("sort")===g?f="desc"===f?"asc":"desc":(g=d.data("sort"),f="desc");c([g,f],!0)}),a.data("inited",1))},initSidebar:function(){var a=
this.sidebar,c=this.options.view;a.find("li.list a").each(function(){var f=b(this),g=f.attr("href"),n=g.match(/view=((.*)&|(.*)\/|(.*))/);if(n)f.attr("href",g.replace("view="+(n[2]||n[3]||n[4]),"view="+c));else if(n=g.match(/^#\/orders\/hash\/(.*?)\/?$/))f.attr("href","#/orders/view="+c+"&hash="+encodeURIComponent(n[1])+"/");else if(n=g.match(/orders\/((.*)\/|(.*))/))n[1]?(g=n[2]||n[3],g+="&view="+c):g="view="+c,f.attr("href","#/orders/"+g+"/")});var d=a.find("li.selected").removeClass("selected");
this.filter_params.state_id?b.isArray(this.filter_params.state_id)?b("#s-pending-orders").addClass("selected"):a.find('li[data-state-id="'+this.filter_params.state_id+'"]').addClass("selected"):this.filter_params.contact_id?a.find("li[data-contact-id="+this.filter_params.contact_id+"]").addClass("selected"):this.filter_params.storefront?(d=decodeURIComponent(this.filter_params.storefront),"/"===d.slice(-1)&&(d=d.slice(0,-1)),a.find('li[data-storefront="'+d+'"]').addClass("selected")):b.order_list.filter_params_str?
a.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||d.addClass("selected"):b("#s-all-orders").addClass("selected");a.find("li.list a").unbind("click.order_list").bind("click.order_list",function(){a.find("li.selected").removeClass("selected");b(this).closest("li").addClass("selected");if(b(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==b.orders.hash){var f=b.orders.hash.replace("orders/","");b.order_list.dispatch(f,!0)}})},updateSelectionMenuActionItemsByStates:function(a){var c=
[];if("string"===typeof a)c.push(a);else if(b.isArray(a))c=[].concat(a);else return;a=this.$selectionMenu.find(".wf-actions .js-wf-action-item");a.addClass("s-disabled");var d={};a.each(function(){var g=b(this),n=g.data("actionId");g=g.data("availableForStates").split(",");for(var h=0;h<c.length;h++){var k=c[h];k=""+k;-1!==g.indexOf(k)&&(d[k]=d[k]||[],d[k].push(n))}});var f=b.shop.intersectArrays(b.shop.getValues(d),!0);0<f.length&&a.filter(function(){return-1<b.inArray(b(this).data("actionId"),f)}).removeClass("s-disabled")},
enableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").removeClass("s-disabled")},disableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").addClass("s-disabled")},initSelecting:function(){var a=this,c=this.container,d=this.select_all_input;a.filter_params&&a.filter_params.state_id&&d.is(":checked")&&a.updateSelectionMenuActionItemsByStates(a.filter_params.state_id);d.click(function(){b(this).trigger("select",
this.checked)});b(window).one("wa_before_dispatched",function(k){a.$selectionMenu.hide()});a.xhrs.printforms=null;var f=function(k){k=tmpl("template-order-list-printforms-menu-items",k);var p=a.$selectionMenu.find(".wf-actions");p.find(".s-printform-item,.s-printform-item-sep,.s-printform-item-button").remove();p.append(k)};b(document).keydown(function(k){16!=k.keyCode||b(k.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(k){16==k.keyCode&&
(document.body.onselectstart=null)});var g=function(){var k=b("#order-list"),p=d.attr("checked");k=k.find(".order.selected:first").length;p||k?(a.$selectionMenu.show(),k=null,k=p?a.options.all_order_state_ids?a.options.all_order_state_ids:a.filter_params&&a.filter_params.state_id?a.filter_params.state_id:null:a.container.find(".order.selected").map(function(){return b(this).data("stateId")}).toArray(),null!==k?(k=b.shop.getUniqueValues(k),a.updateSelectionMenuActionItemsByStates(k)):a.enableAllSelectionMenuActionItems()):
a.$selectionMenu.hide()};c.off("select",".order").on("select",".order",function(k,p){(void 0!==p?p:1)?b(this).addClass("selected").find("input:first").attr("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",!1),d.is(":checked")&&d.attr("checked",!1));g();return!1});var n=function(){a.xhrs.printforms&&a.xhrs.printforms.abort();f({printforms:[]});a.xhrs.printforms=null;d.is(":checked")&&null!==b.order_list.all_printforms?f({printforms:b.order_list.all_printforms}):a.xhrs.printforms=
b.shop.getJSON("?module=orders&action=printforms",a.getSelectedOrders(),function(k){b.isEmptyObject(k.data.printforms)||(d.is(":checked")&&(b.order_list.all_printforms=k.data.printforms),f(k.data),a.xhrs.printforms=null)})};d.unbind("select").bind("select",function(k,p){p=void 0!==p?p:!0;k=b(this);p?(k.attr("checked",!0),c.find(".order").trigger("select",!0,!1)):(k.attr("checked",!1),c.find(".order").trigger("select",!1,!1));n()});c.off("click",".order input").on("click",".order input",function(k){var p=
k.shiftKey;k=this.checked;var r=b(this).parents(".order:first");k?r.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),r.removeClass("selected"));if(p&&k){(p=c.data("last_checked"))||(p=c.find(".order:first").trigger("select",!0));var w=r.prevAll(".selected[data-order-id="+p.attr("data-order-id")+"]");if(w.length){var x=r.prev();for(p=p.get(0);x.length&&p!=x.get(0);)x.addClass("selected").find("input").attr("checked",!0),x=x.prev()}else if(w=r.nextAll(".selected[data-order-id="+p.attr("data-order-id")+
"]"),w.length)for(x=r.next(),p=p.get(0);x.length&&p!=x.get(0);)x.addClass("selected").find("input").attr("checked",!0),x=x.next();c.data("last_checked")||w.length||p.trigger("selected",!1)}k&&c.data("last_checked",r);g();n()});var h=function(k,p){if(100<p.count)alert($_("Maximum of %d orders is allowed for bulk form printing.").replace("%d",100));else{var r="?module=orders&action=printformsDisplay";p=b.map(p.serialized,function(w){return w.name+"="+w.value}).join("&");k=b.map(k,function(w){return"form[]="+
w}).join("&");r+="&"+p+"&"+k;k=(""+Math.random()).slice(2);window.open(r,k)}};a.$selectionMenu.off("click.printforms").on("click.printforms",".s-printform-item-button",function(k){k.preventDefault();a.xhrs.printforms&&a.xhrs.printforms.abort();a.xhrs.printforms=null;k=a.$selectionMenu.find(".s-printform-item :checkbox").map(function(){var r=b(this);return r.is(":checked")?r.data("id"):!1}).toArray();if(k.length){var p=a.getSelectedOrders(!0);if(!(0>=p.count))return h(k,p),!1}})},updateTitle:function(a,
c){c=parseInt(c,10)||0;var d="";this.options.state_names&&(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?d=this.options.state_names[this.filter_params.state_id]:b.isArray(this.filter_params.state_id)&&(d=$_("Processing")):d=$_("All orders"));document.title=c?"("+c+") "+d+(a||""):d+a},updateCounters:function(a){var c=this.sidebar;c||(c=b("#s-sidebar"));var d=b("#s-pending-orders .small"),f;for(f in a)if(a.hasOwnProperty(f)){var g=a[f],n;for(n in g)if(g.hasOwnProperty(n)){var h=
"common_counters"==f?b("#s-"+n+"-orders .count"):"storefront_counters"===f?c.find("li[data-"+f.replace("_counters","")+'="'+n+'"] .count'):c.find("li[data-"+f.replace("_counters","")+"-id="+n+"] .count");var k=parseInt(h.text(),10)||0;g[n]=""+g[n];"+"==g[n].substr(0,1)?k+=parseInt(g[n].substr(1),10)||0:"-"==g[n].substr(0,1)?(k-=parseInt(g[n].substr(1),10)||0,k=0>k?0:k):k=parseInt(g[n],10)||0;h.text(k);"new"==n&&(d.text(k?"+"+k:""),b.shop.updateAppCounter(k),this.updateTitle(this.options.title_suffix,
parseInt(k,10)))}}},updateListItems:function(a){var c="template-order-list-"+this.options.view;if(document.getElementById(c)){var d=this.container;b.isArray(a)||(a=[a]);c=b("<div></div>").append(tmpl(c,{orders:a,check_all:"table"==this.options.view?this.select_all_input.attr("checked"):!1}));var f=b(".order",d);b(".order",c).each(function(){var g=b(this);f.filter("[data-order-id="+g.attr("data-order-id")+"]").replaceWith(g)});c.remove();this.container.trigger("append_order_list",[a])}},hideListItems:function(a){var c=
b.Deferred();setTimeout(function(){if(b.order_list&&b.order_list.container&&b.order_list.container.length){if(b.isArray(a)){var d=b.order_list.container.find(".order");n=b();for(var f=0;f<a.length;f++){var g=d.filter("[data-order-id="+a[f]+"]");n=n.add(g)}}else var n=b.order_list.container.find(".order[data-order-id="+a+"]");var h=n.length,k=0;n.slideUp(450,function(){k++;k>=h&&c.resolve()})}},1E3);return c.promise()},dispatch:function(a,c){"string"===typeof a&&(a=b.shop.helper.parseParams(a));var d=
{list:function(){b.order_list.finit();b.orders.load("?module=orders&"+b.orders.buildOrdersUrlComponent(a),function(){b.order_list.dispatch(a)})},order:function(){b.order_list.loadOrder(a.id)}};null===this.params?(this.params=a,c&&d.list()):a.id&&(c||a.id!=this.params.id)?(d.order(),this.params=a):(c||this.diff(a,this.params)||this.diff(this.params,a))&&d.list()},diff:function(a,c){for(var d in a)if(a.hasOwnProperty(d)&&"id"!=d&&a[d]!==c[d])return!0;return!1},buildLoadListUrl:function(a,c,d){return"?module=orders&action=loadList&id="+
a+(this.filter_params_str?"&"+this.filter_params_str:"")+(c?"&lt=1":"")+(d?"&counters=1":"")+(this.options.view?"&view="+this.options.view:"")+("&sort[0]="+this.sort[0]+"&sort[1]="+this.sort[1])},updateProcess:function(a,c){a=a||"run";c=c||{};timeout=c.timeout||6E4;var d=this,f=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};f();if("run"==a){var g=function(h,k){var p=d.container.find(".order:first");
p=parseInt(p.attr("data-order-id"),10)||0;return b.getJSON(d.buildLoadListUrl(p,!0,!0),function(r){if("ok"==r.status){b.isEmptyObject(r.data.counters)||d.updateCounters(r.data.counters);if(r.data.count)try{d.container.prepend(tmpl("template-order-list-"+d.options.view,{orders:r.data.orders,check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),b(".lazyloading-progress-string").text(r.data.progress.loaded+" "+r.data.progress.of),d.container.trigger("append_order_list",[r.data.orders])}catch(w){console&&
(console.log("Error: "+w.message),k());return}"function"===typeof h&&h(r)}else console&&console.log("Error when loading new orders: "+r.errors),"function"===typeof k&&k()}).error(function(r){console&&(r&&r.errors?console.log("Error when loading new orders: "+r.errors):console.log(["Error when loading new orders",r]));"function"===typeof k&&k()})},n=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=g(n,f):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=g(n,
f)})},timeout)};n()}},finit:function(a){a=this.xhrs;var c=this.lazy_load_win,d;for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&a[d].abort();this.updateProcess("kill");c&&c.lazyLoad("stop");this.params=null}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_form:null,$storefront_selector:null,stocks:[],slide_on:!1,options:{},locales:{},init:function(b){this.options=b;b.id&&(this.id=b.id);this.container="string"===typeof b.container?$(b.container):b.container;this.form="string"===typeof b.form?$(b.form):b.form;this.$storefront_selector=$("#order-storefront");b.stocks.sort(function(a,c){return a.sort-c.sort});this.stocks=b.stocks;b.title&&(document.title=title);b.float_delimeter||(b.float_delimeter=
".");b.locales&&(this.locales=b.locales);this.float_delimeter=b.float_delimeter;this.prev_ship_method=null;this.container.trigger("order_edit_init");this.initView();this.initShippingControl();this.initDiscountControl();this.initCouponControl();this.initCustomerSourceControl(b.customer_sources)},initCustomerForm:function(b){this.customer_form=new ShopBackendOrderEditorCustomerForm($("#s-order-edit-customer"),this,b)},initView:function(){var b=this,a=b.options;this.initStorefrontSelector();var c=function(h){var k=
h.find(".s-orders-sku-stock-select").find("option:selected"),p=h.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");h.find(".s-orders-stock-icon-aggregate").show();h.find(".s-orders-stock-icon").html("").hide();p=p.length?p:h;k.attr("data-icon")&&(p.find(".s-orders-stock-icon-aggregate").hide(),p.find(".s-orders-stock-icon").html(k.attr("data-icon")).show(),h.find(".s-orders-stock-icon .s-stock-left-text").show(),p.find(".s-orders-stock-icon .s-stock-left-text").hide())};
$.order_edit.slide(!0,"add"==a.mode);this.container.find(".back").click(function(){$.order_edit.id?$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.getOrderItems(this.container,!0);$(".s-order-item").each(function(){var h=$(this);c(h)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());$.order_edit.options.currency=$(this).val()});var d=a.price_edit||!1,f=$("#orders-add-autocomplete");f.autocomplete({source:"?action=autocomplete&with_counts=1",
minLength:3,delay:300,select:function(h,k){$(".s-order-errors").empty();h="?module=orders&action=getProduct&product_id="+k.item.id+"&order_id="+$.order_edit.id+"&currency="+$.order_edit.options.currency;(k=b.getStorefront())&&(h+="&storefront="+k);$.getJSON(h,function(p){var r=$("#order-items");r=parseInt(r.find(".s-order-item:last").attr("data-index"),10)+1||0;var w=p.data.product;w.sku_id&&w.skus[w.sku_id]&&(w.skus[w.sku_id].checked=!0);$("#order-currency").length&&!$("#order-currency").attr("disabled")&&
($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled","disabled"));w=$("#s-orders-add-row");w.before(tmpl("template-order",{data:p.data,options:{index:r,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:d}}));p=w.prev();$("#s-order-comment-edit").show();$.order_edit.updateTotal();c(p)});f.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",
".s-orders-skus input[type=radio]",function(){var h=$(this),k=h.parents("tr:first"),p=h.closest("li"),r=this.value,w=k.attr("data-product-id"),x=k.attr("data-index"),u=null;"edit"==($.order_edit.id?"edit":"add")&&(u=parseInt(h.attr("name").replace("sku[edit][",""),10));h="?module=orders&action=getProduct&product_id="+w+"&sku_id="+r+"&currency="+$.order_edit.options.currency;(r=b.getStorefront())&&(h+="&storefront="+r);$.getJSON(h,function(v){var z=-1!==k.find("input:first").attr("name").indexOf("add")?
"add":"edit";k.find(".s-orders-services").replaceWith(tmpl("template-order-services-"+z,{services:v.data.sku.services,service_ids:v.data.service_ids,product_id:w,options:{price_edit:d,index:x,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks}}));k.find(".s-orders-product-price").find("input").val(v.data.sku.price);k.find(".s-orders-sku-stock-place").empty();p.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+z,{sku:v.data.sku,index:x,stocks:$.order_edit.stocks,item_id:u}));
c(k);$.order_edit.updateTotal()})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var h=$(this).parents("tr.s-order-item:first");c(h)});var g=function(h,k,p){var r=h.attr("data-price");h=h.attr("data-percent-price");p&&k.val(r);k.attr("data-price",r);k.attr("data-percent-price",h)};this.container.off("change",".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var h=$(this),k=h.find("option:selected");h=h.parents("li:first");
g(k,h.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var h=$(this),k=h.find("option:selected");h=h.parents("li:first");g(k,h.find(".s-orders-service-price"),!1)});this.container.off("click",".s-order-item-delete").on("click",".s-order-item-delete",function(){$(this).parents("tr:first").remove();$("table#order-items").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});this.container.off("change",
".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",".s-orders-product-price input",function(){var h=$(this).parents("tr:first");$.order_edit.updateServicePriceInPercent(h);$.order_edit.updateTotal()});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);$("#payment_methods").change(function(){var h=
$(this).val();$("#payment-info > div").hide();$.order_edit.updateTotal();$("#payment-custom-"+h).length&&$("#payment-custom-"+h).show()});this.container.off("keydown",".s-orders-quantity").on("keydown",".s-orders-quantity",function(){var h=$(this),k=h.data("timer_id");k&&clearTimeout(k);h.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},450))});if(this.form&&this.form.length){var n=function(){var h=$(this);if(n.xhr)return!1;$.order_edit.showValidateErrors();$('.s-orders-services input[name^="service"][type="checkbox"]:not(:checked),.s-orders-services input.js-fake-service-selected[type="checkbox"]:not(:checked)',
this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",!0)});if(!$.order_edit.container.find(".error").length){$.order_edit.switchSubmitButton("disable");var k=function(){n.xhr=null;$.order_edit.switchSubmitButton();$(".s-orders-services input:disabled",h).attr("disabled",!1)};n.xhr=$.order_edit.id?$.order_edit.saveSubmit(k,"edit"):$.order_edit.saveSubmit(k,"add")}return!1};this.form.unbind("sumbit").bind("submit",n)}$("#subtotal").text(this.roundFloat($("#subtotal").text()));
$("#total").text(this.roundFloat($("#total").text()));$("#discount").val(this.roundFloat($("#discount").val()));$("#tax").text(this.roundFloat($("#tax").text()));this.container.trigger("order_edit_init_view")},initShippingControl:function(){var b=this;b.prev_ship_method=$("#shipping_methods").val();$("#shipping-custom").on("change",":input",function(a){$.shop.trace("#shipping-custom change",[a,this]);a.originalEvent&&$(this).data("affects-rate")&&$.order_edit.updateTotal()});b.setShippingInfo();$("#shipping_methods").change(function(){var a=
$("#shipping_methods option:selected"),c=a.data("rate")||0,d=$("#shipping-rate");d.data("shipping")&&a.val()==b.prev_ship_method||(d.val($.order_edit.formatFloat(c)),d.data("shipping",!1),b.prev_ship_method=a.val());b.setShippingInfo();$.order_edit.updateTotal()});$("#shipping-rate").change(function(){var a=$(this);if(0>a.val())return alert($.order_edit.locales.wrong_cost),a.val(0),!1;$("#shipping-rate").data("shipping",$(this).val());$.order_edit.updateTotal()});this.container.trigger("order_edit_init_shipping")},
initDiscountControl:function(){function b(){0<$.order_edit.parseFloat(a.val())?g.stop().show():g.stop().hide();var h=25;g.is(":visible")&&g.finish().fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+50)}var a=$("#discount"),c=$("#discount-description"),d=$("#update-discount"),f=$("#edit-discount"),g=$("#discount-tooltip-icon");g.tooltip({showURL:!1,bodyHandler:function(){return c.val()||c.data("updated-manually-msg")}});d.tooltip({showURL:!1,
bodyHandler:function(){return d.data("description")||c.data("updated-manually-msg")}});f.length?g.show():g.hide();$("#order-edit-form").on("order_total_updated",function(h,k){a.show();a.parent().find("span.js-order-discount:first").hide();f.hide();d.data("description",k.discount_description);if(k.discount){d.data("value",k.discount).data("description",k.discount_description).data("items_discount",k.items_discount);if("calculate"===d.data("discount")){c.val(d.data("description"));h=d.data("items_discount")||
[];for(var p=0;p<h.length;p++)if(h[p]){var r="#order-items span.js-item-total-discount";r+='[data-discount-id="'+h[p].selector+'"]';r=$(r);r.length&&r.html(h[p].html).show()}b()}"calculate"===d.data("discount")?$.order_edit.parseFloat(k.discount)!==$.order_edit.parseFloat(a.val())&&d.click():d.show()}});var n=function(){a.show();a.parent().find("span.js-order-discount:first").hide();f.hide();$(".js-item-total-discount").hide()};f.click(function(){n();c.val("");return!1});d.click(function(){n();a.val(d.data("value")||
0).change();c.val(d.data("description"));a.attr("title",c.data("edit-manually-msg"));d.hide().data("discount","calculate");$.order_edit.updateTotal();b();return!1});a.on("change",function(){f.click();c.val("");$("#order-items .js-item-total-discount").hide();a.attr("title",null);d.show().data("discount",$(this).val());$.order_edit.updateTotal();b()});this.container.trigger("order_edit_init_discount")},initCouponControl:function(){function b(){r.show();r.css("padding-right",$(".coupon-controls").width()+
4+"px")}var a=$("#coupon_id"),c=$("#coupon-code"),d=$(".coupon-code-label"),f=$(".js-no-coupon-text"),g=$(".js-coupon-icon"),n=$(".js-edit-coupon"),h=$(".js-close-coupon"),k=$(".js-delete-coupon"),p=$("#update-discount"),r=$("#js-coupon-invalid-msg");n.click(function(){$(this).add(f).add(g).add(d).hide();c.data("value",c.val());c.val("").show();h.show()});h.click(function(){c.val(c.data("value"));n.show();""===a.val()?f.show():g.add(d).show();$(this).add(c).add(r).hide()});k.click(function(){$(this).add(c).add(g).add(d).add(n).add(h).add(r).hide();
a.val("");p.click();f.add(n).show()});$(".disabled-link").click(function(w){w.preventDefault()});c.autocomplete({source:function(w,x){$.ajax({type:"POST",url:"?module=marketing&action=CouponsAutocomplete",data:{term:c.val(),products:$('input[name^="product["]').serializeArray()},success:function(u){x(u);u.length?r.hide():b()},error:function(){x([])}})},minLength:1,delay:300,select:function(w,x){x.item.data.valid?(c.val(x.item.label).hide(),a.val(x.item.value),d.html(x.item.label).show(),n.add(g).add(k).show(),
x.item.data.right?($(".s-order-edit-coupon").attr("href",$(".s-order-edit-coupon").data("href")+x.item.value),0!=x.item.value.length&&(p.click(),$(".s-order-edit-coupon").removeClass("disabled-link"))):0!=x.item.value.length&&p.click(),h.hide()):(c.val(x.item.label),b());return!1}})},initCustomerSourceControl:function(b){var a=$("#customer-source");a.autocomplete({delay:0,minLength:0,appendTo:"#order-edit-form",source:function(c,d){var f=b.filter(function(g){return g&&g.indexOf&&0<=g.indexOf(c.term)}).slice(0,
10);1==f.length&&f[0]==c.term?d([]):d(f)}}).on("focus",function(){a.autocomplete("search")})},initUpdateServicePrice:function(){this.container.find(".s-order-item").each(function(){$.order_edit.updateServicePriceInPercent($(this))})},updateServicePriceInPercent:function(b){var a=b.find(".js-order-edit-item-price").val();if("undefined"===typeof a)return null;b.find('[data-currency="%"]').each(function(){var c=$(this),d=a*(c.data("percentPrice")/100);d=$.order_edit.roundFloat(d);c.val($.order_edit.formatFloat(d));
c.attr("data-price",d)})},setShippingInfo:function(){var b=$("#shipping_methods"),a=b.children(":selected"),c=$("#shipping-rate"),d=$("#shipping-info"),f=b.val(),g=b.data("_shipping_id"),n=$.order_edit.checkSelectedAddressFields(),h=[];a.length?(a.data("error")&&!n&&h.push('<span class="error">'+a.data("error")+"</span>"),a.data("est_delivery")&&h.push('<span class="hint est_delivery">'+a.data("est_delivery")+"</span>"),$("#shipping-custom > div").hide(),null!==f&&(f=(""+f).replace(/\..+$/,""),$("#shipping-custom-"+
f).length&&$("#shipping-custom-"+f).show()),a.data("comment")&&h.push('<span class="hint">'+a.data("comment")+"</span>"),h?(a.data("error")&&!n?(c.addClass("error"),b.addClass("error")):(c.removeClass("error"),b.removeClass("error")),d.html(h.join("<br>")).show()):(c.removeClass("error"),d.empty().hide())):b.addClass("error");$.shop.trace("check shipping_methods id",[g,f,a])},checkSelectedAddressFields:function(){var b=$('[name="customer[address.shipping][city]"]'),a=$('[name="customer[address.shipping][region]"]');
b=[{exists:0<b.length,selected:""!=b.val()},{exists:0<a.length,selected:""!=a.val()}];var c=a=0,d;for(d in b){var f=b[d];f.exists&&a++;f.exists&&f.selected&&c++}return a==c},getOrderItems:function(b){var a=[],c=[];b.find(".s-order-item").each(function(){var d=$(this),f=d.find('input[name^="product"]').val(),g=[],n=$.order_edit.parseFloat(d.find(".s-orders-product-price input").val()),h=$.order_edit.parseFloat(d.find("input.s-orders-quantity").val()),k=d.find("select.s-orders-sku-stock-select").val(),
p=d.data("item-id"),r=d.find("input[name^=sku]:not(:radio)").add(d.find("input[name^=sku]:checked")).first().val()||0,w={product_id:f,sku_id:r,services:[]};d.find(".s-orders-services").length&&d.find(".s-orders-services input:checkbox:checked").each(function(){var x=$(this).closest("li"),u=$.order_edit.parseFloat(x.find("input.s-orders-service-price").val()),v=$(this).val();x=x.find(':input[name^="variant["]').val();g.push({id:v,price:u,variant_id:x});w.services.push(v)});w.services.sort();w.services=
w.services.join("_");a.push({id:p,product_id:f,quantity:h,price:n,sku_id:r,services:g,stock_id:k});c.push(w)});c=this.reduceOrderContent(c);b.data("order-content",c);return a},reduceOrderContent:function(b){b.sort(function(a,c){var d=a.product_id-c.product_id;0===d&&(d=a.sku_id-c.sku_id);0===d&&(d=a.services.localeCompare(c.services));return d});return b.map(function(a){return"*"+a.product_id+":"+a.sku_id+":"+a.services}).join(";")},updateTotal:function(){function b(){a=null;$.order_edit.realUpdateTotal()}
var a=null;return function(){a?(clearTimeout(a),a=setTimeout(b,250)):a=setTimeout(b,500)}}(),realUpdateTotal:function(){var b=$.order_edit.container,a=$("#subtotal"),c=$("#total"),d=$("#tax");if(b.find(".s-order-item").length){var f=this;$.order_edit.switchSubmitButton("disable");$.order_edit.showValidateErrors();for(var g={},n=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),h=0;h<n.length;h++)g[n[h].name]=n[h].value;g.storefront=f.getStorefront();g.items=$.order_edit.getOrderItems(b);
var k=$("#update-discount").data("discount");void 0!==k&&("calculate"!==k&&(k=$.order_edit.parseFloat(k)),g.discount=k);$.order_edit.id?g.order_id=$.order_edit.id:g.currency=$("#order-edit-form input[name=currency]").val();b=$("#shipping_methods").val();n=$("#payment_methods").val();h=$("#coupon_id").val();$("#shipping-rate").data("shipping")&&(g.shipping=$("#shipping-rate").data("shipping"));g.params={shipping_id:b,coupon_id:h,payment_id:n};g["customer[id]"]=g.contact_id=$("#s-customer-id").val();
g.tax="calculate";b&&(b=parseInt(b.split(".")[0]),0<b&&$("#shipping-custom").find(">#shipping-custom-"+b+" :input").each(function(){g[this.name]=this.value}));$.ajax({type:"POST",url:"?module=order&action=total",data:g,success:function(p){if(p&&"ok"===p.status){var r=$("#shipping-rate"),w=$("#shipping_methods"),x=$.trim(w.val())||"",u=x.replace(/\W.+$/,"");p.data&&(p.data=$.order_edit.parseTotalResponse(p.data));w.empty();w.prepend('<option value=""></option>');if(0<p.data.shipping_method_ids.length){var v=
$("#shipping-custom");v.empty();var z=p.data.shipping_method_ids,H=p.data.shipping_methods,F=!1,E=!1;-1!==z.indexOf(x)&&(F=!0);F||-1===z.indexOf(Number(u))||(E=F=!0);v.find(">div.fields.form").hide();for(var B=0;B<z.length;B+=1){var D=""+z[B],y=H[D],C=D.replace(/\W.+$/,""),e=$("<option></option>");e.html(y.name).attr("value",D).data("rate",y.rate);e.data("error",y.error||void 0);e.data("est_delivery",y.est_delivery||void 0);e.data("comment",y.comment||void 0);e.data("external",y.external||!1);w.append(e);
x||0!==B||$("#shipping-rate").val($.order_edit.formatFloat(y.rate));if(u==C){if(y.custom_data)for(var l in y.custom_data)y.custom_data.hasOwnProperty(l)&&e.data(l,y.custom_data[l]);y.custom_html&&(e=v.find("#shipping-custom-"+C),e.length||(v.append('<div id="shipping-custom-'+C+'" class="fields form"></div>'),e=v.find("#shipping-custom-"+C)),e.html(y.custom_html))}if(!F&&(y=(""+D).split("."),C=x.split("."),""!==C[0]&&void 0!==y[0]&&void 0!==C[0]&&y[0]==C[0])){x=D;w.val(x);$.order_edit.setShippingInfo();
$.order_edit.realUpdateTotal();return}}w.val(x);E&&w.val(u);w.data("_shipping_id",u);$.shop.trace("set shipping_methods id",[u,x])}""!=k&&$("#discount").val(p.data.discount);r.val(p.data.shipping);$("#order-edit-form").trigger("order_total_updated",p.data);a.text(p.data.subtotal);c.text(p.data.total);d.text(p.data.tax);$.order_edit.showValidateErrors(p.data.errors);f.setShippingInfo()}$.order_edit.switchSubmitButton()},dataType:"json"})}else a.text(0),c.text(0),$.order_edit.checkSelectedAddressFields()&&
($("#shipping_methods, #shipping-rate").removeClass("error"),$("#shipping-info").empty().hide())},saveSubmit:function(b,a){var c=this.form,d=c.serializeArray();"calculate"===$("#update-discount").data("discount")?$(d).each(function(){"discount"==this.name&&(this.value="calculate")}):void 0===$("#update-discount").data("discount")&&(d=d.filter(function(f){return"discount"!==f.name}),0<$("#discount").val()?d.discount_description=$("#edit-discount").val():d=d.filter(function(f){return"discount_description"!==
f.name}));success="add"==a?function(f){$.order_edit.container.trigger("order_edit_save_success",{data:f.data,is_new:!0});!$.order_edit.options.embedded_version&&$.order_edit.slide(!1,!0)&&(location.href="#/orders/state_id=new&view=split&id="+f.data.order.id+"/")}:function(f){$.order_edit.container.trigger("order_edit_save_success",{data:f.data,is_new:!1});$.order_edit.options.embedded_version||$.order_edit.container.find(".back").click()};this.container.trigger("order_edit_save",d);return $.shop.jsonPost(c.attr("action"),
d,success,function(f){$.shop.trace(a,f);f&&f.errors&&!$.isEmptyObject(f.errors)&&$.order_edit.showValidateErrors(f.errors)},b)},parseTotalResponse:function(b){["total","discount","shipping","tax","subtotal"].forEach(function(a){if("number"===typeof b[a]||"string"===typeof b[a])b[a]=$.order_edit.roundFloat(parseFloat((+b[a]).toFixed(2)))});return b},roundFloat:function(b){return b?this.formatFloat(Math.round(100*b)/100):0},formatFloat:function(b){return","===this.float_delimeter?(""+b).replace(".",
","):""+b},parseFloat:function(b){return b?parseFloat((""+b).replace(",",".")):0},slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(b,a,c){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{b="undefined"===typeof b?!0:b;a="undefined"===typeof a?!1:a;var d=this.options.duration||200,f=this.options.view,g=[];return!this.slide_on&&b?(g.push($("#s-sidebar").animate({width:0},d,function(){$(this).hide()})),$(".s-level2").hide(),g.push($("#maincontent").animate({"margin-top":45},
d)),g.push($("#s-content").animate({"margin-left":0},d)),g.push($("#s-orders").animate({width:0},d,function(){$(this).hide()})),g.push($("#s-order").animate({"margin-left":0},d).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(g).done(function(){$.order_list&&$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");
"function"===typeof c&&c.call(this)}),!0):this.slide_on&&!b?(g.push($("#s-order").animate({"margin-left":"table"==f||a?200:300},d).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),g.push($("#s-orders").animate({width:300},d).show()),g.push($("#s-content").animate({"margin-left":200},d)),g.push($("#maincontent").animate({"margin-top":84},d)),$(".s-level2").show(),g.push($("#s-sidebar").animate({width:200},d).show()),
this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),$.when(g).done(function(){$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof c&&c.call(this)}),!0):!1}},switchSubmitButton:function(b){var a=this.form,c=$(a).find(".s-order-items-edit td.save i.loading");a=$(a).find("[type=submit]");"disable"===b?(c.css("display","inline-block"),a.attr("disabled",!0)):(c.css("display","none"),a.attr("disabled",!1))},showValidateErrors:function(b){var a=
[];$.shop.trace("showValidateErrors",b);$("#shipping-info").find(".error").empty();$(".error").removeClass("error");$("#s-order-edit-customer .errormsg").empty();this.customer_form&&this.customer_form.showValidateErrors(b?b.customer:{});$(".s-order-errors").empty();if(b&&b.order){if(!$.isEmptyObject(b.order.items))for(var c in b.order.items){var d=$(".s-order-item[data-index="+c+"]"),f=b.order.items[c],g;for(g in f){var n=d.find(".s-error-item-"+g);n.length?n.text(f[g]):a.push(f[g])}delete b.order.items[c]}if(!$.isEmptyObject(b.order.product)){var h=
b.order.product,k;for(k in h)h.hasOwnProperty(k)&&"quantity"in h[k]&&$(".s-order-item[data-product-id="+k+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=""+h[k].sku_id&&$(this).find("ul.s-orders-skus").length||($(this).find(".s-orders-quantity").addClass("error"),a.push(h[k].quantity))})}b.order.common&&a.push(b.order.common);b.order.discount&&($("#discount").addClass("error"),a.push(b.order.discount));a.length&&$(".s-order-errors").html(a.join("<br>"))}},getSelectedStorefront:function(b){var a=
this.$storefront_selector,c=$.trim(a.val());return b?{storefront:c,data:a.find(":selected").data()}:c},getStorefrontSelector:function(){return this.$storefront_selector},getStorefront:function(){return this.getStorefrontSelector().val()},initStorefrontSelector:function(){var b=this;b.$storefront_selector.on("change",function(){b.customer_form&&b.customer_form.isEnabled()&&b.customer_form.reloadForm()})},filterStorefrontSelector:function(b){var a=this.$storefront_selector;a.find("option").each(function(){var c=
$(this),d=c.val(),f=c.data();c.show();!f.orderStorefront&&d&&b&&!f[b]&&(c.hide(),c.is(":selected")&&a.val(""))})},getPercentSymbol:function(){return"%"}};var ShopBackendCustomerForm=function(b){ShopBackendCustomerForm=function(a,c){this.options=c||{};this.$wrapper=a;this.dom_ns=this.$wrapper.attr("id");this.namespace=c.namespace||null;this.locales=c.locales;this.fields_config=c.fields_config||{};this.$wrapper.data("ShopBackendCustomerForm",this);b.contains(document,this.$wrapper.get(0))&&this.activate()};ShopBackendCustomerForm.prototype.activate=function(){this.$wrapper.off("."+this.dom_ns);this.initConfirmedCheckboxes();this.initContactTypeSelector();
this.initShippingAddress();this.initBillingAddress();this.initAdditionalAddressSubfields();this.fixStyles()};ShopBackendCustomerForm.prototype.deactivate=function(){this.$wrapper.off("."+this.dom_ns);this.unbindAll()};ShopBackendCustomerForm.prototype.getOptions=function(){return this.options||{}};ShopBackendCustomerForm.prototype.setOptions=function(a){this.options=a||{}};ShopBackendCustomerForm.prototype.getContact=function(a){var c=this.options.contact||{};return a?b.extend({},c,!0):c};ShopBackendCustomerForm.prototype.initConfirmedCheckboxes=
function(){var a=this.$wrapper,c=a.find(".field-email:eq(0)"),d=a.find(".field-phone:eq(0)"),f=a.find(".s-customer-email-confirmed-control");a=a.find(".s-customer-phone-confirmed-control");c.find(".value").children().first().after(f);d.find(".value").children().first().after(a)};ShopBackendCustomerForm.prototype.initContactTypeSelector=function(){var a=this;a.$wrapper.on("click."+a.dom_ns,".s-order-form-contact-type-selector-wrapper :radio",function(){var c=b(this),d=a.$wrapper.find(".s-order-form-contact-type-selector-wrapper .loading");
c=b.trim(c.val());d.show();a.reloadForm({type:c},{afterReload:function(){d.hide()}})})};ShopBackendCustomerForm.prototype.initAdditionalAddressSubfields=function(){var a=this.fields_config,c=this.$wrapper,d=function(){return".s-customer-more-address-subfields-control"},f=function(){return".s-address-block"};c.find(f()).each(function(){var g=b(this),n=g.closest(".field-address"),h="";n.hasClass("field-address-shipping")?h="shipping":n.hasClass("field-address-billing")&&(h="billing");if(h){var k=g.find(".field").hide(),
p=b(),r=0;b.each(a["address."+h].fields||{},function(w){p=k.filter(".field-address-"+w).show();r++});r!=k.length&&p.after(c.find(d()).first().clone())}});c.on("click",d(),function(){var g=b(this);g.siblings(f()).length?g.siblings(".field, input").appendTo(g.siblings(f())).show():g.closest(f()).find(".field").show();g.remove()})};ShopBackendCustomerForm.prototype.initShippingAddress=function(){var a=this,c=a.$wrapper,d=function(){return c.find(".field-address-shipping").find(".value").children()},
f=function(){return".s-customer-more-shipping-addresses-control"};d().each(function(h){var k=b(this);h=0<h?a.locales.extra_shipping_address:a.locales.main_shipping_address;h=b("<span />").addClass("s-block-header bold").text(h);k.addClass("s-address-block").prepend(h)});var g=1<d().length,n=0<d().not(":first").find(".errormsg,.error").length;g&&!n&&(d().not(":first").hide(),d().first().after(c.find(f())));c.on("click",f()+" .js-toggle-button",function(h){h.preventDefault();d().not(":first").show();
c.find(f()).hide()})};ShopBackendCustomerForm.prototype.initBillingAddress=function(){var a=this,c=a.$wrapper,d=function(){return c.find(".field-address-billing").find(".value").children()},f=function(){return".s-customer-more-billing-addresses-control"};d().each(function(h){var k=b(this);h=0<h?a.locales.extra_billing_address:a.locales.main_billing_address;h=b("<span />").addClass("s-block-header bold").text(h);k.addClass("s-address-block").prepend(h)});var g=1<d().length,n=0<d().not(":first").find(".errormsg,.error").length;
g&&!n&&(d().not(":first").hide(),d().first().after(c.find(f())));c.on("click",f()+" .js-toggle-button",function(h){h.preventDefault();d().not(":first").show();c.find(f()).hide()})};ShopBackendCustomerForm.prototype.fixStyles=function(){this.$wrapper.find('.field-birthday input[name="'+this.namespace+'[birthday][year]"]').css({width:"",minWidth:""})};ShopBackendCustomerForm.prototype.updateInnerHtml=function(a){var c=this.$wrapper;a=b("<div>").hide().appendTo("body").html(a);var d=a.find(".s-customer-form-wrapper");
d=ShopBackendCustomerForm.getInstance(d);this.setOptions(d.getOptions());c.html(a.children(0).html());a.remove()};ShopBackendCustomerForm.prototype.reloadForm=function(a,c){var d=this,f=d.$wrapper;c=c||{};var g=b.extend({},a||{});g.type||(g.type=d.getContact().type);var n=f.find(".loading").show();c.beforeReload&&c.beforeReload(g);f.trigger("beforeReload",[g]);if(!a["new"]){a=f.find(":input:not(:disabled)").serializeArray();var h=["shipping","billing"];b.each(a,function(k,p){if(p.name.indexOf(d.namespace)){k=
$jscomp.makeIterator(h);for(var r=k.next();!r.done;r=k.next()){r=r.value;var w=b('[name="'+d.namespace+"[address."+r+'][region]"]');0<w.length&&""!=w.data("country")&&(g[d.namespace+"[address."+r+"][data][country]"]=w.data("country"))}}g[p.name]=p.value})}b.post("?action=customerForm",g,function(k){d.updateInnerHtml(k);n.hide();k=d.getContact(!0);c.afterReload&&c.afterReload(k);f.trigger("afterReload",[k])})};ShopBackendCustomerForm.prototype.bind=function(a,c){this.$wrapper.on(a+".custom"+this.dom_ns,
c)};ShopBackendCustomerForm.prototype.unbindAll=function(){this.$wrapper.off(event+".custom"+this.dom_ns)};ShopBackendCustomerForm.getInstance=function(a){return a.data("ShopBackendCustomerForm")instanceof ShopBackendCustomerForm?a.data("ShopBackendCustomerForm"):null};return ShopBackendCustomerForm}(jQuery);var ShopBackendOrderEditorCustomerForm=function(b){ShopBackendOrderEditorCustomerForm=function(a,c,d){this.options=d||{};this.$wrapper=a&&0<a.length?a:b("#s-order-edit-customer");this.editor=c;this.$customer_inputs=this.$wrapper.find(":input");this.initial_values={};this.$customer_form_wrapper=this.$wrapper.find(".s-customer-form-wrapper");(this.customer_form=ShopBackendCustomerForm.getInstance(this.$customer_form_wrapper))||console.error("There is not ShopBackendCustomerForm instance");this.$autocomplete=
b("#customer-autocomplete");this.$customer_id=b("#s-customer-id");this.$new_customer_link=b("#s-order-new-customer");this.contact=d.contact||{};this.init()};ShopBackendOrderEditorCustomerForm.prototype.init=function(){this.initForm();this.rememberInitialValues();this.initAutocomplete()};ShopBackendOrderEditorCustomerForm.prototype.rememberInitialValues=function(){var a=this;a.$customer_inputs.each(function(){var c=b(this),d=c.attr("name"),f=c.val();c.is(":radio")?c.is(":checked")&&(a.initial_values[d]=
f):c.is(":checkbox")?a.initial_values[d]=c.is(":checked"):a.initial_values[d]=f})};ShopBackendOrderEditorCustomerForm.prototype.resetInputValues=function(){var a=this;a.$customer_inputs.each(function(){var c=b(this),d=c.attr("name"),f=c.val();d=a.initial_values[d]||"";c.is(":radio")?f===d&&c.attr("checked","checked"):c.is(":checkbox")?c.is(":checked")?c.attr("checked","checked"):c.attr("checked",""):c.val()})};ShopBackendOrderEditorCustomerForm.prototype.disable=function(a){var c=this.$customer_id,
d=this.$wrapper;a="undefined"===typeof a?!0:a;c.attr("disabled",a);a?d.addClass("s-opaque"):d.removeClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isDisabled=function(){return this.$wrapper.hasClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isEnabled=function(){return!this.isDisabled()};ShopBackendOrderEditorCustomerForm.prototype.activate=function(a){var c=this.$new_customer_link,d=this.$autocomplete;"undefined"===typeof a||a?(this.disable(!1),d.val("").hide(200),
c.hide(200)):(this.disable(),d.val("").show(),c.show())};ShopBackendOrderEditorCustomerForm.prototype.focusFirstEmptyInput=function(){var a=this.$customer_inputs,c=!1;a.filter("input[type=text], textarea").each(function(){var d=b(this);if(d.is(":not(:hidden)")&&!this.value)return c=!0,d.focus(),!1});c||a.first().focus()};ShopBackendOrderEditorCustomerForm.prototype.initAutocomplete=function(){var a=this,c=function(f){var g=a.inputName;var n=parseInt(f,10)||"+"==f.substr(0,1)||-1!==f.indexOf("(");
g="[name="+g.call(a,n?"phone":-1!==f.indexOf("@")?"email":"firstname")+"]";a.$customer_inputs.filter(g).val(f)},d="";a.$autocomplete.autocomplete({source:function(f,g){d=f.term;b.getJSON(a.options.autocomplete_url,f,function(n){(n=n||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});g(n)})},delay:300,minLength:3,select:function(f,g){f=g.item;if(0<f.value)return a.reloadForm({id:f.value,"new":!0}),!1;if(a.editor.getSelectedStorefront())return a.reloadForm({},{afterReload:function(){c(d)}}),
!1;c(d);a.$customer_id.val(0);a.activate();setTimeout(function(){a.focusFirstEmptyInput()},200);return!1},focus:function(f,g){this.value=g.item.name;return!1}})};ShopBackendOrderEditorCustomerForm.prototype.reloadForm=function(a,c){var d=this,f=d.customer_form;c=c||{};d.disable(!0);a=a||{};f.reloadForm(a,{afterReload:function(g){d.$customer_inputs=d.$wrapper.find(":input");d.contact=g||{};d.$customer_id.val(g.id);d.activate();setTimeout(function(){d.focusFirstEmptyInput()},200);d.editor.updateTotal();
c.afterReload&&c.afterReload(g)}})};ShopBackendOrderEditorCustomerForm.prototype.initForm=function(){for(var a=this,c=a.customer_form,d=a.editor,f=a.$wrapper,g=["firstname","middlename","lastname"],n=0,h=g.length;n<h;n+=1)a.$customer_inputs.filter("[name="+a.inputName(g[n])+"]").addClass("s-error-customer-name");f.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>');a.$new_customer_link.on("click",function(){if(0<a.$customer_id.val())return!1;d.filterStorefrontSelector(a.getContact().type);
d.getSelectedStorefront()?a.reloadForm():(a.activate(),a.$customer_inputs.first().focus());return!1});0<a.getContact().id?a.activate():a.activate(!1);f.off("focus",":input").on("focus",":input",function(){a.disable(!1)});c.bind("beforeReload",function(k,p){"undefined"===typeof p.id&&(p.id=a.getContact().id);p.storefront=d.getSelectedStorefront()});c.bind("afterReload",function(k,p){d.filterStorefrontSelector(p.type)});d.filterStorefrontSelector(a.getContact().type);f.on("change",':input[name*="[address.shipping]"]',
function(k){k.originalEvent&&(b.shop.trace("Update total if customer address edit",[this,k]),d.updateTotal())});d.form.submit(function(){a.disable(!1)})};ShopBackendOrderEditorCustomerForm.prototype.showValidateErrors=function(a){a=b.extend({},a||{});if(!b.isEmptyObject(a)){var c=this.customer_form;a=b.trim(a.html);0<a.length&&c.updateInnerHtml(a)}};ShopBackendOrderEditorCustomerForm.prototype.inputName=function(a){return'"customer['+a+']"'};ShopBackendOrderEditorCustomerForm.prototype.getContact=
function(){return this.contact=this.contact||{}};return ShopBackendOrderEditorCustomerForm}(jQuery);
