(function(b){function a(a){return b.data(a,"tooltip")}function c(d){a(this).delay?l=setTimeout(g,a(this).delay):g();p=!!a(this).track;b(document.body).bind("mousemove",e);e(d)}function d(){if(!b.tooltip.blocked&&this!=h&&(this.tooltipText||a(this).bodyHandler)){h=this;r=this.tooltipText;if(a(this).bodyHandler){f.title.hide();var d=a(this).bodyHandler.call(this);d.nodeType||d.jquery?f.body.empty().append(d):f.body.html(d);f.body.show()}else if(a(this).showBody){d=r.split(a(this).showBody);f.title.html(d.shift()).show();
f.body.empty();for(var e=0,g;g=d[e];e++)0<e&&f.body.append("<br/>"),f.body.append(g);f.body.hideWhenEmpty()}else f.title.html(r).show(),f.body.hide();a(this).showURL&&b(this).url()?f.url.html(b(this).url().replace("http://","")).show():f.url.hide();f.parent.addClass(a(this).extraClass);a(this).fixPNG&&f.parent.fixPNG();c.apply(this,arguments)}}function g(){l=null;m&&b.fn.bgiframe||!a(h).fade?f.parent.show():f.parent.is(":animated")?f.parent.stop().show().fadeTo(a(h).fade,h.tOpacity):f.parent.is(":visible")?
f.parent.fadeTo(a(h).fade,h.tOpacity):f.parent.fadeIn(a(h).fade);e()}function e(d){if(!(b.tooltip.blocked||d&&"OPTION"==d.target.tagName))if(!p&&f.parent.is(":visible")&&b(document.body).unbind("mousemove",e),null==h)b(document.body).unbind("mousemove",e);else{f.parent.removeClass("viewport-right").removeClass("viewport-bottom");var c=f.parent[0].offsetLeft,g=f.parent[0].offsetTop;d&&(c=d.pageX+a(h).left,g=d.pageY+a(h).top,d="auto",a(h).positionLeft&&(d=b(window).width()-c,c="auto"),f.parent.css({left:c,
right:d,top:g}));d=b(window).scrollLeft();var k=b(window).scrollTop(),r=b(window).width(),l=b(window).height(),m=f.parent[0];d+r<m.offsetLeft+m.offsetWidth&&(c-=m.offsetWidth+20+a(h).left,f.parent.css({left:c+"px"}).addClass("viewport-right"));k+l<m.offsetTop+m.offsetHeight&&(g-=m.offsetHeight+20+a(h).top,f.parent.css({top:g+"px"}).addClass("viewport-bottom"))}}function k(d){function c(){f.parent.removeClass(e.extraClass).hide().css("opacity","")}if(!b.tooltip.blocked){l&&clearTimeout(l);h=null;var e=
a(this);m&&b.fn.bgiframe||!e.fade?c():f.parent.is(":animated")?f.parent.stop().fadeTo(e.fade,0,c):f.parent.stop().fadeOut(e.fade,c);a(this).fixPNG&&f.parent.unfixPNG()}}var f={},h,r,l,m=b.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),p=!1;b.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){b.tooltip.blocked=!b.tooltip.blocked}};b.fn.extend({tooltip:function(a){a=b.extend({},b.tooltip.defaults,a);f.parent||
(f.parent=b('<div id="'+a.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),b.fn.bgiframe&&f.parent.bgiframe(),f.title=b("h3",f.parent),f.body=b("div.body",f.parent),f.url=b("div.url",f.parent));var c=this.each(function(){b.data(this,"tooltip",a);this.tOpacity=f.parent.css("opacity");this.tooltipText=this.title;b(this).removeAttr("title");this.alt=""}).mouseover(d).mouseout(k);a.noHideOnClick||c.click(k);return c},fixPNG:m?function(){return this.each(function(){var a=
b(this).css("backgroundImage");a.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(a=RegExp.$1,b(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"}).each(function(){var a=b(this).css("position");"absolute"!=a&&"relative"!=a&&b(this).css("position","relative")}))})}:function(){return this},unfixPNG:m?function(){return this.each(function(){b(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){b(this)[b(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);!function(b){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):b(jQuery)}(function(b){function a(b){b=b[0];return 0<b.offsetWidth&&0<b.offsetHeight}function c(a){if(a.minTime&&(a.minTime=n(a.minTime)),a.maxTime&&(a.maxTime=n(a.maxTime)),a.durationTime&&"function"!=typeof a.durationTime&&(a.durationTime=n(a.durationTime)),"now"==a.scrollDefault)a.scrollDefault=function(){return a.roundingFunction(n(new Date),
a)};else if(a.scrollDefault&&"function"!=typeof a.scrollDefault){var d=a.scrollDefault;a.scrollDefault=function(){return a.roundingFunction(n(d),a)}}else a.minTime&&(a.scrollDefault=function(){return a.roundingFunction(a.minTime,a)});if("string"===b.type(a.timeFormat)&&a.timeFormat.match(/[gh]/)&&(a._twelveHourTime=!0),!1===a.showOnFocus&&-1!=a.showOn.indexOf("focus")&&a.showOn.splice(a.showOn.indexOf("focus"),1),0<a.disableTimeRanges.length){for(var c in a.disableTimeRanges)a.disableTimeRanges[c]=
[n(a.disableTimeRanges[c][0]),n(a.disableTimeRanges[c][1])];a.disableTimeRanges=a.disableTimeRanges.sort(function(a,b){return a[0]-b[0]});for(c=a.disableTimeRanges.length-1;0<c;c--)a.disableTimeRanges[c][0]<=a.disableTimeRanges[c-1][1]&&(a.disableTimeRanges[c-1]=[Math.min(a.disableTimeRanges[c][0],a.disableTimeRanges[c-1][0]),Math.max(a.disableTimeRanges[c][1],a.disableTimeRanges[c-1][1])],a.disableTimeRanges.splice(c,1))}return a}function d(a){var d=a.data("timepicker-settings"),c=a.data("timepicker-list");
if(c&&c.length&&(c.remove(),a.data("timepicker-list",!1)),d.useSelect)var k=c=b("<select />",{"class":"ui-timepicker-select"});else c=b("<ul />",{"class":"ui-timepicker-list"}),k=b("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),k.css({display:"none",position:"absolute"}).append(c);if(d.noneOption)if(!0===d.noneOption&&(d.noneOption=d.useSelect?"Time...":"None"),b.isArray(d.noneOption))for(var h in d.noneOption){if(parseInt(h,10)==h){var l=g(d.noneOption[h],d.useSelect);c.append(l)}}else l=
g(d.noneOption,d.useSelect),c.append(l);(d.className&&k.addClass(d.className),null===d.minTime&&null===d.durationTime||!d.showDuration)||("function"==typeof d.step?"function":d.step,k.addClass("ui-timepicker-with-duration"),k.addClass("ui-timepicker-step-"+d.step));l=d.minTime;"function"==typeof d.durationTime?l=n(d.durationTime()):null!==d.durationTime&&(l=d.durationTime);h=null!==d.minTime?d.minTime:0;var m=null!==d.maxTime?d.maxTime:h+u-1;h>m&&(m+=u);m===u-1&&"string"===b.type(d.timeFormat)&&d.show2400&&
(m=u);var q=d.disableTimeRanges,v=0,C=q.length,x=d.step;"function"!=typeof x&&(x=function(){return d.step});for(var E=0;m>=h;E++,h+=60*x(E)){var A=h,D=t(A,d);if(d.useSelect)var y=b("<option />",{value:D});else y=b("<li />"),y.addClass(43200>A%86400?"ui-timepicker-am":"ui-timepicker-pm"),y.data("time",86400>=A?A:A%86400);y.text(D);if((null!==d.minTime||null!==d.durationTime)&&d.showDuration)if(D=B(h-l,d.step),d.useSelect)y.text(y.text()+" ("+D+")");else{var F=b("<span />",{"class":"ui-timepicker-duration"});
F.text(" ("+D+")");y.append(F)}C>v&&(A>=q[v][1]&&(v+=1),q[v]&&A>=q[v][0]&&A<q[v][1]&&(d.useSelect?y.prop("disabled",!0):y.addClass("ui-timepicker-disabled")));c.append(y)}(k.data("timepicker-input",a),a.data("timepicker-list",k),d.useSelect)?(a.val()&&c.val(e(n(a.val()),d)),c.on("focus",function(){b(this).data("timepicker-input").trigger("showTimepicker")}),c.on("blur",function(){b(this).data("timepicker-input").trigger("hideTimepicker")}),c.on("change",function(){p(a,b(this).val(),"select")}),p(a,
c.val(),"initial"),a.hide().after(c)):(h=d.appendTo,"string"==typeof h?h=b(h):"function"==typeof h&&(h=h(a)),h.append(k),r(a,c),c.on("mousedown click","li",function(d){a.off("focus.timepicker");a.on("focus.timepicker-ie-hack",function(){a.off("focus.timepicker-ie-hack");a.on("focus.timepicker",w.show)});f(a)||a[0].focus();c.find("li").removeClass("ui-timepicker-selected");b(this).addClass("ui-timepicker-selected");z(a)&&(a.trigger("hideTimepicker"),c.on("mouseup.timepicker click.timepicker","li",
function(a){c.off("mouseup.timepicker click.timepicker");k.hide()}))}))}function g(a,d){var c,e,f;return"object"==typeof a?(c=a.label,e=a.className,f=a.value):"string"==typeof a?c=a:b.error("Invalid noneOption value"),d?b("<option />",{value:f,"class":e,text:c}):b("<li />",{"class":e,text:c}).data("time",String(f))}function e(a,b){return a=b.roundingFunction(a,b),null!==a?t(a,b):void 0}function k(a){a.target!=window&&(a=b(a.target),a.closest(".ui-timepicker-input").length||a.closest(".ui-timepicker-wrapper").length||
(w.hide(),b(document).unbind(".ui-timepicker"),b(window).unbind(".ui-timepicker")))}function f(a){a=a.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&a.disableTouchKeyboard}function h(a,d,c){if(!c&&0!==c)return!1;a=a.data("timepicker-settings");var e=!1;c=a.roundingFunction(c,a);return d.find("li").each(function(a,d){var f=b(d);if("number"==typeof f.data("time"))return f.data("time")==c?(e=f,!1):void 0}),e}function r(a,b){b.find("li").removeClass("ui-timepicker-selected");
var d=n(m(a),a.data("timepicker-settings"));if(null!==d&&(d=h(a,b,d))){var c=d.offset().top-b.offset().top;(c+d.outerHeight()>b.outerHeight()||0>c)&&b.scrollTop(b.scrollTop()+d.position().top-d.outerHeight());d.addClass("ui-timepicker-selected")}}function l(a,d){if(""!==this.value&&"timepicker"!=d){var c=b(this);if(!c.is(":focus")||a&&"change"==a.type){var e=c.data("timepicker-settings"),f=n(this.value,e);if(null===f)return void c.trigger("timeFormatError");var h=!1;if(null!==e.minTime&&null!==e.maxTime&&
(f<e.minTime||f>e.maxTime)&&(h=!0),b.each(e.disableTimeRanges,function(){return f>=this[0]&&f<this[1]?(h=!0,!1):void 0}),e.forceRoundTime){var g=e.roundingFunction(f,e);g!=f&&(f=g,d=null)}e=t(f,e);h?p(c,e,"error")&&c.trigger("timeRangeError"):p(c,e,d)}}}function m(a){return a.is("input")?a.val():a.data("ui-timepicker-value")}function p(a,b,d){if(a.is("input")){a.val(b);var c=a.data("timepicker-settings");c.useSelect&&"select"!=d&&"initial"!=d&&a.data("timepicker-list").val(e(n(b),c))}return a.data("ui-timepicker-value")!=
b?(a.data("ui-timepicker-value",b),"select"==d?a.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(d)&&a.trigger("changeTime"),!0):(a.trigger("selectTime"),!1)}function v(a){switch(a.keyCode){case 13:case 9:break;default:a.preventDefault()}}function C(d){var c=b(this),e=c.data("timepicker-list");if(!e||!a(e)){if(40!=d.keyCode)return!0;w.show.call(c.get(0));e=c.data("timepicker-list");f(c)||c.focus()}switch(d.keyCode){case 13:return z(c)&&(l.call(c.get(0),
{type:"change"}),w.hide.apply(this)),d.preventDefault(),!1;case 38:var h=e.find(".ui-timepicker-selected");return h.length?h.is(":first-child")||(h.removeClass("ui-timepicker-selected"),h.prev().addClass("ui-timepicker-selected"),h.prev().position().top<h.outerHeight()&&e.scrollTop(e.scrollTop()-h.outerHeight())):(e.find("li").each(function(a,d){return 0<b(d).position().top?(h=b(d),!1):void 0}),h.addClass("ui-timepicker-selected")),!1;case 40:return h=e.find(".ui-timepicker-selected"),0===h.length?
(e.find("li").each(function(a,d){return 0<b(d).position().top?(h=b(d),!1):void 0}),h.addClass("ui-timepicker-selected")):h.is(":last-child")||(h.removeClass("ui-timepicker-selected"),h.next().addClass("ui-timepicker-selected"),h.next().position().top+2*h.outerHeight()>e.outerHeight()&&e.scrollTop(e.scrollTop()+h.outerHeight())),!1;case 27:e.find("li").removeClass("ui-timepicker-selected");w.hide();break;case 9:w.hide();break;default:return!0}}function x(d){var c=b(this),e=c.data("timepicker-list"),
f=c.data("timepicker-settings");if(!e||!a(e)||f.disableTextInput)return!0;switch(d.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:f.typeaheadHighlight?r(c,e):e.hide()}}function z(a){var b=a.data("timepicker-settings"),d=null,c=a.data("timepicker-list").find(".ui-timepicker-selected");return c.hasClass("ui-timepicker-disabled")?
!1:(c.length&&(d=c.data("time")),null!==d&&("string"!=typeof d&&(d=t(d,b)),p(a,d,"select")),!0)}function B(a,b){a=Math.abs(a);var d,c,e=Math.round(a/60),f=[];return 60>e?f=[e,q.mins]:(d=Math.floor(e/60),c=e%60,30==b&&30==c&&(d+=q.decimal+5),f.push(d),f.push(1==d?q.hr:q.hrs),30!=b&&c&&(f.push(c),f.push(q.mins))),f.join(" ")}function t(a,d){if("number"!=typeof a)return null;var c=parseInt(a%60),e=parseInt(a/60%60),f=parseInt(a/3600%24),f=new Date(1970,0,2,f,e,c,0);if(isNaN(f.getTime()))return null;
if("function"===b.type(d.timeFormat))return d.timeFormat(f);for(var h="",g=0;g<d.timeFormat.length;g++)switch(c=d.timeFormat.charAt(g)){case "a":h+=11<f.getHours()?q.pm:q.am;break;case "A":h+=11<f.getHours()?q.PM:q.AM;break;case "g":c=f.getHours()%12;h+=0===c?"12":c;break;case "G":c=f.getHours();a===u&&(c=d.show2400?24:0);h+=c;break;case "h":c=f.getHours()%12;0!==c&&10>c&&(c="0"+c);h+=0===c?"12":c;break;case "H":c=f.getHours();a===u&&(c=d.show2400?24:0);h+=9<c?c:"0"+c;break;case "i":e=f.getMinutes();
h+=9<e?e:"0"+e;break;case "s":c=f.getSeconds();h+=9<c?c:"0"+c;break;case "\\":g++;h+=d.timeFormat.charAt(g);break;default:h+=c}return h}function n(a,b){if(""===a||null===a)return null;if("object"==typeof a)return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds();if("string"!=typeof a)return a;a=a.toLowerCase().replace(/[\s\.]/g,"");"a"!=a.slice(-1)&&"p"!=a.slice(-1)||(a+="m");var d="("+q.am.replace(".","")+"|"+q.pm.replace(".","")+"|"+q.AM.replace(".","")+"|"+q.PM.replace(".","")+")?",c=a.match(new RegExp("^"+
d+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+d+"$"));if(!c)return null;d=parseInt(1*c[2],10);if(24<d){if(b&&!1===b.wrapHours)return null;d%=24}var e=c[1]||c[5],f=d;12>=d&&e&&(f=e==q.pm||e==q.PM,f=12==d?f?12:0:d+(f?12:0));c=3600*f+60*(1*c[3]||0)+(1*c[4]||0);12>d&&!e&&b&&b._twelveHourTime&&b.scrollDefault&&(d=c-b.scrollDefault(),0>d&&d>=u/-2&&(c=(c+u/2)%u));return c}var u=86400,q={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},w={init:function(a){return this.each(function(){var e=
b(this),f=[],h;for(h in b.fn.timepicker.defaults)e.data(h)&&(f[h]=e.data(h));f=b.extend({},b.fn.timepicker.defaults,f,a);if(f.lang&&(q=b.extend(q,f.lang)),f=c(f),e.data("timepicker-settings",f),e.addClass("ui-timepicker-input"),f.useSelect)d(e);else{if(e.prop("autocomplete","off"),f.showOn)for(var g in f.showOn)e.on(f.showOn[g]+".timepicker",w.show);e.on("change.timepicker",l);e.on("keydown.timepicker",C);e.on("keyup.timepicker",x);f.disableTextInput&&e.on("keydown.timepicker",v);l.call(e.get(0),
null,"initial")}})},show:function(c){var e=b(this),g=e.data("timepicker-settings");if(c&&c.preventDefault(),g.useSelect)return void e.data("timepicker-list").focus();f(e)&&e.blur();c=e.data("timepicker-list");if(!e.prop("readonly")&&(c&&0!==c.length&&"function"!=typeof g.durationTime||(d(e),c=e.data("timepicker-list")),!a(c))){e.data("ui-timepicker-value",e.val());r(e,c);w.hide();c.show();var l={};g.orientation.match(/r/)?l.left=e.offset().left+e.outerWidth()-c.outerWidth()+parseInt(c.css("marginLeft").replace("px",
""),10):l.left=e.offset().left+parseInt(c.css("marginLeft").replace("px",""),10);"t"==(g.orientation.match(/t/)?"t":g.orientation.match(/b/)?"b":e.offset().top+e.outerHeight(!0)+c.outerHeight()>b(window).height()+b(window).scrollTop()?"t":"b")?(c.addClass("ui-timepicker-positioned-top"),l.top=e.offset().top-c.outerHeight()+parseInt(c.css("marginTop").replace("px",""),10)):(c.removeClass("ui-timepicker-positioned-top"),l.top=e.offset().top+e.outerHeight()+parseInt(c.css("marginTop").replace("px",""),
10));c.offset(l);l=c.find(".ui-timepicker-selected");if(!l.length){var p=n(m(e));null!==p?l=h(e,c,p):g.scrollDefault&&(l=h(e,c,g.scrollDefault()))}l&&l.length?(l=c.scrollTop()+l.position().top-l.outerHeight(),c.scrollTop(l)):c.scrollTop(0);return g.stopScrollPropagation&&b(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(a){a.preventDefault();var c=b(this).scrollTop();b(this).scrollTop(c+a.originalEvent.deltaY)}),b(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
k),b(window).on("resize.ui-timepicker",k),g.closeOnWindowScroll&&b(document).on("scroll.ui-timepicker",k),e.trigger("showTimepicker"),this}},hide:function(c){c=b(this);var d=c.data("timepicker-settings");return d&&d.useSelect&&c.blur(),b(".ui-timepicker-wrapper").each(function(){var c=b(this);if(a(c)){var d=c.data("timepicker-input"),e=d.data("timepicker-settings");e&&e.selectOnBlur&&z(d);c.hide();d.trigger("hideTimepicker")}}),this},option:function(a,e){return"string"==typeof a&&"undefined"==typeof e?
b(this).data("timepicker-settings")[a]:this.each(function(){var f=b(this),h=f.data("timepicker-settings"),g=f.data("timepicker-list");"object"==typeof a?h=b.extend(h,a):"string"==typeof a&&(h[a]=e);h=c(h);f.data("timepicker-settings",h);g&&(g.remove(),f.data("timepicker-list",!1));h.useSelect&&d(f)})},getSecondsFromMidnight:function(){return n(m(this))},getTime:function(a){var b=m(this);if(!b)return null;b=n(b);if(null===b)return null;a||(a=new Date);a=new Date(a);return a.setHours(b/3600),a.setMinutes(b%
3600/60),a.setSeconds(b%60),a.setMilliseconds(0),a},isVisible:function(){var b=this.data("timepicker-list");return!(!b||!a(b))},setTime:function(a){var b=this.data("timepicker-settings"),c=b.forceRoundTime?e(n(a),b):t(n(a),b);return a&&null===c&&b.noneOption&&(c=a),p(this,c),this.data("timepicker-list")&&r(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var a=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),a.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};b.fn.timepicker=function(a){return this.length?w[a]?this.hasClass("ui-timepicker-input")?w[a].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof a&&a?void b.error("Method "+a+" does not exist on jQuery.timepicker"):w.init.apply(this,arguments):this};b.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(a,b){if(null===a)return null;if("number"!=typeof b.step)return a;var c=a%(60*b.step);return c>=30*b.step?a+=60*b.step-c:a-=c,a==u&&b.show2400?a:a%u},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(b){var a=function(b,d,g){var e=/[^\w\-\.:]/.test(b)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+b.replace(a.regexp,a.func)+"';return _s;"):g?a.cache[b]=a(a.load(b)):a.cache[b]=a.cache[b]||a(a.load(b));return d?e(d,a):function(b){return e(b,a)}};a.cache={};a.load=function(a){var b=document.getElementById(a),g=/<\\\/(\w+)/g;if(!b&&console)throw{message:"template with id="+a+" not found"};return b?("textarea"==b.tagName.toLowerCase()?b.value:document.getElementById(a).innerHTML).replace(g,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(a,b,g,e,k,f){if(b)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[a]||"\\"+a;if(g)return"="===g?"'+_e("+e+")+'":"'+("+e+"||'')+'";if(k)return"';";if(f)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(b){return String(b||"").replace(a.encReg,function(b){return a.encMap[b]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a,c){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&h(f,k)<=e.distance){if(null!==e.hash){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(a)){this.onscroll=null;return}}e.load()}}function g(){var a=setTimeout(function(){if(e.stopped)clearTimeout(a);else{if(null!==e.hash){var b=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(b)){clearTimeout(a);return}}e.loading?a=setTimeout(arguments.callee,
350):(h(f,k),h(f,k)<=e.distance?(e.load(),a=setTimeout(arguments.callee,350)):(k.get(0).onscroll=d,clearTimeout(a)))}},350)}if("stop"==a){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==a){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==a){if(e=this.data("lazyLoadSettings"))e.loading=!0}else if("wake"==a){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==a)(e=this.data("lazyLoadSettings"))&&
(e.loading||e.load());else{this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:f,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var k=b(window),f=e.container||b(this);null===e.hash||b.isArray(e.hash)||(e.hash=[e.hash]);b.fn.lazyLoad.call(k,e.state);g();var h="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:function(a,c,d){a="string"===
typeof a?b(a):a;d=d||0;return a.position().top+a.outerHeight()-d-(c.scrollTop()+c.height())}}}})(jQuery);(function(b){b.storage=new b.store;b.orders={options:{view:"table"},init:function(a){var c=this;c.options=a;"undefined"!=typeof b.History&&b.History.bind(function(){c.dispatch()});b.wa.errorHandler=function(a){return 403===a.status||404===a.status?(a=b(a.responseText),a=a.find(".dialog-content").length?b('<div class="block double-padded"></div>').append(a.find(".dialog-content *")):b('<div class="block double-padded"></div>').append(a.find(":not(style)")),b("#s-content").empty().append(a),b.orders.onPageNotFound(),
!1):!0};a=window.location.hash;"#/"!==a&&a?b.wa.setHash(a):this.dispatch();this.initSearch();b(document).bind("wa.appcount",function(a,c){var e=parseInt(c.shop,10);b("#s-pending-orders .small").text(e?"+"+e:"");var k=document.title.match(/\(\d+\) /);k?document.title=document.title.replace(k[0],e?"("+e+") ":""):e&&(document.title="("+e+") "+document.title)});b(function(){b("#maincontent").on("click",".s-alert-close",function(){var a=b.storage.get("shop/alerts"),c=b(this).parent();a||(a=[]);a.push(c.data("alert"));
a=a.filter(function(a,b,c){return null!=a&&b==c.indexOf(a)});b.storage.set("shop/alerts",a);c.remove();return!1})});this.checkAlerts()},onPageNotFound:function(){b.order_list&&b.order_list.finit()},initSearch:function(){var a=b("#s-orders-search"),c=[],d=function(c){switch(c.autocomplete_item_type){case "order":b.wa.setHash("#/order/"+c.id+"/");a.val(c.value);break;case "contact":b.wa.setHash("#/orders/contact_id="+c.id+"/");a.val(c.value);break;case "product":b.wa.setHash("#/orders/product_id="+
c.id+"/");a.val(c.value);break;case "coupon":b.wa.setHash("#/orders/coupon_id="+c.id+"/");break;case "tracking_number":b.wa.setHash("#/orders/tracking_number="+c.value+"/");break;case "shipping":b.wa.setHash("#/orders/shipping_id="+c.id+"/");break;case "payment":b.wa.setHash("#/orders/payment_id="+c.id+"/");break;case "city":b.wa.setHash("#/orders/city="+c.value+"/");break;case "region":b.wa.setHash("#/orders/region="+((c.value||"").split(":")[1]||"")+"/");break;case "country":b.wa.setHash("#/orders/country="+
c.value+"/")}};a.unbind("keydown").bind("keydown",function(a){if(13==a.keyCode||10==a.keyCode){var e=b(this);if(!b(this).val())return location.hash="#/orders/all/",e.autocomplete("close"),!1;if(c&&b.isArray(c)&&c.length)return d(c[0]),setTimeout(function(){e.autocomplete("close")},150),!1}});a.autocomplete({minLength:1,delay:300,html:!0,select:function(a,b){d(b.item);return!1},source:function(a,d){b.getJSON("?action=autocomplete&type=order",a,function(a){c=a;d(a)})}})},prevHash:null,hash:null,skipDispatch:0,
stopDispatch:function(a){this.skipDispatch=a},forceHash:function(a){location.hash!=a&&(this.skipDispatch++,b.wa.setHash(a))},dispatch:function(a){if(0<this.skipDispatch)return this.skipDispatch--,!1;if(void 0===a||null===a)a=window.location.hash;a=a.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);if(this.hash=a)if(a=a.split("/"),a[0]){for(var c="",d=a.length,g=null,e=null,d=0;d<a.length;d++){var k=a[d];if(2>d){if(0===d)c=k;else if(parseInt(k,10)!=k&&-1==k.indexOf("="))c+=
k.substr(0,1).toUpperCase()+k.substr(1);else break;"function"==typeof this[c+"Action"]&&(g=c,e=d+1)}else break}"function"!==typeof this[c+"Action"]&&g&&(c=g,d=e);a=a.slice(d);this.preExecute(c);"function"==typeof this[c+"Action"]?(b.shop.trace("$.orders.dispatch",[c+"Action",a]),this[c+"Action"].apply(this,a)):b.shop.error("Invalid action name:",c+"Action");this.postExecute(c)}else this.preExecute(),this.defaultAction(),this.postExecute();else this.preExecute(),this.defaultAction(),this.postExecute()},
back:function(){var a=b.orders.prevHash||"";location.hash=a?a+"/":""},preExecute:function(a,b){},postExecute:function(a,b){this.actionName=a},defaultAction:function(){this.ordersAction()},couponsAction:function(){b.order_list&&b.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(a){this.load("?module=order&action=edit&id="+a,function(){b.order_list&&b.order_list.finit()})},ordersNewAction:function(a){this.load("?module=order&action=edit"+(a?"&"+a:""),function(){b.order_list&&
b.order_list.finit()})},ordersAction:function(a){if("hash"===a)a={hash:Array.prototype.slice.call(arguments,1).join("/")};else{var c="";"search"===a&&(c=Array.prototype.slice.call(arguments,1));1<arguments.length&&(a=Array.prototype.join.call(arguments,"/"));a?"all"===a&&(a=""):a="state_id=new|processing|paid";a=b.shop.helper.parseParams(a||"");a.view||(a.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",a.view);b.order_edit&&b.order_edit.slideBack();c&&(a.search=
c)}"orders"===this.actionName&&b.order_list?b.order_list.dispatch(a):(b.order_list&&b.order_list.finit(),this.load("?module=orders&"+this.buildOrdersUrlComponent(a),function(){b.order_list&&b.order_list.dispatch(a)}))},orderAction:function(a,c){c=b.shop.helper.parseParams(c||"");c.view||(c.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",c.view);b.order_edit&&b.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(a)+"&"+this.buildOrdersUrlComponent(c),
function(){b("#s-content").find("h1 .back.order-list").show()});b.order_list&&b.order_list.finit()},buildOrdersUrlComponent:function(a){var b="",d;for(d in a)a.hasOwnProperty(d)&&"view"!==d&&(b+="&"+d+"="+a[d]);return"view="+(a.view||this.options.view)+b},load:function(a,c,d){function g(){var a=b("#s-orders-views"),c=b("#s-order, #s-orders").length;a.length&&(c?a.css("visibility","visible"):a.css("visibility","hidden"))}function e(){var a=b("#s-orders-sort"),c=b("#s-order, #s-orders").length;a.length&&
(c?a.css("visibility","visible"):a.css("visibility","hidden"))}"function"===typeof c?(d=c,c={}):c=c||{};var k=Math.random();this.random=k;var f=this;return b.get(a,function(a){if("undefined"!==typeof c.check&&!c.check||f.random==k){(c.content||b("#s-content")).removeClass("bordered-left").html(a);"function"===typeof d&&d.call(this);var r=b(window);setTimeout(function(){r.trigger("scroll")},250);g();e();b(".level2").show();b("#s-sidebar").width(200).show();f.checkAlerts()}})},checkAlerts:function(){var a=
b.storage.get("shop/alerts");b.shop.trace("checkAlerts",a);b(".s-alert").each(function(){-1==b.inArray(b(this).data("alert"),a)&&b(this).show()})}}})(jQuery);(function(b){b.order_list={id:0,options:{},container:null,$selectionMenu:null,sidebar:null,select_all_input:null,filter_params:{},filter_params_str:"",params:null,timer_id:0,lazy_load_win:null,all_printforms:null,sort:["create_datetime","desc"],xhrs:{lazy_load:null,update_load:null,printforms:null},init:function(a){this.options=a=a||{};this.filter_params=a.filter_params||{};this.filter_params_str=a.filter_params_str||"";this.container=b("#order-list");"table"==a.view&&(this.container=b("#order-list").find("tbody:first"),
this.$selectionMenu=this.options.$selectionMenu)&&(b("#mainmenu .s-level2").append(this.$selectionMenu),this.select_all_input=this.$selectionMenu.find(".s-order-list-select-all"),this.select_all_input.attr("checked",!1));this.sidebar=b("#s-sidebar");this.id=a.id||0;if(a.orders&&a.orders.length&&a.view){try{this.container.append(tmpl("template-order-list-"+this.options.view,{orders:a.orders},!0)),this.container.trigger("append_order_list",[a.orders])}catch(c){return console&&console.log(c.stack),this}delete a.orders;
delete this.options.orders}a.lazy_loading&&this.initLazyLoad(a.lazy_loading);a.counters&&this.updateCounters(a.counters);a.update_process&&a.count&&this.updateProcess("run",a.update_process);if(a.sort&&a.sort[0]){a.sort[0]=""+a.sort[0];var d=b("#s-orders-sort .s-sort").map(function(){var a=b(this).data("sort")||"";return a?a:!1}).toArray();0>d.indexOf(a.sort[0])&&(a.sort[0]=d[0]);a.sort[1]=a.sort[1]||"";a.sort[1]="desc"===a.sort[1].toLowerCase()?"desc":"asc";this.sort=a.sort}this.initView()},initLazyLoad:function(a){var c=
this,d=c.options.count,g=c.options.total_count,e=b(window);e.lazyLoad("stop");d<g&&(e.lazyLoad({container:this.options.view?c.container:e,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:["orders",""],load:function(){e.lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();var a=c.container.find(".order:last"),d=parseInt(a.attr("data-order-id"),10);if(d){var h=function(){return b.getJSON(c.buildLoadListUrl(d),function(a){if("ok"==a.status){try{c.container.append(tmpl("template-order-list-"+
c.options.view,{orders:a.data.orders,check_all:"table"==c.options.view?c.select_all_input.attr("checked"):!1})),c.container.trigger("append_order_list",[a.data.orders]),c.container.find("[data-order-id="+c.options.id+"]").length&&(c.container.find(".selected").removeClass("selected"),c.container.find("[data-order-id="+c.options.id+"]").addClass("selected"))}catch(d){console&&console.log(d.stack);e.lazyLoad("stop");return}b(".lazyloading-progress-string").text(a.data.progress.loaded+" "+a.data.progress.of);
b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(a.data.progress.chunk);a.data.loaded>=a.data.total_count?(e.lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),e.lazyLoad("wake"))}else console&&console.log("Error when loading orders: "+a.errors),e.lazyLoad("stop")}).error(function(a){console&&(a&&a.errors?console.log("Error when loading orders: "+a.errors):a?console.log(a):console.log("Error when loading orders"));e.lazyLoad("stop")})};null===c.xhrs.update_load?
c.xhrs.lazy_load=h():c.xhrs.update_load.then(function(){c.xhrs.lazy_load=h()})}else console.log("Unkown last item"),e.lazyLoad("stop")}}),b("#s-orders").off("click",".lazyloading-link").on("click",".lazyloading-link",function(){e.lazyLoad("force");return!1}),this.lazy_load_win=e)},initView:function(){this.initSortMenu();this.initSidebar();"table"==this.options.view&&this.$selectionMenu&&this.$selectionMenu.length&&this.initSelecting();this.options.id&&this.loadOrder(this.options.id);var a=b("#s-orders-views");
a.find("li.selected").removeClass("selected");a.find('li[data-view="'+this.options.view+'"]').addClass("selected");a.find("li a").each(function(){var a=b(this),c=b(this).parents("li:first");a.attr("href","#/orders/view="+c.attr("data-view")+(b.order_list.options.filter_params_str?"&"+b.order_list.options.filter_params_str:"")+"/")});var c=function(a,c){var e=function(a,c){b.order_list.updateCounters({state_counters:a.data.state_counters,common_counters:{pending:a.data.pending_count}});b.isEmptyObject(a.data.orders)||
b.order_list.updateListItems(a.data.orders);b.order_list.select_all_input.trigger("select",!1);var d=[],e=b.order_list.filter_params;if(!b.isEmptyObject(a.data.orders))for(var g=0,k=a.data.orders.length;g<k;g++)!b.isEmptyObject(e)&&e.state_id&&("string"===b.type(e.state_id)&&e.state_id!==a.data.orders[g].state_id?d.push(a.data.orders[g].id):"array"===b.type(e.state_id)&&-1!==e.state_id.indexOf(a.data.orders[g].state_id)&&d.push(a.data.orders[g].id));b.isEmptyObject(d)||b.order_list.hideListItems(d).done(function(){if(!b.order_list.container.find(".order:not(:hidden):first").length){var a=
'<div class="block double-padded align-center blank"><br><br><br><br><span class="gray large">'+$_("There are no orders in this view.")+'</span><div class="clear-left"></div></div></div>';b("#s-content").html(a)}});c instanceof Function&&c(a)},k=function(f,h){b.shop.jsonPost("?module=orders&action=performAction&id="+a+"&offset="+(f||0)+"&"+b.order_list.options.filter_params_str,c,function(a){"ok"==a.status?a.data.offset<a.data.total_count?k(a.data.offset,e):e(a,h):e(a,h)})};k(0,function(){b.orders.dispatch()})};
if(this.$selectionMenu)this.$selectionMenu.on("click","a",function(){var a=b(this).data("action-id");if(a){var g=b.order_list.getSelectedOrders();g.order_id?c(a,g):confirm($_("Perform action to all selected orders?"))&&c(a,g)}return!1})},loadOrder:function(a){this.container.find(".selected").removeClass("selected");this.container.find("[data-order-id="+a+"]").addClass("selected");b("#s-order-title").find(".loading").show();b.orders.load("?module=order&id= "+a+"&"+this.filter_params_str,{content:b("#s-order")},
function(){this.id=a})},getSelectedOrders:function(a){a=a||!1;var c={count:0,all:!1};if(this.select_all_input.attr("checked")){c.all=!0;var d=b.order_list.filter_params;a?(c.serialized=[],b.isEmptyObject(d)?c.serialized.push({name:"filter_params",value:""}):b.each(d,function(a,d){b.isArray(d)?b.each(d,function(b,d){c.serialized.push({name:"filter_params["+a+"]["+b+"]",value:d})}):c.serialized.push({name:"filter_params["+a+"]",value:d})})):c.filter_params=b.isEmptyObject(d)?"":d;c.count=this.options.total_count}else a?
c.serialized=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return{name:"order_id[]",value:b(this).attr("data-order-id")}}).toArray():c.order_id=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return b(this).attr("data-order-id")}).toArray();return c},initSortMenu:function(){var a=b("#s-orders-sort"),c=function(c,g){var e=c[0],k=c[1],f=b('.s-sort[data-sort="'+e+'"] a',a).text();a.find(".s-current-sort").data("sort",e);a.find(".s-current-sort").data("order",
k);a.find(".s-current-sort .f-text").text(f);a.find(".s-sort-order").hide().filter('[data-order="'+k+'"]').show();if(g){f=window.location.hash||"";f=f.replace(/(^[^#]*#\/*|\/$)/g,"");f.split("/")[1]||(f="#/orders/state_id=new|processing|paid");var f=f.replace(/(&*sort\[[01]\]=.*?[&\/]|&*sort\[[01]\]=.*?$)/g,""),h=0<f.indexOf("=");h&&(f=f.replace(/[\/&]$/,""));b.wa.setHash(f+((h?"&":"")+"sort[0]="+e+"&sort[1]="+k+"/"))}};c(this.sort);a.data("inited")||(a.find(".s-sort a").click(function(){var d=b(this),
g=a.find(".s-current-sort").data(),e=g.sort,g=g.order;d.data("sort")===e?g="desc"===g?"asc":"desc":(e=d.data("sort"),g="desc");c([e,g],!0)}),a.data("inited",1))},initSidebar:function(){var a=this.sidebar,c=this.options.view;a.find("li.list a").each(function(){var a=b(this),d=a.attr("href"),k=d.match(/view=((.*)&|(.*)\/|(.*))/);k?a.attr("href",d.replace("view="+(k[2]||k[3]||k[4]),"view="+c)):(k=d.match(/^#\/orders\/hash\/(.*?)\/?$/))?a.attr("href","#/orders/view="+c+"&hash="+encodeURIComponent(k[1])+
"/"):(k=d.match(/orders\/((.*)\/|(.*))/),d="",k&&(k[1]?(d=k[2]||k[3],d+="&view="+c):d="view="+c,a.attr("href","#/orders/"+d+"/")))});var d=a.find("li.selected").removeClass("selected");this.filter_params.state_id?b.isArray(this.filter_params.state_id)?b("#s-pending-orders").addClass("selected"):a.find('li[data-state-id="'+this.filter_params.state_id+'"]').addClass("selected"):this.filter_params.contact_id?a.find("li[data-contact-id="+this.filter_params.contact_id+"]").addClass("selected"):this.filter_params.storefront?
(d=decodeURIComponent(this.filter_params.storefront),"/"===d.slice(-1)&&(d=d.slice(0,-1)),a.find('li[data-storefront="'+d+'"]').addClass("selected")):b.order_list.filter_params_str?a.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||d.addClass("selected"):b("#s-all-orders").addClass("selected");a.find("li.list a").unbind("click.order_list").bind("click.order_list",function(){a.find("li.selected").removeClass("selected");b(this).closest("li").addClass("selected");
if(b(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==b.orders.hash){var c=b.orders.hash.replace("orders/","");b.order_list.dispatch(c,!0)}})},initSelecting:function(){var a=this,c=this.container,d=this.select_all_input;d.click(function(){b(this).trigger("select",this.checked)});a.xhrs.printforms=null;var g=function(b){b=tmpl("template-order-list-printforms-menu-items",b);var c=a.$selectionMenu.find(".wf-actions");c.find(".s-printform-item,.s-printform-item-sep,.s-printform-item-button").remove();
c.append(b)};b(document).keydown(function(a){16!=a.keyCode||b(a.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(a){16==a.keyCode&&(document.body.onselectstart=null)});var e=function(){if(b.order_list.filter_params&&!b.order_list.filter_params.length){var c=b("#order-list"),e=d.attr("checked"),c=c.find(".order.selected:first").length;e||c?a.$selectionMenu.show():a.$selectionMenu.hide()}};c.off("select",".order").on("select",".order",function(a,
c){(void 0!==c?c:1)?b(this).addClass("selected").find("input:first").attr("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",!1),d.is(":checked")&&d.attr("checked",!1));e();return!1});var k=function(){a.xhrs.printforms&&a.xhrs.printforms.abort();g({printforms:[]});a.xhrs.printforms=null;d.is(":checked")&&null!==b.order_list.all_printforms?g({printforms:b.order_list.all_printforms}):a.xhrs.printforms=b.shop.getJSON("?module=orders&action=printforms",a.getSelectedOrders(),
function(c){b.isEmptyObject(c.data.printforms)||(d.is(":checked")&&(b.order_list.all_printforms=c.data.printforms),g(c.data),a.xhrs.printforms=null)})};d.unbind("select").bind("select",function(a,d){d=void 0!==d?d:!0;var e=b(this);d?(e.attr("checked",!0),c.find(".order").trigger("select",!0,!1)):(e.attr("checked",!1),c.find(".order").trigger("select",!1,!1));k()});c.off("click",".order input").on("click",".order input",function(a){var f=a.shiftKey;a=this.checked;var g=b(this).parents(".order:first");
a?g.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),g.removeClass("selected"));if(f&&a){(f=c.data("last_checked"))||(f=c.find(".order:first").trigger("select",!0));var m=g.prevAll(".selected[data-order-id="+f.attr("data-order-id")+"]"),p;if(m.length)for(p=g.prev(),f=f.get(0);p.length&&f!=p.get(0);)p.addClass("selected").find("input").attr("checked",!0),p=p.prev();else if(m=g.nextAll(".selected[data-order-id="+f.attr("data-order-id")+"]"),m.length)for(p=g.next(),f=f.get(0);p.length&&f!=
p.get(0);)p.addClass("selected").find("input").attr("checked",!0),p=p.next();c.data("last_checked")||m.length||f.trigger("selected",!1)}a&&c.data("last_checked",g);e();k()});var f=function(a,c){if(100<c.count)alert($_("Maximum of %d orders is allowed for bulk form printing.").replace("%d",100));else{var d="?module=orders&action=printformsDisplay",e=b.map(c.serialized,function(a){return a.name+"="+a.value}).join("&"),f=b.map(a,function(a){return"form[]="+a}).join("&"),d=d+("&"+e+"&"+f),e=(""+Math.random()).slice(2);
window.open(d,e)}};a.$selectionMenu.off("click.printforms").on("click.printforms",".s-printform-item-button",function(c){c.preventDefault();a.xhrs.printforms&&a.xhrs.printforms.abort();a.xhrs.printforms=null;c=a.$selectionMenu.find(".s-printform-item :checkbox").map(function(){var a=b(this);return a.is(":checked")?a.data("id"):!1}).toArray();if(c.length){var d=a.getSelectedOrders(!0);if(!(0>=d.count))return f(c,d),!1}})},updateTitle:function(a,c){c=parseInt(c,10)||0;var d="";this.options.state_names&&
(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?d=this.options.state_names[this.filter_params.state_id]:b.isArray(this.filter_params.state_id)&&(d=$_("Processing")):d=$_("All orders"));document.title=c?"("+c+") "+d+(a||""):d+a},updateCounters:function(a){var c=this.sidebar;c||(c=b("#s-sidebar"));var d=b("#s-pending-orders .small"),g;for(g in a)if(a.hasOwnProperty(g)){var e=a[g],k;for(k in e)if(e.hasOwnProperty(k)){var f;f="common_counters"==g?b("#s-"+k+"-orders .count"):
"storefront_counters"===g?c.find("li[data-"+g.replace("_counters","")+'="'+k+'"] .count'):c.find("li[data-"+g.replace("_counters","")+"-id="+k+"] .count");var h=parseInt(f.text(),10)||0,r=0;e[k]=""+e[k];"+"==e[k].substr(0,1)?r=h+(parseInt(e[k].substr(1),10)||0):"-"==e[k].substr(0,1)?(r=h-(parseInt(e[k].substr(1),10)||0),r=0>r?0:r):r=parseInt(e[k],10)||0;f.text(r);"new"==k&&(d.text(r?"+"+r:""),b.shop.updateAppCounter(r),this.updateTitle(this.options.title_suffix,parseInt(r,10)))}}},updateListItems:function(a){var c=
"template-order-list-"+this.options.view;if(document.getElementById(c)){var d=this.container;b.isArray(a)||(a=[a]);var c=b("<div></div>").append(tmpl(c,{orders:a,check_all:"table"==this.options.view?this.select_all_input.attr("checked"):!1})),g=b(".order",d);b(".order",c).each(function(){var a=b(this);g.filter("[data-order-id="+a.attr("data-order-id")+"]").replaceWith(a)});c.remove();this.container.trigger("append_order_list",[a])}},hideListItems:function(a){var c=b.Deferred();setTimeout(function(){if(b.order_list&&
b.order_list.container&&b.order_list.container.length){if(b.isArray(a))for(var d=b.order_list.container.find(".order"),g=b(),e=0;e<a.length;e++)var k=d.filter("[data-order-id="+a[e]+"]"),g=g.add(k);else var g=b.order_list.container.find(".order[data-order-id="+a+"]");var f=g.length,h=0;g.slideUp(450,function(){h++;h>=f&&c.resolve()})}},1E3);return c.promise()},dispatch:function(a,c){"string"===typeof a&&(a=b.shop.helper.parseParams(a));var d={list:function(){b.order_list.finit();b.orders.load("?module=orders&"+
b.orders.buildOrdersUrlComponent(a),function(){b.order_list.dispatch(a)})},order:function(){b.order_list.loadOrder(a.id)}};null===this.params?(this.params=a,c&&d.list()):a.id&&(c||a.id!=this.params.id)?(d.order(),this.params=a):(c||this.diff(a,this.params)||this.diff(this.params,a))&&d.list()},diff:function(a,b){for(var d in a)if(a.hasOwnProperty(d)&&"id"!=d&&a[d]!==b[d])return!0;return!1},buildLoadListUrl:function(a,b,d){return"?module=orders&action=loadList&id="+a+(this.filter_params_str?"&"+this.filter_params_str:
"")+(b?"&lt=1":"")+(d?"&counters=1":"")+(this.options.view?"&view="+this.options.view:"")+("&sort[0]="+this.sort[0]+"&sort[1]="+this.sort[1])},updateProcess:function(a,c){a=a||"run";c=c||{};timeout=c.timeout||6E4;var d=this,g=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};g();if("run"==a){var e=function(a,c){var e=d.container.find(".order:first"),e=parseInt(e.attr("data-order-id"),10)||0;return b.getJSON(d.buildLoadListUrl(e,
!0,!0),function(e){if("ok"==e.status){b.isEmptyObject(e.data.counters)||d.updateCounters(e.data.counters);if(e.data.count)try{d.container.prepend(tmpl("template-order-list-"+d.options.view,{orders:e.data.orders,check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),b(".lazyloading-progress-string").text(e.data.progress.loaded+" "+e.data.progress.of),d.container.trigger("append_order_list",[e.data.orders])}catch(g){console&&(console.log("Error: "+g.message),c());return}"function"===
typeof a&&a(e)}else console&&console.log("Error when loading new orders: "+e.errors),"function"===typeof c&&c()}).error(function(a){console&&(a&&a.errors?console.log("Error when loading new orders: "+a.errors):console.log(["Error when loading new orders",a]));"function"===typeof c&&c()})},k=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=e(k,g):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=e(k,g)})},timeout)};k()}},finit:function(a){a=this.xhrs;var b=this.lazy_load_win,
d;for(d in a)a.hasOwnProperty(d)&&null!==a[d]&&a[d].abort();this.updateProcess("kill");b&&b.lazyLoad("stop");this.params=null}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_fields:null,customer_inputs:null,stocks:[],slide_on:!1,options:{},init:function(b){this.options=b;b.id&&(this.id=b.id);this.container="string"===typeof b.container?$(b.container):b.container;this.form="string"===typeof b.form?$(b.form):b.form;this.customer_fields=$("#s-order-edit-customer");this.customer_inputs=this.customer_fields.find(":input");b.stocks.sort(function(a,b){return a.sort-b.sort});this.stocks=b.stocks;b.title&&(document.title=title);
b.float_delimeter||(b.float_delimeter=".");this.float_delimeter=b.float_delimeter;this.initView();this.initShippingControl();this.initDiscountControl();this.initCustomerSourceControl(b.customer_sources)},initView:function(){var b=this.options;this.initCustomerForm(this.id?"edit":"add");var a=function(a){var b=a.find(".s-orders-sku-stock-select").find("option:selected"),c=a.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");a.find(".s-orders-stock-icon-aggregate").show();
a.find(".s-orders-stock-icon").html("").hide();c=c.length?c:a;b.attr("data-icon")&&(c.find(".s-orders-stock-icon-aggregate").hide(),c.find(".s-orders-stock-icon").html(b.attr("data-icon")).show(),a.find(".s-orders-stock-icon .s-stock-left-text").show(),c.find(".s-orders-stock-icon .s-stock-left-text").hide())};$.order_edit.slide(!0,"add"==b.mode);this.container.find(".back").click(function(){$.order_edit.id?$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.getOrderItems(this.container,
!0);$(".s-order-item").each(function(){var b=$(this);a(b)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());$.order_edit.options.currency=$(this).val()});var c=b.price_edit||!1,d=$("#orders-add-autocomplete");d.autocomplete({source:"?action=autocomplete&with_counts=1",minLength:3,delay:300,select:function(b,e){$(".s-order-errors").empty();$.getJSON("?module=orders&action=getProduct&product_id="+e.item.id+($.order_edit.id?"&order_id="+$.order_edit.id:"&currency="+
$.order_edit.options.currency),function(b){var d=$("#order-items"),d=parseInt(d.find(".s-order-item:last").attr("data-index"),10)+1||0,e=b.data.product;e.sku_id&&e.skus[e.sku_id]&&(e.skus[e.sku_id].checked=!0);$("#order-currency").length&&!$("#order-currency").attr("disabled")&&($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled","disabled"));e=$("#s-orders-add-row");e.before(tmpl("template-order",{data:b.data,
options:{index:d,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:c}}));b=e.prev();$("#s-order-comment-edit").show();$.order_edit.updateTotal();a(b)});d.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",".s-orders-skus input[type=radio]",function(){var b=$(this),d=b.parents("tr:first"),e=b.closest("li"),g=this.value,l=d.attr("data-product-id"),m=d.attr("data-index"),p=null;"edit"==($.order_edit.id?"edit":"add")&&(p=parseInt(b.attr("name").replace("sku[edit][",
""),10));$.getJSON("?module=orders&action=getProduct&product_id="+l+"&sku_id="+g+($.order_edit.id?"&order_id="+$.order_edit.id:"&currency="+$.order_edit.options.currency),function(b){d.find(".s-orders-services").replaceWith(tmpl("template-order-services",{services:b.data.sku.services,service_ids:b.data.service_ids,product_id:l,options:{price_edit:c,index:m,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks}}));d.find(".s-orders-product-price").find("input").val(b.data.sku.price);var g;
g=-1!==d.find("input:first").attr("name").indexOf("add")?"add":"edit";d.find(".s-orders-sku-stock-place").empty();e.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+g,{sku:b.data.sku,index:m,stocks:$.order_edit.stocks,item_id:p}));a(d);$.order_edit.updateTotal()})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var b=$(this).parents("tr.s-order-item:first");a(b)});var g=function(a,b,c){var d=a.attr("data-price");a=
a.attr("data-percent-price");c&&b.val(d);b.attr("data-price",d);b.attr("data-percent-price",a)};this.container.off("change",".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var a=$(this),b=a.find("option:selected"),a=a.parents("li:first");g(b,a.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var a=$(this),b=a.find("option:selected"),a=a.parents("li:first");g(b,a.find(".s-orders-service-price"),!1)});this.container.off("click",
".s-order-item-delete").on("click",".s-order-item-delete",function(){var a=$(this);a.parents("tr:first").remove();a.parents("table:first").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});this.container.off("change",".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",".s-orders-product-price input",function(){var a=$(this),b=
$.order_edit.parseFloat(a.val());a.parents("tr:first").find(".s-orders-service-price").each(function(){var a=$(this);if("%"===a.data("currency")&&a.attr("data-price")===a.val()){var c=b*(a.data("percentPrice")/100);a.val($.order_edit.formatFloat(c));a.attr("data-price",c)}});$.order_edit.updateTotal()});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);$(".s-order-customer-details").on("change",
"input,select,checkbox,textarea",function(){$(this).attr("name")&&0<$(this).attr("name").indexOf("address")&&$.order_edit.updateTotal()});$("#payment_methods").change(function(){var a=$(this).val();$("#payment-info > div").hide();$("#payment-custom-"+a).length&&$("#payment-custom-"+a).show()});this.container.off("keydown",".s-orders-quantity").on("keydown",".s-orders-quantity",function(){var a=$(this),b=a.data("timer_id");b&&clearTimeout(b);a.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},
450))});if(this.form&&this.form.length){var e=function(){var a=$(this);if(e.xhr)return!1;$.order_edit.showValidateErrors();$('.s-orders-services input[name^="service"][type="checkbox"]:not(:checked),.s-orders-services input.js-fake-service-selected[type="checkbox"]:not(:checked)',this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",!0)});if(!$.order_edit.container.find(".error").length){$(".s-order-items-edit td.save i.loading").css("display","inline-block");a.find("[type=submit]").attr("disabled",
!0);var b=function(){e.xhr=null;a.find("[type=submit]").attr("disabled",!1);$(".s-orders-services input:disabled",a).attr("disabled",!1);$(".s-order-items-edit td.save i.loading").css("display","none")};e.xhr=$.order_edit.id?$.order_edit.saveSubmit(b,"edit"):$.order_edit.saveSubmit(b,"add")}return!1};this.form.unbind("sumbit").bind("submit",e)}$("#subtotal").text(this.roundFloat($("#subtotal").text()));$("#total").text(this.roundFloat($("#total").text()));$("#discount").val(this.roundFloat($("#discount").val()))},
initShippingControl:function(){var b=$("#shipping-rate"),a=$("#shipping_methods").val();$("#shipping-custom").on("change",":input",function(a){$.shop.trace("#shipping-custom change",[a,this]);a.originalEvent&&$(this).data("affects-rate")&&$.order_edit.updateTotal()});$("#shipping_methods").change(function(){var c=$(this),d=c.children(":selected"),g=d.data("rate")||0;b.data("shipping")&&d.val()==a||(b.val($.order_edit.formatFloat(g)),b.data("shipping",!1),a=d.val());g=[];d.data("error")&&g.push('<span class="error">'+
d.data("error")+"</span>");d.data("est_delivery")&&g.push('<span class="hint est_delivery">'+d.data("est_delivery")+"</span>");var e=c.val().replace(/\..+$/,""),c=c.data("_shipping_id");$("#shipping-custom > div").hide();$("#shipping-custom-"+e).length&&$("#shipping-custom-"+e).show();d.data("comment")&&g.push('<span class="hint">'+d.data("comment")+"</span>");g?(d.data("error")?b.addClass("error"):$("#shipping-rate").removeClass("error"),$("#shipping-info").html(g.join("<br>")).show()):(b.removeClass("error"),
$("#shipping-info").empty().hide());$.shop.trace("check shipping_methods id",[c,e]);$.order_edit.updateTotal()});$("#shipping-rate").keyup(function(){$("#shipping-rate").data("shipping",$(this).val());$.order_edit.updateTotal()})},initDiscountControl:function(){function b(){0<$.order_edit.parseFloat(a.val())?e.stop().show():e.stop().hide();var b=25;e.is(":visible")&&e.finish().fadeOut(b+=50).fadeIn(b+=50).fadeOut(b+=50).fadeIn(b+=50).fadeOut(b+=50).fadeIn(b+=50).fadeOut(b+=50).fadeIn(b+50)}var a=
$("#discount"),c=$("#discount-description"),d=$("#update-discount"),g=$("#edit-discount"),e=$("#discount-tooltip-icon");$(document).tooltip;e.tooltip({showURL:!1,bodyHandler:function(){return c.val()||c.data("updated-manually-msg")}});d.tooltip({showURL:!1,bodyHandler:function(){return d.data("description")||c.data("updated-manually-msg")}});g.length?e.show():e.hide();$("#order-edit-form").on("order_total_updated",function(e,h){a.show();a.parent().find("span.js-order-discount:first").hide();g.hide();
d.data("description",h.discount_description);if(h.discount){d.data("value",h.discount).data("description",h.discount_description).data("items_discount",h.items_discount);if("calculate"==d.data("discount")){c.val(d.data("description"));for(var k=d.data("items_discount")||[],l=0;l<k.length;l++)if(k[l]){var m="#order-items span.js-item-total-discount",m=m+('[data-discount-id="'+k[l].selector+'"]'),m=$(m);m.length&&m.html(k[l].html).show()}b()}"calculate"===d.data("discount")?$.order_edit.parseFloat(h.discount)+
""!=$.order_edit.parseFloat(a.val())&&d.click():d.show()}});var k=function(){a.show();a.parent().find("span.js-order-discount:first").hide();g.hide();$(".js-item-total-discount").hide()};g.click(function(){k();c.val("");return!1});d.click(function(){k();a.val(d.data("value")||0).change();c.val(d.data("description"));a.attr("title",c.data("edit-manually-msg"));d.hide().data("discount","calculate");$.order_edit.updateTotal();b();return!1});a.on("keyup",function(){g.click();c.val("");$("#order-items .js-item-total-discount").hide();
a.attr("title",null);d.show().data("discount",$(this).val());$.order_edit.updateTotal();b()})},initCustomerSourceControl:function(b){var a=$("#customer-source");a.autocomplete({delay:0,minLength:0,appendTo:"#order-edit-form",source:function(a,d){var g=b.filter(function(b){return b&&b.indexOf&&0<=b.indexOf(a.term)}).slice(0,10);1==g.length&&g[0]==a.term?d([]):d(g)}}).on("focus",function(){a.autocomplete("search")})},getOrderItems:function(b){var a=[],c=[];b.find(".s-order-item").each(function(){var b=
$(this),g=b.find('input[name^="product"]').val(),e=[],k=$.order_edit.parseFloat(b.find(".s-orders-product-price input").val()),f=$.order_edit.parseFloat(b.find("input.s-orders-quantity").val()),h=b.find("select.s-orders-sku-stock-select").val(),r=b.find("input[name^=sku]:not(:radio)").add(b.find("input[name^=sku]:checked")).first().val()||0,l={product_id:g,sku_id:r,services:[]};b.find(".s-orders-services").length&&b.find(".s-orders-services input:checkbox:checked").each(function(){var a=$(this).closest("li"),
b=$.order_edit.parseFloat(a.find("input.s-orders-service-price").val()),c=$(this).val(),a=a.find(':input[name^="variant["]').val();e.push({id:c,price:b,variant_id:a});l.services.push(c)});l.services.sort();l.services=l.services.join("_");a.push({product_id:g,quantity:f,price:k,sku_id:r,services:e,stock_id:h});c.push(l)});c=this.reduceOrderContent(c);b.data("order-content",c);b.data("order-content")!==c&&$("#discount").trigger("keyup");return a},reduceOrderContent:function(b){b.sort(function(a,b){var d=
a.product_id-b.product_id;0==d&&(d=a.sku_id-b.sku_id);0==d&&a.services.localeCompare(b.services)});return b.map(function(a){return"*"+a.product_id+":"+a.sku_id+":"+a.services}).join(";")},updateTotal:function(){function b(){a=null;$.order_edit.realUpdateTotal()}var a=null;return function(){a?(clearTimeout(a),a=setTimeout(b,250)):a=setTimeout(b,500)}}(),realUpdateTotal:function(){var b=$.order_edit.container,a=$("#subtotal"),c=$("#total");if(b.find(".s-order-item").length){$.order_edit.showValidateErrors();
for(var d={},g=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),e=0;e<g.length;e++)d[g[e].name]=g[e].value;d.items=$.order_edit.getOrderItems(b);var k=$("#update-discount").data("discount");void 0!==k&&("calculate"!==k&&(k=$.order_edit.parseFloat(k)),d.discount=k);$.order_edit.id?d.order_id=$.order_edit.id:d.currency=$("#order-edit-form input[name=currency]").val();b=$("#shipping_methods").val();$("#shipping-rate").data("shipping")&&(d.shipping=$("#shipping-rate").data("shipping"));
d.params={shipping_id:b};d["customer[id]"]=d.contact_id=$("#s-customer-id").val();b&&(b=parseInt(b.split(".")[0]),0<b&&$("#shipping-custom").find(">#shipping-custom-"+b+" :input").each(function(){d[this.name]=this.value}));$.ajax({type:"POST",url:"?module=order&action=total",data:d,success:function(b){if("ok"===b.status){var d=$("#shipping-rate");if(0<b.data.shipping_method_ids.length){var e=$("#shipping_methods"),g=e.val(),m=g.replace(/\W.+$/,"");e.empty();e.prepend('<option value=""></option>');
$("#shipping-custom").empty();var p=b.data.shipping_method_ids,v=b.data.shipping_methods,C=-1!==p.indexOf(g),x=$("#shipping-custom");x.find(">div.fields.form").hide();for(var z=0;z<p.length;z+=1){var B=p[z],t=v[B],n=$("<option></option>");n.html(t.name).attr("value",B).data("rate",t.rate);n.data("error",t.error||void 0);n.data("est_delivery",t.est_delivery||void 0);n.data("comment",t.comment||void 0);n.data("external",t.external||!1);if(t.custom_data)for(var u in t.custom_data)t.custom_data.hasOwnProperty(u)&&
n.data(u,t.custom_data[u]);e.append(n);g||0!==z||$("#shipping-rate").val($.order_edit.formatFloat(t.rate));if(t.custom_html){var n=B.replace(/\W.+$/,""),q=x.find("#shipping-custom-"+n);q.length||(x.append('<div id="shipping-custom-'+n+'" style="display: none;" class="fields form"></div>'),q=x.find("#shipping-custom-"+n));q.html(t.custom_html);m==n?q.show():q.hide()}if(!C&&(t=(""+B).split("."),n=g.split("."),""!==n[0]&&void 0!==t[0]&&void 0!==n[0]&&t[0]==n[0])){g=B;e.val(g);$.order_edit.realUpdateTotal();
return}}e.val(g);e.data("_shipping_id",m);$.shop.trace("set shipping_methods id",[m,g])}""!=k&&$("#discount").val($.order_edit.roundFloat(b.data.discount));d.data("shipping")||d.val($.order_edit.roundFloat(b.data.shipping));$("#order-edit-form").trigger("order_total_updated",b.data);a.text($.order_edit.roundFloat(b.data.subtotal));c.text($.order_edit.roundFloat(b.data.total));$.order_edit.showValidateErrors(b.data.errors)}},dataType:"json"})}else a.text(0),c.text(0)},saveSubmit:function(b,a){var c=
this.form,d=c.serializeArray();"calculate"===$("#update-discount").data("discount")?$(d).each(function(){"discount"==this.name&&(this.value="calculate")}):void 0===$("#update-discount").data("discount")&&(d=d.filter(function(a){return"discount"!==a.name}),0<$("#discount").val()?d.discount_description=$("#edit-discount").val():d=d.filter(function(a){return"discount_description"!==a.name}));success="add"==a?function(a){$.order_edit.slide(!1,!0)&&(location.href="#/orders/state_id=new&view=split&id="+
a.data.order.id+"/")}:function(a){$.order_edit.container.find(".back").click()};$.shop.trace(a,c.serialize());return $.shop.jsonPost(c.attr("action"),d,success,function(b){$.shop.trace(a,b);b&&b.errors&&!$.isEmptyObject(b.errors)&&$.order_edit.showValidateErrors(b.errors)},b)},roundFloat:function(b){return b?this.formatFloat(Math.round(100*b)/100):0},formatFloat:function(b){return","===this.float_delimeter?(""+b).replace(".",","):""+b},parseFloat:function(b){return b?parseFloat((""+b).replace(",",
".")):0},slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(b,a,c){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{b="undefined"===typeof b?!0:b;a="undefined"===typeof a?!1:a;var d=this.options.duration||200,g=this.options.view,e=[];return!this.slide_on&&b?(e.push($("#s-sidebar").animate({width:0},d,function(){$(this).hide()})),$(".s-level2").hide(),e.push($("#maincontent").animate({"margin-top":45},d)),e.push($("#s-content").animate({"margin-left":0},
d)),e.push($("#s-orders").animate({width:0},d,function(){$(this).hide()})),e.push($("#s-order").animate({"margin-left":0},d).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(e).done(function(){$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");"function"===typeof c&&c.call(this)}),!0):this.slide_on&&!b?(e.push($("#s-order").animate({"margin-left":"table"==
g||a?200:300},d).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),e.push($("#s-orders").animate({width:300},d).show()),e.push($("#s-content").animate({"margin-left":200},d)),e.push($("#maincontent").animate({"margin-top":84},d)),$(".s-level2").show(),e.push($("#s-sidebar").animate({width:200},d).show()),this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),$.when(e).done(function(){$.order_list.lazy_load_win&&
$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof c&&c.call(this)}),!0):!1}},showValidateErrors:function(b){$(".error").removeClass("error");$("#s-order-edit-customer .errormsg").empty();if(b&&b.customer){var a=b.customer;$.order_edit.customer_fields.find(".field-group:first").html(a.html);delete a.html;for(var c in a)$.order_edit.customer_fields.find(".s-error-customer-"+c).each(function(){var b=$(this);"EM"==this.tagName?b.text(a[c]):b.addClass("error")})}var d=[];$(".s-order-errors").empty();
if(b&&b.order){if(!$.isEmptyObject(b.order.items))for(var g in b.order.items){var e=$(".s-order-item[data-index="+g+"]"),a=b.order.items[g];for(c in a){var k=e.find(".s-error-item-"+c);k.length?k.text(a[c]):d.push(a[c])}delete b.order.items[g]}if(!$.isEmptyObject(b.order.product)){var f=b.order.product,h;for(h in f)f.hasOwnProperty(h)&&"quantity"in f[h]&&$(".s-order-item[data-product-id="+h+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=""+f[h].sku_id&&$(this).find("ul.s-orders-skus").length||
($(this).find(".s-orders-quantity").addClass("error"),d.push(f[h].quantity))})}b.order.common&&d.push(b.order.common);b.order.discount&&($("#discount").addClass("error"),d.push(b.order.discount));d.length&&$(".s-order-errors").html(d.join("<br>"))}},bindValidateErrorPlaceholders:function(){for(var b=["firstname","middlename","lastname"],a=0,c=b.length;a<c;a+=1)$.order_edit.customer_inputs.filter("[name="+$.order_edit.inputName(b[a])+"]").addClass("s-error-customer-name");$.order_edit.customer_fields.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>')},
initCustomerForm:function(b){b="undefined"===typeof b?"add":b;$.order_edit.bindValidateErrorPlaceholders();if("add"===b){var a=$("#customer-autocomplete"),c=function(a){a="undefined"===typeof a?!0:a;$("#s-customer-id").attr("disabled",a);a?$("#s-order-edit-customer").addClass("s-opaque"):$("#s-order-edit-customer").removeClass("s-opaque")},d=function(b){"undefined"===typeof b||b?(c(!1),a.val("").hide(200)):(c(),e(),a.val("").show())},g=function(a){return parseInt(a,10)||"+"==a.substr(0,1)||-1!==a.indexOf("(")},
e=function(){var a={};$.order_edit.customer_inputs.each(function(){var b=$(this);a[b.attr("name")]=b.val()});return function(){$.order_edit.customer_inputs.each(function(){var b=$(this);b.val(a[b.attr("name")]||"")})}};d(!1);$.order_edit.customer_fields.off("focus",":input").on("focus",":input",function(){c(!1)});$("#s-order-new-customer").click(function(){e();d();$.order_edit.customer_inputs.first().focus();$("#s-customer-id").val(0);return!1});var k="";a.autocomplete({source:function(a,b){k=a.term;
$.getJSON($.order_edit.options.autocomplete_url,a,function(a){(a=a||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});b(a)})},delay:300,minLength:3,select:function(a,b){var c=b.item,e=function(){var a=!1;$.order_edit.customer_inputs.filter("input[type=text], textarea").each(function(){var b=$(this);if(b.is(":not(:hidden)")&&!this.value)return a=!0,b.focus(),!1});a||$.order_edit.customer_inputs.first().focus()};if(c.value)$.get("?action=contactForm&id="+c.value,function(a){$.order_edit.customer_fields.find(".field-group:first").html(a);
$.order_edit.customer_inputs=$.order_edit.customer_fields.find(":input");$("#s-customer-id").val(c.value);d();setTimeout(function(){e()},200);$.order_edit.updateTotal()});else{var m="[name="+$.order_edit.inputName(g(k)?"phone":-1!==k.indexOf("@")?"email":"firstname")+"]";$.order_edit.customer_inputs.filter(m).val(k);$("#s-customer-id").val(0);d();setTimeout(function(){e()},200)}return!1},focus:function(a,b){this.value=b.item.name;return!1}});$("#order-add-form").submit(function(){c(!1)})}},inputName:function(b){return'"customer['+
b+']"'},getPercentSymbol:function(){return"%"}};
//# sourceMappingURL=order.min.js.map