!function(e){"use strict";var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.$skus=r.$wrapper.find(".wa-skus-wrapper"),r.$services=r.$wrapper.find(".wa-services-wrapper"),r.$amount=r.$wrapper.find(".js-quantity-field"),r.$price=r.$wrapper.find(".js-product-price"),r.$comparePrice=r.$wrapper.find(".js-product-price-compare"),r.$button=r.$wrapper.find(".js-submit-button"),r.dialog=r.$wrapper.data("dialog"),r.scope=r.dialog.options.scope,r.currency=e.currency,r.services=e.services,r.features=e.features,r.locales=e.locales,r.images=e.images,r.skus=e.skus,r.added_class="is-added",r.amount=parseFloat(r.$amount.val()),r.sku_id=parseFloat(e.sku_id),r.price=parseFloat(e.price),r.compare_price=parseFloat(e.price),r.init()},r.prototype.init=function(){var r=this;r.$wrapper.on("click",".wa-feature-wrapper .wa-variant",function(a){a.preventDefault(),r.changeFeature(e(this))}),r.$skus.on("change",".js-sku-field",function(){var a=e(this),i=a.data("disabled");if("checked"===a.attr("checked")){var t=a.val(),o=r.skus[t];r.changeSKU(o,!i)}}),r.$services.on("change",".js-service-field",function(){r.changeService(e(this))}),r.$services.on("change",".js-variant-select",function(){r.updatePrice()}),r.initSubmit()},r.prototype.DEBUG=function(){var e=this,r=console.log,a={hint:"font-weight: bold; color: #666;",info:"font-weight: bold; font-size: 1.25em; color: blue;",warn:"font-weight: bold; font-size: 1.25em;",error:"font-weight: bold; font-size: 1.25em;"};if(e.scope&&e.scope.options&&e.scope.options.DEBUG){if(a[arguments[1]]){switch(arguments[0]="string"==typeof arguments[0]?"%c"+arguments[0]:arguments[0],arguments[1]){case"info":r=console.info;break;case"error":r=console.error;break;case"warn":r=console.warn}arguments[1]=a[arguments[1]]}return r.apply(console,arguments)}},r.prototype.initSubmit=function(){var e=this,r=!1;e.$button.on("click",function(a){a.preventDefault(),r||(r=!0,e.dialog.lock(!0),e.dialog.options.onSubmit(e.sku_id).always(function(){r=!1,e.dialog.lock(!1)}).done(function(){e.dialog.close()}))})},r.prototype.changeSKU=function(r,a){var i=this;r||i.DEBUG("SKU is missing","error"),function(r){var a=e(".js-product-sku"),i=a.closest(".wa-sku-wrapper");r?(a.text(r),i.show()):(a.text(""),i.hide())}(r.sku),function(r){var a=i.images.default;r&&i.images[r]&&(a=i.images[r]),e("img#js-product-image").attr("src",a.uri_200)}(r.image_id),i.updateStocks(r.id),i.updateServices(r.id),i.updatePrice(r.price,r.compare_price),a?i.$button.removeAttr("disabled"):i.$button.attr("disabled",!0),i.sku_id=parseFloat(r.id),i.dialog.resize()},r.prototype.changeFeature=function(r){var a=this,i=r.closest(".wa-feature-wrapper"),t=i.find(".js-feature-field"),o=r.data("variant-id");i.find(".wa-variant.selected").removeClass("selected"),r.addClass("selected"),t.val(o).trigger("change");var s=function(){var r="",i=null;a.$wrapper.find(".wa-feature-wrapper .js-feature-field").each(function(){var a=e(this);r+=a.data("feature-id")+":"+a.val()+";"});var t=a.features[r];return t?i=t:a.DEBUG("Feature error","error"),i}(),c=s.id,n=a.skus[c];n?a.changeSKU(n,s.available):a.DEBUG("SKU id error","error")},r.prototype.changeService=function(e){var r=this,a=e.closest(".wa-service-wrapper"),i=a.find(".js-variant-select");if(i.length){e.is(":checked")?i.removeAttr("disabled"):i.attr("disabled","disabled")}r.updatePrice()},r.prototype.updateServices=function(r){var a=this,i=a.services[r];e.each(i,function(r,i){var t=a.$wrapper.find(".wa-service-wrapper[data-id='"+r+"']");if(!t.length)return a.DEBUG("Service is missing"),!0;if(i)if(t.show().find("input").removeAttr("disabled"),"string"==typeof i)t.find(".js-service-price").html(window.waOrder.ui.formatPrice(i)),t.find(".js-service-field").data("price",i);else{var o=t.find(".js-variant-select"),s=o.val(),c=!1;o.html(""),e.each(i,function(e,r){if(r){e===s&&(c=!0);var a='<option data-price="%price%" value="%value%">%name% (+%formatted_price%)</option>',i=r[0],t=r[1];a=a.replace("%value%",e).replace("%price%",t).replace("%name%",i).replace("%formatted_price%",window.waOrder.ui.formatPrice(t,!0)),o.append(a)}}),c?o.val(s):o[0].selectedIndex=0}else t.hide().find("input, select").attr("disabled",!0).removeAttr("checked")})},r.prototype.updateStocks=function(r){this.$wrapper.find(".wa-stocks-wrapper").find(".wa-stock-wrapper").each(function(){var a=e(this);a.data("sku-id")+""==r+""?a.show():a.hide()})},r.prototype.updatePrice=function(e,r){var a=this;e=parseFloat(e),r=parseFloat(r);var i,t,o=a.$price,s=a.$comparePrice,c=a.amount;e?(a.price=e,o.data("price",e)):e=a.price,r>=0?(a.compare_price=r,s.data("price",r)):r=a.compare_price,i=(e+0)*c,t=(r+0)*c,o.html(window.waOrder.ui.formatPrice(i)),s.html(window.waOrder.ui.formatPrice(t)),r>0?s.removeClass("is-hidden"):s.addClass("is-hidden")},r}(e);window.waOrder=window.waOrder||{},window.waOrder.CartProductDialog=r}(jQuery);
//# sourceMappingURL=product.min.js.map
