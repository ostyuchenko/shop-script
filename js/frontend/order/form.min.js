!function(e){"use strict";var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.templates=e.templates,r.errors=e.errors,r.scope=e.scope,r.contact_id=e.contact_id,r.reload=!1,r.initClass()},r.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&r.scope.DEBUG("Errors:","error",r.errors),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, textarea, input",function(t){var o=e(this),a=!!o.data("affects-rate")||!!o.data("reload"),n=o.closest(".wa-field-wrapper");n.length||(n=o.parent()),r.scope.validate(n,!0).length||a&&r.update({reload:!0})}),r.initType(),r.initAuth(),r.initDatepicker()},r.prototype.initAuth=function(){function r(){e.contains(document,a.$wrapper[0])?i&&i.close():n.off("wa_auth_contact_logged",r)}function t(r,t){r.on("click","a",function(r){var t=e(this),a=t.data("type"),n=["login","signup","forgotpassword","setpassword"];a&&(r.preventDefault(),n.indexOf(a)>=0&&o(a))}),r.on("wa_auth_set_password",function(e,r){o("setpassword",{data:[{name:"hash",value:r}]})}),r.on("wa_auth_resent_password",function(e,r){o("login")}),r.on("wa_auth_contact_signed",function(e,r,t){t.password_sent&&o("login")}),r.on("wa_auth_form_change_view",function(){t.resize()})}function o(r,o){o=o||{};var n=a.scope.urls.auth_dialog,l=[{name:"type",value:r}],p=a.$wrapper.find(".js-type-field");if(p.length){var c=e.trim(p.val());c&&l.push({name:"contact_type",value:c})}return o.data&&(l=l.concat(o.data)),s&&s.abort(),i&&i.lock(!0),s=e.post(n,l,function(r){i&&i.close(),i=new window.waOrder.ui.Dialog({$wrapper:e(r),onOpen:t})}).always(function(){s=null})}var a=this,n=e(document),i=null,s=null;n.on("wa_auth_contact_logged",r),a.contact_id?a.$wrapper.on("click",".js-logout-button",function(r){e(document).trigger("wa_order_reload_start")}):a.$wrapper.on("click",".js-show-login-dialog",function(e){e.preventDefault(),o("login")})},r.prototype.initType=function(){var r=this,t=r.$wrapper.find(".js-type-toggle").first(),o=r.$wrapper.find(".js-type-field");new window.waOrder.ui.Toggle({$wrapper:t,change:function(t,a,n){var i=e(a).data("id");i&&(r.reload=!0,o.val(i),r.scope.update())}})},r.prototype.initDatepicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var r=e(this),t={},o=r.data("alt");if(o){var a=r.closest(".wa-field-wrapper").find(o);a.length&&(t.altField=a,t.altFormat="yy-mm-dd")}r.datepicker(t),r.on("keydown keypress keyup",function(e){13===e.which&&e.preventDefault()})})},r.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"auth[html]",value:1});else{var o=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"auth[html]",value:1});var a=r.scope.validate(r.$form,o);a.length&&(t.errors=a)}return t},r.prototype.render=function(e){var r=this,t=!1;return e.auth&&e.auth.html&&(r.$wrapper.replaceWith(e.auth.html),t=!0),t},r.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},r.prototype.update=function(e){var r=this;return e.reload&&(r.reload=!0),r.scope.update()},r}(e),t=function(e){return t=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.reload=!0,r.initClass()},t.prototype.initClass=function(){function r(r,a){r.length&&(r.on("keydown",function(){t(r)}),r.on("change",function(){a&&a.length&&e.each(a,function(e,r){r.length&&r.attr("disabled",!0)}),o(r)}))}function t(e){clearTimeout(n),n=setTimeout(function(){e.trigger("change")},i)}function o(e){clearTimeout(n),a.scope.trigger("region_change")}var a=this,n=0,i=2e3;"object"==typeof a.errors&&Object.keys(a.errors).length&&a.scope.DEBUG("Errors:","error",a.errors),a.$form.on("submit",function(e){e.preventDefault()});var s=a.$form.find(".js-location-field"),l=a.$form.find(".js-country-field"),p=a.$form.find(".js-region-field"),c=a.$form.find(".js-city-field"),u=a.$form.find(".js-zip-field");r(l,[p,c,u]),r(p,[c,u]),r(c,[u]),r(s),r(u)},t.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"region[html]",value:"only"});else{var o=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"region[html]",value:"only"});var a=r.scope.validate(r.$form,o);a.length&&(t.errors=a)}return t},t.prototype.render=function(e){var r=this,t=!1;return e.region&&e.region.html&&(r.$wrapper.replaceWith(e.region.html),t=!0),t},t.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},t.prototype.update=function(e){var r=this;r.reload=!!e.reload,r.scope.update().always(function(){r.reload=!0})},t}(e),o=function(e){var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.active_class="is-active",r.onChange="function"==typeof e.onChange?e.onChange:function(){},r.$active=r.$wrapper.find(".wa-type-wrapper."+r.active_class),r.initClass()},r.prototype.initClass=function(){var r=this;r.$wrapper.on("click",".wa-type-wrapper",function(t){t.preventDefault(),r.changeType(e(this))})},r.prototype.changeType=function(e){var r=this;if(e.hasClass(r.active_class))return!1;var t=e.data("id");t&&(r.$active.length&&r.$active.removeClass(r.active_class),r.$active=e.addClass(r.active_class),r.onChange(t))},r}(jQuery);return o=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.locales=e.locales,r.errors=e.errors,r.scope=e.scope,r.reload=!0,r.initClass()},o.prototype.initClass=function(){var t=this;"object"==typeof t.errors&&Object.keys(t.errors).length&&t.scope.DEBUG("Errors:","error",t.errors),t.$form.on("submit",function(e){e.preventDefault()});var o=null,a=t.$wrapper.find("#js-delivery-types-section");if(a.length){var n=a.find(".js-type-field");new r({$wrapper:a,onChange:function(e){n.val(e),t.scope.DEBUG("Delivery type changed â€” "+e,"info"),o&&o.val(""),t.update({reload:!0})}})}var i=t.$wrapper.find("#js-delivery-variants-section");i.length&&(o=i.find(".js-variant-field"),new window.waOrder.ui.Dropdown({$wrapper:i.find(".js-variants-select"),hover:!1,change_title:!1,change_selector:".wa-dropdown-item",change:function(r,a,n){var i=e(a),s=i.data("id"),l=i.find(".wa-name").data("name");o.val(s),n.setTitle(l),t.update({reload:!0})}}))},o.prototype.getData=function(r){var t=this,o=[];if(r.clean)o.push({name:"shipping[html]",value:"only"});else{var a=!1!==r.render_errors;t.$form.length&&(o=t.$form.serializeArray()),!r.only_api&&t.reload&&o.push({name:"shipping[html]",value:"only"});var n=t.scope.validate(t.$form),i=t.$wrapper.find("#js-delivery-types-section");if(i.length){var s=i.find(".wa-types-list"),l=i.find(".js-type-field");if(!e.trim(l.val()).length&&(n.push({$wrapper:s,id:"type_required",value:t.locales.type_required}),a&&!s.hasClass("wa-error"))){var p=e('<div class="wa-error-text" />').text(t.locales.type_required).insertAfter(s);s.addClass("wa-error").one("change",function(){s.removeClass("wa-error"),p.remove()})}}var c=t.$wrapper.find("#js-delivery-variants-section");if(c.length){var u=c.find(".js-variants-select"),f=c.find(".js-variant-field");if(!e.trim(f.val()).length&&(n.push({$wrapper:u,id:"variant_required",value:t.locales.variant_required}),a&&!u.hasClass("wa-error"))){var d=e('<div class="wa-error-text" />').text(t.locales.variant_required).insertAfter(u);u.addClass("wa-error").one("change",function(){u.removeClass("wa-error"),d.remove()})}}n.length&&(o.errors=n)}return o},o.prototype.render=function(e){var r=this,t=!1;return e.shipping&&e.shipping.html&&(r.$wrapper.replaceWith(e.shipping.html),t=!0),t},o.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},o.prototype.update=function(e){var r=this;r.reload=!!e.reload,r.scope.update().always(function(){r.reload=!0})},o}(e),a=function(e){return a=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.reload=!0,r.initClass()},a.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&r.scope.DEBUG("Errors:","error",r.errors),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, textarea, input",function(t){var o=e(this),a=!!o.data("affects-rate")||!!o.data("reload"),n=o.closest(".wa-field-wrapper");n.length||(n=o.parent()),r.scope.validate(n,!0).length||a&&r.update({reload:!0})}),r.initPhotos()},a.prototype.initPhotos=function(){var r=this,t=r.$wrapper.find(".wa-photos-section");if(!t.length)return!1;!function(){var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.$slides=e.$slides,r.$left_arrow=e.$left_arrow,r.$right_arrow=e.$right_arrow,r.disable_class="is-disabled",r.wrapper_w=null,r.scroll_w=null,r.slide_w=null,r.left=0,r.is_locked=!1,r.initClass()},r.prototype.initClass=function(){function r(){e.contains(document,t.$wrapper[0])?t.wrapper_w!==t.$wrapper.outerWidth()&&t.reset():o.off("resize",r)}var t=this,o=e(window);t.setData(),t.showArrows(),t.$wrapper.on("scroll",function(e){t.left=t.$wrapper.scrollLeft()}),t.$left_arrow.on("click",function(e){e.preventDefault(),t.$left_arrow.hasClass(t.disable_class)||t.move(!1)}),t.$right_arrow.on("click",function(e){e.preventDefault(),t.$right_arrow.hasClass(t.disable_class)||t.move(!0)}),o.on("resize",r)},r.prototype.setData=function(){var e=this;e.wrapper_w=e.$wrapper.outerWidth(),e.scroll_w=e.$wrapper[0].scrollWidth,e.slide_w=e.$slides.first().outerWidth(!0)},r.prototype.showArrows=function(){var e=this,r=e.disable_class;e.left>0?(e.$left_arrow.removeClass(r),e.scroll_w-e.wrapper_w-e.left>0?e.$right_arrow.removeClass(r):e.$right_arrow.addClass(r)):(e.$left_arrow.addClass(r),e.scroll_w-e.wrapper_w>0?e.$right_arrow.removeClass(r):e.$right_arrow.addClass(r))},r.prototype.set=function(e){var r=this;r.is_locked||(r.is_locked=!0,e=e?parseFloat(e):0,e>=0||(e=0),r.$wrapper.animate({scrollLeft:e},200,function(){r.is_locked=!1}),r.left=e)},r.prototype.move=function(e){var r=this,t=4*r.slide_w,o=r.scroll_w-r.wrapper_w,a=0;o>0&&(e?(a=r.left+t,a%r.slide_w>0&&(a=parseInt(r.left/r.slide_w)*r.slide_w),a>o&&(a=o)):(a=r.left-t,a%r.slide_w>0&&(a=parseInt(r.left/r.slide_w)*r.slide_w),a<0&&(a=0))),r.set(a),r.showArrows()},r.prototype.reset=function(){var e=this;e.set(),e.setData(),e.showArrows()},r}(e),o=t.find(".wa-photos-list"),a=o.find(".wa-photo-wrapper");new r({$wrapper:o,$slides:a,$left_arrow:t.find(".js-scroll-prev"),$right_arrow:t.find(".js-scroll-next")})}(),t.on("click",".js-show-photo",function(e){e.preventDefault(),window.open(this.href)})},a.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"details[html]",value:"only"});else{var o=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"details[html]",value:"only"});var a=r.scope.validate(r.$form,o);a.length&&(t.errors=a)}return t},a.prototype.render=function(e){var r=this,t=!1;return e.details&&e.details.html&&(r.$wrapper.replaceWith(e.details.html),t=!0),t},a.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},a.prototype.update=function(e){var r=this;r.reload=!!e.reload,r.scope.update().always(function(){r.reload=!0})},a}(e),n=function(e){return n=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.locales=e.locales,r.reload=!0,r.initClass()},n.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&r.scope.DEBUG("Errors:","error",r.errors),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, textarea, input",function(t){var o=e(this),a=!!o.data("affects-rate")||!!o.data("reload"),n=o.closest(".wa-field-wrapper");n.length||(n=o.parent()),r.scope.validate(n,!0).length||a&&r.update({reload:!0})}),r.initMethods()},n.prototype.initMethods=function(){function r(e){var r=e.find(".js-method-field");n.length&&n.removeClass(a),n=e.addClass(a),r.attr("checked",!0).trigger("change")}var t=this,o=t.$wrapper.find(".js-methods-list");if(!o.length)return!1;var a="is-active",n=o.find(".wa-method-wrapper."+a);o.on("click",".wa-method-wrapper",function(t){t.preventDefault();var o=e(this);n.length?n[0]!==o[0]&&r(o):r(o)})},n.prototype.getData=function(r){var t=this,o=[];if(r.clean)o.push({name:"payment[html]",value:"only"});else{var a=!1!==r.render_errors;t.$form.length&&(o=t.$form.serializeArray()),!r.only_api&&t.reload&&o.push({name:"payment[html]",value:1});var n=t.scope.validate(t.$wrapper,a),i=t.$wrapper.find(".js-methods-list");if(i.length){var s=i.find(".js-method-field:checked");if(s.length)o.push({name:s.attr("name"),value:s.val()});else if(n.push({$wrapper:i,id:"method_required",value:t.locales.method_required}),a){if(!i.hasClass("wa-error")){var l=e('<div class="wa-error-text" />').text(t.locales.method_required).insertAfter(i);i.addClass("wa-error").one("change",function(){i.removeClass("wa-error"),l.remove()})}}}n.length&&(o.errors=n)}return o},n.prototype.render=function(e){var r=this,t=!1;return e.payment&&e.payment.html&&(r.$wrapper.replaceWith(e.payment.html),t=!0),t},n.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},n.prototype.update=function(e){var r=this;return e.reload&&(r.reload=!0),r.scope.update()},n}(e),i=function(e){return i=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.templates=e.templates,r.reload=!0,r.initClass()},i.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&(r.scope.DEBUG("Errors:","error",r.errors),r.renderErrors(r.errors)),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, input, textarea",function(t){var o=e(this),a=o.closest(".wa-field-wrapper");o.data("reload")?r.update({reload:!0}):a.length&&r.scope.validate(a,!0)});var t=r.$wrapper.find(".wa-comment-section");if(t.length){t.on("click"," .js-open-section",function(e){e.preventDefault(),t.toggleClass("is-opened")})}r.$wrapper.on("click",".js-show-terms-dialog",function(t){t.preventDefault(),r.templates.terms_dialog&&new r.scope.ui.Dialog({$wrapper:e(r.templates.terms_dialog)})}),r.$wrapper.on("click",".js-submit-order-button",function(e){e.preventDefault(),r.create()})},i.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"confirm[html]",value:"only"});else{var o=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"confirm[html]",value:1});var a=r.scope.validate(r.$wrapper,o);a.length&&(t.errors=a)}return t},i.prototype.render=function(e){var r=this,t=!1;return e.confirm&&e.confirm.html&&(r.$wrapper.replaceWith(e.confirm.html),t=!0),t},i.prototype.renderErrors=function(r){var t=this,o=[];return e.each(r,function(e,r){"cart_invalid"===r.name&&t.$wrapper.trigger("wa_order_cart_invalid"),o.push(r)}),o},i.prototype.update=function(e){var r=this;return e.reload&&(r.reload=!0),r.scope.update()},i.prototype.create=function(){function r(r){function t(e){var r=0;if(e.is(":visible"))r=e.offset().top;else{var o=e.parent();o.length&&(r=t(o))}return r}var o=0;if(r.$field&&r.$field.length){o=t(r.$field)-40,r.$field.focus()}r.$wrapper&&r.$wrapper.length&&(o=r.$wrapper.offset().top-40),e("html, body").scrollTop(o)}var t=this,o=t.scope.validate(t.scope.$wrapper,!0);o.length?(t.scope.DEBUG("Errors:","error",o),r(o[0])):t.scope.update({create:!0,render_errors:!0}).then(function(e){if(e.order_id){t.scope.trigger("created",e),t.scope.lock(!0);try{location.href=t.scope.urls.success}catch(e){t.scope.DEBUG(e.message,"error")}}else{var o=t.scope.renderErrors(e);o.length&&r(o[0])}},function(e,t){"front_errors"===e&&t.length&&r(t[0])})},i}(e),s=function(e){function l(r){return r.errors&&(Array.isArray(r.errors)||(r.errors=function(r){var t=[];return r&&e.each(r,function(e,r){t.push({name:e,value:r})}),t}(r.errors))),r}return s=function(r){var t=this;if(!(r.outer_options&&"string"==typeof r.outer_options.wrapper&&r.outer_options.wrapper.length>0))throw new Error("Checkout wrapper element not specified.");var o=e(r.outer_options.wrapper);if(1!==o.length)throw new Error("Error: Checkout form wrapper element must be exactly one on page (found "+o.length+")");if(!r.urls.calculate)throw new Error("Must specify url_calculate");if(!r.urls.create)throw new Error("Must specify url_create_order");t.$outer_wrapper=o,t.$wrapper=r.$wrapper,t.options=r.outer_options,t.locales=r.locales,t.urls=r.urls,t.ui=window.waOrder.ui,t.sections={},t.render_scheduled=!1,t.calculate_promise=null,t.create_promise=null,t.calculate_xhr=null,t.reload_xhr=null,t.create_xhr=null,t.initClass()},s.prototype.initClass=function(){function r(){var e=i.getFormData({sections:["auth","region","confirm"]});i.update({data:e}).then()}function t(){e.contains(document,i.$wrapper[0])?i.update().then():s.off("click",t)}function o(){e.contains(document,i.$wrapper[0])?i.reload():s.off("wa_auth_contact_logout",o)}function a(){e.contains(document,i.$wrapper[0])?(s.trigger("wa_order_reload_start"),location.reload()):e(document).off("wa_auth_contact_logged",a)}function n(){e.contains(document,i.$wrapper[0])?i.lock(!0):s.off("wa_order_reload_start",n)}var i=this,s=e(document);i.$wrapper.removeAttr("style").removeClass("is-not-ready"),i.$outer_wrapper.data("controller",i),i.trigger("ready",i),i.$wrapper.data("ready").resolve(i),i.$wrapper.on("region_change",r),s.on("wa_order_cart_changed",t),s.on("wa_auth_contact_logout",o),s.on("wa_auth_contact_logged",a),s.on("wa_order_reload_start",n)},s.prototype.DEBUG=function(){var e=this,r=console.log,t={hint:"font-weight: bold; color: #666;",info:"font-weight: bold; font-size: 1.25em; color: blue;",warn:"font-weight: bold; font-size: 1.25em;",error:"font-weight: bold; font-size: 1.25em;"};if(e.options&&e.options.DEBUG){if(t[arguments[1]]){switch(arguments[0]="string"==typeof arguments[0]?"%c"+arguments[0]:arguments[0],arguments[1]){case"info":r=console.info;break;case"error":r=console.error;break;case"warn":r=console.warn}arguments[1]=t[arguments[1]]}return r.apply(console,arguments)}},s.prototype.initAuth=function(e){var t=this;e.scope=t,t.sections.auth=new r(e),t.DEBUG("Auth initialized","info",t.sections.auth)},s.prototype.initRegion=function(e){var r=this;e.scope=r,r.sections.region=new t(e),r.DEBUG("Region initialized","info",r.sections.region)},s.prototype.initShipping=function(e){var r=this;e.scope=r,r.sections.shipping=new o(e),r.DEBUG("Shipping initialized","info",r.sections.shipping)},s.prototype.initDetails=function(e){var r=this;e.scope=r,r.sections.details=new a(e),r.DEBUG("Details initialized","info",r.sections.details)},s.prototype.initPayment=function(e){var r=this;e.scope=r,r.sections.payment=new n(e),r.DEBUG("Payment initialized","info",r.sections.payment)},s.prototype.initConfirm=function(e){var r=this;e.scope=r,r.sections.confirm=new i(e),r.DEBUG("Confirm initialized","info",r.sections.confirm)},s.prototype.trigger=function(e,r){var t=this,o="wa_order_form_"+e;t.$wrapper.triggerHandler(e,r||null),t.$outer_wrapper.trigger(o,r||null)},s.prototype.validate=function(r,t){function o(r){function t(){n.removeClass(a),o.remove(),n.off("change",t)}var o=e('<div class="wa-error-text" />').text(r.value),a="wa-error";if(r.$field){var n=r.$field;if(!n.hasClass(a)){n.addClass(a);var i=n.closest(".wa-field-wrapper");i.length?i.append(o):o.insertAfter(n),n.on("change keyup",t)}}}var a=this,n=[];return r.find(".wa-input").each(function(){var r=e(this),t=r.attr("name"),o=r.val().trim();if(r.is(":disabled"))return!0;if(o.length){if(!t)return!0;if(r.hasClass("wa-email")){a.ui.validate.email(o)||n.push({$field:r,name:t,value:a.locales.invalid})}else if(r.hasClass("wa-phone")){var i=a.ui.validate.phone(o);i||n.push({$field:r,name:t,value:a.locales.invalid})}else if(r.hasClass("wa-url")){var s=a.ui.validate.url(o);s||n.push({$field:r,name:t,value:a.locales.invalid})}else if(r.hasClass("wa-number")){var l=a.ui.validate.number(o);l||n.push({$field:r,name:t,value:a.locales.invalid})}}else{!!r.attr("required")&&n.push({$field:r,name:t,value:a.locales.required})}}),r.find(".wa-checkbox").each(function(){var r=e(this),t=r.attr("name"),o=r.is(":checked");if(r.is(":disabled"))return!0;if(o){if(!t)return!0}else{!!r.attr("required")&&n.push({$field:r,name:t,value:a.locales.required})}}),r.find(".wa-select, wa-textarea").each(function(){var r=e(this),t=r.attr("name"),o=e.trim(r.val());if(r.is(":disabled"))return!0;if(o.length){if(!t)return!0}else{!!r.attr("required")&&n.push({$field:r,name:t,value:a.locales.required})}}),t&&n.length&&e.each(n,function(e,r){o(r)}),n},s.prototype.renderErrors=function(r){var t=this,o=[];return r.error_step_id&&r.errors&&e.each(t.sections,function(e,t){if(r.error_step_id===e&&"function"==typeof t.renderErrors){var a=t.renderErrors(r.errors);a.length&&(o=o.concat(a))}}),o},s.prototype.getFormData=function(r){r=r||{};var t=this,o=[],a=[],n=!!r.render_errors;return e.each(t.sections,function(e,t){var i=!1;if(r.sections&&Array.isArray(r.sections)&&(r.sections.indexOf(e)>=0||(i=!0)),"function"==typeof t.getData){var s=n&&!a.length,l=t.getData({clean:i,only_api:!!r.only_api,render_errors:s});l.length&&(o=o.concat(l)),l.errors&&(a=a.concat(l.errors))}}),a.length&&(o.errors=a,t.DEBUG("Errors:","warn",a)),o},s.prototype.update=function(r){r=r||{};var t=this,o=e.Deferred(),a=o.promise(),n=[],i=!!r.render_errors,s=!1;if(n=r.data?r.data:t.getFormData({render_errors:i}),i&&n.errors)return o.reject("front_errors",n.errors),a;a=r.create?t.create(n):t.calculate(n);var l=["auth","region","shipping","details","payment","confirm"];return e.each(l,function(e,r){var o=null;if(!t.sections[r])return!0;o=t.sections[r],o.$wrapper.addClass("is-locked"),a.always(function(){o.$wrapper.removeClass("is-locked")}).then(function(e){if("function"==typeof o.render){o.render(e)&&(s=!0,t.trigger(r+"_changed",e))}},function(e,r){r&&t.DEBUG("render errors:","errors",r)})}),a.then(function(e){s&&t.trigger("changed",e)}),a},s.prototype.calculate=function(r){function t(){if(!r)return o.DEBUG("Form data is required.","error"),a.reject("error"),!1;r.push({name:"response",value:"json"}),o.DEBUG("Form data:","info"),o.DEBUG(r),o.calculate_xhr=e.post(o.urls.calculate,r,"json").done(function(e){if("ok"===e.status){var r=l(e.data);o.DEBUG("API received:","info"),o.DEBUG(r),a.resolve(r)}else o.DEBUG("API not received.","error",e.errors?e.errors:"No error description"),a.reject("fail",e)}).fail(function(e,r){"abort"===r?t():(o.DEBUG("Getting API aborted.","error",r),a.reject(r))})}var o=this;if(o.calculate_promise)return o.calculate_xhr&&o.calculate_xhr.abort(),o.calculate_promise;var a=e.Deferred();return o.calculate_promise=a.promise(),o.calculate_promise.then(function(){o.calculate_promise=null,o.calculate_xhr=null},function(){o.calculate_promise=null,o.calculate_xhr=null}),t(),o.calculate_promise},s.prototype.create=function(r){var t=this;if(t.create_promise)return t.create_xhr&&t.create_xhr.abort(),t.create_promise;var o=e.Deferred();return t.create_promise=o.promise(),t.create_promise.then(function(){t.create_promise=null,t.create_xhr=null},function(){t.create_promise=null,t.create_xhr=null}),function(){if(!r)return t.DEBUG("Form data is required.","error"),o.reject("error"),!1;r.push({name:"response",value:"json"}),t.DEBUG("Form data for create:","info"),t.DEBUG(r),t.create_xhr=e.post(t.urls.create,r,"json").done(function(e){if("ok"===e.status){var r=l(e.data);t.DEBUG("API received:","info"),t.DEBUG(r),o.resolve(r)}else t.DEBUG("API not received.","error",e.errors?e.errors:"No error description"),o.reject("fail",e)}).fail(function(e,r){t.DEBUG("Getting API aborted.","error",r),o.reject(r)})}(),t.create_promise},s.prototype.reload=function(){var r=this,t=e.Deferred();if(!r.reload_xhr){r.calculate_xhr&&(r.calculate_xhr.abort(),r.calculate_xhr=!1),r.lock(!0);var o=r.getFormData({only_api:!0});r.options&&(o.push({name:"opts[DEBUG]",value:r.options.DEBUG?1:0}),o.push({name:"opts[wrapper]",value:r.options.wrapper}),void 0===r.options.adaptive||r.options.adaptive&&"false"!==r.options.adaptive||o.push({name:"opts[adaptive]",value:"false"})),o.push({name:"response",value:"html"}),r.DEBUG("Form is reloading...","info",o),r.trigger("before_reload",r),r.reload_xhr=e.post(r.urls.calculate,o).done(function(e){r.$outer_wrapper.one("wa_order_form_ready",function(){var e=r.$outer_wrapper.data("controller");t.resolve(e)}),r.$wrapper.replaceWith(e),r.DEBUG("Form reloaded.","info"),r.trigger("reloaded",r)}).fail(function(e,o){r.DEBUG("Reload is failed.","error",o),t.reject(o)}).always(function(){r.lock(!1),r.reload_xhr=!1})}return t.promise()},s.prototype.lock=function(e){var r=this;e?r.$wrapper.addClass("is-locked"):r.$wrapper.removeClass("is-locked")},s}(e);window.waOrder=window.waOrder||{},window.waOrder.Form=s}(jQuery);
//# sourceMappingURL=form.min.js.map
