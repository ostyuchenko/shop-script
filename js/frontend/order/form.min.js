!function(e){"use strict";var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.templates=e.templates,r.errors=e.errors,r.scope=e.scope,r.contact_id=e.contact_id,r.reload=!1,r.initClass()},r.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&r.scope.DEBUG("Errors:","error",r.errors),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, textarea, input",function(t){var a=e(this),o=!!a.data("affects-rate")||!!a.data("reload"),n=a.closest(".wa-field-wrapper");n.length||(n=a.parent()),r.scope.validate(n,!0).length||o&&r.update({reload:!0})}),r.initType(),r.initAuth(),r.initDatepicker()},r.prototype.initAuth=function(){function r(r,a){r.on("click","a",function(r){var a=e(this),o=a.data("type"),n=["login","signup","forgotpassword","setpassword"];o&&(r.preventDefault(),n.indexOf(o)>=0&&t(o))}),r.on("wa_auth_set_password",function(e,r){t("setpassword",{data:[{name:"hash",value:r}]})}),r.on("wa_auth_resent_password",function(e,r){t("login")}),r.on("wa_auth_contact_signed",function(e,r,a){a.password_sent&&t("login")}),r.on("wa_auth_form_change_view",function(){a.resize()})}function t(t,i){i=i||{};var s=a.scope.urls.auth_dialog,l=[{name:"type",value:t}],p=a.$wrapper.find(".js-type-field");if(p.length){var c=e.trim(p.val());c&&l.push({name:"contact_type",value:c})}return i.data&&(l=l.concat(i.data)),n&&n.abort(),o&&o.lock(!0),n=e.post(s,l,function(t){o&&o.close(),o=new window.waOrder.ui.Dialog({$wrapper:e(t),onOpen:r})}).always(function(){n=null})}var a=this,o=null,n=null;a.scope.$wrapper.on("before_reload",function(){o&&o.close()}),a.contact_id?a.$wrapper.on("click",".js-logout-button",function(r){r.preventDefault();var t=a.scope.urls.logout;e.get(t,function(){a.scope.$wrapper.trigger("wa_auth_contact_logout")})}):a.$wrapper.on("click",".js-show-login-dialog",function(e){e.preventDefault(),t("login")})},r.prototype.initType=function(){var r=this,t=r.$wrapper.find(".js-type-toggle").first(),a=r.$wrapper.find(".js-type-field");new window.waOrder.ui.Toggle({$wrapper:t,change:function(t,o,n){var i=e(o).data("id");i&&(r.reload=!0,a.val(i),r.scope.update())}})},r.prototype.initDatepicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var r=e(this),t={},a=r.data("alt");if(a){var o=r.closest(".wa-field-wrapper").find(a);o.length&&(t.altField=o,t.altFormat="yy-mm-dd")}r.datepicker(t),r.on("keydown keypress keyup",function(e){13===e.which&&e.preventDefault()})})},r.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"auth[html]",value:1});else{var a=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"auth[html]",value:1});var o=r.scope.validate(r.$form,a);o.length&&(t.errors=o)}return t},r.prototype.render=function(e){var r=this,t=!1;return e.auth&&e.auth.html&&(r.$wrapper.replaceWith(e.auth.html),t=!0),t},r.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},r.prototype.update=function(e){var r=this;return e.reload&&(r.reload=!0),r.scope.update()},r}(e),t=function(e){return t=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.reload=!0,r.initClass()},t.prototype.initClass=function(){function r(r,o){r.length&&(r.on("keydown",function(){t(r)}),r.on("change",function(){o&&o.length&&e.each(o,function(e,r){r.length&&r.attr("disabled",!0)}),a(r)}))}function t(e){clearTimeout(n),n=setTimeout(function(){e.trigger("change")},i)}function a(e){clearTimeout(n),o.scope.trigger("region_change")}var o=this,n=0,i=2e3;"object"==typeof o.errors&&Object.keys(o.errors).length&&o.scope.DEBUG("Errors:","error",o.errors),o.$form.on("submit",function(e){e.preventDefault()});var s=o.$form.find(".js-location-field"),l=o.$form.find(".js-country-field"),p=o.$form.find(".js-region-field"),c=o.$form.find(".js-city-field"),u=o.$form.find(".js-zip-field");r(l,[p,c,u]),r(p,[c,u]),r(c,[u]),r(s),r(u)},t.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"region[html]",value:"only"});else{var a=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"region[html]",value:"only"});var o=r.scope.validate(r.$form,a);o.length&&(t.errors=o)}return t},t.prototype.render=function(e){var r=this,t=!1;return e.region&&e.region.html&&(r.$wrapper.replaceWith(e.region.html),t=!0),t},t.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},t.prototype.update=function(e){var r=this;r.reload=!!e.reload,r.scope.update().always(function(){r.reload=!0})},t}(e),a=function(e){var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.active_class="is-active",r.onChange="function"==typeof e.onChange?e.onChange:function(){},r.$active=r.$wrapper.find(".wa-type-wrapper."+r.active_class),r.initClass()},r.prototype.initClass=function(){var r=this;r.$wrapper.on("click",".wa-type-wrapper",function(t){t.preventDefault(),r.changeType(e(this))})},r.prototype.changeType=function(e){var r=this;if(e.hasClass(r.active_class))return!1;var t=e.data("id");t&&(r.$active.length&&r.$active.removeClass(r.active_class),r.$active=e.addClass(r.active_class),r.onChange(t))},r}(jQuery);return a=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.locales=e.locales,r.errors=e.errors,r.scope=e.scope,r.reload=!0,r.initClass()},a.prototype.initClass=function(){var t=this;"object"==typeof t.errors&&Object.keys(t.errors).length&&t.scope.DEBUG("Errors:","error",t.errors),t.$form.on("submit",function(e){e.preventDefault()});var a=null,o=t.$wrapper.find("#js-delivery-types-section");if(o.length){var n=o.find(".js-type-field");new r({$wrapper:o,onChange:function(e){n.val(e),t.scope.DEBUG("Delivery type changed â€” "+e,"info"),a&&a.val(""),t.update({reload:!0})}})}var i=t.$wrapper.find("#js-delivery-variants-section");i.length&&(a=i.find(".js-variant-field"),new window.waOrder.ui.Dropdown({$wrapper:i.find(".js-variants-select"),hover:!1,change_title:!1,change_selector:".wa-dropdown-item",change:function(r,o,n){var i=e(o),s=i.data("id"),l=i.find(".wa-name").data("name");a.val(s),n.setTitle(l),t.update({reload:!0})}}))},a.prototype.getData=function(r){var t=this,a=[];if(r.clean)a.push({name:"shipping[html]",value:"only"});else{var o=!1!==r.render_errors;t.$form.length&&(a=t.$form.serializeArray()),!r.only_api&&t.reload&&a.push({name:"shipping[html]",value:"only"});var n=t.scope.validate(t.$form),i=t.$wrapper.find("#js-delivery-types-section");if(i.length){var s=i.find(".wa-types-list"),l=i.find(".js-type-field");if(!e.trim(l.val()).length&&(n.push({$wrapper:s,id:"type_required",value:t.locales.type_required}),o&&!s.hasClass("wa-error"))){var p=e('<div class="wa-error-text" />').text(t.locales.type_required).insertAfter(s);s.addClass("wa-error").one("change",function(){s.removeClass("wa-error"),p.remove()})}}var c=t.$wrapper.find("#js-delivery-variants-section");if(c.length){var u=c.find(".js-variants-select"),f=c.find(".js-variant-field");if(!e.trim(f.val()).length&&(n.push({$wrapper:u,id:"variant_required",value:t.locales.variant_required}),o&&!u.hasClass("wa-error"))){var d=e('<div class="wa-error-text" />').text(t.locales.variant_required).insertAfter(u);u.addClass("wa-error").one("change",function(){u.removeClass("wa-error"),d.remove()})}}n.length&&(a.errors=n)}return a},a.prototype.render=function(e){var r=this,t=!1;return e.shipping&&e.shipping.html&&(r.$wrapper.replaceWith(e.shipping.html),t=!0),t},a.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},a.prototype.update=function(e){var r=this;r.reload=!!e.reload,r.scope.update().always(function(){r.reload=!0})},a}(e),o=function(e){return o=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.reload=!0,r.initClass()},o.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&r.scope.DEBUG("Errors:","error",r.errors),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, textarea, input",function(t){var a=e(this),o=!!a.data("affects-rate")||!!a.data("reload"),n=a.closest(".wa-field-wrapper");n.length||(n=a.parent()),r.scope.validate(n,!0).length||o&&r.update({reload:!0})}),r.initPhotos()},o.prototype.initPhotos=function(){var r=this,t=r.$wrapper.find(".wa-photos-section");if(!t.length)return!1;!function(){var r=function(e){return r=function(e){var r=this;r.$wrapper=e.$wrapper,r.$slides=e.$slides,r.$left_arrow=e.$left_arrow,r.$right_arrow=e.$right_arrow,r.disable_class="is-disabled",r.wrapper_w=null,r.scroll_w=null,r.slide_w=null,r.left=0,r.is_locked=!1,r.initClass()},r.prototype.initClass=function(){function r(){e.contains(document,t.$wrapper[0])?t.wrapper_w!==t.$wrapper.outerWidth()&&t.reset():a.off("resize",r)}var t=this,a=e(window);t.setData(),t.showArrows(),t.$wrapper.on("scroll",function(e){t.left=t.$wrapper.scrollLeft()}),t.$left_arrow.on("click",function(e){e.preventDefault(),t.$left_arrow.hasClass(t.disable_class)||t.move(!1)}),t.$right_arrow.on("click",function(e){e.preventDefault(),t.$right_arrow.hasClass(t.disable_class)||t.move(!0)}),a.on("resize",r)},r.prototype.setData=function(){var e=this;e.wrapper_w=e.$wrapper.outerWidth(),e.scroll_w=e.$wrapper[0].scrollWidth,e.slide_w=e.$slides.first().outerWidth(!0)},r.prototype.showArrows=function(){var e=this,r=e.disable_class;e.left>0?(e.$left_arrow.removeClass(r),e.scroll_w-e.wrapper_w-e.left>0?e.$right_arrow.removeClass(r):e.$right_arrow.addClass(r)):(e.$left_arrow.addClass(r),e.scroll_w-e.wrapper_w>0?e.$right_arrow.removeClass(r):e.$right_arrow.addClass(r))},r.prototype.set=function(e){var r=this;r.is_locked||(r.is_locked=!0,e=e?parseFloat(e):0,e>=0||(e=0),r.$wrapper.animate({scrollLeft:e},200,function(){r.is_locked=!1}),r.left=e)},r.prototype.move=function(e){var r=this,t=4*r.slide_w,a=r.scroll_w-r.wrapper_w,o=0;a>0&&(e?(o=r.left+t,o%r.slide_w>0&&(o=parseInt(r.left/r.slide_w)*r.slide_w),o>a&&(o=a)):(o=r.left-t,o%r.slide_w>0&&(o=parseInt(r.left/r.slide_w)*r.slide_w),o<0&&(o=0))),r.set(o),r.showArrows()},r.prototype.reset=function(){var e=this;e.set(),e.setData(),e.showArrows()},r}(e),a=t.find(".wa-photos-list"),o=a.find(".wa-photo-wrapper");new r({$wrapper:a,$slides:o,$left_arrow:t.find(".js-scroll-prev"),$right_arrow:t.find(".js-scroll-next")})}(),t.on("click",".js-show-photo",function(e){e.preventDefault(),window.open(this.href)})},o.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"details[html]",value:"only"});else{var a=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"details[html]",value:"only"});var o=r.scope.validate(r.$form,a);o.length&&(t.errors=o)}return t},o.prototype.render=function(e){var r=this,t=!1;return e.details&&e.details.html&&(r.$wrapper.replaceWith(e.details.html),t=!0),t},o.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},o.prototype.update=function(e){var r=this;r.reload=!!e.reload,r.scope.update().always(function(){r.reload=!0})},o}(e),n=function(e){return n=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.locales=e.locales,r.reload=!0,r.initClass()},n.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&r.scope.DEBUG("Errors:","error",r.errors),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, textarea, input",function(t){var a=e(this),o=!!a.data("affects-rate")||!!a.data("reload"),n=a.closest(".wa-field-wrapper");n.length||(n=a.parent()),r.scope.validate(n,!0).length||o&&r.update({reload:!0})}),r.initMethods()},n.prototype.initMethods=function(){function r(e){var r=e.find(".js-method-field");n.length&&n.removeClass(o),n=e.addClass(o),r.attr("checked",!0).trigger("change")}var t=this,a=t.$wrapper.find(".js-methods-list");if(!a.length)return!1;var o="is-active",n=a.find(".wa-method-wrapper."+o);a.on("click",".wa-method-wrapper",function(t){t.preventDefault();var a=e(this);n.length?n[0]!==a[0]&&r(a):r(a)})},n.prototype.getData=function(r){var t=this,a=[];if(r.clean)a.push({name:"payment[html]",value:"only"});else{var o=!1!==r.render_errors;t.$form.length&&(a=t.$form.serializeArray()),!r.only_api&&t.reload&&a.push({name:"payment[html]",value:1});var n=t.scope.validate(t.$wrapper,o),i=t.$wrapper.find(".js-methods-list");if(i.length){var s=i.find(".js-method-field:checked");if(s.length)a.push({name:s.attr("name"),value:s.val()});else if(n.push({$wrapper:i,id:"method_required",value:t.locales.method_required}),o){if(!i.hasClass("wa-error")){var l=e('<div class="wa-error-text" />').text(t.locales.method_required).insertAfter(i);i.addClass("wa-error").one("change",function(){i.removeClass("wa-error"),l.remove()})}}}n.length&&(a.errors=n)}return a},n.prototype.render=function(e){var r=this,t=!1;return e.payment&&e.payment.html&&(r.$wrapper.replaceWith(e.payment.html),t=!0),t},n.prototype.renderErrors=function(r){var t=[];return e.each(r,function(e,r){t.push(r)}),t},n.prototype.update=function(e){var r=this;return e.reload&&(r.reload=!0),r.scope.update()},n}(e),i=function(e){return i=function(e){var r=this;r.$wrapper=e.$wrapper,r.$form=r.$wrapper.find("form:first"),r.errors=e.errors,r.scope=e.scope,r.templates=e.templates,r.reload=!0,r.initClass()},i.prototype.initClass=function(){var r=this;"object"==typeof r.errors&&Object.keys(r.errors).length&&(r.scope.DEBUG("Errors:","error",r.errors),r.renderErrors(r.errors)),r.$form.on("submit",function(e){e.preventDefault()}),r.$wrapper.on("change","select, input, textarea",function(t){var a=e(this),o=a.closest(".wa-field-wrapper");a.data("reload")?r.update({reload:!0}):o.length&&r.scope.validate(o,!0)});var t=r.$wrapper.find(".wa-comment-section");if(t.length){t.on("click"," .js-open-section",function(e){e.preventDefault(),t.toggleClass("is-opened")})}r.$wrapper.on("click",".js-show-terms-dialog",function(t){t.preventDefault(),r.templates.terms_dialog&&new r.scope.ui.Dialog({$wrapper:e(r.templates.terms_dialog)})}),r.$wrapper.on("click",".js-submit-order-button",function(e){e.preventDefault(),r.create()})},i.prototype.getData=function(e){var r=this,t=[];if(e.clean)t.push({name:"confirm[html]",value:"only"});else{var a=!1!==e.render_errors;r.$form.length&&(t=r.$form.serializeArray()),!e.only_api&&r.reload&&t.push({name:"confirm[html]",value:1});var o=r.scope.validate(r.$wrapper,a);o.length&&(t.errors=o)}return t},i.prototype.render=function(e){var r=this,t=!1;return e.confirm&&e.confirm.html&&(r.$wrapper.replaceWith(e.confirm.html),t=!0),t},i.prototype.renderErrors=function(r){var t=this,a=[];return e.each(r,function(e,r){"cart_invalid"===r.name&&t.$wrapper.trigger("wa_order_cart_invalid"),a.push(r)}),a},i.prototype.update=function(e){var r=this;return e.reload&&(r.reload=!0),r.scope.update()},i.prototype.create=function(){function r(r){var t=0;r.$field&&r.$field.length&&(t=r.$field.offset().top-40,r.$field.focus()),r.$wrapper&&r.$wrapper.length&&(t=r.$wrapper.offset().top-40),e("html, body").scrollTop(t)}var t=this,a=t.scope.validate(t.scope.$wrapper,!0);a.length?(t.scope.DEBUG("Errors:","error",a),r(a[0])):t.scope.update({create:!0,render_errors:!0}).then(function(e){if(e.order_id){t.scope.trigger("created",e);try{location.href=t.scope.urls.success}catch(e){t.scope.DEBUG(e.message,"error")}}else{var a=t.scope.renderErrors(e);a.length&&r(a[0])}},function(e,t){"front_errors"===e&&t.length&&r(t[0])})},i}(e),s=function(e){function l(r){return r.errors&&(Array.isArray(r.errors)||(r.errors=function(r){var t=[];return r&&e.each(r,function(e,r){t.push({name:e,value:r})}),t}(r.errors))),r}return s=function(r){var t=this;if(!(r.outer_options&&"string"==typeof r.outer_options.wrapper&&r.outer_options.wrapper.length>0))throw new Error("Checkout wrapper element not specified.");var a=e(r.outer_options.wrapper);if(1!==a.length)throw new Error("Error: Checkout form wrapper element must be exactly one on page (found "+a.length+")");if(!r.urls.calculate)throw new Error("Must specify url_calculate");if(!r.urls.create)throw new Error("Must specify url_create_order");t.$outer_wrapper=a,t.$wrapper=r.$wrapper,t.options=r.outer_options,t.locales=r.locales,t.urls=r.urls,t.ui=window.waOrder.ui,t.sections={},t.render_scheduled=!1,t.calculate_promise=null,t.create_promise=null,t.calculate_xhr=null,t.reload_xhr=null,t.create_xhr=null,t.initClass()},s.prototype.initClass=function(){function r(){var e=n.getFormData({sections:["auth","region","confirm"]});n.update({data:e}).then()}function t(){e.contains(document,n.$wrapper[0])?n.update().then():i.off("click",t)}function a(){e.contains(document,n.$wrapper[0])?n.reload():i.off("wa_auth_contact_logout",a)}function o(){e.contains(document,n.$wrapper[0])?n.reload():e(document).off("wa_auth_contact_logged",o)}var n=this,i=e(document);n.$wrapper.removeAttr("style").removeClass("is-not-ready"),n.$outer_wrapper.data("controller",n),n.trigger("ready",n),n.$wrapper.data("ready").resolve(n),n.$wrapper.on("region_change",r),i.on("wa_order_cart_changed",t),i.on("wa_auth_contact_logout",a),i.on("wa_auth_contact_logged",o)},s.prototype.DEBUG=function(){var e=this,r=console.log,t={hint:"font-weight: bold; color: #666;",info:"font-weight: bold; font-size: 1.25em; color: blue;",warn:"font-weight: bold; font-size: 1.25em;",error:"font-weight: bold; font-size: 1.25em;"};if(e.options&&e.options.DEBUG){if(t[arguments[1]]){switch(arguments[0]="string"==typeof arguments[0]?"%c"+arguments[0]:arguments[0],arguments[1]){case"info":r=console.info;break;case"error":r=console.error;break;case"warn":r=console.warn}arguments[1]=t[arguments[1]]}return r.apply(console,arguments)}},s.prototype.initAuth=function(e){var t=this;e.scope=t,t.sections.auth=new r(e),t.DEBUG("Auth initialized","info",t.sections.auth)},s.prototype.initRegion=function(e){var r=this;e.scope=r,r.sections.region=new t(e),r.DEBUG("Region initialized","info",r.sections.region)},s.prototype.initShipping=function(e){var r=this;e.scope=r,r.sections.shipping=new a(e),r.DEBUG("Shipping initialized","info",r.sections.shipping)},s.prototype.initDetails=function(e){var r=this;e.scope=r,r.sections.details=new o(e),r.DEBUG("Details initialized","info",r.sections.details)},s.prototype.initPayment=function(e){var r=this;e.scope=r,r.sections.payment=new n(e),r.DEBUG("Payment initialized","info",r.sections.payment)},s.prototype.initConfirm=function(e){var r=this;e.scope=r,r.sections.confirm=new i(e),r.DEBUG("Confirm initialized","info",r.sections.confirm)},s.prototype.trigger=function(e,r){var t=this,a="wa_order_form_"+e;t.$wrapper.triggerHandler(e,r||null),t.$outer_wrapper.trigger(a,r||null)},s.prototype.validate=function(r,t){function a(r){function t(){n.removeClass(o),a.remove(),n.off("change",t)}var a=e('<div class="wa-error-text" />').text(r.value),o="wa-error";if(r.$field){var n=r.$field;if(!n.hasClass(o)){n.addClass(o);var i=n.closest(".wa-field-wrapper");i.length?i.append(a):a.insertAfter(n),n.on("change keyup",t)}}}var o=this,n=[];return r.find(".wa-input").each(function(){var r=e(this),t=r.attr("name"),a=r.val().trim();if(r.is(":disabled"))return!0;if(a.length){if(!t)return!0;if(r.hasClass("wa-email")){o.ui.validate.email(a)||n.push({$field:r,name:t,value:o.locales.invalid})}else if(r.hasClass("wa-phone")){var i=o.ui.validate.phone(a);i||n.push({$field:r,name:t,value:o.locales.invalid})}else if(r.hasClass("wa-url")){var s=o.ui.validate.url(a);s||n.push({$field:r,name:t,value:o.locales.invalid})}else if(r.hasClass("wa-number")){var l=o.ui.validate.number(a);l||n.push({$field:r,name:t,value:o.locales.invalid})}}else{!!r.attr("required")&&n.push({$field:r,name:t,value:o.locales.required})}}),r.find(".wa-checkbox").each(function(){var r=e(this),t=r.attr("name"),a=r.is(":checked");if(r.is(":disabled"))return!0;if(a){if(!t)return!0}else{!!r.attr("required")&&n.push({$field:r,name:t,value:o.locales.required})}}),r.find(".wa-select, wa-textarea").each(function(){var r=e(this),t=r.attr("name"),a=e.trim(r.val());if(r.is(":disabled"))return!0;if(a.length){if(!t)return!0}else{!!r.attr("required")&&n.push({$field:r,name:t,value:o.locales.required})}}),t&&n.length&&e.each(n,function(e,r){a(r)}),n},s.prototype.renderErrors=function(r){var t=this,a=[];return r.error_step_id&&r.errors&&e.each(t.sections,function(e,t){if(r.error_step_id===e&&"function"==typeof t.renderErrors){var o=t.renderErrors(r.errors);o.length&&(a=a.concat(o))}}),a},s.prototype.getFormData=function(r){r=r||{};var t=this,a=[],o=[],n=!!r.render_errors;return e.each(t.sections,function(e,t){var i=!1;if(r.sections&&Array.isArray(r.sections)&&(r.sections.indexOf(e)>=0||(i=!0)),"function"==typeof t.getData){var s=n&&!o.length,l=t.getData({clean:i,only_api:!!r.only_api,render_errors:s});l.length&&(a=a.concat(l)),l.errors&&(o=o.concat(l.errors))}}),o.length&&(a.errors=o,t.DEBUG("Errors:","warn",o)),a},s.prototype.update=function(r){r=r||{};var t=this,a=e.Deferred(),o=a.promise(),n=[],i=!!r.render_errors,s=!1;if(n=r.data?r.data:t.getFormData({render_errors:i}),i&&n.errors)return a.reject("front_errors",n.errors),o;o=r.create?t.create(n):t.calculate(n);var l=["auth","region","shipping","details","payment","confirm"];return e.each(l,function(e,r){var a=null;if(!t.sections[r])return!0;a=t.sections[r],a.$wrapper.addClass("is-locked"),o.always(function(){a.$wrapper.removeClass("is-locked")}).then(function(e){if("function"==typeof a.render){a.render(e)&&(s=!0,t.trigger(r+"_changed",e))}},function(e,r){r&&t.DEBUG("render errors:","errors",r)})}),o.then(function(e){s&&t.trigger("changed",e)}),o},s.prototype.calculate=function(r){function t(){if(!r)return a.DEBUG("Form data is required.","error"),o.reject("error"),!1;r.push({name:"response",value:"json"}),a.DEBUG("Form data:","info"),a.DEBUG(r),a.calculate_xhr=e.post(a.urls.calculate,r,"json").done(function(e){if("ok"===e.status){var r=l(e.data);a.DEBUG("API received:","info"),a.DEBUG(r),o.resolve(r)}else a.DEBUG("API not received.","error",e.errors?e.errors:"No error description"),o.reject("fail",e)}).fail(function(e,r){"abort"===r?t():(a.DEBUG("Getting API aborted.","error",r),o.reject(r))})}var a=this;if(a.calculate_promise)return a.calculate_xhr&&a.calculate_xhr.abort(),a.calculate_promise;var o=e.Deferred();return a.calculate_promise=o.promise(),a.calculate_promise.then(function(){a.calculate_promise=null,a.calculate_xhr=null},function(){a.calculate_promise=null,a.calculate_xhr=null}),t(),a.calculate_promise},s.prototype.create=function(r){var t=this;if(t.create_promise)return t.create_xhr&&t.create_xhr.abort(),t.create_promise;var a=e.Deferred();return t.create_promise=a.promise(),t.create_promise.then(function(){t.create_promise=null,t.create_xhr=null},function(){t.create_promise=null,t.create_xhr=null}),function(){if(!r)return t.DEBUG("Form data is required.","error"),a.reject("error"),!1;r.push({name:"response",value:"json"}),t.DEBUG("Form data for create:","info"),t.DEBUG(r),t.create_xhr=e.post(t.urls.create,r,"json").done(function(e){if("ok"===e.status){var r=l(e.data);t.DEBUG("API received:","info"),t.DEBUG(r),a.resolve(r)}else t.DEBUG("API not received.","error",e.errors?e.errors:"No error description"),a.reject("fail",e)}).fail(function(e,r){t.DEBUG("Getting API aborted.","error",r),a.reject(r)})}(),t.create_promise},s.prototype.reload=function(){var r=this,t=e.Deferred();if(!r.reload_xhr){r.calculate_xhr&&(r.calculate_xhr.abort(),r.calculate_xhr=!1),r.$wrapper.addClass("is-locked");var a=r.getFormData({only_api:!0});r.options&&(a.push({name:"opts[DEBUG]",value:r.options.DEBUG?1:0}),a.push({name:"opts[wrapper]",value:r.options.wrapper}),void 0===r.options.adaptive||r.options.adaptive&&"false"!==r.options.adaptive||a.push({name:"opts[adaptive]",value:"false"})),a.push({name:"response",value:"html"}),r.DEBUG("Form is reloading...","info",a),r.trigger("before_reload",r),r.reload_xhr=e.post(r.urls.calculate,a).done(function(e){r.$outer_wrapper.one("wa_order_form_ready",function(){var e=r.$outer_wrapper.data("controller");t.resolve(e)}),r.$wrapper.replaceWith(e),r.DEBUG("Form reloaded.","info"),r.trigger("reloaded",r)}).fail(function(e,a){r.DEBUG("Reload is failed.","error",a),t.reject(a)}).always(function(){r.$wrapper.removeClass("is-locked"),r.reload_xhr=!1})}return t.promise()},s}(e);window.waOrder=window.waOrder||{},window.waOrder.Form=s}(jQuery);
//# sourceMappingURL=form.min.js.map
