!function(t){"use strict";function o(t,e,i){var a=/[^\w\-\.:]/.test(t)?new Function(o.arg+",tmpl","var _e=tmpl.encode"+o.helper+",_s='"+t.replace(o.regexp,o.func)+"';return _s;"):o.cache[t]=!i&&o.cache[t]||o(o.load(t));return e?a(e,o):function(t){return a(t,o)}}o.cache={},o.load=function(t){var e=document.getElementById(t);if(!e&&console)throw{message:"template with id="+t+" not found"};return e?("textarea"==e.tagName.toLowerCase()?e.value:document.getElementById(t).innerHTML).replace(/<\\\/(\w+)/g,"</$1"):null},o.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,o.func=function(t,e,i,a,o,n){return e?{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+a+")+'":"'+("+a+"||'')+'":o?"';":n?"_s+='":void 0},o.encReg=/[<>&"'\x00]/g,o.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},o.encode=function(t){return String(t||"").replace(o.encReg,function(t){return o.encMap[t]||""})},o.arg="o",o.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return o}):t.tmpl=o}(this),function(l){l.fn.lazyLoad=function(t,e){if("stop"==t)(i=this.data("lazyLoadSettings"))&&(i.stopped=!0);else if("reload"==t)(i=this.data("lazyLoadSettings"))&&(i.stopped=!1,i.loading=!1,this.get(0).onscroll=null,this.lazyLoad(i));else if("sleep"==t)(i=this.data("lazyLoadSettings"))&&(i.loading=!0);else if("wake"==t)(i=this.data("lazyLoadSettings"))&&(i.loading=!1);else if("force"==t)(i=this.data("lazyLoadSettings"))&&!i.loading&&i.load();else{if("get"===t)return(i=this.data("lazyLoadSettings")||{})[e];this.data("lazyLoadSettings",l.extend({distance:50,load:function(){},container:o,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},t||{}));(i=this.data("lazyLoadSettings")).loading=!1,i.stopped=!1;var i,a=l(window),o=i.container||l(this);null===i.hash||l.isArray(i.hash)||(i.hash=[i.hash]),l.fn.lazyLoad.call(a,i.state);var n,s=setTimeout(n=function(){if(i.stopped)clearTimeout(s);else{if(null!==i.hash){var t=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===i.hash.indexOf(t))return void clearTimeout(s)}i.loading?s=setTimeout(n,350):(r(o,a),r(o,a)<=i.distance?(i.load(),s=setTimeout(n,350)):(a.get(0).onscroll=d,clearTimeout(s)))}},350),r="function"==typeof i.distanceBetweenBottoms?i.distanceBetweenBottoms:function(t,e,i){return i=i||0,(t="string"==typeof t?l(t):t).position().top+t.outerHeight()-i-(e.scrollTop()+e.height())}}function d(){if(i.stopped)this.onscroll=null;else if(!i.stopped&&!i.loading&&r(o,a)<=i.distance){if(null!==i.hash){var t=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===i.hash.indexOf(t))return void(this.onscroll=null)}i.load()}}}}(jQuery),$.fn.liveDraggable=function(e){var i;this.each(function(t,e){var i=$(this);i.data("init_draggable")&&i.off("mouseover",i.data("init_draggable"))}),this.off("mouseover").on("mouseover",i=function(){var t=$(this);t.data("init_draggable")||t.data("init_draggable",i).draggable(e)})},$.fn.liveDroppable=function(e){this.each(function(t,e){var i=$(this);i.data("init_droppable")&&i.off("mouseover",i.data("init_droppable"))});var i=function(){var t=$(this);t.data("init_droppable")||(t.data("init_droppable",i).droppable(e),t.mouseover())};i.call(this),this.off("mouseover",i).on("mouseover",i)},function(v){v.fn.inlineEditable=function(t,e){var c,u,p,h,f;if(this.length)return c=!1,"string"==typeof t?"setOption"==t&&(u=this.data("inlineEditableSettings")||{},v.extend(!0,u,e),void 0!==e.hold&&"function"!=typeof e.hold&&(u.hold=a(u.hold)),this.data("inlineEditableSettings",u)):(e=this.data("inlineEditableSettings"),this.data("inlineEditableSettings",v.extend({inputType:"text",inputClass:"",size:{height:null,width:null},minSize:{height:null,width:null},maxSize:{height:null,width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},afterMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},e,t||{})),u=this.data("inlineEditableSettings")||{},p=this,h="read",f="","function"!=typeof u.hold&&(u.hold=a(u.hold)),function(){var t;this.data("inited")||(u.truncate&&"boolean"==typeof u.truncate&&(u.truncate=255),u.truncate&&(t=u.placeholder&&u.placeholder===this.text()?"":this.text(),this.data("real_text",t),this.text(t.length<u.truncate-3?t:t.substr(0,u.truncate-3)+"...")),u.placeholder&&o.call(this),u.editLink&&v(u.editLink).unbind("click.inlineEditable").bind("click.inlineEditable",function(){u.hold.call(p)||"edit"!=h&&i.call(p.get(0))}),u.editOnItself&&this.unbind("click.inlineEditable").bind("click.inlineEditable",function(){u.hold.call(p)||"edit"!=h&&i.call(this)}),this.unbind("editable.inlineEditable").bind("editable.inlineEditable",function(){u.hold.call(p)||"edit"!=h&&i.call(this)}),this.unbind("placeholder.inlineEditable").bind("placeholder.inlineEditable",function(t,e){e&&u.placeholder&&o.call(this),e||v(this).removeClass(u.placeholderClass)}),this.data("inited",!0))}.call(this)),this;function o(){m(v(this))||v(this).addClass(u.placeholderClass).text(u.placeholder)}function i(){h="edit",this.id=this.id||(""+Math.random()).slice(2);var t,e,i,a=this.id+"-input",o=v("#"+a);if(o.length||(p.after(function(t){{if("textarea"!==u.inputType)return'<input type="text" id="'+t+'" style="display:none;">';return'<textarea id="'+t+'" style="display:none;"></textarea>'}}(a)),o=v("#"+a)),o.addClass(u.inputClass),a=o,t=p,e=u.size.height||t.height(),t=u.size.width||1.5*t.width(),e=u.minSize.height&&e<u.minSize.height?u.minSize.height:e,t=u.minSize.width&&t<u.minSize.width?u.minSize.width:t,e=u.maxSize.height&&e>u.maxSize.height?u.maxSize.height:e,t=u.maxSize.width&&t>u.maxSize.width?u.maxSize.width:t,a.height(e),a.width(t),u.placeholder&&m(v(this))==u.placeholder&&!function(){m(v(this))==u.placeholder&&v(this).text("").removeClass(u.placeholderClass)}.call(p),u.beforeMakeEditable.call(this,o),f=u.truncate?p.data("real_text"):m(p),o.val(f).show().focus(),p.hide(),v(u.editLink).hide(),!c){for(var n=[],s=[],r=0,d=u.makeReadableBy.length;r<d;++r)"blur"==(l=u.makeReadableBy[r])&&o.blur(function(){"read"!=h&&g.call(this)}),"enter"==l&&n.push(13),"esc"==l&&n.push(27);for(var l,r=0,d=u.updateBy.length;r<d;++r)"alt+enter"==(l=u.updateBy[r])&&s.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==l&&s.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==l&&s.push({ctrl:!0,alt:!1,shift:!1,key:17});n.length&&(i=n,o.keydown(function(t){if(!~i.indexOf(t.keyCode)||t.ctrlKey||t.altKey||t.shiftKey||"read"!=h&&g.call(this,27==t.keyCode?f:null),s.length)for(var e in s){e=s[e];if(t.keyCode==e.key&&t.ctrlKey==e.ctrl&&t.altKey==e.alt&&t.shiftKey==e.shift){p.trigger("readable");break}}})),p.unbind("readable.inlineEditable").bind("readable.inlineEditable",function(t,e){var i;"read"!=h&&(i=this.id+"-input",i=v("#"+i),g.call(i,i.val(),e))}),c=!0}u.afterMakeEditable.call(this,o)}function g(t,e){var i,a;e=void 0!==e,null!=t?v(this).val(t):t=v(this).val(),!1===e&&!1===u.beforeBackReadable.call(p.get(0),this,{changed:t!=f,old_text:f,new_text:t})||(h="read",u.placeholder&&function(t){return!v(t).val()&&(v(this).text(u.placeholder).addClass(u.placeholderClass),!0)}.call(p,this)||(u.allowEmpty||t)&&(u.truncate?(p.data("real_text",t),p.text(t.length<u.truncate-3?t:t.substr(0,u.truncate-3)+"...")):(i=p,a=t,u.html?i.html(a):i.text(a)),t||o.call(this)),p.show(),v(this).hide(),v(u.editLink).show(),!1===e&&u.afterBackReadable.call(p.get(0),this,{changed:t!=f,old_text:f}))}function a(t){return function(){return t}}function m(t){return u.html?t.html():t.text()}}}(jQuery),function(v){v.fn.photoStreamSlider=function(t){var g=v.extend({duration:200,height:48},t||{}),m=this;!function t(){for(var d=m.find(g.photoStream),l=v("li.visible",d),r=v("li",d),c=l.filter(":first").outerWidth()*l.length,u=r.filter(":first").outerWidth()*r.length,e=g.height||r.filter(":first").outerHeight(),i=(d.parent().css({overflow:"hidden",height:e,position:"relative",padding:"4px 0",margin:0,width:c}),d.find("li:first")),p=((o=l.filter(":first")).outerWidth()-o.width())/2,a=0,h=i.outerWidth(),o=o.get(0);i.length&&i.get(0)!=o;)a+=h,i=i.next();function f(e){var t,i,a,o,n=(e="string"==typeof e?{direction:e,animate:!0}:e).direction||"forward",s=e.steps||l.length;function r(){f.execution=!1;var t="on"+n.charAt(0).toUpperCase()+n.slice(1);"function"==typeof(t=g[t])&&t.call(m),"function"==typeof(t=e.fn)&&t.call(m)}f.execution||(f.execution=!0,t=l.filter(":first").outerWidth()*s,i=l.length,"forward"==n?(o=(a=l.filter(":last").nextAll(":lt("+s+")")).length,a=a.filter(":last"),o&&(l.removeClass("visible"),a.prevAll(":lt("+(i-1)+")").addClass("visible"),a.addClass("visible"))):(a=(o=l.filter(":first").prevAll(":lt("+s+")")).length,s=o.filter(":last"),a&&(l.removeClass("visible"),s.nextAll(":lt("+(i-1)+")").addClass("visible").show(),s.addClass("visible"))),l=v("li.visible",d),o=d.position().left,o="forward"==n?-(a=u-c-p)<(o-=t)?o:-a:(o+=t)<p?o:p,e.animate?d.animate({left:o},g.duration,r):(d.css({left:o}),r()))}d.css({position:"absolute",left:-(a-=p),width:u}),v(g.forwardLink).unbind("click").bind("click",function(){return f("forward"),!1}),v(g.backwardLink).unbind("click").bind("click",function(){return f("backward"),!1}),m.unbind("append prepend").bind("append prepend",function(t,e){if("append"==t.type){for(var i=d.find("li:last"),a=v();i.hasClass("dummy");)a=a.add(i),i=i.prev("li");a.remove(),d.append(e)}else{var o=(e=v("<div></div>").html(e)).find("li"),n=o.length*h;e.remove();for(var i=d.find("li:first"),s=v();i.hasClass("dummy");)s=s.add(i),i=i.next("li");s.remove(),d.prepend(o)}r=d.find("li"),u=r.filter(":first").outerWidth()*r.length,d.css("width",u),"prepend"==t.type&&(e=function(){d.css("left",parseInt(d.css("left"))-n)},d.is(":animated")&&d.stop(!1,!0),e()),d.find("li.selected").hasClass("visible")&&m.trigger("home",[null,!1])}),m.unbind("forward backward").bind("forward backward",function(t,e){f({direction:t.type,steps:e.steps,animate:void 0===e.animate||e.animate,fn:e.fn}),e=d.find("li.selected"),(t="forward"==t.type?e.next("li:not(.dummy)"):e.prev("li:not(.dummy)")).length&&(e.removeClass("selected"),t.addClass("selected"))}),m.unbind("home").bind("home",function(t,e,i){var a=parseInt(l.length/2),o=(a=l.filter(":eq("+a+")")).nextAll(".selected:first"),n=a.prevAll(".selected:first"),s=0,r="";return i=void 0===(i="function"!=typeof e?e:i)||i,o.length?(r="forward",a.nextAll().each(function(){if(++s,v(this).hasClass("selected"))return!1})):n.length&&(r="backward",a.prevAll().each(function(){if(++s,v(this).hasClass("selected"))return!1})),r&&s?f({direction:r,steps:s,fn:e,animate:i}):"function"==typeof e&&e(),!1}),m.unbind("refresh").bind("refresh",function(){t()})}()}}(jQuery),function(m){function a(){m("#hint-menu-block").hide().children().hide()}m.product_dragndrop={handlers:{},options:{},init:function(t){return(this.options=t).collections&&(this.initDragCollections(),this.initDropCollections()),t.products&&(this.initDragProducts(),this.initDropProducts()),this},bind:function(t,e){return this.handlers[t]=e,this},trigger:function(t){if("function"==typeof this.handlers[t])return this.handlers[t].apply(this,Array.prototype.slice.call(arguments,1))},initDragProducts:function(){var o=m("#product-list"),t=o.find(".product:not(.s-alien)");t.find(".drag-handle").on("selectstart",function(){return!(document.onselectstart=function(){return!1})}),t.liveDraggable({opacity:.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,containment:[0,0,m(window).width(),{toString:function(){return m(document).height()}}],start:function(t,e){document.ondragstart=function(){return!1},e.helper.data("scrollTop",m(document).scrollTop()),m(document).bind("scroll",m.product_dragndrop._scrolHelper),m(".block.drop-target").addClass("drag-active")},handle:".drag-handle",stop:function(t,e){document.ondragstart=null,document.onselectstart=null;var i=m(this);i.find("input:checked").length||i.removeClass("selected"),a(),m(document).unbind("scroll",m.product_dragndrop._scrolHelper),m(".block.drop-target").removeClass("drag-active"),a()},helper:function(t,e){var i=1,a=o.find(".s-select-all");return a.is(":checked")?i=a.attr("data-count"):(a=o.find(".product.selected")).length?i=-1!==a.index(this)?a.length:(m(this).trigger("select",!0),a.length+1):m(this).addClass("selected"),'<div id="products-helper"><span class="indicator red">'+i+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},drag:function(t,e){t=t.originalEvent;e.position.left=t.pageX-20,e.position.top=t.pageY}})},initDropProducts:function(){m("#product-list .product").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(t,e){var i;return!m(this).hasClass("s-alien")&&!!e.draggable.hasClass("product")&&(m.product_dragndrop.trigger("is_product_sortable")?a():(e=m.product_dragndrop.options.sort)&&((i=m("#hint-menu-block").show()).children().hide(),i.find("."+e).show()),void m.product_dragndrop._activatePhotoListItem.call(this))},out:function(t,e){m.product_dragndrop._unactivatePhotoListItem.call(this)},drop:function(t,e){if(!e.draggable.hasClass("product"))return!1;var i=m(this);if(i.hasClass("selected"))return m.product_dragndrop._unactivatePhotoListItem.call(this),!1;var a=m("#product-list").find(".product.selected");if(!m.product_dragndrop.trigger("is_product_sortable"))return m.product_dragndrop._unactivatePhotoListItem.call(this),m.product_dragndrop._unactivatePhotoListItem.call(e.draggable),!1;var o=null;if(i.hasClass("s-alien")){var n=i.nextAll(":not(.s-alien):first");if(n.length)o=n.attr("data-product-id"),n.before(a);else{if(!(n=i.prevAll(":not(.s-alien):first")).length||n.hasClass("selected"))return!1;o=null,n.after(a)}n.hasClass("last")&&(n.removeClass("last"),a.filter(":last").addClass("last"))}else i.hasClass("drag-active-last")||(o=i.attr("data-product-id")),i.hasClass("last")&&i.hasClass("drag-active-last")?(i.after(a).removeClass("drag-active drag-active-last last"),a.filter(":last").addClass("last")):i.before(a).removeClass("drag-active"),i.removeClass("drag-active drag-active-last");m.product_dragndrop._unactivatePhotoListItem.call(this),m.product_dragndrop._unactivatePhotoListItem.call(e.draggable),a.trigger("select",!1);n=a.map(function(){return m(this).attr("data-product-id")}).toArray();m.product_dragndrop.trigger("move_product",{product_ids:n,before_id:o,error:function(t){t&&console&&console.log(void 0!==t.errors?t.errors:t)}})}})},initDragCollections:function(){var t=m("#wa-app .sidebar:first"),e=t.position(),i=t.width(),t=t.height();m(".s-collection-list li.dr").liveDraggable({containment:[e.left,e.top,e.left+1.25*i,e.top+1.25*t],refreshPositions:!0,revert:"invalid",helper:function(){var t=m(this),e=t.parents(".s-collection-list:first").find("ul:first"),t=t.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(e);return t.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>'),t},cursor:"move",cursorAt:{left:5},opacity:.75,zIndex:9999,distance:5,start:function(t,e){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},initDropCollections:function(){this.initDropBetweenCollections(),this.initDropInsideCollections()},initDropBetweenCollections:function(){m(".s-collection-list li.drag-newposition").liveDroppable({greedy:!0,tolerance:"pointer",over:function(t,e){var i=m(this);if(e.draggable.attr("data-type")!=i.attr("data-type"))return!1;i.addClass("active").parent().parent().addClass("drag-active")},out:function(t,e){var i=m(this);if(e.draggable.attr("data-type")!=i.attr("data-type"))return!1;i.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(t,e){var i=m(this);if(e.draggable.attr("data-type")!=i.attr("data-type"))return!1;(i.is(":animated")||i.hasClass("dragging"))&&i.stop().animate({height:"2px"},300,null,function(){i.removeClass("dragging")}),i.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(t,e){var i,a,o,n,s,r,d,l,c,u=m(this),p=e.draggable,e=p.attr("data-type");return e==u.attr("data-type")&&(a=(i=function(t){t=t.split("-");return t.shift(),t.join("-")})(p.attr("id")),d=u.prev("li"),c=p.next(),o=p.prev(),!(d.length&&d.attr("id")=="category-"+a&&!d.hasClass("dr-helper")))&&this!=p.next().get(0)&&(n=p.parent("ul"),s=n.children("li.dr[id!=category-"+a+"]").length,r=parseInt(i(n.parent().attr("id")),10)||0,u.after(c).after(p),void(((d=p.parent().parent()).is("li.dr")||d.is(".s-collection-list"))&&(l=0,d.is(".s-collection-list")||(l=parseInt(i(d.attr("id")),10)||0),u=null,(c=p.nextAll("li.dr:first")).length&&(u=i(c.attr("id"))||null),s||r===l||(n.parent("li").children("i").hide(),n.hide()),m.product_dragndrop.trigger("move_list",{id:a,type:e,before_id:u,parent_id:l,success:function(t){s||r===l||(n.parent("li").children("i").remove(),n.remove(),m.categories_tree.setCollapsed(r))},error:function(t){t&&console&&console.log(void 0!==t.errors?t.errors:t),o.after(p.next()).after(p),s||n.show()}}))))}})},initDropInsideCollections:function(){m(".s-collection-list li.dr a").liveDroppable({tolerance:"pointer",greedy:!0,out:function(t,e){var i=e.draggable,a=m(this).parent();if(!i.hasClass("product")&&a.attr("data-type")!=i.attr("data-type"))return!1;i.hasClass("product")&&e.helper.find("span").show().end().find("i").hide(),a.removeClass("drag-newparent")},over:function(t,e){var i=e.draggable,a=m(this).parent(),o=i.attr("data-type");if(!i.hasClass("product")&&o!=a.attr("data-type"))return!1;if("set"!=o&&a.addClass("drag-newparent"),i.hasClass("product"))return a.hasClass("dynamic")?e.helper.find("span").hide().end().find("i").show():e.helper.find("span").show().end().find("i").hide(),!1;if(!i.hasClass("dynamic")&&a.hasClass("dynamic"))return e.helper.find("i.no-bw").show(),!1;e.helper.find("i.no-bw").hide();var n='.dr[id!="'+i.attr("id")+'"]',s=m(),r=function(t,e){return!e.length||(t=t.add(e.nextUntil(n).filter("li.drag-newposition")),0<e.nextAll(n).length)?t:r(t,e.parent().closest("li"))},o=a.prevAll(n+":first"),d=(s=0<o.length?0<(e=o.find(n)).length?r(s,e.last()):r(s,o):s.add(a.prevUntil(n).filter("li.drag-newposition")),s=0<a.children("ul").children(n).length?s.add(a.children("ul").children("li.drag-newposition:first")):r(s,a),m(".drag-newposition:animated, .drag-newposition.dragging").not(s));d.stop().animate({height:"2px"},300,null,function(){d.removeClass("dragging")}),s.stop().animate({height:"10px"},300,null,function(){s.addClass("dragging")})},drop:function(t,e){var i,a,o,n,s,r,d,l,c,u,p,h,f=e.draggable,g=m(this).parent(),e=f.attr("data-type");if(!f.hasClass("product")){if("set"==e)return!1;if(g.attr("id")==f.attr("id"))return!1;if(e!=g.attr("data-type"))return!1}return g.removeClass("drag-newparent"),f.hasClass("product")?(g.hasClass("dynamic")||(i=m("#product-list"),a={},i.find(".s-select-all").is(":checked")?a.whole_list=!0:(o=i.find(".product.selected"),a.product_ids=o.map(function(){return m(this).attr("data-product-id")}).toArray()),m.product_dragndrop.trigger("add_to_list",m.extend(a,{collection_param:g.attr("id").replace("-","_id="),success:function(t){a.whole_list?i.find(".s-select-all").trigger("select",!1):a.product_ids&&a.product_ids.length&&o.trigger("select",!1),t.data&&(g.find(">.counters .count:not(.subtree)").text(t.data.count),g.find(">.counters .subtree").text(t.data.total_count))}}))),!1):!(!f.hasClass("dynamic")&&g.hasClass("dynamic"))&&(n=f.attr("id").split("-")[1],g.attr("id")!="category-"+n)&&(f.hasClass("product")?(m("#product-list").find(".product.selected").trigger("select",!1),!1):(s=parseInt(g.attr("id").split("-")[1],10)||0,r=null,d=f.next(),l=f.prev(),c=!1,g.hasClass("drag-newposition")?r=g.parent("ul"):g.children("ul").length?r=g.children("ul"):g.find(">i.collapse-handler-ajax").length||((r=m('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+e+'"></li></ul>').appendTo(g)).find(".drag-newposition").mouseover(),m('<i class="icon16 darr overhanging collapse-handler-ajax unapproved" id="'+e+"-"+s+'-handler"></i>').insertBefore(g.children("a")),c=!0),u=f.parent("ul"),p=u.children("li.dr[id!=category-"+n+"]").length,h=parseInt(u.parent().attr("id").split("-")[1],10)||0,r&&r.append(f).append(d),p||h===s||(u.parent("li").children("i").hide(),u.hide()),void(g.is("li.dr")&&m.product_dragndrop.trigger("move_list",{id:n,type:e,parent_id:s,success:function(t){p||h===s||(u.parent("li").children("i").remove(),u.remove(),m.categories_tree.setCollapsed(h)),r?(m(".s-collection-list .unapproved").removeClass("unapproved"),c?m.categories_tree.setExpanded(s):g.trigger("count_subtree")):(f.remove(),d.remove(),g.trigger("update_counters",t.data.count||{}))},error:function(t){t&&console&&console.log(void 0!==t.errors?t.errors:t),l.after(f).after(d),p||u.show(),m(".s-collection-list .unapproved").remove()}}))))}})},_scrolHelper:function(t){var e=m("#products-helper"),i=e.data("scrollTop"),a=m(document).scrollTop(),i=i?a-i:50;e.css("top",e.position().top+i+"px"),e.data("scrollTop",a)},_extDragActivate:function(t,e,i){var a,o,n,s,r=i+"-last";e.hasClass("last")?(a=t.pageX,t=t.pageY,o=e.width(),n=e.height(),s=e.offset(),"thumbs"==m.product_dragndrop.options.view?a>s.left+.5*o&&a<=s.left+o?(e.removeClass(i).addClass(r),m.product_dragndrop._shiftToLeft(e)):a>s.left&&a<=s.left+.5*o?(e.removeClass(r).addClass(i),m.product_dragndrop._shiftToRight(e)):m.product_dragndrop._shiftAtPlace(e):"table"==m.product_dragndrop.options.view&&(t>s.top+.5*n?e.removeClass(i).addClass(r):t>s.top&&e.removeClass(r).addClass(i)),(t<s.top||t>s.top+n||a<s.left||a>s.left+o)&&e.removeClass(i).removeClass(r)):e.addClass("drag-active")},_bindExtDragActivate:function(e,i){m(document).bind("mousemove.ext_drag_activate",function(t){m.product_dragndrop._extDragActivate(t,e,i)})},_unbindExtDragActivate:function(){m(document).unbind("mousemove.ext_drag_activate")},_activatePhotoListItem:function(){var t=m(this),e=m.product_dragndrop.trigger("is_product_sortable"),i=e?"drag-active":"drag-active-disabled";e&&"thumbs"==m.product_dragndrop.options.view&&m.product_dragndrop._shiftToRight(t),t.hasClass("last")?m.product_dragndrop._bindExtDragActivate(t,i):t.addClass(i)},_unactivatePhotoListItem:function(){var t=m(this),e=m.product_dragndrop.trigger("is_product_sortable"),i=e?"drag-active":"drag-active-disabled",a=i+"-last";t.hasClass("last")&&m.product_dragndrop._unbindExtDragActivate(),t.removeClass(i+" "+a),e&&"thumbs"==m.product_dragndrop.options.view&&m.product_dragndrop._shiftAtPlace(t)},_shiftToLeft:function(t){var e,i;"left"!==t.data("shifted")&&((i=t.find(".p-wrapper")).length||(e=t.children(),(i=m("<div class='p-wrapper' style='position:relative;'></div>").appendTo(t)).append(e)),i.stop().animate({left:-15},200),t.data("shifted","left"))},_shiftToRight:function(t){var e,i;"right"!==t.data("shifted")&&((i=t.find(".p-wrapper")).length||(e=t.children(),(i=m("<div class='p-wrapper' style='position:relative;'></div>").appendTo(t)).append(e)),i.stop().animate({left:15},200),t.data("shifted","right"))},_shiftAtPlace:function(t){var e,i;t.data("shifted")&&((e=t.find(".p-wrapper")).length&&(i=e.children(),e.stop().css({left:0}),t.append(i),e.remove()),t.data("shifted",""))}}}(jQuery),function(s){function r(t,e){var i=c(t);"category"==i.parent.attr("data-type")&&i.parent.trigger("count_subtree",!1),t.removeClass("rarr").addClass("darr"),i.target.show(),"function"==typeof e&&e(t)}function d(t,e){var i=t.parent.find(".loading:first"),t=t.parent.find(".counters");e?(i.show(),t.hide()):(i.hide(),t.show())}function i(t,e){var i,a;e=e,"category"!=(a=c(i=t)).parent.attr("data-type")||a.parent.hasClass("dynamic")||a.parent.trigger("count_subtree",!0),i.removeClass("darr").addClass("rarr"),a.target.hide(),"function"==typeof e&&e(i),s.get("?action=categoryExpand&id="+l(t)+"&collapsed=1")}function a(e,i,a){var o,n;e.data("loading_content")||((o=c(e)).ul.length?r(e,i):d(o,!0),n=!o.ul.length,e.data("loading_content",n),s.get("?action=categoryExpand&id="+l(e)+(n?"&tree=1":""),function(t){n&&((o.target.length?o.target:o.parent).append(t),d(o,!1),r(e,i),e.data("loading_content",!1)),"function"==typeof a&&a()}))}var l=function(t){var e=/^category-(.*?)-handler$/;return e.test(t.attr("id"))?t.attr("id").replace(e,function(){return parseInt(arguments[1],10)||0}):0},c=function(t){var e,i;return t=l(t)?i=(e=t.parents("li:not(.drag-newposition):first")).find("ul:first"):(i=(e=t.parent()).next()).find("ul:first"),{parent:e,target:i,ul:t}};s.categories_tree={init:function(){s("#s-category-list-block").off("click",".collapse-handler-ajax").on("click",".collapse-handler-ajax",function(){var t=s(this);(t.hasClass("darr")?i:a)(t)}),s("#s-category-list-block .heading").off("click").click(function(t){var e=s(this).find(".collapse-handler-ajax");e.is(t.target)||e.click()})},collapse:function(t,e){(t=s(t)).hasClass("darr")?i(t,e):"function"==typeof e&&e(t)},expand:function(t,e,i){(t=s(t)).hasClass("rarr")?a(t,e,i):("function"==typeof e&&e(t),"function"==typeof i&&i(t))},isCollapsed:function(t){return s(t).hasClass("rarr")},setExpanded:function(t){s.get("?action=categoryExpand&id="+t)},setCollapsed:function(t){s.get("?action=categoryExpand&id="+t+"&collapsed=1")},getHandlerByCategoryId:function(t){s();return t=parseInt(t,10)||0,s(t?"#category-"+t+"-handler":"#s-category-list-handler")}}}(jQuery),function(d){d.product_sidebar={options:{},init:function(){var o=d("#s-sidebar"),n=(d.product_dragndrop.init({collections:!0}).bind("move_list",function(e){var t;e.type?(t={id:e.id,type:e.type,parent_id:e.parent_id||0},e.before_id&&(t.before_id=e.before_id),d.products.jsonPost("?module=products&action=moveList",t,e.success,function(t){return t.errors&&t.errors.length&&d.each(t.errors,function(t,e){var i,a="string"==typeof e?e:null;(a="string"==typeof e.text?e.text:a)&&(e=a,a=(a='<div class="dialog width650px height250px small">\n    <div class="dialog-background"></div>\n        <div class="dialog-window">\n        <div class="dialog-content">\n            <div class="dialog-content-indent">\n                <p>%text%</p>\n            </div>\n        </div>\n        <div class="dialog-buttons">\n            <div class="dialog-buttons-gradient">\n                <input class="button gray cancel" type="button" value="%button_text%">\n            </div>\n        </div>\n    </div>\n</div>').replace("%text%",e).replace("%button_text%",d.wa.locale.Close),(i=d(a)).waDialog({onClose:function(){i.remove()}}))}),"function"==typeof e.error?e.error(t):e.error})):"function"==typeof e.error&&e.error("Unknown list type")}),o.off("add",".s-collection-list ul").on("add",".s-collection-list ul",function(t,e,i,a){var o=d(this),n=o.parents(".s-collection-list:first"),s=d("<ul></ul>"),i=(s.append(tmpl("template-sidebar-list-item",{type:i,item:e})),s.children(":not(.drag-newposition):first")),e=i.attr("id"),e=o.find("#"+e),r=s.children();return e.length?a&&e.replaceWith(i):o.prepend(r).show(),r.each(function(){var t=d(this);(t.hasClass("dr")?t.find("a"):t).mouseover()}),o.find(".drag-newposition").css({height:"2px"}).removeClass("dragging"),n.find(".s-empty-list").hide(),s.remove(),!1}),o.unbind("update").bind("update",function(t,e){for(var i in e)if("all"==i)d("#s-all-products").find(".count:first").text(e[i].count);else{var a,o="#"+i+"-";for(a in e[i])d(o+a).find(".count:first").text(e[i][a].count)}return!1}),d("#s-tag-cloud").unbind("update").bind("update",function(t,e){var i,a='<ul class="tags"><li class="block align-center">';for(i in e){var o=e[i];a+='<a href="#/products/tag='+o.uri_name+'/" style="font-size: '+o.size+"%; opacity: "+o.opacity+'"  data-id="'+o.id+'"  class="s-product-list">'+o.name+"</a> "}return a+="</li></ul>",d("#s-tag-cloud").html(a).parents(".block:first").show(),!1}),o.off("count_subtree",".s-collection-list li").on("count_subtree",".s-collection-list li",function(t,e){var i=d(this),a=(void 0===e&&(e=i.find("i.collapse-handler-ajax").hasClass("rarr")),i.find(">.counters .count:not(.subtree)")),i=i.find(">.counters .subtree");return i.length||(i=a.clone().addClass("subtree").hide(),a.after(i)),(e?(a.hide(),i):(i.hide(),a)).show(),!1}),o.off("update_counters",".s-collection-list li").on("update_counters",".s-collection-list li",function(t,e){var i=d(this),a=i.find(">.count:not(.subtree)"),i=i.find(">.subtree");return i.length||(i=a.clone().addClass("subtree").hide(),a.after(i)),void 0!==e.item&&a.text(parseInt(e.item,10)||0),void 0!==e.subtree&&i.text(parseInt(e.subtree,10)||0),!1}),o.find("#s-category-list-widen-arrows"));n.find("a.arrow").unbind("click").bind("click",function(){var t,e=o.attr("class"),i=0,a=e.match(/left([\d]{2,3})px/);return a&&a[1]&&(i=parseInt(a[1]))&&(a=i+(d(this).is(".right")?50:-50),(a=Math.max(Math.min(a,1e3),200))!=i)&&(n.css({width:a.toString()+"px"}),o.attr("class",e.replace((i=["left"+i+"px","left"+a+"px"])[0],i[1])),o.css("width",""),e=(t=d("#s-content")).attr("class"),t.attr("class",e.replace(i[0],i[1])),t.css("margin-left",""),d.product&&d.product.setOptions({sidebar_width:a}),d.shop.jsonPost("?action=sidebarSaveWidth",{width:a}),o.trigger("change_width",[a])),!1}),o.off("click","#s-forcesort-by-name").on("click","#s-forcesort-by-name",function(){return d.product_sidebar.sortCategoryDialog(),!1}),o.off("click",".s-new-list").on("click",".s-new-list",function(){var t,e=d(this),i=e.attr("id"),a=0;return i?t=i.replace("s-new-",""):(t=(i=e.parents("li.dr:first").attr("id").split("-"))[0],a=i[1]),"category"===t?shopDialogProductsCategory.staticDialog(d.product_list.collection_hash[1],a,"new"):shopDialogProductsSet.staticDialog(d.product_list.collection_hash[1],"new"),!1})},updateItemInCategoryList:function(t,e){var i=d("#category-"+t.data.id);return i.find(".name:first").html(t.data.name),d.isArray(t.data.routes)&&t.data.routes.length?i.find(".routes:first").html(" "+t.data.routes.join(" ")):i.find(".routes:first").html(" "),t.data.subcategories_updated?"0"==t.data.status?i.find("a").addClass("gray"):"1"==t.data.status&&i.find("a").removeClass("gray"):"0"==t.data.status?i.children("a").addClass("gray"):"1"==t.data.status&&i.children("a").removeClass("gray"),i.find(".id:first").html(t.data.id),i.attr("id","category-"+t.data.id),i.find("a").attr("href",e),null},createNewElementInList:function(e,i){function t(){var t;n&&((t=o.find("#"+i+"-"+e.parent_id)).find(">.collapse-handler-ajax").length||(t.append('<ul class="menu-v with-icons dr"><li class="drag-newposition" data-type="'+i+'"></li></ul>'),t.find(".drag-newposition").mouseover(),t.find(">a").before('<i class="icon16 darr overhanging collapse-handler-ajax" id="'+i+"-"+n+'-handler"></i>'),d.categories_tree.setExpanded(n)),o=t.find("ul:first")),o.trigger("add",[e,i])}var a=d("#s-"+i+"-list"),o=a.find("ul:first"),n=(o.length||(a.prepend('<ul class="menu-v with-icons"><li class="drag-newposition" data-type="'+i+'"></li></ul>'),a.find(".drag-newposition").mouseover(),o=a.find("ul:first")),parseInt(e.parent_id,10)||0),a=d.categories_tree.getHandlerByCategoryId(n);"category"==i?d.categories_tree.expand(a,function(){t()}):t()},sortCategoryDialog:function(){d("#s-products-sort-categories").waDialog({disableButtonsOnSubmit:!0,onSubmit:function(t){d(this)}})},initCategoryDescriptionWysiwyg:function(t){var e=t.find(".field.description"),e=(e.find("i").hide(),e.find(".s-editor-core-wrapper").show(),.8*t.find(".dialog-window").height()||350),i=d("#s-category-description-content");i.waEditor({lang:wa_lang,toolbarFixed:!1,maxHeight:e,minHeight:e,modification_wysiwyg_msg:i.data("modification-wysiwyg-msg"),uploadFields:t.data("uploadFields")})}}}(jQuery),function(d){Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var i,a=[],o=arguments[1],n=0;n<e;n++)n in this&&(i=this[n],t.call(o,i,n,this))&&a.push(i);return a}),d(function(){d("#s-content").on("click",".s-alert-close",function(){var t=d.storage.get("shop/alerts");return(t=t||[]).push(d(this).parent().data("alert")),d.storage.set("shop/alerts",t),d(this).parent().remove(),!1})}),d.storage=new d.store,d.products={hash:"",list_hash:"",list_params:{},random:"",init:function(t){d.extend(this.options,t),this.initRouting(),this.initSearch(),d.product_sidebar.init(),d.categories_tree.init(),this.initCollapsible(),this.tagsHandler()},data:{prev_action:null},initRouting:function(){void 0!==d.History&&d.History.bind(function(){d.products.dispatch()}),d.wa.errorHandler=function(t){return 403!==t.status&&404!==t.status||(t=(t=d(t.responseText)).find(".dialog-content").length?d('<div class="block double-padded"></div>').append(t.find(".dialog-content *")):d('<div class="block double-padded"></div>').append(t.find(":not(style)")),d("#s-content").empty().append(t),!1)};var t=window.location.hash;"#/"!==t&&t?d.wa.setHash(t):this.dispatch()},skip_dispatch:0,forceHash:function(t){t!=location.hash&&(d.products.skip_dispatch++,d.wa.setHash(t))},dispatch:function(t){if(0<d.products.skip_dispatch)d.products.skip_dispatch--;else{t=(t=void 0===t?window.location.hash:t).replace(/(^[^#]*#\/*|\/$)/g,"");var e=new d.Event("shop_before_dispatched");if(d(window).trigger(e),e.isDefaultPrevented())return d.products.skip_dispatch=1,window.location.hash=d.products.list_hash,!1;this.hash=t;try{if(t)if((t=t.split("/"))[0]){for(var i="",a=t.length,o=0;o<t.length;o++){var n=t[o];if(!(o<2)){a=o;break}if(0===o)i=n;else{if("product"==i||"tag"==i||"search"==i||"plugins"==i||"pages"==i||"stocks"==i){a=o;break}if(parseInt(n,10)==n||-1!=n.indexOf("=")){a=o;break}i+=n.substr(0,1).toUpperCase()+n.substr(1)}}var s=t.slice(a);this.preExecute(i,s),"function"==typeof this[i+"Action"]?(d.shop.trace("$.products.dispatch",[i+"Action",s]),this[i+"Action"].apply(this,s)):d.shop.error("Invalid action name:",i+"Action")}else this.preExecute(),this.defaultAction();else this.preExecute(),this.defaultAction()}catch(t){d.shop.error(t.message,t)}}},load:function(t,e){var i=Math.random(),a=(this.random=i,this);d.get(t,function(t){if(a.random==i){if(d("#s-content").removeClass("bordered-left").html(t),d("html, body").animate({scrollTop:0},200),e)try{e.call(this)}catch(t){d.shop.error("$.products.load callback error: "+t.message,t)}d(document).trigger("wa_loaded")}})},addOptions:function(t){this.options=d.extend(this.options,t||{})},preExecute:function(t,e){try{var i;this.data.prev_action&&this.data.prev_action!=t&&(i=this.data.prev_action+"Termination",d.shop.trace("$.products.preExecute",[i,t]),"function"==typeof this[i])&&this[i].apply(this,[]),this.data.prev_action=t,a=d("#wa"),(o=a.data("style"))?a.attr("style",o):a.removeAttr("style"),d(window).resize(),d("body > .dialog").trigger("close").remove()}catch(t){d.shop.error("preExecute error: "+t.message,t)}var a,o},defaultAction:function(){this.productsAction()},welcomeAction:function(){this.load("?module=products&action=welcome")},paramsFromSession:function(i){if(window.sessionStorage&&window.JSON&&window.JSON.stringify&&window.JSON.parse&&i.category_id){storage=sessionStorage.getItem("shop/list_categories")||"{}";try{storage=JSON.parse(storage)}catch(t){storage={}}var a=storage[i.category_id]=storage[i.category_id]||{};d.each(["sort","order"],function(t,e){void 0===i[e]?i[e]=a[e]:a[e]=i[e]});try{sessionStorage.setItem("shop/list_categories",JSON.stringify(storage))}catch(t){}}return i},buildProductsUrlComponent:function(t){return(((t=this.paramsFromSession(t)).view?"&view="+t.view:"")+(t.category_id?"&category_id="+t.category_id:"")+(t.set_id?"&set_id="+t.set_id:"")+(t.tag?"&tag="+t.tag:"")+(t.sort?"&sort="+t.sort:"")+(t.order?"&order="+t.order:"")+(t.text?"&text="+t.text:"")+(t.edit?"&edit="+t.edit:"")+(t.hash?"&hash="+t.hash:"")+(t.page?"&page="+t.page:"")+(t.type_id?"&type_id="+t.type_id:"")).slice(1)},productsAction:function(){var t=Array.prototype.join.call(arguments,"/"),t=d.shop.helper.parseParams(t||"");this.list_hash=this.hash,this.list_params=t,void 0!==d.product_list&&void 0!==d.product_list.fixed_blocks&&(d.product_list.fixed_blocks.set&&d.product_list.fixed_blocks.set.unsetFixed(),d.product_list.fixed_blocks.category)&&d.product_list.fixed_blocks.category.unsetFixed(),this.load("?module=products&"+this.buildProductsUrlComponent(t),this.checkAlerts)},checkAlerts:function(){var t=d.storage.get("shop/alerts");d(".s-alert").each(function(){-1==d.inArray(d(this).data("alert"),t)&&d(this).show()})},productAction:function(t,e,i){void 0!==i&&"force-old"===i&&(i="main/"+i);var a=Array.prototype.slice.call(arguments).filter(function(t){return t.length}).join("/"),o=(d.shop.trace("$.products.productAction",[a,arguments]),"?module=product");t&&(o+="&id="+t),void 0!==d.product?d.product.dispatch(a):this.load(o,function(t){d.product.dispatch(a)})},productTermination:function(){void 0!==d.product&&d.product.termination()},reviewsAction:function(t,e){this.load("?module=reviews"+(t?"&"+t:""))},stocksAction:function(t){var e,i="";t&&"desc"!==t&&"asc"!==t?(e=(t=""+(t||"")).match(/stock_count_(\d*)_*(desc|asc)*/))&&(i="stock_count_"+e[1],t="desc"===e[2]?"desc":"asc"):i="count",d("#s-stocks-container").length?d("#s-stocks-container").trigger("load",["balance",(t?"order="+t:"")+(i?"&sort="+i:"")]):this.load("?module=stocks"+(t?"&order="+t:"")+(i?"&sort="+i:"")+"&tab=balance")},stockslogAction:function(t){d("#s-stocks-container").length?d("#s-stocks-container").trigger("load",["log",t||""]):this.load("?module=stocks"+(t?"&"+t:"")+"&tab=log")},servicesAction:function(t){this.load("?module=services"+(t?"&id="+t:""),function(){d("#s-content").addClass("bordered-left"),"function"==typeof d.products.afterServicesAction&&d.products.afterServicesAction()})},tagsHandler:function(){d("#s-products-all-tags").autocomplete({source:"?module=product&action=tagsAutocomplete&type=search",minLength:1,delay:300,select:function(t,e){return d.wa.setHash("#/products/tag="+e.item.value),!1}})},initCollapsible:function(){function n(t,e){d(t).removeClass("darr").addClass("rarr"),s(t).hide(),e||(d.storage.set(r+t.id+"/collapse",1),!1!==e&&(e=t.id.replace(/\-handler$/,""),(t=d(t).parents("div.block:first").find("#"+e+":first")).length)&&(e=t.data("on-collapse-url"))&&d.get(e))}function s(t){return(t=d(t).parent()).is("li")?t.find("ul:first"):t.next()}var r="shop/products/";d(".collapse-handler").off("click").on("click",function(){var t,e,i,a,o;d(this).hasClass("darr")?n(this):(s(t=this).show(),(i=d(t)).removeClass("rarr").addClass("darr"),d.storage.del(r+t.id+"/collapse"),a=t.id.replace(/\-handler$/,""),(o=i.parents("div.block:first").find("#"+a+"-placeholder:first")).length?((e=d(t).parents("div.block:first").find(".count:first")).find("i.icon16.loading").remove(),e.find("i.icon16").hide(),e.prepend('<i class="icon16 loading"></i>'),d.get(o.data("url"),function(t){o.replaceWith(d(t)),e.find("i.icon16.loading").remove(),e.find("i.icon16").show(),o.remove()})):(i=d(t).parents("div.block:first").find("#"+a+":first")).length&&(t=i.data("on-expand-url"))&&d.get(t))}).each(function(){var t=r+this.id+"/collapse",e=d(this).hasClass("rarr");(d.storage.get(t)||e)&&n(this,!e)}),d(".collapse-handler").closest(".heading").off("click").on("click",function(t){($collapse_handler=d(this).find(".collapse-handler")).is(t.target)||$collapse_handler.click()})},initSearch:function(){function i(){d.wa.setHash("#/products/"+(d.products.list_params&&d.products.list_params.view?"view="+d.products.list_params.view+"&":"")+"text="+encodeURIComponent(this.value))}var a=d("#s-products-search");a.unbind("keydown").bind("keydown",function(t){var e;if(13==t.keyCode)return i.call(this),(e=d(this)).autocomplete("close"),setTimeout(function(){e.autocomplete("close")},300),!1}),a.unbind("search").bind("search",function(){return i.call(this),!1}),a.autocomplete({source:"?action=autocomplete",minLength:3,delay:300,select:function(t,e){return a.val(""),d.wa.setHash("#/product/"+e.item.id),!1}})},jsonPost:function(t,e,i,a){d.shop.jsonPost(t,e,i,a)},_iframePost:function(t,i,a){var e=t.attr("id")+"-iframe",o=(d("#"+e).length||t.after("<iframe id="+e+" name="+e+" style='display:none;'></iframe>"),d("#"+e));t.attr("target",e),o.one("load",function(){try{var e=d(this).contents().find("body").html(),t=d.parseJSON(e)}catch(t){return void a(e)}("ok"==t.status?i:a)(t)})}}}(jQuery),function(f){f.product={options:{duration:200,container_selector:"#shop-productprofile",message_selector:"#product-save-message",form_selector:"#s-product-save",update_delay:100},message:{submit:'<i class="icon16 loading"></i>',success:'<i class="icon16 yes"></i>',error:'<i class="icon16 no"></i>'},path:{id:null,mode:null,tab:null,tail:null,raw:null,params:{}},ajax:{random:null,target:null,link:null,save:!1,cached:{}},data:{main:{}},$edit_forms:f(),getData:function(t,e){return(this.data[t]||{})[e]},setData:function(t,e,i){this.data[t]=this.data[t]||{},this.data[t][e]=i},standalone_tabs:["images","services","pages","reviews"],init:function(t,e){this.setOptions(t,e),this.initFeatureDate(),this.deleteDivider()},setOptions:function(t,e){e?this[e+"_options"]=f.extend(this[e+"_options"]||{},t||{}):this.options=f.extend(this.options,t||{}),this.options.sidebar_width=this.options.sidebar_width||250},get:function(t){if(this.options[t+"_selector"])return f(this.options[t+"_selector"]);throw new exception("")},deleteDivider:function(){f(".js-delete-divider").click(function(){f(this).parent().find("input").val(""),f(this).parent().hide(),f.product.helper.updateSubmitButton(!0)})},initFeatureDate:function(){var t=f(f.product.options.form_selector).find(".js-datepicker-wrapper"),e=t.find(".js-datepicker");function i(){var e=f(this),i=e.siblings(".js-datepicker-hidden");e.val()||i.val("");try{f.datepicker.parseDate(f.datepicker._defaults.dateFormat,e.val()),e.data("last-correct-value",e.val()),i.data("last-correct-value",i.val())}catch(t){e.val(e.data("last-correct-value")||""),i.val(i.data("last-correct-value")||"")}}e.each(function(){f(this).datepicker({altField:f(this).siblings(".js-datepicker-hidden"),altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,onSelect:i}).on("blur",i).on("keydown keypress keyup",function(t){13===t.which&&t.preventDefault()})}),t.on("click",".js-focus-on-field",function(){e.focus()})},parsePath:function(t){var e=(t=t.replace(/^.*#\//,"").replace(/(^\/|\/$)/,"")).split("/"),i=e.pop(),a={};return i.match(/^[\w_\-]+=/)?a=f.shop.helper.parseParams(i):e.push(i),{id:e[0]||"new",mode:e[1]||"profile",tab:!!e[1]&&(e[2]||"main"),tail:e.slice(3).join("/")||"",raw:t,params:a}},dispatch:function(t){"string"==typeof t&&(t=this.parsePath(t));var e,i,a,o=[];if(f.shop.trace("$.product.dispatch",[this.path,t,t.raw]),t.tab)switch(t.tab){case"main":f(document).trigger("wa_product_section_change","product-general");break;case"descriptions":f(document).trigger("wa_product_section_change","product-seo");break;case"images":f(document).trigger("wa_product_section_change","product-media");break;case"features":f(document).trigger("wa_product_section_change","product-sku");break;case"services":f(document).trigger("wa_product_section_change","product-services");break;case"related":f(document).trigger("wa_product_section_change","product-related");break;case"pages":f(document).trigger("wa_product_section_change","product-pages");break;default:f(document).trigger("wa_product_section_change","product")}else f(document).trigger("wa_product_section_change","product");this.path.id||(e=this.get("container")).length&&(this.path.id=e.data("product-id"),o.push("load")),this.path.id!=t.id?(this.path.id&&o.push("blur"),o.push("load")):(e="undefined",this.path.mode!=t.mode?(f.shop.trace("$.product.dispatch mode",this.path.mode+"->"+t.mode),this.path.mode&&this.path.tab?(f.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+t.tab),e=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),o.push(this.path.mode+"Tab"+e+"Blur"),o.push(this.path.mode+"TabBlur"),o.push(this.path.mode+"Blur")):o.push("focus"),o.push(t.mode+"Init"),o.push(t.mode+"Focus")):this.path.tab&&t.tab!=this.path.tab&&(f.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+t.tab),e=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),o.push(t.mode+"Tab"+e+"Blur"),o.push(t.mode+"TabBlur")),o.push(t.mode+"Action"),i=this.tabIsLoaded(t),t.tab&&(e=t.tab.substr(0,1).toUpperCase()+t.tab.substr(1)),t.tab&&t.tab!=this.path.tab&&(f.shop.trace("$.product.dispatch tabFocus",this.path.tab+"->"+t.tab),i?(o.push(t.mode+"TabShow"),o.push(t.mode+"TabInit"),o.push(t.mode+"Tab"+e+"Init"),o.push(t.mode+"TabFocus"),o.push(t.mode+"Tab"+e+"Focus")):(o.push(t.mode+"TabFocus"),a=t.mode+"Tab"+e+"Load",this.isCallable(a)?o.push(a):o.push(t.mode+"TabLoad"))),t.tab&&i&&o.push(t.mode+"Tab"+e+"Action"));for(var n=0;n<o.length;n++)if(!1===this.call(o[n],[t]))return!1},termination:function(){var t,e=[];this.path.mode&&this.path.tab&&(t=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),e.push(this.path.mode+"Tab"+t+"Blur"),e.push(this.path.mode+"TabBlur"),e.push(this.path.mode+"Blur")),e.push("blur");for(var i=0;i<e.length;i++)this.call(e[i],[])},isCallable:function(t){return"function"==typeof this[t]},tabIsLoaded:function(t){return!!f("#s-product-edit-forms").find(".s-product-form."+t.tab).length},call:function(e,t,i){var a=null,o=this.isCallable(e);if(f.shop.trace("$.product.call",[e,t=t||[],o]),o)try{a=this[e].apply(this,t)}catch(t){f.shop.error("Error at method $.product."+e+". Original message: "+t.message,t)}return a},load:function(t){var e,i=this.get("container");i.length&&i.data("product-id")==t.id||(e=this,i="?module=product&id="+t.id,t.hasOwnProperty("tail")&&"force-old"===t.tail&&(i+="&force-old=1"),f.shop.trace("$.product.load product",i),f.products.load(i,function(){e.dispatch(t)})),this.editTabMainData.sku_id="new"==t.id?-1:0,this.editTabMainData.stocks={}},focus:function(){f("*").off(".product"),this.helper.init()},blur:function(){this.path.id=null,this.path.mode=null,this.path.tab=null,this.path.tail=null,f("*").off(".product"),f("#mainmenu").find(".s-level2").show(),f("#s-product-edit-menu, #s-product-edit-save-panel").hide();var t="fast";f("#s-sidebar").show().animate({width:f.product.options.sidebar_width},t).queue(function(){f(this).dequeue()}),f("#s-toolbar").show().animate({width:"200px"}),f("#maincontent").animate({"margin-top":"84px"},t),f("#s-content").animate({"margin-left":f.product.options.sidebar_width},t)},saveData:function(e,i,a){var o=this,t=o.get("form"),n="radio",s=t.find('input[name="product[sku_type]"]:first');if(s.is(":radio")?(r=t.find('input[name="product[sku_type]"]:checked').val(),s=t.find('input[name="product[sku_type]"]')):(n="hidden",r=t.find('input[name="product[sku_type]"]:not(:disabled)').val()),"1"==r){var r=f("#s-product-feature-superposition").find("input:checked:first").length;if(!r&&"radio"==n)return s.filter("[value=0]").attr("checked",!0),f.product.onSkuTypeChange(0),!1}if(o.ajax.save)setTimeout(function(){o.saveData(e,i,a)},100);else{if(this.path.tab){r="editTab"+this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1)+"Save";if(!1===this.call(r))return!1}o.ajax.save=!0,f("#s-product-description-content").length&&f("#s-product-description-content").waEditor("sync"),t.find(".s-price").find("input").each(function(){this.value=this.value.replace(/\s+/g,"")}),f.shop.trace("$.product.saveData(mode="+e+", tab="+i+")");n=f("#product-tags_tag");n.length&&(s=jQuery.Event("keypress",{which:13}),n.trigger(s)),f(t).find(':input[name^="product\\["]:not(:disabled)').each(function(){var t=f(this).attr("type");if("text"!=t&&"textarea"!=t)return!0;this.defaultValue==this.value?f(this).attr("disabled",!0).addClass("js-ajax-disabled"):f(this).hasClass("js-ajax-disabled")&&f(this).removeAttr("disabled").removeClass("js-ajax-disabled")}),this.refresh("submit"),this.clearValidateErrors(),f.ajax({url:f(t).attr("action"),data:f(t).serializeArray(),dataType:"json",type:"post",success:function(t){if("fail"==t.status)o.showValidateErrors(t.errors)||o.refresh("error",t.errors);else if(t.data.redirect)f.shop.trace("$.product.saveData redirect",t.data.redirect),window.location.href=t.data.redirect;else{if(o.refresh("success",t.data.message||""),f.shop.trace("$.product.saveData updateData",[e,i]),o.updateData(t.data,e,i),a&&"function"==typeof a&&a(),o.path.tab){t="editTab"+o.path.tab.substr(0,1).toUpperCase()+o.path.tab.substr(1)+"Saved";if(!1===o.call(t))return!1}f.each(o.standalone_tabs,function(t,e){o.path.tab!=e&&(e="editTab"+e.substr(0,1).toUpperCase()+e.substr(1)+"Saved",o.call(e))})}o.ajax.save=!1},error:function(t,e,i){o.ajax.save=!1,o.refresh("error",e)}})}return!1},showValidateErrors:function(t){var i,a,e,o,n,s;return!f.isEmptyObject(t=t||{})&&(a=!1,e=(i=this).$edit_forms,t.features&&t.features.gtin&&(o=e.find(".s-product-form.features").find('input[name="product[features][gtin]"]')).length&&(o.addClass("error js-validate-error-input"),n=f('<div class="errormsg js-validate-error-msg"></div>').text(t.features.gtin),o.after(n),a=!0,i.refresh("error",$_("Cannot save the value of the “GTIN” feature for this product."))),t.skus&&(s=e.find(".s-product-form.main table.s-product-skus tbody"),f.each(t.skus,function(t,e){"status"===t?(a=!0,i.refresh("error",$_(e))):e.features&&e.features.gtin&&(t=s.find('.js-sku-settings[data-id="'+t+'"]').find('input[name="'+("skus["+t+"][features][gtin]")+'"]')).length&&(t.addClass("error js-validate-error-input"),e=f('<div class="errormsg js-validate-error-msg"></div>').text(e.features.gtin),t.after(e),a=!0,i.refresh("error",$_("Cannot save the value of the “GTIN” feature for an SKU of this product.")))})),a)},clearValidateErrors:function(){var t=this.$edit_forms,e=t.find(".s-product-form.main table.s-product-skus tbody"),t=t.find(".s-product-form.features");e.find(".js-validate-error-input").removeClass("error"),e.find(".js-validate-error-msg").remove(),t.find(".js-validate-error-input").removeClass("error"),t.find(".js-validate-error-msg").remove()},updateData:function(r,t,e){f.shop.trace("$.product.updateData("+t+","+e+")",r);var i,a,o=f("#s-product-edit-forms .s-product-form.main"),n=this.path.id,t=(this.path.id&&"new"!=this.path.id?this.path.id!=r.id&&f.shop.error("Abnormal product ID change",[this.path.id,r]):(this.path.id=r.id,f(this.options.container_selector).data("product-id",this.path.id),s="/product/"+this.path.id+"/",null!==t&&(t=t||this.path.mode||"profile")&&("profile"!=t&&(s+=t+"/"),null!==e)&&(e=e||this.path.tab||"")&&"main"!=e.toLowerCase()&&(s+=e+"/"),f.shop.trace("update location.hash="+s),i=/#\/product\/new\//,a="#/product/"+this.path.id+"/",f("#shop-productprofile, #s-product-edit-menu, #s-product-edit-forms, #s-product-profile-page").find('[href*="#/product/new/"]').each(function(){f(this).attr("href",f(this).attr("href").replace(i,a))}),f("#s-product-edit-forms").find(':input[name="product\\[id\\]"]').val(this.path.id),window.location.hash=s),f("#shop-productprofile h1"));if(t.find(".s-product-name:first").text(r.name),t.find(".s-product-id").show().text("id: "+r.id),document.title=r.name+f.product.options.title_suffix,f("#product-stock-stat").html(tmpl("template-product-stock-stat",r.raw)),o.find(':input[name="product\\[type_id\\]"]').parents(".value").data("type",r.type_id),f.isEmptyObject(r.frontend_urls))f(".s-product-frontend-url-not-empty").hide(),f(".s-product-frontend-url-empty").show();else{var e=f("#s-product-frontend-url");e.text(r.url);f("#s-product-frontend-url-input").val(r.url),e.trigger("readable");for(var s=e.parent(),d=(s.attr("href",r.frontend_urls[0].url),s.find("span:first").text(r.frontend_urls[0].base),e.closest("div.value").find(".s-product-frontend-url").each(function(t){r.frontend_urls[t+1]&&f(this).attr("href",r.frontend_urls[t+1].url).text(r.frontend_urls[t+1].url)}),f(".s-product-frontend-url-not-empty").show(),f(".s-product-frontend-url-empty").hide(),""),l=0,c=r.frontend_urls.length;l<c;l+=1)d+=' <span class="s-product-frontend-url-not-empty"><a href="'+r.frontend_urls[l].url+'" target="_blank">'+r.frontend_urls[l].url+'</a><i class="icon10 new-window"></i></span> ';d&&f("#s-product-frontend-links").find(".s-product-frontend-url-not-empty").wrapAll("<div></div>").closest("div").replaceWith(d)}this.editTabMainUpdate(r.raw||{},r.features_selectable_strings,n),o.find("select.s-product-categories").each(function(){var t=f(this),e=t.parent(),i=t.val(),a=("select"==i||"---"==i?1<f("#s-product-edit-forms .s-product-form.main select.s-product-categories").length?e.remove():e.find(".s-product-delete-from-category").hide():"create"==i&&("0"==(a=e.find("input.val").val())?1<f("#s-product-edit-forms .s-product-form.main select.s-product-categories").length?e.remove():(t.val(a),t.show().attr("disabled",!1),e.find("input.val").attr("disabled",!0),e.find(".s-new-category").hide(),e.find(".s-product-delete-from-category").hide()):(t.val(a),t.show().attr("disabled",!1),e.find("input.val").attr("disabled",!0),e.find(".s-new-category").hide(),e.find(".s-product-delete-from-category").show())),parseInt(i,10));if(!f.isEmptyObject(r.storefront_map[a])){for(var o="",n=r.storefront_map[a],s=0;s<n.length;s+=1)o+='<a class="hint" href="'+n[s]+'" target="_blank">'+n[s]+"</a> ";e.find(".s-storefront-map").html(o)}}),f("#s-product-categories").html(tmpl("template-product-categories",{categories:r.categories||[]})),f("#s-product-tags").html(tmpl("template-product-tags",{tags:r.tags||[]})),f("#s-product-save table.s-product-skus > tbody > tr").each(function(){var e=f(this).data("id");f(this).find("td.s-stock .s-product-stock-icon").each(function(){var t=f(this).data("stock");r.raw&&r.raw.skus&&r.raw.skus[e]&&r.raw.skus[e].stock_icon[t]&&f(this).html(r.raw.skus[e].stock_icon[t])})}),o.find("tr.js-sku-settings").each(function(){var t=f(this),e=t.attr("data-id"),e=r.raw.skus[e];e&&void 0!==e.file_name&&!e.file_name&&(t.find(".s-sku-attachment").hide(),t.find(".fileupload").show())}),this.helper.checkChanges(this.get("form"),!0),f("#s-product-edit-menu li a i.icon10.status-yellow-tiny").remove(),this.helper.updateSubmitButton(!1),"0"==r.raw.sku_type&&((t=f("#s-product-feature-superposition")).find("input[type=checkbox]").attr("checked",!1),(s=t.find("ul.features li")).find(".count").text(""),s.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass("status-gray-tiny"),(e=t.find(".superposition-count")).find(".options").text(""),e.find(".skus").text("")),f("#s-product-meta-title").attr("placeholder",r.default_meta_title),f("#s-product-meta-keywords").attr("placeholder",r.default_meta_keywords),f("#s-product-meta-description").attr("placeholder",r.default_meta_description),f('#s-product-profile-tabs .s-tab-block[data-tab="stock-logs"]').trigger("refresh"),this.setData("main","category_name",r.category_name)},refresh:function(t,e){f(this.options.form_selector).find(':input[name^="product\\["]:disabled.js-ajax-disabled').each(function(){f(this).removeAttr("disabled").removeClass("js-ajax-disabled")});var i=f(this.options.message_selector),a=(i.removeClass("errormsg successmsg status").empty().show(),this.timer&&clearTimeout(this.timer),null);switch(i.append(this.message[t]||""),t){case"submit":i.addClass("status");break;case"error":i.addClass("errormsg");for(var o=0;o<e.length;o++)i.append(e[o][0]);a=2e4;break;case"success":e&&i.addClass("successmsg").append(e),this.helper.updateSubmitButton(!(a=3e3))}a&&(this.timer=setTimeout(function(){i.removeClass("errormsg successmsg status").empty().show()},a))},editTabLoad:function(t,e){var i=this,a=f("#s-product-edit-forms .s-product-form."+t.tab);!0===e||!a.length&&"new"==t.id?(f.shop.trace("product.editTabLoad: create",[t.tab+" — create",t,e]),this.saveData(this.path.mode,t.tab,function(){t.tab&&i.call(t)})):this.editTabLoadContent(t)},editTabLoadContent:function(o,t){var n=this,e="?module=product&action="+(o=o||this.path).tab+"&id="+o.id,s=(o.tail&&(e+="&param[]="+o.tail.split("/").join("&param[]=")),Math.random()),r=(this.ajax.random=s,f("#s-product-edit-forms .s-product-form."+o.tab));if(r.length&&r.remove(),f("#s-product-edit-forms > form").append(tmpl("template-productprofile-tab",{id:o.tab})),r=f("#s-product-edit-forms .s-product-form."+o.tab),this.ajax.target=r,this.ajax.link=f("#s-product-edit-menu li."+o.tab),f.shop.trace("$.product.editTabLoadContent",[o,e,o.params]),o.params&&t){var i=typeof o.params;switch(i){case"String":e+=o.params;break;case"Array":e+=o.params.serialize();break;default:f.shop.error("unexpected type "+i,o.params)}}f.ajax({url:e,type:t?"POST":"GET",data:t||o.params||{},success:function(t,e){if(f.shop.trace("$.product.loadTab status="+e),n.ajax.random==s){r.empty().append(t),n.ajax.target=null,n.ajax.link=null;e="#/product/"+o.id+"/edit/";if(o.tab&&(e+=o.tab+"/"),o.tail&&(e+=o.tail+"/"),o.params&&!f.isEmptyObject(o.params)){var i,a=[];for(i in o.params)o.params.hasOwnProperty(i)&&a.push(i+"="+o.params[i]);e+=a.join("&")}window.location.hash=e,n.dispatch(o)}}})},editTabInit:function(t){f("html, body").animate({scrollTop:0},200),f("#shop-productprofile").find(".s-product-name").removeClass("editable"),this.$edit_forms=f("#s-product-edit-forms")},editTabFocus:function(t){f("#s-product-edit-menu li."+t.tab).addClass("selected"),this.refresh()},editTabBlur:function(t){var e,i;t&&(f("#s-product-edit-forms .s-product-form").hide(),f("#s-product-edit-menu li.selected").removeClass("selected"),e=t.tab,-1!==this.standalone_tabs.indexOf(e)&&(i=this).helper.checkChanges(this.get("form"),!0,function(t){t&&(f.shop.trace("$.product.editTabBlur: save standalone tab ["+e+"]",i.standalone_tabs),i.saveData(i.path.mode,e,function(){e&&i.call(i.path)}))}),this.path.tab=null,this.path.tail=null)},editTabShow:function(t){var e=f("#s-product-edit-forms .s-product-form."+t.tab);e.length?(e.show(),f.shop.trace("$.product.showTab",t),this.path.tab=t.tab):f.shop.error("$.product.showTab",t)},editClick:function(t){var e,i=t.attr("href").replace(/.*#\/product\/(\d+|new)\/edit\//,"").replace(/\/$/,"").split("/"),a=[];if(i.length){f.shop.trace("$.product.editClick",i);for(var o,n="editTab";o=i.shift();)o="function"==typeof this[n+=o.substr(0,1).toUpperCase()+o.substr(1)],f.shop.trace("$.settings.featuresClick try",[n,o,i]),!0==o&&(e=n,a=i.slice(0))}if(e){if(f.shop.trace("$.product.editClick",[e,a]),!t.hasClass("js-confirm")||confirm(t.attr("title")||"Are you sure?")){a.push(t);try{this[e].apply(this,a)}catch(t){f.shop.error("Error at method $.product."+e+". Original message: "+t.message,t)}}}else f.shop.error("Not found js handler for link",[e,t]);return!1},switchSubMenu:function(t){t=t||"default",f("#mainmenu .s-submenu > *").hide(),f("#mainmenu .s-submenu .s-submenu-"+t).show()},profileFocus:function(){var t=this.options.duration,e=this;f("#s-product-edit-menu, #s-product-edit-save-panel").hide(),e.switchSubMenu(),f("#s-sidebar").show().animate({width:f.product.options.sidebar_width}),f("#s-toolbar").show().animate({width:"200px"},t).queue(function(){f(this).dequeue(),f("#s-product-edit-forms").hide(),f("#s-product-profile-page, h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").show(),e.get("container").find(".back").attr("href","#/"+f.products.list_hash)}),f("#maincontent").animate({"margin-top":"84px"},t),f("#s-content").animate({"margin-left":f.product.options.sidebar_width},t),f("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return e.editClick(f(this))})},profileAction:function(){this.path.mode="profile"},disableSkus:function(t,e){var i=f(this.options.form_selector).find(".s-sku-list");t?e?i.find(".s-sku-virtual").hide().find(":input").attr("disabled",!0):i.find(".s-sku-virtual").show().find(":input").attr("disabled",!1):(e?i.hide():i.show(),i.find(":input").attr("disabled",e))},skuTypeFeaturesSelectableLoad:function(e,i){var a=this,t="?module=product&action=featuresSelectable&id="+this.path.id,o={type_id:e,sku_type:1};f("#s-product-feature-superposition-field-group").load(t,o,function(){var t=a.featureSelectableInit();i&&(i.base_price_selectable&&t.find(':input[name="product[base_price_selectable]"]').val(i.base_price_selectable),i.currency)&&t.find("select.s-product-currency").val(i.currency),a.onSkuTypeEnabled(e)})},onSkuTypeEnabled:function(t){for(var e,i,a=f("#s-product-feature-superposition-field-group"),o=(t&&a.data("type",t),a.show(400,function(){f.product.checkFeatureValidation()}),a.find("input").attr("disabled",!1),"new"==f.product.path.id?f.product.disableSkus(!1,!0):f.product.disableSkus(!0,!1),["compare_price","purchase_price"]),n=0;n<o.length;n++)(e=a.find(':input[name="product['+o[n]+'_selectable]"]:first')).length&&!parseInt(e.val())&&(i=f(':input[name^="skus"][name$="['+o[n]+']"]:first')).length&&e.val(i.val())},checkFeatureValidation:function(){var t=f("#s-product-feature-superposition-field-group").find("ul.features li"),e=f("#product-save-message");t.find(".status-blue-tiny").length?e.removeClass("errormsg").empty():e.addClass("errormsg").empty().html($_("Select parameters to be available to customers for ordering this product in the storefront.")).show()},onSkuTypeChange:function(t){var e,i=f("#s-product-feature-superposition-field-group");f.shop.trace("onSkuTypeChange",{sku_type:t}),"1"==t?(t=f(this.options.form_selector+' :input[name="product[type_id]"]').val(),i.data("type")!=t?(e={base_price_selectable:i.find(':input[name="product[base_price_selectable]"]').val(),currency:i.find("select.s-product-currency").val()},parseInt(e.base_price_selectable)||(e.base_price_selectable=f(':input[name^="skus"][name$="[price]"]:first').val()),f.product.skuTypeFeaturesSelectableLoad(t,e)):f.product.onSkuTypeEnabled()):(i.hide(400,function(){f("#product-save-message").removeClass("errormsg").empty()}),i.find("input").attr("disabled",!0),t=f(this.options.form_selector).find(".s-product-skus"),"new"==f.product.path.id?f.product.disableSkus(!1,!1):(e=t.find("tbody"),f.product.disableSkus(!0,!0),e.find(">tr:not(.s-sku-virtual)").length||(f.product.editTabMainSkuAdd(),e.find(">tr:not(.s-sku-virtual):first").find('input[name="product[sku_id]"]').attr("checked",!0))),t.closest(".field").find(".name").show())},featureSelectableInit:function(){var t=f(this.options.form_selector),i=f("#s-product-feature-superposition"),a=t.find(".s-product-skus"),t=t.find(':input[name="product[base_price_selectable]"]'),o=this;return i.on("click","ul.features>li",function(){var t=f(this),t=(t.parent().find("li.selected").removeClass("selected"),t.addClass("selected"),t.attr("data-feature-id")),t=i.find(".feature-values[data-feature-id="+t+"]");return i.find(".feature-values").hide(),t.show(),!1}),i.on("change","ul.values>li input",function(){var t=f(this).parents("li:first").parent().find(">li input:checked").length,e=i.find("ul.features li.selected"),t=(e.find(".count").text(t||""),t?"status-blue-tiny":"status-gray-tiny");e.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass(t),o.featureSelectableCount(i),f.product.checkFeatureValidation()}),f.shop.changeListener(t,function(){a.find(".s-sku-virtual .s-price input").val(f(this).val())}),f.shop.changeListener(a,function(){var t,e=f(this);"product[sku_id]"!=e.attr("name")&&(e=e.parents("tr:first")).length&&(t=parseInt(e.attr("data-id"),10))&&(!e.hasClass("js-sku-settings")||(e=a.find("tr[data-id="+t+"]:first")).length)&&(e.find("input.s-input-virtual").val(0),e.removeClass("s-sku-virtual"),f("#s-product-view").find("tr[data-id="+t+"]").removeClass("s-sku-virtual"))},"input, textarea"),i.find("i.status-blue-tiny:first").parents("li").trigger("click"),i},featureSelectableCount:function(o){o=o||f("#s-product-feature-superposition");var n=[],s=f("#s-product-edit-forms .s-product-form.features"),t=(o.find("ul.features>li").each(function(){var t,i,e=f(this),a=parseInt(e.find(".count").text(),10);a&&n.push(a),s.length&&(t=s.find('div[data-code="'+e.data("feature-code")+'"] div.value'),a?(a=e.data("feature-id"),i=o.find('div.feature-values[data-feature-id="'+a+'"] ul.values input:checked'),t.each(function(){var t=f(this),e=i.filter('[value="'+t.data("value-id")+'"]').length;t.find("input:checkbox").attr("checked",e?"checked":null).attr("disabled","disabled"),e?t.show():t.hide()})):(t.show(),t.find("input:checkbox").each(function(t,e){e.checked=e.defaultChecked,e.disabled=null})))}),o.find(".superposition-count"));if(n.length){t.find(".options").text($_("Parameters: %s").replace("%s",n.join(" x ")));for(var e=1,i=0,a=n.length;i<a;i+=1)e*=n[i];t.find(".skus").html('<span class="highlighted">'+$_("SKUs: %d").replace("%d",e)+"</span>")}else t.find(".options").text(""),t.find(".skus").html("")},editInit:function(){if(f("#s-product-edit-forms").unbind("keydown.product").bind("keydown.product",function(t){if(f(t.target).is(":input")&&(t.ctrlKey||t.metaKey)&&83==t.keyCode)return f("#s-product-save-button").click(),!1}),f.shop.makeFlexibleInput("s-product-meta-title"),!this.options.edit_rights)return window.location.hash="#/product/"+this.path.id+"/",!1;var e=f(this.options.form_selector),i=(e.bind("submit.product",function(t){return f.product.saveData("profile",null)}),e.on("change.product, keyup.product","div.s-product-form:not(.ajax) :input",function(t){f.product.helper.onChange(f(this).parents("div.s-product-form"))}),e.on("change.product, keyup.product, keypress.product",':input[name="product[name]"]',function(t){f.product.helper.onNameChange(f(this),!1,f.product.options.update_delay||500)}),f.shop.changeListener(e,':input[name="product[url]"]',function(){var t=f(this);f.getJSON("?module=product&action=checkUrlInUse",{id:f.product.path.id,url:t.val()||""},function(t){f.product.informAboutUrlInUse("ok"===t.status&&t.data.url_in_use)})}),f("#product-tags"));i.data("tags_input_init")||(i.tagsInput({autocomplete_url:"?module=product&action=tagsAutocomplete",height:120,onChange:function(){f.product.updateMetaFields()},defaultText:""}).data("tags_input_init",!0),f("#s-product-popular-tags").off("click.product","a").on("click.product","a",function(){var t=f(this).text();i.removeTag(t),i.addTag(t)})),e.on("change.product",".s-product-currency",function(){var t=f(this).val();e.find(".s-product-currency").val(t),e.find(".s-product-currency-readonly").text(t),f("#s-product-currency-code").val(t)}),e.on("change.product",':input[name="product[type_id]"]',function(){return f.product.editTabMainTypeChange(f(this))}),e.on("change",'select[name="product[status]"]',function(){"1"==f(this).val()?(f(this).prev().removeClass("no-bw").addClass("yes"),f(".s-product-status-text").hide()):(f(this).prev().removeClass("yes").addClass("no-bw"),f(".s-product-status-text").show())}),e.on("change",'input[name="product[sku_type]"]',function(){f.product.onSkuTypeChange(this.value)}).change(),f.product.featureSelectableInit(),f.product.editTabMainTypeChange(f(".js-shop-product-set-type"))},informAboutUrlInUse:function(t){t?f("#s-product-url-in-use-block").show().find(".s-text").html(t):f("#s-product-url-in-use-block").hide()},editFocus:function(){var t=this.options.duration,e=this;f("h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").hide(),f("#s-sidebar, #s-toolbar").animate({width:0},t).queue(function(){f(this).hide(),f(this).dequeue(),f("#s-product-edit-menu, #s-product-edit-forms, #s-product-edit-save-panel").show(),"new"!=e.path.id?e.get("container").find(".back").attr("href","#/product/"+e.path.id+"/"):e.get("container").find(".back").attr("href","#/"+f.products.list_hash),f("#s-product-profile-page").hide(),e.switchSubMenu("productprofile")}),f("#maincontent").animate({"margin-top":"40px"},t),f("#s-content").animate({"margin-left":0},t),f("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return e.editClick(f(this))})},editBlur:function(){this.path.tab=!1,this.path.mode=!1,f(f.product.options.form_selector).off("submit.product"),f(this.options.form_selector).off("change.product, keyup.product"),f("#s-product-edit-forms").off("click.edit-product")},editAction:function(t){this.path.mode=t.mode},editTabMainData:{sku_id:-1,stocks:{}},editTabMainInit:function(t){f("#s-product-type").each(function(){f(this).parent().get(0)!=document.body&&(f("body > #s-product-type").remove(),f(document.body).append(f(this)))});var e=f("#s-product-edit-forms .s-product-form.main"),a=this,o=e.find("table.s-product-skus:last > tbody"),i=(o.sortable({distance:5,helper:"original",items:"> tr",handle:"i.sort",opacity:.75,tolerance:"pointer",update:function(t,e){var i=parseInt(f(e.item).data("id"),10),e=void 0===(e=f(e.item).prev().data("id"))?0:parseInt(e,10),e=(a.editTabMainSkuSort(i,e,f(this)),o.find('> tr.js-sku-settings[data-id="'+i+'"]'));e.length&&(e=e.detach(),f.shop.trace("detach",e),e)&&(f.shop.trace("detach",o.find('> tr[data-id="'+i+'"]').length),o.find('> tr[data-id="'+i+'"]:first').after(e))},start:function(t,e){o.find("> tr.js-sku-settings").hide()},stop:function(t,e){o.find("> tr.js-sku-settings").show()}}),f("#s-product-frontend-url"));i.inlineEditable({editLink:"#s-product-frontend-url-edit-link",editOnItself:!1,minSize:{height:15,width:100},makeReadableBy:[],beforeMakeEditable:function(t){var e=f(this).closest("span.s-product-frontend-url-not-empty"),i=e.find("span.slash"),a=e.find("i.new-window");f(t).after(i),a.hide(),e.find("a.s-frontend-base-url").hide(),e.find("span.s-frontend-base-url").show()},beforeBackReadable:function(t,e){var i=f(this).closest("span.s-product-frontend-url-not-empty"),a=i.find("span.slash");i.find("i.new-window").show(),i.find("span.s-frontend-base-url").hide(),i.find("a.s-frontend-base-url").show().append(a)}}),parseInt(t.id,10)||i.trigger("editable"),"new"==t.id&&f.product_list&&f.isArray(f.product_list.collection_hash)&&("category"==f.product_list.collection_hash[0]?e.find("select.s-product-categories").val(f.product_list.collection_hash[1]):"set"==f.product_list.collection_hash[0]&&e.find(".add-set-button").click().closest(".field").find("select:first").val(f.product_list.collection_hash[1])),e.off("change.product","select.s-product-categories").on("change.product","select.s-product-categories",function(t){var e=f(this),i=e.val(),a=e.parent(),o=a.find(".s-product-delete-from-category"),n=parseInt(i,10)||0;n?o.show():o.hide(),"create"==i?(a.find(".s-new-category").show(),a.find("input.val").attr("disabled",!1),e.hide().attr("disabled",!0).addClass("js-ignore-change")):a.find("input.val").val(n)}),e.off("keydown.product","input.new-category").on("keydown.product","input.new-category",function(t){if(13==t.keyCode)return f(this).parent().find("input[type=button]").click(),!1}),e.off("click.product",".s-new-category input[type=button]").on("click.product",".s-new-category input[type=button]",function(t){var a=f(this).parent(),o=a.parent(),n=a.find("input[name=new_category]"),e=n.val();f.shop.jsonPost("?module=category&action=save&category_id=0&parent_id=0",{name:e},function(t){var e=o.find("select"),i=e.find("option.separator:first").show();f.when(i.after('<option class="category" value="'+t.data.id+'">'+t.data.name+"</option>")).then(function(){e.find("option:first").text($_("Please select a category")),e.val(t.data.id).attr("disabled",!1).show().removeClass("js-ignore-change"),a.find("input.val").val(t.data.id).attr("disabled",!0),a.hide(),o.find(".s-product-delete-from-category").show(),n.val(""),f.product.helper.onTabChanged("main",{"saving new category":!0}),f("#s-category-list>ul").trigger("add",[t.data,"category"])})})}),e.off("click.product",".s-product-delete-from-category").on("click.product",".s-product-delete-from-category",function(){var t,e,i=f(this),a=i.parent("div"),o=a.find("select");return o.length?2<f("#s-product-edit-forms .s-product-form.main select.s-product-categories").length?(o.attr("disabled",!0),t=a.parents("div.field:first").find('input[name="product[categories.deleted]"]'),0<parseInt(o.val())&&((e=t.val().split(",")).push(o.val()),e.sort(),t.val(e.join(",")),f.product.helper.onChange(f.product.get("form").find("div.main:first"))),a.remove()):(o.val("selected").attr("disabled",!1),a.find("input.val").val(0).attr("disabled",!0).parent().hide(),a.find(".s-storefront-map").html(""),a.find(".s-product-delete-from-category").hide()):(t=a.parents("div.field:first").find('input[name="product[categories.deleted]"]'),o=i.parents(".value:first").find(":input:first"),0<parseInt(o.val())&&((e=t.val().split(",")).push(o.val()),e.sort(),t.val(e.join(",")),f.product.helper.onChange(f.product.get("form").find("div.main:first"))),i.parents(".value:first").remove()),!1})},editTabMainAction:function(t){var e=!1,i=null;t&&t.params&&t.params.focus?((i=t.params.name||"").length||t.params.sku&&(i="product[skus]["+parseInt(t.params.sku,10)+"]",t.params.focus&&(i+="["+t.params.focus+"]"),"stock"==t.params.focus)&&(i+="["+(parseInt(t.params.stock,10)||0)+"]"),e=':input[name$="'+i.replace(/(\[|\]|\|\-)/g,"\\$1")+'"]:first'):t&&"new"==t.id&&(e=':input[name$="[name]"]:first'),e&&(f.shop.trace("$.product.editTabMainFocus",[i,f(e).length]),setTimeout(function(){f(e).focus(),window.location.hash="#/product/"+t.raw.replace(/\/focus=.*$/,"/")},100))},editTabMainBlur:function(){},editTabMainSave:function(){if(!1===this.call("editTabMainSkuEproductSave"))return!1},helper:{options:{tab_changed:'<i class="icon10 status-yellow-tiny"></i>',defaultChangedStatus:!1},data:{url_helper:{url:"",name:"",timer:null}},init:function(){this.data.url_helper={url:"",name:"",timer:null}},onTabChanged:function(t,e){f.shop.trace("$.product.onTabChanged id="+t+" changed="+!!e,e),f("#s-product-edit-menu li."+t+" .s-product-edit-tab-status").html(e?this.options.tab_changed:""),e&&this.updateSubmitButton(!0)},type:function(t){return parseInt(t,10)||parseInt(f('#s-product-edit-forms .s-product-form.main :input[name="product\\[type_id\\]"]').val(),10)||0},onNameChange:function(t,e,i){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var a,o=f(f.product.options.form_selector).find(':input[name="product\\[url\\]"]'),n=o.parent();f.product.path.id&&"new"!=f.product.path.id||o.val()!=this.data.url_helper.url?(f.shop.trace("$.product.onNameChange stop "+this.data.url_helper.url+" != "+o.val()),f(f.product.options.form_selector).off(".product",':input[name="product\\[name\\]"]'),n.find(".js-url-helper").hide()):(e&&(n.find(".js-url-helper").length?n.find(".js-url-helper").show():n.append('<i class="icon16 loading js-url-helper"></i>')),(a=this).data.url_helper.timer=setTimeout(function(){a.urlHelper(t,o,i)},i||500))},onChange:function(e){var i=this.getContainerId(e),a=this;this.checkChanges(e.parents("form"),!1,function(t){a.updateSubmitButton(t),t?a.checkChanges(e,!1,function(t){a.onTabChanged(i,t)}):a.onTabChanged(i,t)})},urlHelper:function(t,e){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var i,t={name:f(t).val()};f.shop.trace("$.product.urlHelper ",t),t.url!=this.data.url_helper.name?((i=this).data.url_helper.url=t.url,f.getJSON("?module=product&action=suggestUrl",t,function(t){"ok"===t.status&&(i.data.url_helper.url=t.data.url,e.val(t.data.url),e.parent().find(".js-url-helper").hide(),f.product.informAboutUrlInUse(t.data.in_use))})):e.parent().find(".js-url-helper").hide()},getValueByName:function(t,e){for(var i=t,a=e.replace(/\]/,"").split("[");a.shift();){if(void 0===i[e]){i="";break}i=i[e]}return f.shop.trace("$.product.helper.getValueByName",[i,e,t]),i},checkChangesStack:{},checkChanges:function(e,i,a){var o=e.attr("id"),n=(this.checkChangesStack[o]&&(clearTimeout(this.checkChangesStack[o]),this.checkChangesStack[o]=null),this);this.checkChangesStack[o]=setTimeout(function(){var t=n.checkChangesDelayed(e,i);f.shop.trace("$.product.helper.checkChanges["+o+"]",[e,i,t,a?"callback":"none"]),a&&a(t)},i?50:500)},checkChangesDelayed:function(a,o){var n=this.options.defaultChangedStatus,s=this,t=":input:not(.js-ignore-change)";if(a.hasClass("s-product-form")){if(a.hasClass("ajax"))return!1}else a.hasClass("s-product-form-chunk")||(t=".s-product-form:not(.ajax) "+t);return a.find(t).each(function(){var t,e=f(this),i=(e.attr("type")||this.tagName).toLowerCase();switch(i){case"input":case"text":case"textarea":e.hasClass("ace_text-input")||this.defaultValue!=this.value&&(n=!0,o)&&(this.defaultValue=this.value,s.updateInput(this.name,this.value,"textarea"==i));break;case"radio":case"checkbox":this.defaultChecked!=this.checked&&(n=!0,o)&&(this.defaultChecked=this.checked);break;case"select":this.length&&f(this).find("option").each(function(){this.defaultSelected!=this.selected&&(n=!0,o)&&(this.defaultSelected=this.selected)});break;case"file":this.value&&(n=!0,o)&&(this.value=null);break;case"reset":case"button":case"submit":break;case"hidden":e.hasClass("js-check-change")&&void 0!==e.attr("data-value")&&(defaultValue=e.attr("data-value"),this.disabled?o&&(t=f.shop.helper.escape(this.name),(t=a.find(':input[name="'+t+'"]:enabled')).length)&&e.attr("data-value",t.val()):defaultValue!=this.value&&(n=!0,o)&&e.attr("data-value",this.value));break;default:f.shop.error("$.product.checkChangesDelayed unsupported type "+i,[i,this])}return!o&&n&&(f.shop.trace("$.product.helper.checkChangesDelayed",[this,n,this.defaultValue,this.value]),n=e),o||!n}),n},getContainerId:function(t){var e,i=(f(t).attr("class")||"").split(" "),a=!1;for(e in i)if("s-product-form"!=i[e]){a=i[e];break}return a},updateInput:function(t,e,i,a){var o,n;t&&(o=".s-"+t.replace(/\[(.+?)\]/g,"-$1")+"-input",f.shop.trace("update field: "+t+" "+o,e),(n=f(o)).is("input,textarea")?n.val(e):!i||"product[summary]"===t?n.text(e):n.html(e),a)&&(i=(i=f(o).attr("name")).replaceAll(/\[-[\d]+\]/,"["+a+"]"),f.shop.trace("$.product.helper.updateInput name",[i]))},updateSubmitButton:function(t){f("#s-product-edit-save-panel :submit").removeClass(t?"green":"yellow").addClass(t?"yellow":"green")},count:function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i}},multiSkus:function(t,e){e="boolean"!=typeof e||e;var i=f("#s-product-edit-forms .s-product-form.main table.s-product-skus:first");1<t?(i.find("thead tr th.s-sku-sort").show(),i.find(".s-name,.s-sku-sort").show("slow"),i.find(".delete").parent("a").show(),e&&(2===t?i.find("> tbody:first > tr:first .s-name :input"):i.find("> tbody:first > tr:last .s-name :input")).focus()):(i.find("thead tr th.s-sku-sort").hide(),i.find(".s-name,.s-sku-sort").hide(),i.find(".delete").parent("a").hide(),i.find(".s-sku-big").removeClass("s-sku-big"))},editTabMainSkuAdd:function(){try{var t=f("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),i=0,a="0",e=(t.find(':input[name$="[price]"]').each(function(){var t=f(this),e=t.val()?t.val().replace(",","."):0,e=parseFloat(e);i<e&&(i=e,a=t.val()||"0")}),0),o=(t.find(':input[name$="[purchase_price]"]').each(function(){e=Math.max(e,parseFloat(f(this).val())||0)}),f.product.multiSkus(t.find("tr:not(.js-sku-settings)").length+1),{id:--f.product.editTabMainData.sku_id,product_id:f('input:hidden[name="product[id]"]').val()||"new",sku:"",available:1,status:1,name:"",price:""+i,price_loc:a,purchase_price:""+e,stock_icon:{0:"<i class='icon10 status-green' ></i>"},stock:{},count:null});f.shop.trace("$.product.editTabMainSkuAdd",[f.product.editTabMainData.sku_id,o]),t.append(tmpl("template-sku-edit",{sku_id:f.product.editTabMainData.sku_id,sku:o,stocks:this.getData("main","stocks"),stock_ids:this.getData("main","stock_ids")},!0)),t.find(".s-product-currency").trigger("change"),t.find("td.s-sku").addClass("s-sku-big")}catch(t){f.shop.error(t.message,t)}return!1},editTabMainSkuSort:function(t,e,i){try{f.post("?module=product&action=skuSort",{product_id:this.path.id,sku_id:t,after_id:e},function(t){f.shop.trace("$.product.editTabMainSkuSort result",t),t.error&&(f.shop.error("Error occurred while sorting product SKUs","error"),i.sortable("cancel"))},function(t){f.shop.trace("$.product.editTabMainSkuSort cancel",{data:t}),i.sortable("cancel"),f.shop.error("Error occurred while sorting product SKUs","error")})}catch(t){f.shop.error(t.message,t)}return!1},editTabMainProductDelete:function(t){var e=f("#s-product-list-delete-products-dialog"),i=e.parent();return(i=e.length?i:f("<div></div>").appendTo("body")).load("?module=dialog&action=productsDelete",{product_id:[f.product.path.id]},function(){f("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){f(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(e){return f(this).find(".dialog-buttons i.loading").show(),f.shop.jsonPost("?module=products&action=deleteList",{product_id:[f.product.path.id],get_lists:1},function(t){f.product_list&&f("#s-sidebar").trigger("update",t.data.lists),e.trigger("close"),window.location.hash="#/products/"}),!1}})}),!1},editTabMainSkuDelete:function(e,t){var i,a=f("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),o=t.parents("tbody").find('> tr[data-id="'+e+'"]'),n=this;0<e?(i=t.parents("tbody").find('tr[data-id]:not(.js-sku-settings):not([data-id^="-"])').length,t=t.parents("tbody").find("tr[data-id]:not(.js-sku-settings)").length,1<i?f.ajax({url:"?module=product&action=skuDelete",data:{sku_id:e,product_id:this.path.id},dataType:"json",type:"post",success:function(t){"fail"==t.status?n.refresh("error",t.errors):t.data.redirect?window.location.href=t.data.redirect:(n.refresh("success",t.data.message||"Success"),o.hide("normal",function(){o.remove(),f('#s-product-view table.s-product-skus > tbody > tr[data-id="'+e+'"]').remove(),f.product.multiSkus(a.find("tr:not(.js-sku-settings)").length,!1)}),f("#s-product-edit-forms .s-product-form.main").find("input[name=product\\[sku_id\\]][value="+t.data.sku_id+"]").attr("checked",!0))},error:function(t,e,i){n.refresh("error",e)}}):1<t?(o.after('<input type="hidden" name="skus['+e+']" value="%deleted%">'),o.hide("normal",function(){o.remove(),f('#s-product-view table.s-product-skus > tbody >tr[data-id="'+e+'"]').remove(),f.product.multiSkus(a.find("tr:not(.js-sku-settings)").length,!1)})):n.refresh("error",$_("A product must have at least one SKU."))):o.hide("normal",function(){o.remove(),f('#s-product-view table.s-product-skus > tbody >tr[data-id="'+e+'"]').remove(),f.product.multiSkus(a.find("tr:not(.js-sku-settings)").length,!1)})},editTabMainCategoriesAdd:function(){var t=f("#s-product-edit-forms .s-product-form.main select.s-product-categories:last").parent("div"),e=t.clone(!1);e.find("select").val("select").attr("disabled",!1).show(),e.find("input.val").val(0).attr("disabled",!0).parent().hide(),e.find(".s-product-delete-from-category").hide(),e.find(".s-storefront-map").html(""),e.show(),t.after(e)},editTabMainSkuStock:function(t,e){var i=f("#s-product-sku-"+t),t=(i.hide().find(":input:enabled").attr("disabled",!0),f("#s-product-sku-stock-"+t));t.show().find(":input:disabled").removeAttr("disabled"),t.find(":input:first").val(i.find(":input:first").val())},editTabMainSkuSettings:function(i,t){t.hide();var o=t.parents("tr"),t=o.data(),e=this;f.when(o.after(tmpl("template-sku-settings",{sku_id:i,sku:t}))).done(function(){var t="?module=product&action=skuSettings",a=(t=(t=(t+="&product_id="+e.path.id)+("&sku_id="+i))+("&type_id="+e.helper.type()),f('#s-product-edit-forms .s-product-form.main tr.js-sku-settings[data-id="'+i+'"] > td:first'));a.load(t,function(){if(o.find(':input[name$="[available]"], :input[name$="[status]"]').remove(),f.product_images&&f.product_images.options&&f.product_images.options.enable_2x&&f.fn.retina&&a.find(".s-product-image-crops img").retina(),f.product.initFeatureDate(),0<i){f.shop.trace("fileupload",[a.find(".fileupload").length,typeof a.find(".fileupload").fileupload]);try{var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)")),e=t?decodeURIComponent(t[1]):"";a.find(".fileupload:first").fileupload({dropZone:null,url:"?module=product&action=skuEproductUpload",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,start:function(){a.find(".fileupload:first").hide()},progress:function(t,e){f.shop.trace("fileupload progress",e);var i=a.find(".js-progressbar-container");i.show(),i.find(".progressbar-inner:first").css("width",Math.round(100*e.loaded/e.total,0)+"%")},done:function(t,e){f.shop.trace("fileupload done",[e.result,typeof e.result]);var i,e=(e.result.files||[]).shift();a.find(".js-progressbar-container").hide(),!e||e.error?(a.find(".error-message").text(e.error).show(),a.find(".fileupload:first").addClass("error").show()):((i=a.find(".s-sku-attachment")).find("input.s-input-file-name").val(e.name),i.find(".s-file-name").text(e.name),i.find(".s-file-size").text(e.size),i.find(".s-file-description").val(""),i.find("input[type=checkbox]").attr("checked",!0),i.show(),o.find("input.s-input-virtual").val(0))},fail:function(t,e){f.shop.trace("fileupload fail",[e.textStatus,e.errorThrown]),a.find(".error-message").text("error").show().text(e.errorThrown||"error"),a.find(".js-progressbar-container").hide(),a.find(".fileupload:first").addClass("error").show()},formData:{product_id:f.product.path.id,sku_id:i,_csrf:e}})}catch(t){f.shop.error("Exception "+t.message,t)}}})})},editTabMainSkuImageSelect:function(t,e,i){var a=i.parents("li:first"),o=a.hasClass("selected"),n=i.parents("div.value:first");n.find("ul.s-product-image-crops li.selected").removeClass("selected"),o?n.find('input[name$="[image_id]"]').val(0):(a.addClass("selected"),n.find('input[name$="[image_id]"]').val(e)),f.shop.trace("$.product.editTabMainSkuImageSelect",[n,n.find(':input[name$="[image_id]"]')]),f.product.helper.onChange(i.parents("div.s-product-form"))},editTabMainSkuEproductSave:function(t){t=f("#s-product-edit-forms .s-product-form.main tr.js-sku-settings"+(t&&0<t?'[data-id="'+t+'"]':"")+" > td:first .fileupload");f.shop.trace("$.product.editTabMainSkuEproductSave",t.length),t.length&&t.fileupload("start")},editTabMainSkuEproductDelete:function(t){},editTabMainLinkEdit:function(t){return!1},editTabMainTypeSelect:function(t){var e=t.parents("form").find(':input[name="product[type_id]"]').parents(".value");"main"==this.path.tab?t.hide():(e.find(".js-action").hide(),window.location.hash="/product/"+this.path.id+"/"+this.path.mode+"/"),e.find(".js-type-name").hide(),e.find(":input").show().focus(),setTimeout(function(){e.find(":input").focus()},100)},editTabMainTypeChange:function(t){var e,i,a=t.parents(".value"),t=t.find(":selected:first"),o=t.val(),n=parseInt(t.data("sku-type")),s="features",t=(a.find(".js-type-icon").html(t.data("icon")),a.find(".js-type-name").text(t.text()),o!=a.data("type")?f("#s-product-edit-forms .s-product-form."+s).length&&void 0!==this.editTabFeaturesReload?this.editTabFeaturesReload(o):(i="/features/"+o+"/",(e=f("#s-product-edit-menu > li."+s+" > a")).attr("href",e.attr("href").replace(/\/features\/.*$/,i))):(i="/features/",(e=f("#s-product-edit-menu > li."+s+" > a")).attr("href",e.attr("href").replace(/\/features\/.*$/,i))),f(this.options.form_selector+' :input[name="product[sku_type]"]')),a=(f.shop.trace("sku_type",[n,t]),t.filter('[value="1"]').trigger("disabled",[!n||null]),t.parents("ul"));n?(t.filter(":checked").change(),a.find('[data-sku-type="1"]').hide()):(t.filter('[value="0"]').trigger("checked",!0).change(),a.find('[data-sku-type="1"]').show())},editTabMainUpdate:function(t,e,i){var a,o=f("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody"),n=f("#s-product-view table.s-product-skus tbody"),s=(o.find('tr[data-id^="-"]').remove(),n.find('tr[data-id^="-"]').remove(),o.parents("table").find("tr:hidden").show(),[]);for(a in t.skus||{})s.push(f.extend({id:a},t.skus[a]));var s=s.sort(function(t,e){return t.sort-e.sort}),r=this.getData("main","stocks"),d=this.getData("main","stock_ids"),l="";tmpl.cache["template-sku-edit"]=tmpl(tmpl.load("template-sku-edit"));for(var c=0,u=s.length;c<u;c+=1)l+=tmpl("template-sku-edit",{sku_id:s[c].id,sku:s[c],hide_sort_column:u<=1,stocks:r,stock_ids:d,checked:s[c].id==t.sku_id});o.html(l),o.find("select.s-product-currency").val(t.currency),o.parent().show(),o.closest(".s-sku-list").show(),this.multiSkus(o.find("tr:not(.js-sku-settings)").length);for(l="",c=0,u=s.length;c<u;c+=1)l+=tmpl("template-sku",{sku_id:s[c].id,sku:s[c],stocks:r,stock_ids:d,runout:t.runout||{}});n.html(l),i&&"new"!=i||o.parents("div.field-group:first").after(f("#s-sku-type-field-group")),e&&((n=f("#s-product-feature-superposition .superposition-count")).find(".options").text(e.options),n.find(".skus").html('<span class="highlighted">'+e.skus+"</span>"));var p=/#\/product\/new\//,h="#/product/"+t.id+"/";f("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody, #s-product-view table.s-product-skus tbody").find('[href*="#/product/new/"]').each(function(){f(this).attr("href",f(this).attr("href").replace(p,h))})},editTabDescriptionsBlur:function(){var t=f("#s-product-description-content");t.length&&t.data("redactor")&&t.waEditor("sync")},editTabDescriptionsAction:function(){var e,t=f("#s-product-description-content");t.length&&!t.data("redactor")&&(e=t.parents("div.s-product-form"),t.waEditor({lang:wa_lang,modification_wysiwyg_msg:t.data("modification-wysiwyg-msg"),toolbarFixedTopOffset:f("#mainmenu").length?f("#mainmenu").height():0,imageUploadFields:t.data("uploadFields"),saveButton:f("#s-product-save-button"),callbacks:{change:function(){t.length&&(t.waEditor("sync"),f.product.helper.onChange(e))},keydown:function(t){if(("115"==t.which||"83"==t.which)&&(t.ctrlKey||t.metaKey))return t.preventDefault(),f("#s-product-save-button").click(),!1;f.product.helper.onChange(e)}}}))},profileInit:function(){var t,a;void 0!==f.product_list&&void 0!==f.product_list.fixed_blocks&&(f.product_list.fixed_blocks.set&&f.product_list.fixed_blocks.set.unsetFixed(),f.product_list.fixed_blocks.category)&&f.product_list.fixed_blocks.category.unsetFixed(),this.options.edit_rights&&(t=f("#shop-productprofile").find(".s-product-name"),parseInt(this.path.id,10)?t.addClass("editable"):t.removeClass("editable"),a=this.get("form"),t.inlineEditable({minSize:{width:150},maxSize:{width:550},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){f("#s-edit-product").hide()},afterBackReadable:function(i,t){if(f("#s-edit-product").show(),!t.changed)return!1;f.shop.jsonPost("?module=product&action=save&id="+f.product.path.id,{update:{name:f(i).val()}},function(t){var e=f(i).val();document.title=e+f.product.options.title_suffix,"ok"===t.status&&t.data&&f("#s-product-meta-title").attr("placeholder",t.data.default_meta_title),a.find('input[name="product[name]"]').val(e)})},hold:function(){return!f(this).hasClass("editable")}}));this.call("profileLazyInit",[])},profileLazyInit:function(){var t,i,e=f("#product-sales-plot");window.sales_data&&sales_data.length?e.data("graph_rendered")||(t=function(){e.length&&0<e.width()?(showSalesGraph(sales_data,"undefined"==typeof cash_type?null:cash_type),e.data("graph_rendered",1)):setTimeout(t,1e3)})():e.remove(),sku_plot_data&&sku_plot_data.length&&sku_plot_data[0]&&sku_plot_data[0].length?f("#product-sku-plot").data("graph_rendered")||(i=[],f.each(sku_plot_data[0],function(t,e){i.push({label:e[0],value:e[1]})}),showPieGraph(i,{color_type:"products"}),f("#product-sku-plot").data("graph_rendered",1)):f("#product-sku-plot").remove()},updateMetaFields:function(){for(var t=f(".s-product-name-input").val(),e=(f("#s-product-meta-title").attr("placeholder",t),[t]),i=5,t=(f(".s-sku-name-input").each(function(){if(i<=0)return!1;var t=f.trim(f(this).val());t&&e.push(t),--i}),this.getData("main","category_name")),a=(null!==t&&e.push(t),f("#product-tags").val().split(",")),i=5,o=0;o<a.length&&!(i<=0);o+=1){var n=f.trim(a[o]);n&&e.push(n),--i}f("#s-product-meta-keywords").attr("placeholder",e.join(", ")),f("#s-product-meta-description").attr("placeholder",f("#s-product-summary").val())},getId:function(){return this.path.id}}}(jQuery),function(d){d.fn.rateWidget=function(t,e,i){var o,a=!!("ontouchstart"in window||navigator.msMaxTouchPoints),n=this;if(this&&this.length)return"string"==typeof t?"getOption"==t&&"rate"==e?parseInt(this.attr("data-rate"),10):("setOption"==t&&("rate"==e&&(s.call(this,parseInt(i,10)),e={rate:i}),"object"==typeof e)&&e&&(o=this.data("rateWidgetSettings")||{},d.extend(o,e),void 0!==e.hold)&&"function"!=typeof e.hold&&(o.hold=r(o.hold)),this):(this.data("rateWidgetSettings",d.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0},t||{})),this.data("inited")?void 0:("function"!=typeof(o=this.data("rateWidgetSettings")).hold&&(o.hold=r(o.hold)),function(){n.attr("id")||n.attr("id",(""+Math.random()).substr(2));null!==o.rate&&n.attr("data-rate",o.rate);n.find("i:lt("+n.attr("data-rate")+")").removeClass("star-empty").addClass("star"),a||n.mouseover(function(t){o.hold.call(n)||"I"==(t=t.target).tagName&&((t=d(t)).prevAll().removeClass("star star-empty").addClass("star-hover").end().removeClass("star star-empty").addClass("star-hover"),t.nextAll().removeClass("star star-hover").addClass("star-empty"))}).mouseleave(function(){o.hold.call(n)||s.call(n,n.attr("data-rate"))});{var t,e,i;n.click(function(t){if(!o.hold.call(n)){for(var e=t.target;"I"!=e.tagName;)if(e==this)return;var i=n.attr("data-rate"),a=0;return n.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(a++,d(this).removeClass("star-empty").addClass("star"),this==e)return i!=a&&(n.attr("data-rate",a),o.onUpdate(a)),!1}),!1}}),o.withClearAction&&(t="clear-"+d(this).attr("id"),(e=d("#"+t)).length||(n.after('<a href="javascript:void(0);" class="inline-link rate-clear" id="'+t+'" style="display:none;"><b><i>'+$_("clear")+"</b></i></a>"),e=d("#"+t)),e.click(function(){var t;o.hold.call(n)||(t=n.attr("data-rate"),s.call(n,0),0!==t&&o.onUpdate(0))}),n.parent().mousemove(function(){o.hold.call(n)||(i&&clearTimeout(i),e.show(0))}).mouseleave(function(){i=setTimeout(function(){o.hold.call(n)||e.hide(0)},150)}))}this.unbind("clear").bind("clear",function(){s.call(n,0)}),this.data("inited",!0),n[0].addEventListener("touchend",function(t){d(t.target).trigger("click")},!1)}.call(this),this));function s(t){var e=0;this.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(e==t)return!1;e++,d(this).removeClass("star-empty").addClass("star")}),this.attr("data-rate",t)}function r(t){return function(){return t}}}}(jQuery),function(d){d.product_reviews={container:null,sidebar_counter:null,statuses:{},form:null,hotkeys:{"alt+enter":{ctrl:!1,alt:!0,shift:!1,key:13},"ctrl+enter":{ctrl:!0,alt:!1,shift:!1,key:13},"ctrl+s":{ctrl:!0,alt:!1,shift:!1,key:17}},options:{},init:function(i){this.options=i,this.statuses=i.statuses,i.product_id&&(this.product_id=i.product_id),this.form=d("#s-review-add-form"),this.sidebar_counter=d("#s-all-reviews").find(".count"),i.container&&("object"==typeof i.container?this.container=i.container:this.container=d(i.container),this.container.find(".s-reviews").off("click",".s-review-reply, .s-review-delete, .s-review-restore, .js-review-publish").on("click",".s-review-reply, .s-review-delete, .s-review-restore, .js-review-publish",function(){var t=d(this),e=t.parents("li:first"),e=parseInt(e.attr("data-id"),10)||0;if(t.hasClass("s-review-reply")){if("ignore"===d.product_reviews.options.reply)return;d.product_reviews.prepareAddingForm.call(t,d.product_reviews.form,e)}else t.hasClass("s-review-delete")?d.product_reviews.deleteReview(e,i.afterDelete):t.hasClass("s-review-restore")?d.product_reviews.restoreReview(e,i.afterRestore):t.hasClass("js-review-publish")&&d.product_reviews.publishReview(e);return!1})),this.product_id&&this.container.addClass("ajax");function t(){d.product_reviews.addReview("backend",i.afterAdd)}this.addHotkeyHandler("textarea","ctrl+enter",t),this.form.find("input.save").unbind("click").bind("click",t),this.initView(),this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading),d.product&&(d.product.editTabReviewsAction=function(t){t.tail&&setTimeout(function(){d.product_reviews.activeReplyToForm(t.tail)},200)})},activeReplyToForm:function(t){var e,i=this.container.find(".s-reviews li[data-id="+t+"]");i.length&&(e=i.find(".s-review-reply:first"),this.prepareAddingForm.call(e,this.form,t),d(document).scrollTop(i.offset().top))},initView:function(){var t;"reviews"==d.products.hash.substr(0,7)&&((t=d("#s-sidebar")).find("li.selected").removeClass("selected"),t.find("#s-all-reviews").addClass("selected"))},initReview:function(t){var i=d(document),a=t.$wrapper,o=a.data("id"),n=t.locales,s=t.urls,r=!1;a.on("click",".js-show-image",function(t){t.preventDefault();var t=d(this),e=[],t=(a.find(".js-show-image").each(function(){var t=d(this);e.push({href:t.attr("href"),title:(t=t.attr("title"),d("<div />").text(t).html())})}),t.closest(".s-image-wrapper").prevAll(".s-image-wrapper").length);t&&(e=e.slice(t).concat(e.slice(0,t))),d.swipebox(e,{useSVG:!1,hideBarsDelay:!1,afterOpen:function(){i.on("scroll",function t(){var e=d("#swipebox-close");e.length&&e.trigger("click");i.off("scroll",t)})}})}),a.on("click",".js-delete-image",function(t){t.preventDefault();var e,i=d(this).closest(".s-image-wrapper"),t=i.data("image-id");!r&&confirm(n.confirm)&&(r=!0,e=s.delete,d.post(e,{review_id:o,image_id:t},"json").always(function(){r=!1}).done(function(){i.remove()}))})},initLazyLoad:function(t){var i=t.count,a=t.total_count,e=t.url||"?module=reviews",o=d(t.target||".s-reviews:first ul:first");d(window).lazyLoad("stop"),i<a&&(d(window).lazyLoad({container:o,state:void 0===t.auto||t.auto?"wake":"stop",load:function(){d(window).lazyLoad("sleep"),d(".lazyloading-link").hide(),d(".lazyloading-progress").show(),d.get(e+"&lazy=1&offset="+i+"&total_count="+a,function(t){var t=d("<div></div>").html(t),e=t.find(".s-reviews").children();i+=e.length,o.append(e),d(".lazyloading-progress-string").replaceWith(t.find(".lazyloading-progress-string")),d(".lazyloading-progress").replaceWith(t.find(".lazyloading-progress")),a<=i?(d(window).lazyLoad("stop"),d(".lazyloading-link").hide()):(d(".lazyloading-link").show(),d(window).lazyLoad("wake")),t.remove()},"html")}}),d(".lazyloading-link").unbind("click").bind("click",function(){return d(window).lazyLoad("force"),!1}))},prepareAddingForm:function(t,e){var i;e?(this.after(t),t.find(".rate a:first").hide()):((i=d("#s-review-add li:first")).find("form").length||i.append(t),t.find(".rate a:first").show()),d.product_reviews.clear(!1),d("input[name=parent_id]",t).val(e)},addHotkeyHandler:function(t,e,i){var a=this.hotkeys[e];this.form.off("keydown",t).on("keydown",t,function(t){if(t.keyCode==a.key&&t.altKey==a.alt&&t.ctrlKey==a.ctrl&&t.shiftKey==a.shift)return i()})},addReview:function(t,s){var r=this.sidebar_counter;d.post("backend"!=t&&t?"#":"?module=reviews&action=add",d.product_reviews.form.serialize(),function(t){var e,i,a,o,n;"fail"==t.status?(d.product_reviews.clear(!1),d.product_reviews.showErrors(t.errors)):"ok"==t.status&&t.data.html?(e=d("input[name=parent_id]",d.product_reviews.form),i=d.product_reviews.form.parents(".s-review:first").parent("li"),a=t.data.html,o=d("ul:first",i),n=d.product_reviews.container,i.length||(n.show(),o=d("ul:first",n).show()),o.length||(o=d('<ul class="menu-v with-icon"></ul>'),i.append(o)),o.append(d('<li data-id="'+t.data.id+'" data-parent-id="'+t.data.parent_id+'"></li>').append(a)),d("textarea",d.product_reviews.form).val(""),(n=d("#s-review-add")).find("form").length||(n.append(d.product_reviews.form),e.val(0)),r.length&&r.text(parseInt(r.text(),10)+1),"function"==typeof s&&s(t),d.product_reviews.clear()):console&&console.log("Error occured.")},"json").error(function(t){console&&console.log(t.responseText?"Error occured: "+t.responseText:"Error occured.")})},deleteReview:function(i,a){var o=this.container,n=this.sidebar_counter;d.post("?module=reviews&action=changeStatus",{review_id:i,status:this.statuses.deleted},function(t){var e;"ok"==t.status&&((e=o.find("li[data-id="+i+"]").find("div:first")).removeClass("is-published").removeClass("is-unpublished").addClass("is-deleted"),e.find(".s-review-delete").hide(),e.find(".s-review-restore").show(),n.length&&n.text(parseInt(n.text(),10)-1),"function"==typeof a)&&a(t)},"json")},restoreReview:function(e){var i=this.container,a=this.sidebar_counter;d.post("?module=reviews&action=changeStatus",{review_id:e,status:this.statuses.published},function(t){"ok"==t.status&&((t=i.find("li[data-id="+e+"]").find("div:first")).addClass("is-published").removeClass("is-unpublished").removeClass("is-deleted"),t.find(".s-review-delete").show(),t.find(".s-review-restore").hide(),a.length&&a.text(parseInt(a.text(),10)+1),"function"==typeof success)&&success()},"json")},publishReview:function(e){var i=this.container,a=this.sidebar_counter;d.post("?module=reviews&action=changeStatus",{review_id:e,status:this.statuses.published},function(t){"ok"==t.status&&((t=i.find("li[data-id="+e+"]").find("div:first")).addClass("is-published").removeClass("is-unpublished").removeClass("is-deleted"),t.find(".s-review-delete").show(),t.find(".js-review-publish").remove(),a.length&&a.text(parseInt(a.text(),10)+1),"function"==typeof success)&&success()},"json")},clear:function(t){t=void 0===t||t,d(".errormsg",this.form).remove(),d(".error",this.form).removeClass("error"),d(".wa-captcha-refresh",this.form).click(),t&&(d("input[name=captcha], textarea",this.form).val(""),d("input[name=rate]",this.form).val(0),d(".rate a:first",this.form).trigger("clear"))},showErrors:function(t){for(var e=0,i=t.length,a=t[e];e<i;a=t[++e])for(var o in a)d("[name="+o+"]",this.form).after(d('<em class="errormsg"></em>').text(a[o])).addClass("error")}}}(jQuery),function(s){s.product_images={product_id:0,image:null,product_image:null,image_list:null,photo_stream:null,tail:null,options:{},init:function(t){this.options=t,this.product_id=t.product_id||0,this.image=t.image||null,this.options.placeholder=this.options.placeholder||null;var e=s("#s-product-edit-menu .images"),i=(this.image?setTimeout(function(){s.product_images.initImage()},200):this.initImageList(t),e.find(".hint").text(t.count||t.images&&t.images.length||0),s("#s-product-edit-forms .s-product-form.images").addClass("ajax"),s.product.editTabImagesAction=function(t){var e,i;null!==s.product_images.tail&&(i="?module=product&action=images&id="+t.id,t.tail&&(i+="&param[]="+t.tail,s.product_images.photo_stream)&&s.product_images.photo_stream.length&&(e=s.product_images.photo_stream.find(".s-stream-wrapper>ul"),i=(i+="&ps[left]="+parseInt(e.css("left"),10))+"&ps[width]="+parseInt(e.css("width"),10)),s.get(i,function(t){s("#s-product-edit-forms .s-product-form.images").html(t)})),s.product_images.tail=t.tail},s.product.editTabImagesBlur=function(t){s("#fileupload").fileupload("destroy")},s("#s-product-set-custom-badge"));s(".s-product-images-actions").off("click","li").on("click","li",function(){var t=s(this),e=t.attr("data-action");switch(e){case"set-badge":s.product_images.setBadge(t.attr("data-type"));break;case"set-custom-badge":i.data("type",t.attr("data-type")),i.show();break;case"delete-badge":s.product_images.deleteBadge()}return"set-custom-badge"!=e&&i.hide(),!1}),i.find("input[type=button]").unbind("click").bind("click",function(){var t=s(this).parent();return i.show(),s.product_images.setBadge(i.data("type"),t.find("textarea[name=code]").val()),!1})},initImageList:function(t){this.image_list=s(t.image_list||"#s-product-image-list"),this.image_list.html(tmpl("template-product-image-list",{images:t.images,placeholder:t.placeholder,type:t.type,product_id:this.product_id})),this.initListSortable(),t.type&&"thumbs"!=t.type||this.initListEditable(),t.enable_2x&&s.fn.retina&&this.image_list.find("img").retina()},initImage:function(){s("#s-product-one-image").parent().width();this.photo_stream=s("#s-product-image-toolbar ul.s-photostream:first");var t=this.setImageDimensions(),i=(s(window).unbind("resize.product_images").bind("resize.product_images",function(t){var e;s("#s-product-image").length&&s.product_images.image?(e=s.product_images.setImageDimensions(),s.product_images.loupe.resize(e)):s(this).unbind("resize.product_images")}),s("#s-product-image-description").inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:s.product_images.options.placeholder,minSize:{height:50,widht:600},size:{width:t.width},editLink:"#s-product-image-description-edit-link",allowEmpty:!0,beforeMakeEditable:function(t){var e=s(this),i=this.id+"-button",a=s("#"+i);a.length||(t.after('<br><input type="button" id="'+i+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),s("#"+i).click(function(){e.trigger("readable")})),s("#"+this.id+"-hint").show(),a.show().prev("br").hide()},afterBackReadable:function(t,e){var t=s(t).val(),i="#"+this.id+"-";s(i+"button").hide().prev("br").hide(),s(i+"hint").hide(),e.changed&&s.products.jsonPost("?module=product&action=imageSave",{id:s.product_images.image.id,data:{description:t}})}}),this.photo_stream),a=i.find("li.selected"),o=(i.photoStreamSlider({backwardLink:"#s-product-image-toolbar .rewind",forwardLink:"#s-product-image-toolbar .ff",photoStream:"ul",duration:400}),i.off("click","li.visible a").on("click","li.visible a",function(){var t=s(this).attr("href"),e=s(this).parent();return a.removeClass("selected"),a=e.addClass("selected"),i.trigger("home",[function(){location.href=t}]),!1}),this.photo_stream=i,this.product_image=s("#s-product-image"),s("#s-product-set-custom-badge")),t=(s(".s-product-image-actions").off("click","li").on("click","li",function(){var t=s(this),e=t.attr("data-action");switch(e){case"delete":s.product_images.deleteImage();break;case"rotate-right":s.product_images.rotateImage("right");break;case"rotate-left":s.product_images.rotateImage("left");break;case"set-badge":s.product_images.setBadge(t.attr("data-type"));break;case"set-custom-badge":o.data("type",t.attr("data-type")),o.show();break;case"delete-badge":s.product_images.deleteBadge()}return"set-custom-badge"!=e&&o.hide(),!1}),o.find("input[type=button]").unbind("click").bind("click",function(){var t=s(this).parent();return o.show(),s.product_images.setBadge(o.data("type"),t.find("textarea[name=code]").val()),!1}),this.image),e=(s("#s-product-image-loupe").length&&s.product_images.loupe.init({original:{width:t.width,height:t.height,src:"?module=product&action=ImageDownload&id="+t.id},image:{width:this.product_image.width(),height:this.product_image.height(),src:t.url_big,dom:this.product_image},animate:!(!t.dimensions.width||!t.dimensions.height)}),this),n=(s("#s-restore-image-original").unbind("click").bind("click",function(){confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))&&(e.coverToggle(),s.products.jsonPost("?module=product&action=imageRestore",{id:e.image.id},function(t){s("#s-product-view").find("li[data-image-id="+e.image.id+"] img").attr("src",t.data.url_crop),s("<img>").attr("src",t.data.url_big).load(function(){s(this).remove(),s.products.dispatch("#/product/"+e.product_id+"/edit/images/"+e.image.id+"/"),e.coverToggle()})},"json"))}),this.options.enable_2x&&s.fn.retina&&s("#s-product-image").retina(),!1);s(document).unbind("keydown.product_images").bind("keydown.product_images",function(t){var e=s(t.target).prop("nodeName").toLowerCase(),t=t.keyCode;if(!(n||"text"==e||"textarea"==e||37!=t&&39!=t))return 39==t?((e=i.find("li.selected").next()).length&&!e.hasClass("dummy")&&(n=!0,location.href=e.find("a").attr("href")),!1):37==t?((e=i.find("li.selected").prev()).length&&!e.hasClass("dummy")&&(n=!0,location.href=e.find("a").attr("href")),!1):void 0})},setImageDimensions:function(){var t=s("#s-product-image"),e=s("#s-product-one-image").parent().width(),i=this.image.dimensions,a=(i.width=parseInt(i.width,10),i.height=parseInt(i.height,10),{width:"",height:""});return!isNaN(i.width)&&i.width<e?(a.width=i.width,isNaN(i.height)||(a.height=i.height)):a.width=e,t.css(a),a},deleteImage:function(){var o=this,e=s("#s-product-image-delete-dialog");e.waDialog({onSubmit:function(){e.trigger("close"),o.coverToggle();var t=e.find("form");return s.shop.jsonPost(t.attr("action"),t.serialize(),function(t){var e="#/product/"+o.product_id+"/edit/images/",i=o.photo_stream.find("li.selected"),a=i.next("li:not(.dummy)");(a.length||(a=i.prev("li:not(.dummy)")).length)&&(e=a.find("a").attr("href")),s(".s-product-image-crops").find("li[data-image-id="+t.data.id+"]").remove(),o.coverToggle(),location.href=e}),!1}})},rotateImage:function(t){var e=this;e.coverToggle(),s.products.jsonPost("?module=product&action=imageRotate&id="+e.image.id,{direction:t},function(t){s("#s-product-view").find("li[data-image-id="+e.image.id+"] img").attr("src",t.data.url_crop),s("<img>").attr("src",t.data.url_big).load(function(){s(this).remove(),s.products.dispatch("#/product/"+e.product_id+"/edit/images/"+e.image.id+"/"),e.coverToggle()})})},setBadge:function(i,t,a){t=t||i;var o=s("#photo-organize-menu"),n=o.find("li[data-type="+i+"]");n.find("a").append('<span class="count"><i class="icon16 loading"></i></span>'),s.shop.jsonPost("?module=product&action=badgeSet&id="+this.product_id,{code:t},function(t){var e=s("#s-product-one-image");e.find(".top.right").html(t.data),o.find("li.selected").removeClass("selected").find(".small").text(""),n.addClass("selected"),n.find("span.count").remove(),e.length||(n.find("a").append('<span class="count"><i class="icon10 yes"></i></span>'),setTimeout(function(){n.find("span.count").remove()},1e3)),"custom"!=i?(s("#s-product-set-custom-badge").hide(),n.find(".small").text(t.data)):s("#s-product-set-custom-badge").show(),"function"==typeof a&&a(t)})},deleteBadge:function(){s.getJSON("?module=product&action=badgeDelete&id="+this.product_id,function(t){s("#s-product-one-image").find(".top.right").html(""),s("#photo-organize-menu").find("li.selected").removeClass("selected").find(".small").text("")})},initListSortable:function(){this.image_list.sortable({distance:5,helper:"clone",items:"li",opacity:.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},update:function(t,e){document.ondragstart=null;var i=s(this),e=s(e.item),a=parseInt(e.attr("data-image-id"),10),e=e.next(),o=null;e.length&&(o=parseInt(e.attr("data-image-id"),10)),s.products.jsonPost("?module=product&action=imageMove",{id:a,before_id:o},function(t){"function"==typeof s.product_images.options.onSort&&s.product_images.options.onSort(a,o)},function(){i.sortable("cancel")})}})},coverToggle:function(){var t,e=s("#s-product-image-cover");e.is(":hidden")?((t=e.find(".loading")).css({position:"absolute",left:parseInt((e.width()-t.width())/2,10)+"px",top:parseInt((e.height()-t.height())/2,10)+"px"}),e.show()):e.hide()},initListEditable:function(){this.image_list.off("click",".editable").on("click",".editable",function(){s(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:s.product_images.options.placeholder,minSize:{height:40},allowEmpty:!0,beforeMakeEditable:function(t){var e=s(this),i=(t.css({"font-size":e.css("font-size"),"line-height":e.css("line-height")}).width(e.parents("li:first").find("img").width()),this.id+"-button"),a=s("#"+i);a.length||(t.after('<br><input type="button" id="'+i+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),s("#"+i).click(function(){e.trigger("readable")})),s("#"+this.id+"-hint").show(),a.show()},afterBackReadable:function(t,e){var i=s(this),i=parseInt(i.parents("li:first").attr("data-image-id"),10),t=s(t).val(),a="#"+this.id+"-";s(a+"button").hide(),s(a+"hint").hide(),e.changed&&s.products.jsonPost("?module=product&action=imageSave",{id:i,data:{description:t}})}}).trigger("editable")})}}}(jQuery),function(s){s.product_stocks={options:{},container:null,products_ids:[],init:function(t){this.options=t,this.stocks=t.stocks,this.container=s("#s-product-stocks"),this.products_ids=[],this.initView(),t.stocks&&1<t.stocks.length&&this.initDragndrop(),this.options.lazy_loading&&0<this.options.product_stocks.length&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(t){var i,a=t.count,o=t.total_count,n=t.sort;s(window).lazyLoad("stop"),a<o&&(i=this,s(window).lazyLoad({container:i.container,state:void 0===t.auto||t.auto?"wake":"stop",hash:"stocks",load:function(){s(window).lazyLoad("sleep"),s(".lazyloading-link").hide(),s(".lazyloading-progress").show();function e(t){console&&(t&&t.errors?console.error("Error when loading products: "+t.errors):t&&t.responseText?console.error("Error when loading products: "+t.responseText):console.error(t)),s(window).lazyLoad("stop")}var t=["module=stocksBalance","offset="+a,"total_count="+o];i.options.order&&t.push("order="+i.options.order),n&&t.push("sort="+n),s.get("?"+t.join("&"),function(t){t&&"ok"===t.status?(a+=t.data.count,i.append({product_stocks:t.data.product_stocks,stocks:i.stocks})?(s(".lazyloading-progress-string").text(t.data.progress.loaded+" "+t.data.progress.of),s(".lazyloading-progress").hide(),s(".lazyloading-chunk").text(t.data.progress.chunk),o<=a?(s(window).lazyLoad("stop"),s(".lazyloading-link").hide()):(s(".lazyloading-link").show(),s(window).lazyLoad("wake"))):s(window).lazyLoad("stop")):e(t)},"json").error(e)}}),s(".lazyloading-link").off("click").on("click",function(){return s(window).lazyLoad("force"),!1}))},initView:function(){if(!this.append({product_stocks:this.options.product_stocks,stocks:this.stocks}))return this},initDragndrop:function(){this.container.find("td.s-stock-cell .js-item").liveDraggable({containment:this.container,distance:5,helper:function(){return s(this).clone().append('<i class="fas fa-times text-gray no-bw" style="margin-left: 0; margin-right: 0; display: none;"></i>')},refreshPositions:!0,start:function(){s(this).parents("tr:first").find("td.s-stock-cell").addClass("drag-active").filter(":first").addClass("first")},stop:function(){s(this).parents("tr:first").find("td.s-stock-cell").removeClass("drag-active").filter(":first").removeClass("first")}}),this.container.find("td").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(t,e){s(this).hasClass("drag-active")?e.helper.find(".no-bw").hide():e.helper.find(".no-bw").show()},drop:function(t,e){var i,a,o=s(this);return!!o.hasClass("drag-active")&&(i=(e=e.draggable).parents("td:first"),o.get(0)!=i.get(0))&&(e=(i=e.attr("id").replace("s-item-","").split("-"))[1],o=o.attr("data-stock-id"),a=[i[0],o],!(a=s("#s-item-"+a.join("-"))).length||!a.hasClass("infinity"))&&((a=s("#s-transfer-product-dialog")).length&&a.parent().remove(),void s("<div></div>").appendTo("body").load("?module=transfer",{sku_id:i[0],from:e,to:o},function(){s(this).find(".dialog").on("afterSubmit",function(t,e){var i,a=s(".s-stocks-transfers");a.data("empty")?(a.data("empty",0),a.html(e.data.html),s('.s-transfer-item[data-id="'+e.data.transfer.id+'"]',a)):(i=s("<div>").html(e.data.html),e=s('.s-transfer-item[data-id="'+e.data.transfer.id+'"]',i),a.find("tbody").prepend(e))})}))}})},append:function(t){var e,i,a=this;e=t,i=[],s.each(e.product_stocks,function(t,e){a.products_ids.indexOf(e.id)<0&&(i.push(e),a.products_ids.push(e.id))}),e.product_stocks=i,t=e;try{this.container.append(tmpl("template-product-stocks",t))}catch(t){return console.error("Error: "+t.message),!1}return!0}}}(jQuery),function(n){n.product_stocks_log={product_id:null,container:null,options:{},init:function(t){(this.options=t).container?this.container=n(t.container):this.container=n("body"),this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(t){var i,a=t.count,o=this.options.total_count,e=t.url;n(window).lazyLoad("stop"),a<o&&(i=this,n(window).lazyLoad({container:i.container,state:void 0===t.auto||t.auto?"wake":"stop",load:function(){var t;i.container.is(":visible")?(n(window).lazyLoad("sleep"),n(".lazyloading-link").hide(),n(".lazyloading-progress").show(),n.get(e+"&lazy=1&offset="+a+"&total_count="+o,function(t){var t=n("<div></div>").html(t),e=t.find("table tr");!e.length||(a+=e.length,n("table",i.container).append(e),o<=a)?(n(window).lazyLoad("stop"),n(".lazyloading-progress").hide()):(n(window).lazyLoad("wake"),n(".lazyloading-link").show()),n(".lazyloading-progress-string",i.container).replaceWith(n(".lazyloading-progress-string",t)),n(".lazyloading-chunk",i.container).replaceWith(n(".lazyloading-chunk",t)),t.remove()})):(n(window).lazyLoad("sleep"),t=setInterval(function(){i.container.is(":visible")&&(n(window).lazyLoad("wake"),clearInterval(t))},500))}}),n(".lazyloading-link").off("click").on("click",function(){return n(window).lazyLoad("force"),!1}))}}}(jQuery),function(n){n.stocks_log={container:null,options:{},init:function(t){this.options=t,this.container=t.container||n("#s-content"),this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(t){var i,a=t.count,o=this.options.total_count,e=t.url;n(window).lazyLoad("stop"),a<o&&(i=this,n(window).lazyLoad({container:i.container,state:void 0===t.auto||t.auto?"wake":"stop",load:function(){n(window).lazyLoad("sleep"),n(".lazyloading-link").hide(),n(".lazyloading-progress").show(),n.get(e+"&lazy=1&offset="+a+"&total_count="+o,function(t){var t=n("<div></div>").html(t),e=t.find("table tr");!e.length||(a+=e.length,n("table",i.container).append(e),o<=a)?(n(window).lazyLoad("stop"),n(".lazyloading-progress").hide()):(n(window).lazyLoad("wake"),n(".lazyloading-link").show()),n(".lazyloading-progress-string",i.container).replaceWith(n(".lazyloading-progress-string",t)),n(".lazyloading-chunk",i.container).replaceWith(n(".lazyloading-chunk",t)),t.remove()})}}),n(".lazyloading-link").off("click").on("click",function(){return n(window).lazyLoad("force"),!1}))}}}(jQuery),function(n){n.product_orders={product_id:null,container:null,options:{},init:function(t){(this.options=t).container?this.container=n(t.container):this.container=n("body"),this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(t){var i,a=t.count,o=this.options.total_count,e=t.url;n(window).lazyLoad("stop"),a<o&&(i=this,n(window).lazyLoad({container:i.container,state:void 0===t.auto||t.auto?"wake":"stop",load:function(){n(window).lazyLoad("sleep"),n(".lazyloading-link").hide(),n(".lazyloading-progress").show(),n.get(e+"&lazy=1&offset="+a+"&total_count="+o,function(t){var t=n("<div></div>").html(t),e=t.find("table tr");!e.length||(a+=e.length,n("table",i.container).append(e),o<=a)?(n(window).lazyLoad("stop"),n(".lazyloading-progress").hide()):(n(window).lazyLoad("wake"),n(".lazyloading-link").show()),n(".lazyloading-progress-string",i.container).replaceWith(n(".lazyloading-progress-string",t)),n(".lazyloading-chunk",i.container).replaceWith(n(".lazyloading-chunk",t)),t.remove()})}}),n(".lazyloading-link").off("click").on("click",function(){return n(window).lazyLoad("force"),!1}))}}}(jQuery),function(s){var n=new Array,r=new Array;s.fn.doAutosize=function(t){var e=s(this).data("minwidth"),i=s(this).data("maxwidth"),a="",o=s(this),n=s("#"+s(this).data("tester_id"));""!==(a=o.val())&&(a=a.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),n.html(a),(n=(a=n.width())+t.comfortZone>=e?a+t.comfortZone:e)<o.width()&&e<=n||e<n&&n<i)&&o.width(n)},s.fn.resetAutosize=function(t){var e=s(this).data("minwidth")||t.minInputWidth||s(this).width(),t=s(this).data("maxwidth")||t.maxInputWidth||s(this).closest(".tagsinput").width()-t.inputPadding,i=s(this),a=s("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),o=s(this).attr("id")+"_autosize_tester";0<!s("#"+o).length&&(a.attr("id",o),a.appendTo("body")),i.data("minwidth",e),i.data("maxwidth",t),i.data("tester_id",o),i.css("width",e)},s.fn.addTag=function(a,o){return o=jQuery.extend({focus:!1,callback:!0},o),this.each(function(){var t,e=s(this).attr("id"),i=s(this).val().split(n[e]);""==i[0]&&(i=new Array),a=jQuery.trim(a),o.unique?1==(t=s(i).tagExist(a))&&s("#"+e+"_tag").addClass("not_valid"):t=!1,""!=a&&1!=t&&(s("<span>").addClass("tag").append(s("<span>").text(a).append("  "),s("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return s("#"+e).removeTag(escape(a))})).insertBefore("#"+e+"_addTag"),i.push(a),s("#"+e+"_tag").val(""),o.focus?s("#"+e+"_tag").focus():s("#"+e+"_tag").blur(),s.fn.tagsInput.updateTagsField(this,i),o.callback&&r[e]&&r[e].onAddTag&&r[e].onAddTag.call(this,a),r[e])&&r[e].onChange&&(t=i.length,r[e].onChange.call(this,s(this),i[t-1]))}),!1},s.fn.removeTag=function(a){return a=unescape(a),this.each(function(){var t=s(this).attr("id"),e=s(this).val().split(n[t]);s("#"+t+"_tagsinput .tag").remove(),str="";for(var i=0;i<e.length;i++)e[i]!=a&&(str=str+n[t]+e[i]);s.fn.tagsInput.importTags(this,str),r[t]&&r[t].onRemoveTag&&r[t].onRemoveTag.call(this,a)}),!1},s.fn.tagExist=function(t){return 0<=jQuery.inArray(t,s(this))},s.fn.importTags=function(t){id=s(this).attr("id"),s("#"+id+"_tagsinput .tag").remove(),s.fn.tagsInput.importTags(this,t)},s.fn.tagsInput=function(t){var o=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},t);return this.each(function(){o.hide&&s(this).hide();var a=s(this).attr("id"),t=jQuery.extend({pid:a,real_input:"#"+a,holder:"#"+a+"_tagsinput",input_wrapper:"#"+a+"_addTag",fake_input:"#"+a+"_tag"},o),e=(n[a]=t.delimiter,(o.onAddTag||o.onRemoveTag||o.onChange)&&(r[a]=new Array,r[a].onAddTag=o.onAddTag,r[a].onRemoveTag=o.onRemoveTag,r[a].onChange=o.onChange),'<div id="'+a+'_tagsinput" class="tagsinput"><div id="'+a+'_addTag">');if(o.interactive&&(e=e+'<input id="'+a+'_tag" value="" data-default="'+o.defaultText+'" />'),s(e+='</div><div class="tags_clear"></div></div>').insertAfter(this),s(t.holder).css("width",o.width),s(t.holder).css("height",o.height),""!=s(t.real_input).val()&&s.fn.tagsInput.importTags(s(t.real_input),s(t.real_input).val()),o.interactive){if(s(t.fake_input).val(s(t.fake_input).attr("data-default")),s(t.fake_input).css("color",o.placeholderColor),s(t.fake_input).resetAutosize(o),s(t.holder).bind("click",t,function(t){s(t.data.fake_input).focus()}),s(t.fake_input).bind("focus",t,function(t){s(t.data.fake_input).val()==s(t.data.fake_input).attr("data-default")&&s(t.data.fake_input).val(""),s(t.data.fake_input).css("color","#000000")}),null!=o.autocomplete_url){for(attrname in autocomplete_options={source:o.autocomplete_url},o.autocomplete)autocomplete_options[attrname]=o.autocomplete[attrname];void 0!==jQuery.Autocompleter?(s(t.fake_input).autocomplete(o.autocomplete_url,o.autocomplete),s(t.fake_input).bind("result",t,function(t,e,i){e&&s("#"+a).addTag(e[0]+"",{focus:!0,unique:o.unique})})):void 0!==jQuery.ui.autocomplete&&(s(t.fake_input).autocomplete(autocomplete_options),s(t.fake_input).bind("autocompleteselect",t,function(t,e){return s(t.data.real_input).addTag(e.item.value,{focus:!0,unique:o.unique}),!1}))}else s(t.fake_input).bind("blur",t,function(t){var e=s(this).attr("data-default");return""!=s(t.data.fake_input).val()&&s(t.data.fake_input).val()!=e?t.data.minChars<=s(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=s(t.data.fake_input).val().length)&&s(t.data.real_input).addTag(s(t.data.fake_input).val(),{focus:!0,unique:o.unique}):(s(t.data.fake_input).val(s(t.data.fake_input).attr("data-default")),s(t.data.fake_input).css("color",o.placeholderColor)),!1});s(t.fake_input).bind("keypress",t,function(t){if(t.which==t.data.delimiter.charCodeAt(0)||13==t.which)return t.preventDefault(),t.data.minChars<=s(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=s(t.data.fake_input).val().length)&&s(t.data.real_input).addTag(s(t.data.fake_input).val(),{focus:!0,unique:o.unique}),s(t.data.fake_input).resetAutosize(o),!1;t.data.autosize&&s(t.data.fake_input).doAutosize(o)}),t.removeWithBackspace&&s(t.fake_input).bind("keydown",function(t){var e;8==t.keyCode&&""==s(this).val()&&(t.preventDefault(),t=s(this).closest(".tagsinput").find(".tag:last").text(),e=s(this).attr("id").replace(/_tag$/,""),t=t.replace(/[\s]+x$/,""),s("#"+e).removeTag(escape(t)),s(this).trigger("focus"))}),s(t.fake_input).blur(),t.unique&&s(t.fake_input).keydown(function(t){8!=t.keyCode&&!String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/)||s(this).removeClass("not_valid")})}return!1}),this},s.fn.tagsInput.updateTagsField=function(t,e){var i=s(t).attr("id");s(t).val(e.join(n[i]))},s.fn.tagsInput.importTags=function(t,e){s(t).val("");for(var i=s(t).attr("id"),a=e.split(n[i]),o=0;o<a.length;o++)s(t).addTag(a[o],{focus:!1,callback:!1});r[i]&&r[i].onChange&&r[i].onChange.call(t,t,a[o])}}(jQuery),function(C){C.product_list={options:{},collection_hash:[],collection_param:"",total_count:0,category_count:0,sort:null,order:null,container:null,toolbar:null,sortable:!0,cached:{},fixed_blocks:{},init:function(t){var e=[];t.collection_param&&e.push(t.collection_param),e.push("view="+t.view),t.sort&&e.push("sort="+t.sort),t.order&&e.push("order="+t.order),t.page&&1<t.page&&e.push("page="+t.page),e="#/products/"+e.join("&"),C.products.forceHash(e);try{this.options=t,this.container=C("#product-list"),this.toolbar=C(".js-product-list-toolbar"),this.sidebar=C("#s-sidebar");var i,a=this.options.products;if(delete this.options.products,this.total_count=this.options.total_count||0,this.category_count=parseInt(this.options.category_count,10),isNaN(this.category_count)&&(this.category_count=this.total_count),this.sortable=(void 0===t.sortable?this:t).sortable,this.sort=t.sort||null,t.enable_2x&&this.container.on("append_product_list",function(){C.fn.retina&&C.product_list.container.find("img").not(".is-empty").retina()}),a&&t.view){try{this.container.append(tmpl("template-product-list-"+this.options.view,{products:a,sort:this.sort,primary_currency:this.options.primary_currency,stocks:this.options.stocks},"thumbs"!=this.options.view)),this.container.trigger("append_product_list",[a])}catch(t){return console.log("Error: "+t.message),this}delete t.products}C.isArray(this.options.collection_hash)&&this.options.collection_hash.length?this.collection_hash=this.options.collection_hash:this.collection_hash=[],this.options.collection_param?this.collection_param=this.options.collection_param:this.collection_param="",t.order&&(this.order=t.order),this.options.lazy_loading?this.initLazyLoad(this.options.lazy_loading):(i=e.replace(/&page=\d+/,"")+"&page=",C(".pagination a").each(function(){var t=C(this).attr("href").match(/\?page=(\d+)/);C(this).attr("href",i+(t?t[1]:1))})),this.initSelecting(),this.initView(this.options.view),this.initDragndrop(),this.rubberTable(),"table"==this.options.view&&this.initInlineEditor()}catch(t){C.shop.error("$.product_list.init error: "+t.message,t)}return this},initLazyLoad:function(t){var i,e,a=t.count,o=this.total_count;C(window).lazyLoad("stop"),a<o&&(e=(i=this).container.find("tr.header th[data-additional-column]").map(function(){return C(this).data("additional-column")}).get().join(","),C(window).lazyLoad({container:i.container,state:void 0===t.auto||t.auto?"wake":"stop",hash:["","products"],load:function(){C(window).lazyLoad("sleep"),C(".lazyloading-link").hide(),C(".lazyloading-progress").show(),C.get("?module=products&action=loadList&offset="+a+"&total_count="+o+(i.collection_param?"&"+i.collection_param:"")+(i.sort?"&sort="+i.sort:"")+(i.order?"&order="+i.order:"")+"&enabled_columns="+(e||""),function(t){if("ok"==t.status&&t.data.count){a+=t.data.count;var e=i.container;try{i.container.append(tmpl("template-product-list-"+i.options.view,{products:t.data.products,check_all:!!e.find(".s-select-all:first").length&&e.find(".s-select-all:first").attr("checked"),sort:C.product_list.sort,primary_currency:C.product_list.options.primary_currency,stocks:C.product_list.options.stocks})),i.container.trigger("append_product_list",[t.data.products])}catch(t){return console.log("Error: "+t.message),void C(window).lazyLoad("stop")}e.find(".last").removeClass("last"),e.find(".product:last").addClass("last"),C(".lazyloading-progress-string").text(t.data.progress.loaded+" "+t.data.progress.of),C(".lazyloading-progress").hide(),C(".lazyloading-chunk").text(t.data.progress.chunk),o<=a?(C(window).lazyLoad("stop"),C(".lazyloading-link").hide()):(C(".lazyloading-link").show(),C(window).lazyLoad("wake"))}else t.data&&!t.data.count?console&&(console.log("Count of again loaded products is 0"),C(".lazyloading-progress").hide()):(t.errors&&console&&console.log("Error when loading products: "+t.errors),C(window).lazyLoad("stop"))},"json")}}),C(".lazyloading-link").off("click").on("click",function(){return C(window).lazyLoad("force"),!1}))},initSelecting:function(){function n(){var t=parseInt(s.find("> .product.selected").length,10);t?a.text(t).show():a.text("").hide()}var s=this.container,a=this.toolbar.find(".count"),r=s.find(".s-select-all:first");C(document).keydown(function(t){16!=t.keyCode||C(t.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(t){16==t.keyCode&&(document.body.onselectstart=null)}),s.off("select",".product").on("select",".product",function(t,e,i){return i=void 0===i||i,(e=void 0===e||e)?C(this).addClass("selected").find("input:first").attr("checked",!0):(C(this).removeClass("selected").find("input:first").attr("checked",!1),r.is(":checked")&&r.attr("checked",!1)),i&&n(),!1}),r.unbind("select").bind("select",function(t,e){e=void 0===e||e;var i=C(this);e?(i.attr("checked",!0),s.find("> .product").trigger("select",!0,!1),a.text(i.attr("data-count")).show()):(i.attr("checked",!1),s.find("> .product").trigger("select",!1,!1),a.text("").hide())}),s.off("click",".product input").on("click",".product input",function(t,e){var t=t.shiftKey,i=this.checked,e=(e&&(t=e.shiftKey,i=e.checked),C(this).parents(".product:first"));if(i?e.addClass("selected"):(r.is(":checked")&&r.attr("checked",!1),e.removeClass("selected")),t&&i){var a,o=(o=s.data("last_checked"))||s.find("> .product:first").trigger("select",!0),t=e.prevAll(".selected[data-product-id="+o.attr("data-product-id")+"]");if(t.length)for(a=e.prev(),o=o.get(0);a.length&&o!=a.get(0);)a.addClass("selected").find("input").attr("checked",!0),a=a.prev();else if((t=e.nextAll(".selected[data-product-id="+o.attr("data-product-id")+"]")).length)for(a=e.next(),o=o.get(0);a.length&&o!=a.get(0);)a.addClass("selected").find("input").attr("checked",!0),a=a.next();s.data("last_checked")||t.length||o.trigger("selected",!1)}i&&s.data("last_checked",e),n()}),C.browser.mozilla&&s.off("click",".product label").on("click",".product label",function(t){var e;t.shiftKey&&(e=C(t.target),C(e).is("label")||(e=C(e).parents("label:first")),(e=C("#"+e.attr("for"))).trigger("click",{shiftKey:t.shiftKey,checked:!e.attr("checked")}))})},initView:function(t){try{var e=this.container,i=this.sidebar,a=(e.find(".s-select-all:first").length&&e.find(".s-select-all:first").click(function(){C(this).trigger("select",this.checked)}),"table"==t&&(C("#s-content .list-view-mode-table").click(function(){return e.toggleClass("single-lined"),C.storage.set("shop/product_list/multi-lined",!e.hasClass("single-lined")),!1}),C.storage.get("shop/product_list/multi-lined"))&&e.removeClass("single-lined"),"view="+t),o=(i.find(".s-collection-list li.dr").each(function(){var t=C(this);t.find("a:first").attr("href","#/products/"+t.attr("id").replace("-","_id=")+"&"+a)}),C("#s-products-search").autocomplete("disable").val(this.options.text||"").autocomplete("enable"),"s-all-products"),n=C.product_list.collection_hash.length&&"search"!==C.product_list.collection_hash[0]&&"tag"!==C.product_list.collection_hash[0]&&"id"!==C.product_list.collection_hash[0],s=(n&&(o=C.product_list.collection_hash.join("-")),C.shop.trace("$.product_list.initView",[t,o]),i.find("li.selected").removeClass("selected"),i.find("#"+o));(s=(s=s.length<=0&&window.location.hash?i.find('a[href="'+window.location.hash+'"]').parent():s).length<=0?i.find("#s-all-products"):s).addClass("selected"),n&&s.find(".count:first").text(this.category_count),C.product_list.fixed_blocks=C.product_list.initFixedBlocks(),this.initEditingControls(),this.initToolbar(),C(document).trigger("product_list_init_view")}catch(t){C.shop.error("$.product_list.initView error: "+t.message,t)}},highlightInlineEditorCells:function(){C.product_list.container.find("tr").each(function(){var t=C(this),e=t.data("edit-rights");e&&t.data("min-price")==t.data("max-price")||t.find(".s-product-price .editable").filter(function(){return!C(this).data("plugin")}).addClass("not-editable"),e&&1==t.data("sku-count")||t.find(".s-product-stock .editable").filter(function(){return!C(this).data("plugin")}).addClass("not-editable")})},initInlineEditor:function(){"use strict";var s=this,r=0;function d(t,e){var i;t.data("denied-reason")==e?(t.data("denied-reason",""),alert(e)):(t.data("denied-reason",e),setTimeout(function(){t.data("denied-reason","")},3e3),t.wrapInner('<div class="animation-container" style="position:relative;"></div>'),i=t.find(".animation-container").animate({left:"3px"},100,function(){i.animate({left:"0px"},100,function(){i.animate({left:"3px"},100,function(){i.animate({left:"0px"},100,function(){i.children().first().unwrap()})})})}))}s.options.stocks&&s.options.stocks.length&&(r=s.options.stocks.length),C.product_list.highlightInlineEditorCells(),C.product_list.container.on("append_product_list",function(){C.product_list.highlightInlineEditorCells()}),C.product_list.container.on("click",".s-product-price,.s-product-stock",function(){var e=C(this);if(!e.data("plugin")){var t,i,a=e.closest("tr"),o=e.hasClass("s-product-price");if(o){if(a.data("min-price")!=a.data("max-price"))return d(e,$_("Inline editing is available only for products with a single SKU"))}else if("1"!=a.data("sku-count"))return d(e,$_("Inline editing is available only for products with a single SKU"));if(!a.data("edit-rights"))return d(e,$_("Insufficient access rights"));e.hasClass("editor-on")||(e.addClass("editor-on").data("read-only-state-html",e.html()),C.product_list.container.removeClass("single-lined"),void 0!==a.data("original-price")?n():(e.html('<i class="icon16 loading"></i>'),t=n,i=[],C.product_list.container.find("tr.product").each(function(){var t=C(this);void 0===t.data("original-price")&&t.data("edit-rights")&&i.push(C(this).data("product-id"))}),i.length?C.post("?module=products&action=inlineEditorData",{ids:i},function(i){i.data&&C.product_list.container.find("tr.product").each(function(){var t=C(this),e=i.data[parseInt(t.data("product-id"),10)];e&&(t.data("stocks",e.stocks||null),t.data("original-price",e.price.replace(/\.?0+$/g,"")))}),t()},"json"):t()))}function n(){o?e.html(tmpl("template-list-price-editor-one",{product_id:a.data("product-id"),currency:a.data("currency"),value:a.data("original-price")})):(t=a.data("stocks"),r?(t&&"object"==typeof t||(t={}),e.html(tmpl("template-list-stock-editor-many",{product_id:a.data("product-id"),values:t}))):(t&&"object"!=typeof t||(t=""),e.html(tmpl("template-list-stock-editor-one",{product_id:a.data("product-id"),value:t})))),e.find(".cancel").click(function(){var t;(t=e).removeClass("editor-on").html(t.data("read-only-state-html")),t.data("read-only-state-html",""),t.data("denied-reason","")});var t,i=e.find("form").submit(function(){return i.find(".loading").length||(i.find(":submit").after('<i class="icon16 loading"></i>'),C.post("?module=products&action=inlineSave",i.serialize(),function(t){i.find(".loading").remove();try{t.data&&t.data[0]&&(t.data[0].alien=a.hasClass("s-alien"));var e=C("<table>").html(tmpl("template-product-list-table",{products:t.data,check_all:C.product_list.container.find(".s-select-all:first").prop("checked"),sort:C.product_list.sort}));a.replaceWith(e.find("tr")),s.container.trigger("append_product_list",[t.data])}catch(t){console.log("Error: "+t.message)}},"json")),!1});i.on("dblclick",!1),setTimeout(function(){e.find(":input:visible:first").focus()},0)}})},initFixedBlocks:function(){var o,n,e,s,r,d,a,i,l,c,u=C("#mainmenu").height(),p=C("#s-sidebar").width(),h=C(window),f=C("#s-fixed-blocks"),g=(f.length||(f=C('<div id="s-fixed-blocks"></div>').css({display:"none",position:"fixed",background:"#fff",top:u,width:p,float:"left"}).appendTo("#s-sidebar")),C("#s-category-list")),m=C("#s-category-list-block"),v=C("#s-set-list"),b=C("#s-set-list-block"),t=(e=m.offset().top,s="s-category-list-dummy",d=!(r="s-category-list-handler"),h.unbind("scroll.fixed_blocks.category").bind("scroll.fixed_blocks.category",function(){var t=e=d?e:m.offset().top;document.getElementById(s)?t+=C("#"+s).height():t+=C("#s-category-list-block").height(),(h.scrollTop()+u+5>=t?_:y)()}),{setFixed:_,unsetFixed:y});function _(){var t,e,i,a;d||(t=C("#"+r),n=C.categories_tree.isCollapsed(t),o=g.is(":hidden"),e=C('<div id="'+s+'" class="block"></div>').css({height:m.height()}),m.replaceWith(e),f.show().append(m.hide()),m.find(".heading").before('<span class="hint float-right" style="margin-top: 3px;">'+$_("Drag products here")+"</span>"),n&&C.categories_tree.expand(t,null,function(){C.categories_tree.collapse(t)}),o||g.hide(),m.show(),C("i.add",m).hide(),C("#"+r).hide(),m.css({"overflow-x":"hidden","overflow-y":"auto"}),a=g.is(":hidden"),m.bind("mousemove.fixed_blocks.category",function(t){document.getElementById("products-helper")&&a&&(i&&(clearTimeout(i),i=null),i=setTimeout(function(){var t,e;a&&(m.css({height:""}),g.show(),t=m.height(),e=(h.height()-u)/2,m.css({height:Math.min(t,e)}),m.find(".heading").prev(".hint").hide(),a=!1)},250))}),h.bind("mouseout.fixed_blocks.category",function(t){t.pageX>p+10&&(i&&clearTimeout(i),i=null,a||(g.hide(),m.css({height:""}),m.find(".heading").prev(".hint").show(),a=!0))}),d=!0)}function y(){var t,e;d&&((t=C("#"+s)).replaceWith(m),m.css({"overflow-x":"","overflow-y":""}),e=C("#"+r),n&&C.categories_tree.collapse(e),o||g.show(),m.find(".heading").prev(".hint").remove(),C("#"+r).show(),C("i.add",m).show(),t.remove(),m.unbind("mousemove.fixed_blocks.category"),h.unbind("mouseout.fixed_blocks.category"),f.children().length||f.hide(),d=!1,C.categories_tree.init())}function w(){var t,e,i;c||(a=v.is(":hidden"),t=C('<div id="'+l+'" class="block"></div>').css({height:b.height()}),b.replaceWith(t),f.show().append(b),b.find(".heading").before('<span class="hint float-right" style="margin-top: 3px;">'+$_("Drag products here")+"</span>"),a||v.hide(),C("i.add",b).hide(),C("i.collapse-handler",b).hide(),b.css({"overflow-x":"hidden","overflow-y":"auto"}),i=v.is(":hidden"),b.bind("mousemove.fixed_blocks.set",function(t){document.getElementById("products-helper")&&i&&(e&&(clearTimeout(e),e=null),e=setTimeout(function(){var t,e;i&&(b.css({height:""}),v.show(),t=b.height(),e=(h.height()-u)/2,b.css({height:Math.min(t,e)}),b.find(".heading").prev(".hint").hide(),i=!1)},250))}),h.bind("mouseout.fixed_blocks.set",function(t){t.pageX>p+10&&(e&&clearTimeout(e),e=null,i||(v.hide(),b.css({height:""}),b.find(".heading").prev(".hint").show(),i=!0))}),c=!0)}function k(){var t;c&&((t=C("#"+l)).replaceWith(b),b.css({"overflow-x":"","overflow-y":""}),b.find(".heading").prev(".hint").remove(),a||v.show(),C("i.add",b).show(),C("i.collapse-handler",b).show(),t.remove(),b.unbind("mousemove.fixed_blocks.category"),h.unbind("mouseout.fixed_blocks.category"),f.children().length||f.hide(),c=!1)}return i=b.offset().top,c=!(l="s-set-list-dummy"),h.unbind("scroll.fixed_blocks.set").bind("scroll.fixed_blocks.set",function(){var t=i=c?i:b.offset().top;document.getElementById(l)?t+=C("#"+l).height():t+=C("#s-set-list-block").height(),(h.scrollTop()+u+5>=t?w:k)()}),{category:t,set:{setFixed:w,unsetFixed:k}}},initEditingControls:function(){var t=C("#s-product-list-title"),i=C.product_list.collection_hash[0],a="set"===i?"?module=set&action=save&":"?module=category&action=save&",t=(t.hasClass("editable")&&(t.inlineEditable({minSize:{width:350},maxSize:{width:600},size:{height:30},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){C(".s-product-list-manage").hide()},afterBackReadable:function(t,e){if(C(".s-product-list-manage").show(),!e.changed)return!1;C.shop.jsonPost(a+C.product_list.collection_param+"&edit=name",{name:C(t).val()},function(t){C.product_list.sidebar.find("#"+i+"-"+t.data.id).find(".name:first").html(t.data.name)})}}),"name"==this.options.edit)&&t.trigger("editable"),C("#s-product-list-settings")),t=(!t.length||"category"!=i&&"set"!=i||t.unbind("click").bind("click",function(){return"category"==i?shopDialogProductsCategory.staticDialog(C.product_list.collection_hash[1],null,"edit"):shopDialogProductsSet.staticDialog(C.product_list.collection_hash[1],"edit"),!1}),C("#s-product-list-delete"));!t.length||"category"!=i&&"set"!=i||t.unbind("click").bind("click",function(){return C("#s-product-list-delete-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){C(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(){var t=C(this),e=parseInt(C.product_list.collection_hash[1]),n=(t.find(".dialog-buttons i.loading").show(),"1"==t.find("input[name=s-delete-products]:checked").val());return"category"==i&&t.find('input[name="s-delete-sub"]').is(":checked")?C.get("?action=categoryExpand&tree=1&recurse=1&id="+e,function(t){t=C("<div>").html(t).find('li[id^="category-"]').map(function(){return parseInt(this.id.substr(9),10)}).get().reverse();t.push(e),function t(e,i){if(!e.length)return i&&i();var a=e.shift();o(["category",a],function(){t(e,i)})}(t,function(){location.href="#/"})}):o(C.product_list.collection_hash,function(){location.href="#/"}),!1;function o(i,a){function e(){C.product_list.remove(t,function(t,e){!function(t,e){"use strict";var i=t[0],a=C("#"+t.join("-")),o=a.prev(".drag-newposition"),t=C("#s-"+t[0]+"-list"),n=t.find("ul:first");"set"==i?(a.remove(),o.remove()):((i=a.find("ul:first")).length&&(i.find(">li.drag-newposition:first").remove(),a.hide(),i.find(">li").each(function(){a.after(this)})),i=a.parents("ul:first"),a.remove(),o.remove(),i.find("li.dr").length||(n.get(0)!=i.get(0)?(i.parents("li:first").find("i.collapse-handler").remove(),i.closest("li").find(".collapse-handler-ajax:first").remove(),i):n.closest(".block").find(".collapse-handler-ajax:first")).remove());n.find("li.dr:first").length?(n.show(),t.find(".s-empty-list").hide()):(n.hide(),t.find(".s-empty-list").show());e.data.old_parent_category&&void 0!==e.data.old_parent_category.children_count&&!parseInt(e.data.old_parent_category.children_count,10)&&C("#category-"+e.data.old_parent_category.id+"-handler").remove()}(i,t),C.product_list.sidebar.trigger("update",t.data.lists),a&&a()})}var t={hash:i.join("/")||"all",remove:["list"]},o=(n&&t.remove.push("products"),C("#"+i.join("-")+"-handler"));return o.length?C.categories_tree.expand(o,function(t){t.parent().find("ul:first").hide(),e()}):e(),!1}}}),!1}),"set"===i&&C("#s-embed-code").click(function(){return C("#s-product-list-embed-dialog").waDialog(),!1})},initDragndrop:function(){C.product_dragndrop.init({products:!0,view:this.options.view,sort:this.options.sort}).bind("move_product",function(t){C.shop.jsonPost("?module=product&action=move&"+C.product_list.collection_param,{product_ids:t.product_ids,before_id:t.before_id||null},t.success,t.error)}).bind("is_product_sortable",function(){return C.product_list.sortable}).bind("add_to_list",function(t){var e={};t.whole_list?e.hash=C.product_list.collection_hash.join("/")||"all":e.product_id=t.product_ids,C.shop.jsonPost("?module=product&action=addToList&"+t.collection_param,e,t.success,t.error)})},initToolbar:function(){var n=this.toolbar;n.find("li").unbind("click.product_list").bind("click.product_list",function(t){t.preventDefault();var e=C(this),t=e.attr("data-action");if(t){var i=C.product_list.getSelectedProducts("delete"!=t);if(i.count)switch(t){case"new-set":break;case"category":C.product_list.categoriesDialog(i);break;case"set":C.product_list.setsDialog(i);break;case"type":C.product_list.typesDialog(i);break;case"assign-tags":C.product_list.assignTagsDialog(i);break;case"delete":C.product_list.deleteProductsDialog(i);break;case"delete-from-set":"set"==C.product_list.collection_hash[0]&&C.product_list.deleteFromSet(i);break;case"delete-from-category":"category"==C.product_list.collection_hash[0]&&C.product_list.deleteFromCategory(i);break;case"visibility":C.product_list.visibilityDialog(i,e);break;case"export":C.product_list.exportProducts(i,C(this).attr("data-plugin"));break;case"duplicate":C.product_list.duplicateProducts(i,C(this));break;case"promo":C.product_list.associatePromo(i,C(this));break;case"coupon":C.product_list.createCoupon(i);break;case"set-badge":case"delete-badge":C.product_list.setBadge(i,C(this));break;default:return}else alert($_("Please select at least one product"));return!1}}),n.find('li[data-action="set-custom-badge"] a').click(function(){return C(this).parent().find(".textarea-wrapper").slideToggle("fast"),!1}).closest("li").find(".textarea-wrapper").click(function(){return!1}).find("input").click(function(){var t=C.product_list.getSelectedProducts(!0);return t.count?C.product_list.setBadge(t,C(this).closest("li")):alert($_("Please select at least one product")),!1}),function(){"use strict";var t,e=C("#mainmenu").height(),i=n.find(":first").offset().top-e,a=C(document),o=C(window);a.bind("scroll",t=function(){jQuery.contains(document.documentElement,n[0])?a.scrollTop()>i&&n.height()+e<o.height()?n.addClass("s-fixed").css({top:e}):n.removeClass("s-fixed"):(a.off("scroll",t),o.off("resize",t))}),o.bind("resize",t)}()},getSelectedProducts:function(t){t=t||!1;var e=this.container,i={count:0};return e.find(".s-select-all:first").attr("checked")?(e=C.product_list.collection_hash.join("/")||"all",t?i.serialized=[{name:"hash",value:e}]:i.hash=e,i.count=this.total_count):t?i.serialized=C.product_list.container.find(".product.selected").map(function(){return i.count+=1,{name:"product_id[]",value:C(this).attr("data-product-id")}}).toArray():i.product_id=C.product_list.container.find(".product.selected").map(function(){return i.count+=1,C(this).attr("data-product-id")}).toArray(),i},visibilityDialog:function(t,e){if(!C.isArray(t.serialized))return!1;var i,a=e.find("i.icon16");a.hasClass("loading")||((e=C("#visibility-dialog-wrapper")).length||(e=C('<div id="visibility-dialog-wrapper">').appendTo("#s-content")),i=a.attr("class"),a.attr("class","icon16 loading"),e.data("products",t).load("?module=dialog&action=visibility",function(){a.attr("class",i)}))},categoriesDialog:function(a){var t=C("#s-categories"),o=this.sidebar,n=this.container;t.length&&t.parent().remove(),C("<div></div>").appendTo("body").load("?module=dialog&action=categories",function(){C("#s-categories").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var t=C(this);t.find(".dialog-content h1 span").text("("+a.count+")").show(),t.find(".dialog-buttons i.loading").hide(),t.find("input[name=new_category_name]").val(""),t.find("input[name=new_category]").attr("checked",!1)},onSubmit:function(e){var i=e.find("form");return i.find(".dialog-buttons i.loading").show(),C.shop.jsonPost(i.attr("action"),i.serializeArray().concat(a.serialized),function(t){t.data.new_category&&C("#s-category-list ul:first").trigger("add",[t.data.new_category,"category","#/products/category_id="+t.data.new_category+"&view="+C.product_list.options.view]),t.data.categories&&(o.trigger("update",[{category:t.data.categories}]),n.find(".s-select-all:first").trigger("select",!1)),i.find("input:checked").attr("checked",!1),e.trigger("close")}),!1}})})},setsDialog:function(a){var t=C("#s-sets"),o=this.sidebar,n=this.container;t.length&&t.parent().remove(),C("<div></div>").appendTo("body").load("?module=dialog&action=sets",function(){C("#s-sets").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var t=C(this);t.find(".dialog-content h1 span").text("("+a.count+")").show(),t.find(".dialog-buttons i.loading").hide(),t.find("input[name=new_set_name]").val(""),t.find("input[name=new_set]").attr("checked",!1)},onSubmit:function(e){var i=e.find("form");return i.find(".dialog-buttons i.loading").show(),C.shop.jsonPost(i.attr("action"),i.serializeArray().concat(a.serialized),function(t){t.data.new_set&&C("#s-set-list ul:first").trigger("add",[t.data.new_set,"set","#/products/set_id="+t.data.new_set+"&view="+C.product_list.options.view]),t.data.sets&&(o.trigger("update",[{set:t.data.sets}]),n.find(".s-select-all:first").trigger("select",!1)),i.find("input:checked").attr("checked",!1),e.trigger("close")}),!1}})})},assignTagsDialog:function(n){var t=C("#s-assign-tags");t.length&&t.remove(),C.post("?module=dialog&action=assignTags",n.serialized,function(t){C("body").append(t),C("#s-assign-tags").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var t=C(this);t.find(".dialog-content h1 span").text("("+n.count+")").show(),t.find(".dialog-buttons i.loading").hide()},onSubmit:function(e){var t,i=C(this),a=i.find("#s-assign-tags-list_tag"),o=(a.length&&(t=jQuery.Event("keypress",{which:13}),a.trigger(t)),i.find(".dialog-buttons i.loading").show(),i.attr("action"));return setTimeout(function(){var t=i.serializeArray().concat(n.serialized);C.shop.jsonPost(o,t,function(t){t.data.denied_message&&alert(t.data.denied_message),"search"===t.data.cloud?e.trigger("close"):t.data.cloud&&C("#s-tag-cloud").trigger("update",[t.data.cloud]),e.trigger("close"),C.products.dispatch()},function(){e.trigger("close")})},10),!1}})})},typesDialog:function(t){function e(){C("#s-types").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){C(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(e){var i=C(this);return i.find(".dialog-buttons i.loading").show(),C.shop.jsonPost(i.attr("action"),i.serializeArray().concat(t.serialized),function(t){o.trigger("update",{type:t.data.types}),a.find(".s-select-all:first").trigger("select",!1),i.find("input:checked").attr("checked",!1),e.trigger("close"),C.products.dispatch()}),!1}})}var i=C("#s-types"),a=this.container,o=this.sidebar;i.parent();i.length?e():C("<div></div>").appendTo("body").load("?module=dialog&action=types",e)},deleteFromSet:function(t){0<t.count&&C.shop.jsonPost("?module=products&action=deleteFromSet&id="+this.collection_hash[1],t.serialized,function(){C.products.dispatch()})},deleteFromCategory:function(t){0<t.count&&C.shop.jsonPost("?module=products&action=deleteFromCategory&id="+this.collection_hash[1],t.serialized,function(){C.products.dispatch()})},deleteProductsDialog:function(t){var e=C("#s-product-list-delete-products-dialog"),i=e.parent();e.length||(i=C("<div></div>").appendTo("body")),0<t.count&&i.load("?module=dialog&action=productsDelete",t,function(){C("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){C(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(i){return C(this).find(".dialog-buttons i.loading").show(),C.product_list.remove(C.extend(t,{remove:["products"]}),function(t,e){C.product_list.sidebar.trigger("update",t.data.lists),C.products.dispatch(),i.trigger("close"),e.length&&alert((i.data("not-allowed-string")||"").replace("%d",e.length))}),!1}})})},exportProducts:function(t,e){for(var i,a=[],o=!1;i=t.serialized.pop();)i.name&&("product_id[]"==i.name?a.push(parseInt(i.value,10)):"hash"==i.name&&(o=i.value));var n="?action=importexport#/";n+=e,o?(n+="/hash/"+o,window.location=n):a.length&&(n+="/hash/id/"+a.join(","),window.location=n)},createCoupon:function(t){for(var e,i=[],a=!1;e=t.serialized.pop();)e.name&&("product_id[]"==e.name?i.push(parseInt(e.value,10)):"hash"==e.name&&(a=e.value));var o=this.options.marketing_url+"coupons/create/";a?(o+="?products_hash="+a,window.location=o):i.length&&(o+="?products_hash=id/"+i.join(","),window.location=o)},duplicateProducts:function(t,a){for(var e,i=[],o=!1;e=t.serialized.pop();)e.name&&("product_id[]"==e.name?i.push(parseInt(e.value,10)):"hash"==e.name&&(o=e.value));(o=!o&&i.length?"id/"+i.join(","):o)&&(a.find("i.icon16").removeClass("split").addClass("loading"),this.duplicate(o,{progress:function(t){a.attr("title",Math.round(100*t.offset/t.total_count)+"%")},finish:function(t,e){a.attr("title",null);var i=a.find("i.icon16");i.removeClass("loading").addClass("yes"),setTimeout(function(){i.removeClass("yes").addClass("split")},3e3),C(document).one("product_list_init_view",function(){var i={};C.each(e,function(t,e){i[e]=1}),C("#product-list [data-product-id]").each(function(){var t=C(this),e=C(this).data("product-id");e&&i[e]&&t.addClass("highlighted")})}),(t||e)&&C.products.dispatch()},error:function(t){}}))},setBadge:function(t,e){var i,a=e.data("action"),o=("set-custom-badge"!=a&&e.parent().find(".textarea-wrapper").slideUp("fast"),e.find(".loading").remove(),e.find("a").append('<span class="count"><i class="icon16 loading"></i></span>'),{}),n=!1;function s(t){var i="delete-badge"==a?null:t.data;C("#product-list [data-product-id]").each(function(){var t,e=C(this);(n||o[e.data("product-id")])&&(e.is("tr")?((t=e.find(".s-image a")).find(".s-image-corner").remove(),i&&t.prepend(C('<div class="s-image-corner"></div>').html(i))):((t=e.find(".s-product-image a")).find(".s-image-corner.top.right").remove(),i&&t.append(C('<div class="s-image-corner top right"></div>').html(i))),e.trigger("badge",[i]))}),"set-custom-badge"==a&&e.parent().find(".textarea-wrapper").slideUp("fast"),e.find(".loading").remove(),e.find("a").append(C('<span class="count"><i class="icon16 yes"></i></span>').animate({opacity:0},function(){C(this).remove()})),C.product_list.container.find(".s-select-all:first").trigger("select",!1)}C.each(t.serialized,function(){n=n||"hash"==this.name,o[this.value]=1}),"delete-badge"==a?(e.find(".loading").remove(),C.shop.jsonPost("?module=product&action=badgeDelete",t.serialized,s)):(i="set-custom-badge"==a?e.find("textarea").val():e.data("type"),(t=t.serialized).push({name:"code",value:i}),C.shop.jsonPost("?module=product&action=badgeSet",t,s,function(t){"object"==typeof t.errors&&"string"==typeof t.errors[0]&&alert(t.errors[0]);e.find(".loading").remove()}))},duplicate:function(e,i){var t={hash:e,limit:50,offset:i.offset||0},a=this,o=[];C.shop.jsonPost("?module=products&action=duplicate",t,function(t){"ok"==(t.status||"error")?(o=o.concat(t.data.new_ids||[]),t.data.offset<t.data.total_count?(i.offset=t.data.offset,a.duplicate(e,i),i.progress(t.data||{})):i.finish(t.data||{},o)):"fail"==t.status&&t.errors.message&&C("#s-product-list-duplicate-error-dialog").waDialog()},function(t){var e;t.errors&&(i.finish(),t.errors.message?((e=C("#s-product-list-duplicate-error-dialog")).find(".js-content").html(t.errors.message),e.waDialog()):alert(t.errors))})},remove:function(e,i){var a,o,t={},n="?module=products&action=deleteList",s=[];(o=e.product_id?function(){e.product_id.length<=100&&(t.get_lists=!0),t.product_id=e.product_id.splice(0,100),C.shop.jsonPost(n,t,function(t){t.data.not_allowed&&t.data.not_allowed.length&&(s=s.concat(t.data.not_allowed)),e.product_id.length?o():"function"==typeof i&&i(t,s)})}:(t.hash=e.hash||this.collection_hash.join("/")||"all",t.remove=C.isArray(e.remove)&&e.remove.length?e.remove:["list"],1==t.remove.length&&"list"==t.remove[0]?function(){C.shop.jsonPost(n,t,i)}:(t.count=100,a=null,function(){C.shop.jsonPost(n,t,function(t){t.data.not_allowed&&t.data.not_allowed.length&&(s=s.concat(t.data.not_allowed)),0<t.data.rest_count&&a!=t.data.rest_count?o():"function"==typeof i&&i(t,s)})})))()},associatePromo:function(t,e){var i,a;e.data("locked")||(e.data("locked",!0),i=location.pathname+"?module=productsAssociatePromoDialog",t={products_hash:function(t){var i=[],a="";C.each(t,function(t,e){e.name&&("product_id[]"===e.name?i.push(parseInt(e.value,10)):"hash"===e.name&&(a=e.value))}),!a&&i.length&&(a="id/"+i.join(","));return a}(t.serialized)},a="is-scroll-locked",C.post(i,t).done(function(t){C(t).waDialog({onLoad:function(){C("body").addClass(a)},onCancel:function(){C("body").removeClass(a),C(this).remove()}})}).always(function(){e.removeData("locked")}))},rubberTable:function(){var t=C("#wa"),e=C("#s-content"),i=C("#s-content > .content"),e=parseInt(e.css("margin-left")),a=parseInt(i.css("margin-right")),o=C(".s-product-list-table-container table").width(),n=t.attr("style");n&&t.data("style",n),n=parseInt(i.width()-C(".s-product-list-table-container").width())+o+e+a,t.width()<n&&t.css({"min-width":n+"px"}),C(window).resize()}}}(jQuery);var shopDialogProductsSet=function(d){return(shopDialogProductsSet=function(t){this.$wrapper=t.$wrapper,this.is_new=t.is_new,this.initClass()}).prototype.initClass=function(){this.is_new&&this.initTransliterateSetID(),this.initTypeSwitch(),this.initDatepickers()},shopDialogProductsSet.prototype.initTypeSwitch=function(){var t=this.$wrapper;t.find("input[name=type]").on("click",function(){"0"==d(this).val()?t.find(".js-set-dynamic-settings").hide():t.find(".js-set-dynamic-settings").show()})},shopDialogProductsSet.prototype.initDatepickers=function(){var a,o,n,t=this;function s(t){var e=d.datepicker._defaults.dateFormat,i=null;try{d.datepicker.parseDate(e,t),i=!0}catch(t){i=!1}return i}t.$wrapper.find(".js-datepicker").each(function(){var t=d(this);t.datepicker({}),t.datepicker("widget").hide()}),a=t.$wrapper.find(".js-start-date"),o=t.$wrapper.find(".js-finish-date"),n="error",a.on("change",function(){var t=d(this),e=d.trim(t.val()),i=null;e&&(s(e)?i=new Date(t.datepicker("getDate").getTime()+864e5):t.val("").addClass(n)),o.datepicker("option","minDate",i)}),o.on("change",function(){var t=d(this),e=d.trim(t.val()),i=null;e&&(s(e)?i=new Date(t.datepicker("getDate").getTime()-864e5):t.val("").addClass(n)),a.datepicker("option","maxDate",i)}),d([a,o]).on("keydown",function(t){var e=d(this);e.hasClass(n)&&e.removeClass(n)}),a.trigger("change").datepicker("refresh"),o.trigger("change").datepicker("refresh")},shopDialogProductsSet.prototype.initTransliterateSetID=function(){var t,i,e=this.$wrapper,a=e.find(".js-product-set-id"),e=e.find(".js-product-list-name"),o={val:"",changed:!1};a.bind("keydown",function(){var e=d(this);null!==t&&(clearTimeout(t),t=null),t=setTimeout(function(){var t=e.val();o.val!==t&&(o.changed=!0,o.val=t,e.unbind("keydown"))},200)}),e.bind("keydown",function(){var e=d(this);o.changed?e.unbind("keydown"):(null!==i&&(clearTimeout(i),i=null),i=setTimeout(function(){var t=e.val();t&&d.getJSON("?action=transliterate&str="+t,function(t){o.changed?e.unbind("keydown"):"ok"==t.status&&(o.val=t.data,a.val(o.val))})},200))})},shopDialogProductsSet.staticDialog=function(i,a){function t(){(e=d("#s-product-set-dialog")).waDialog({esc:!1,disableButtonsOnSubmit:!0,onLoad:function(){new shopDialogProductsSet({$wrapper:e,is_new:"new"===a}),setTimeout(function(){d(".js-product-list-name").focus()},50)},onSubmit:function(s){function t(t){var e=null;0<location.hash.indexOf("set_id")?(e=location.hash.replace("set_id="+i,"set_id="+t.data.id),"rule"in t.data&&(e=(e=e.replace(/&sort=[^&]*/,"&sort=")).replace(/&order=[^&]*/,"&order="))):e="#/products/set_id="+t.data.id,"new"===a&&d.product_sidebar.createNewElementInList(t.data,"set"),d.product_sidebar.updateItemInCategoryList(t,e),location.hash!=e?location.hash=e:d.products.dispatch(),s.trigger("close")}function e(t){if(t&&t.errors){var e,i=t.errors,a=0;for(e in i){var o,n=s.find("input[name="+e+"]");n.length&&(n.addClass("error"),a+=1,(o=n.parent().find(".errormsg")).length&&o.text(i[e]),n.one("keyup",function(){--a||r.find("[type='submit']").removeAttr("disabled",!1),n.removeClass("error"),o.length&&o.text("")}))}return!1}}var r=d(this);if(!r.find("input:file").length)return d.shop.jsonPost(r.attr("action"),r.serialize(),t,e),!1;d.products._iframePost(r,t,e)},onClose:function(){e.find(".js-datepicker").each(function(){d(this).datepicker("widget").hide()})}})}var e=d("#s-product-set-dialog"),o=e.length?e.closest(".s-products-set-dialog-wrapper").empty():d('<div class="s-products-set-dialog-wrapper"></div>').appendTo("body");"new"===a?o.load("?module=set&action=Create",t):"edit"===a&&o.load("?module=set&action=Edit&set_id="+i,t)},shopDialogProductsSet}(jQuery),shopDialogProductsCategory=function(c){return(shopDialogProductsCategory=function(t){var e=this;e.$wrapper=t.$wrapper,e.category_id=t.category_id,e.category_type=t.category_type,e.account_name=t.account_name,e.filter_count=t.filter_count,e.filter_ignore_id=[],e.ignore_id=[],e.filter_element_html=t.templates.filter_element_html,e.show_all=t.texts.show_all,e.initClass()}).prototype.initClass=function(){var t=this,e=(t.initAutocomplete(),t.initEvent(),t.initFilter(),t.initMetaTagEdit(),t.initFrontendUrlEdit(),t.initCategoryVisibility(),t.initSocialMetaTag(),t.initShowMoreFilters(),t.initFilterIgnoreId(),t.updateShowFilterButton(),t.initFilterAutocomplete(),t.$wrapper.find('*[data-slider="range"]'));e.length&&e.each(function(){t.initRangeSlider(".js-feature-slider-"+c(this).data("code"))})},shopDialogProductsCategory.prototype.initEvent=function(){var t=this;t.initDynamicSettingsEvent(),t.disableManualSorting(),t.initShowMore(),t.initShowAllFeatureValue(),t.initGetFeatures(),t.initFieldValidation()},shopDialogProductsCategory.prototype.initShowMoreFilters=function(){var i=this;i.$wrapper.on("click",".js-show-more-filters",function(t){t.preventDefault();t={category:i.category_id,offset:i.getFilterOffset(),ignore_id:i.filter_ignore_id,category_type:i.category_type,get_all:!0};c.post("?module=categoryGetFeatures",t).success(function(t){if(!t||!t.data.features)return!1;t=t.data.features;c.each(t,function(t,e){i.setFilterElement(e)}),i.updateShowFilterButton(!0)})})},shopDialogProductsCategory.prototype.updateShowFilterButton=function(t=!1){var e=this,i=e.$wrapper.find(".js-show-more-filters"),a=e.$wrapper.find(".js-category-filters .js-filter-checkbox").length,a=(--a,a-=e.filter_ignore_id.length,e.filter_count-a);0<a&&!1===t?i.text(e.show_all+" ("+a+")"):i.hide()},shopDialogProductsCategory.prototype.setFilterElement=function(t,e){var i=this.filter_element_html,a=this.$wrapper.find(".js-category-filters");e=e||!1,i=(i=(i=(i=i.replace(/%id/g,t.id)).replace(/%name/g,t.name)).replace(/%code/g,t.code)).replace(/%type_name/g,t.type_name),a.append(i),e&&this.$wrapper.find('.js-category-filter input[data-filter-id="'+t.id+'"]').prop("checked",!0)},shopDialogProductsCategory.prototype.getFilterOffset=function(){var t=this.$wrapper.find(".js-category-filters .js-filter-checkbox").length;return--t,t=(t-=this.filter_ignore_id.length)<0?0:t},shopDialogProductsCategory.prototype.initFilterIgnoreId=function(){var e=[];this.$wrapper.find(".js-category-filters .js-filter-checkbox:checked").each(function(){var t=c(this).val();"price"!==t&&e.push(t)}),this.filter_ignore_id=e},shopDialogProductsCategory.prototype.initFilterAutocomplete=function(){var i=this,t=i.$wrapper.find(".js-filter-autocomplete");t.autocomplete({source:function(t,e){t={term:t.term,category_id:i.category_id,options:{ignore_id:i.filter_ignore_id,category_type:i.category_type}};c.post("?action=autocomplete&type=filter",t,function(t){e(t)},"json")},minLength:1,delay:300,create:function(){t.autocomplete("widget").appendTo(".js-filter-autocomplete-block")},select:function(t,e){return t.preventDefault(),i.setFilterElement(e.item,!0),i.filter_ignore_id.push(parseInt(e.item.id)),c(this).val(""),!1},focus:function(){return!1}})},shopDialogProductsCategory.prototype.initAutocomplete=function(){var a=this,t=a.$wrapper.find(".js-autocomplete"),e=[];t.length&&t.autocomplete({source:function(t,i){a.$wrapper.find(".js-condition-feature").each(function(){var t=c(this).data("feature_id");c.isNumeric(t)&&-1==c.inArray(t,e)&&e.push(t)}),c.ajax({type:"POST",url:"?action=autocomplete&type=feature",data:{term:t.term,options:{ignore_id:e,count:1}},success:function(t){var e=a.$wrapper.find(".js-autocomplete-wrapper .errormsg");i(t),0===t.length?e.html("").html($_("Matching features were not found or are already selected.")):e.html("")},dataType:"json"})},minLength:1,delay:300,create:function(){t.autocomplete("widget").appendTo(".js-autocomplete-block")},select:function(t,e){return a.renderFeature(e.item.id),a.ignore_id.push(parseInt(e.item.id)),!1},focus:function(){return!1}})},shopDialogProductsCategory.prototype.initRangeSlider=function(t){var o=c(t).find(".js-begin"),n=c(t).find(".js-end"),e=parseFloat(o.attr("placeholder")),i=parseFloat(n.attr("placeholder")),s=1,a=c(t).find(".js-range-slider");if(a.data("step"))s=parseFloat(a.data("step"));else{t=i-e;if(Math.round(e)!=e||Math.round(i)!=i){for(var s=t/10,r=0;s<1;)s*=10,r+=1;s=Math.pow(10,-r),(r=Math.round(1e5*Math.abs(Math.round(e)-e))/1e5)&&r<s&&(s=r),(r=Math.round(1e5*Math.abs(Math.round(i)-i))/1e5)&&r<s&&(s=r)}}t=parseFloat(o.val()?o.val():0),e=parseFloat(n.val()?n.val():100<o.val()?parseFloat(o.val())+100:100);a.slider({range:!0,min:t-3,max:e+5,step:s,values:[t,e],slide:function(t,e){var i=c(this).slider("option","min"),a=c(this).slider("option","max");2!=c(e.handle).index()&&(e.values[0]==i&&c(this).slider("option","min",i-s),o.val(e.values[0])),1!=c(e.handle).index()&&(e.values[1]==a&&c(this).slider("option","max",a+s),n.val(e.values[1]))},stop:function(t,e){n.change()}}),o.add(n).change(function(){var t=""===o.val()?a.slider("option","min"):parseFloat(o.val()),e=""===n.val()?a.slider("option","max"):parseFloat(n.val());t<=e&&(a.slider("option","values",[t,e]),a.slider("option","max",parseFloat(e)+5),a.slider("option","min",parseFloat(t)-3))})},shopDialogProductsCategory.prototype.initShowFeatures=function(t,e,i,a,o){var n=t.type.substr(0,5);if("range"==n){var s,r=[],d=[];for(s in t.values)t.values.hasOwnProperty(s)&&(r.push(parseInt(t.values[s].begin)),d.push(parseInt(t.values[s].end)));t.values={},t.values[0]={begin:Math.min.apply(Math,r)?Math.min.apply(Math,r):"",end:Math.max.apply(Math,d)?Math.max.apply(Math,d):""}}e.append(tmpl(i,{feature:t,default_checked:a,show_all:o})),"range"===n&&this.initRangeSlider(".js-feature-slider-"+t.code)},shopDialogProductsCategory.prototype.initGetFeatures=function(){var n=this;this.$wrapper.on("change",".js-condition-feature",function(){var e,t,i,a,o=c(this).closest("tr").find(".js-condition-feature-block");this.checked?(t="?module=category&action=getFeatures&feature_id="+(e=c(this).data("feature_id")),i=c(this).attr("data-loading"),"new"!==n.category_id||i||(c(a=this).closest(".js-condition-feature-names").append('<i class="icon16 loading"></i>'),c.get(t,function(t){"ok"===t.status&&(t.data.features&&(t=t.data.features[e],n.initShowFeatures(t,o,"template_feature_field_values",!0,!1)),c(a).attr("data-loading","ok"),c(a).closest(".js-condition-feature-names").find("i.loading").remove())})),o.show(),o.find(":input").each(function(){c(this).attr("disabled",!1)})):(o.hide(),o.find(":input").each(function(){c(this).attr("disabled",!0)}))})},shopDialogProductsCategory.prototype.initFieldValidation=function(){this.$wrapper.on("input",".js-begin, .js-end",function(){var i,a,o,t=c(this).val(),e="string"==typeof t?t:""+t;i=["0","1","2","3","4","5","6","7","8","9",".",",","-"],o=!(a=[]),c.each(e.split(""),function(t,e){"-"===e?0===a.length&&a.push(e):"."===e||","===e?(e=".",o||(o=!0,a.push(e))):0<=i.indexOf(e)&&a.push(e)}),(e=a.join(""))!==t&&c(this).val(e)})},shopDialogProductsCategory.prototype.renderFeature=function(t){var r=this,d=r.$wrapper,l=!0,e="feature_id="+t,i="GET";t||(l=!1,e={ignore_id:r.ignore_id,category:r.category_id,category_type:r.category_type,get_all:!0},i="POST"),c.ajax({type:i,url:"?module=categoryGetFeatures",data:e,dataType:"json",success:function(t){if(d.find(".js-show-more").find("i.loading").remove(),"ok"===t.status){var e,i,a=d.find(".js-condition-list .js-feature-insertion-block"),o=d.find(".js-show-more").attr("data-count"),n=0;for(e in t.data.features)t.data.features.hasOwnProperty(e)&&(i=t.data.features[e],r.initShowFeatures(i,a,"template_feature_field",l,!1),++n);var s,o=o-n;1===n&&0<o?(s="<b><i>"+r.show_all+" ("+o+")</i></b>",d.find(".js-show-more").html(s).attr("data-count",o)):d.find(".js-autocomplete-wrapper").hide()}else"fail"===t.status&&console.log(t.errors)}})},shopDialogProductsCategory.prototype.initShowAllFeatureValue=function(){var n=this;n.$wrapper.on("click",".js-show-all-feature",function(){var t,e,a=this,o=c(this).data("feature_id");c(this).html('<i class="icon16 loading"></i>'),void 0===o?(c(this).parent().find(".js-feature-hidden").show(),c(this).hide()):(t="?module=category&action=getFeatures&feature_id="+o,e=c(this).parent(),c.get(t,function(t){var i;"ok"===t.status&&t.data.features&&(i=t.data.features[o],e.find(".js-feature-value").each(function(){var t,e=parseInt(c(this).data("f_val"));for(t in i.values)i.values.hasOwnProperty(t)&&t==e&&delete i.values[t]}),n.initShowFeatures(i,e,"template_feature_field_values",!0,!0),c(a).html(""))}))})},shopDialogProductsCategory.prototype.initShowMore=function(){var t,e=this,i=e.$wrapper,a=i.find(".js-show-more").attr("data-count");e.ignore_id.length||e.$wrapper.find(".js-condition-feature").each(function(){c.isNumeric(c(this).data("feature_id"))&&e.ignore_id.push(c(this).data("feature_id"))}),(a-=e.ignore_id.length)<=0?i.find(".js-autocomplete-wrapper").hide():(t="<b><i>"+this.show_all+" ("+a+")</i></b>",i.find(".js-show-more").html(t).attr("data-count",a)),i.find(".js-show-more").click(function(){c(this).html('<i class="icon16 loading"></i>'),e.renderFeature()})},shopDialogProductsCategory.prototype.disableManualSorting=function(){var t=this.$wrapper;t.find(".js-subcategory-toggle").change(function(){this.checked?t.find('.js-sort-type option[value=""]').attr("disabled",!0).next().attr("selected","selected"):t.find('.js-sort-type option[value=""]').attr("disabled",!1)})},shopDialogProductsCategory.prototype.initDynamicSettingsEvent=function(){var i=this.$wrapper;i.find("input[name=type]").on("click",function(){"0"==c(this).val()?(i.find(".js-category-dynamic-settings").hide(),i.find(".js-category-dynamic-settings").find(":input").each(function(){c(this).attr("disabled",!0)})):(i.find(".js-category-dynamic-settings").show(),i.find(".js-category-dynamic-settings").find(":input").each(function(){c(this).hasClass("js-always-disabled")||c(this).attr("disabled",!1)}))}),i.on("keyup","input[name^=rating]",function(){i.find(".js-condition-rating-interval").attr("checked",!0)}),i.find(".js-category-rate").click(function(){i.find(".js-condition-rate").attr("checked",!0)}),i.on("keyup","input[name^=count]",function(){i.find(".js-condition-count-interval").attr("checked",!0)}),i.find(".js-category-count-value").click(function(){i.find(".js-condition-count").attr("checked",!0)}),i.on("change","input[name^=tag]",function(){i.find(".js-condition-tag").attr("checked",!0)}),i.on("keyup","input[name^=price]",function(){i.find(".js-condition-price-interval").attr("checked",!0)}),i.on("keyup","input[name^=compare_price]",function(){i.find(".js-condition-compare-price-interval").attr("checked",!0)}),i.on("keyup","input[name^=purchase_price]",function(){i.find(".js-condition-purchase-price-interval").attr("checked",!0)}),i.on("change",".js-feature-value",function(){this.checked&&c(this).closest("tr").find(".js-condition-feature").attr("checked",!0);var t=c(this).closest("tr").find(".js-condition-feature").attr("data-feature_id"),e=parseInt(c(this).closest(".js-condition-feature-block").find("input:checkbox:checked").length),t=i.find('.js-category-filter input[data-filter-id="'+t+'"]');t.length&&(2<=e?t.is(":disabled")&&t.attr("disabled",!1):t.attr("disabled",!0))})},shopDialogProductsCategory.prototype.initFrontendUrlEdit=function(){c("#s-settings-frontend-url").inlineEditable({editLink:".js-settings-frontend-url-edit-link",editOnItself:!1,minSize:{width:100},makeReadableBy:[],beforeMakeEditable:function(t){var e=c(this).parents("div:first"),i=e.find("span.slash");c(t).after(i),e.find("span.s-frontend-base-url").html(e.find("a.s-frontend-base-url").hide().contents()).show()},beforeBackReadable:function(t,e){var i=c(this),a=i.parents("div:first"),o=a.find("span.slash");i.after(o),a.find("a.s-frontend-base-url").html(a.find("span.s-frontend-base-url").hide().contents()).show()}});var t=this.$wrapper.find(".js-product-list-name"),i=this.$wrapper.find(".js-product-list-url"),a={name:"",url:"",timer_id:null};t.unbind(".create_product_list").bind("change.create_product_list, keyup.create_product_list",function(){var e;a.time_id&&clearTimeout(a.time_id),i.val()!==a.url?t.unbind(".create_product_list"):(e=t.val())!==a.name&&(a.time_id=setTimeout(function(){c.getJSON("?action=transliterate",{str:e},function(t){"ok"===t.status?(i.val(t.data),a={name:e,url:t.data,time_id:null}):console&&(t.errors?console.error(t.errors):t&&console.error(t))})},300))})},shopDialogProductsCategory.prototype.initMetaTagEdit=function(){var e,i,t=this.$wrapper,a=this.account_name;e=c("input[name=meta_title]",t),c.shop.changeListener(c("input[name=name]",t),function(t){e.attr("placeholder",t.val())}),i=c("[name=meta_keywords]",t),c.shop.changeListener(c("input[name=name]",t),function(t){i.attr("placeholder",[a,t.val()].join(", "))}),c.shop.makeFlexibleInput("s-meta-title")},shopDialogProductsCategory.prototype.initSocialMetaTag=function(){var t=this.$wrapper.find(".js-category-social-metatag"),e=t.closest(".field-group"),i=e.find(".editable-og-disabler");t.closest(".field").appendTo(e.closest("form").find('[name="meta_title"]').closest(".field-group")),t.prop("checked")||e.show(),t.change(function(){t.prop("checked")?(e.slideUp(200),i.prop("disabled",!1)):(e.slideDown(200),i.prop("disabled",!0))})},shopDialogProductsCategory.prototype.initFilter=function(){var t=this.$wrapper,e=t.find(".js-category-filter");function i(){var n=!(1<t.find(".js-filter-item .js-filter-checkbox:checked").length);t.find(".js-filter-item").each(function(){var t,e,i,a,o=c(this);t=n,e=(o=o).find(".js-filter-checkbox"),i=o.find("i.sort"),a="unsortable",!t&&e.is(":checked")?o.hasClass(a)&&(o.removeClass(a),i.show()):o.hasClass(a)||(o.addClass(a),i.hide())}),e.sortable("refresh")}t.on("click",".js-category-allow-filter",function(){this.checked?(e.find(":input").each(function(){c(this).data("disabled")||c(this).attr("disabled",!1)}),e.show()):(e.find(":input").each(function(){c(this).attr("disabled",!0)}),e.hide())}),e.sortable({distance:5,opacity:.75,items:"li:not(.unsortable)",handle:".sort",cursor:"move",tolerance:"pointer"}),t.on("change",".js-filter-checkbox",function(){i()}),i()},shopDialogProductsCategory.prototype.initCategoryVisibility=function(){var t=this.$wrapper.find(".js-product-category-visibility-block");c("input[name=storefront]",t).change(function(){"route"==this.value?c('input[name="routes[]"]',t).attr("disabled",!1):c('input[name="routes[]"]',t).attr("disabled",!0)})},shopDialogProductsCategory.staticDialog=function(n,t,s){function e(){c("#s-product-category-dialog").waDialog({esc:!1,disableButtonsOnSubmit:!1,onLoad:function(){c("#s-category-description-content").length&&c.product_sidebar.initCategoryDescriptionWysiwyg(c(this)),setTimeout(function(){c(".js-product-list-name").focus()},150)},onSubmit:function(a){var i,t,e,o=c(this);return i=!1,o.find(".js-condition-feature:checked, .js-condition-tag:checked").each(function(){var t=c(this).closest("tr").find(".js-condition-feature-block, .js-condition-tag-block"),e=t.find(".js-feature-value:checkbox, .js-tag-value:checkbox");e.length&&!e.is(":checked")&&(i=!0,t.find(".errormsg").html("").html($_("Nothing selected")),o.find(".js-category-error").html("").html($_("Nothing selected")))}),setTimeout(function(){o.find(".errormsg").html("")},5e3),!i&&(t=function(t){var e=null;0<location.hash.indexOf("category_id")?(e=location.hash.replace("category_id="+n,"category_id="+t.data.id),("sort_products"in t.data||"rule"in t.data)&&(e=(e=e.replace(/&sort=[^&]*/,"&sort=")).replace(/&order=[^&]*/,"&order="))):e="#/products/category_id="+t.data.id,"new"===s&&c.product_sidebar.createNewElementInList(t.data,"category"),c.product_sidebar.updateItemInCategoryList(t,e),location.hash!=e?location.hash=e:c.products.dispatch(),a.trigger("close")},e=function(t){if(t&&t.errors){var e,i=t.errors;for(e in i)a.find("input[name="+e+"]").addClass("error").parent().find(".errormsg").text(i[e]);return!1}},c("#s-category-description-content").length&&c("#s-category-description-content").waEditor("sync"),o.find("input:file").length?void c.products._iframePost(o,t,e):(c.shop.jsonPost(o.attr("action"),o.serialize(),t,e),!1))}})}var i=c("#s-product-category-dialog"),i=i.length?i.parent():c("<div></div>").appendTo("body");"new"===s&&i.load("?module=category&action=Create&parent_id="+t,e),"edit"===s&&i.load("?module=category&action=Edit&category_id="+n,e)},shopDialogProductsCategory}(jQuery);
//# sourceMappingURL=product.min.js.map
