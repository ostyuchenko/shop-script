(function(b){var a=function(b,d,e){var g=!/[^\w\-\.:]/.test(b)?!e?a.cache[b]=a.cache[b]||a(a.load(b)):a.cache[b]=a(a.load(b)):new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+b.replace(a.regexp,a.func)+"';return _s;");return d?g(d,a):function(b){return g(b,a)}};a.cache={};a.load=function(b){var a=document.getElementById(b),e=/<\\\/(\w+)/g;if(!a&&console)throw{message:"template with id="+b+" not found"};return a?("textarea"==a.tagName.toLowerCase()?a.value:document.getElementById(b).innerHTML).replace(e,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(b,a,e,g,f,h){if(a)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[b]||"\\"+b;if(e)return"="===e?"'+_e("+g+")+'":"'+("+g+"||'')+'";if(f)return"';";if(h)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(b){return String(b||"").replace(a.encReg,function(b){return a.encMap[b]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a){function c(){if(d.stopped)this.onscroll=null;else if(!d.stopped&&!d.loading&&h(g,e)<=d.distance){if(null!==d.hash){var b=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===d.hash.indexOf(b)){this.onscroll=null;return}}d.load()}}if("stop"==a){var d=this.data("lazyLoadSettings");d&&(d.stopped=!0)}else if("sleep"==a){if(d=this.data("lazyLoadSettings"))d.loading=!0}else if("wake"==a){if(d=this.data("lazyLoadSettings"))d.loading=!1}else if("force"==a)(d=
this.data("lazyLoadSettings"))&&(d.loading||d.load());else{this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:g,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));d=this.data("lazyLoadSettings");d.loading=!1;d.stopped=!1;var e=this,g="string"===typeof d.container?b(d.container):d.container;null!==d.hash&&!b.isArray(d.hash)&&(d.hash=[d.hash]);b.fn.lazyLoad.call(e,d.state);var f=setTimeout(function(){if(d.stopped)clearTimeout(f);
else{if(d.hash!==null){var b=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(d.hash.indexOf(b)===-1){clearTimeout(f);return}}if(d.loading)f=setTimeout(arguments.callee,350);else{h(g,e);if(h(g,e)<=d.distance){d.load();f=setTimeout(arguments.callee,350)}else{e.get(0).onscroll=c;clearTimeout(f)}}}},350),h="function"===typeof d.distanceBetweenBottoms?d.distanceBetweenBottoms:function(b,a,d){return b.position().top+b.outerHeight()-(d||0)-(a.scrollTop()+a.height())}}}})(jQuery);$.fn.liveDraggable=function(b){this.each(function(){var b=$(this);b.data("init_draggable")&&b.die("mouseover",b.data("init_draggable"))});this.die("mouseover").live("mouseover",function(){var a=$(this);a.data("init_draggable")||a.data("init_draggable",arguments.callee).draggable(b)})};
$.fn.liveDroppable=function(b){this.each(function(){var b=$(this);b.data("init_droppable")&&b.die("mouseover",b.data("init_droppable"))});var a=function(){var a=$(this);a.data("init_droppable")||(a.data("init_droppable",arguments.callee).droppable(b),a.mouseover())};a.call(this);this.die("mouseover",a).live("mouseover",a)};(function(b){b.fn.inlineEditable=function(a,c){function d(){m(b(this))||b(this).addClass(i.placeholderClass).text(i.placeholder)}function e(){m(b(this))==i.placeholder&&b(this).text("").removeClass(i.placeholderClass)}function g(a){return!b(a).val()?(b(this).text(i.placeholder).addClass(i.placeholderClass),!0):!1}function f(){o="edit";this.id=this.id||(""+Math.random()).slice(2);var a=this.id+"-input",d=b("#"+a);d.length||(n.after(j(a)),d=b("#"+a));d.addClass(i.inputClass);var a=d,c=n,g=i.size.height||
c.height(),c=i.size.width||1.5*c.width(),g=i.minSize.height&&g<i.minSize.height?i.minSize.height:g,c=i.minSize.width&&c<i.minSize.width?i.minSize.width:c,g=i.maxSize.height&&g>i.maxSize.height?i.maxSize.height:g,c=i.maxSize.width&&c>i.maxSize.width?i.maxSize.width:c;a.height(g);a.width(c);i.placeholder&&m(b(this))==i.placeholder&&e.call(n);i.beforeMakeEditable.call(this,d);r=i.truncate?n.data("real_text"):m(n);d.val(r).show().focus();n.hide();b(i.editLink).hide();if(!l){for(var f=[],k=[],a=0,g=i.makeReadableBy.length;a<
g;++a)c=i.makeReadableBy[a],"blur"==c&&d.blur(function(){o!="read"&&h.call(this)}),"enter"==c&&f.push(13),"esc"==c&&f.push(27);a=0;for(g=i.updateBy.length;a<g;++a)c=i.updateBy[a],"alt+enter"==c&&k.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==c&&k.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==c&&k.push({ctrl:!0,alt:!1,shift:!1,key:17});f.length&&d.keydown(function(b){~f.indexOf(b.keyCode)&&!b.ctrlKey&&!b.altKey&&!b.shiftKey&&o!="read"&&h.call(this,b.keyCode==27?r:null);if(k.length)for(var a in k){var d=
k[a];if(b.keyCode==d.key&&b.ctrlKey==d.ctrl&&b.altKey==d.alt&&b.shiftKey==d.shift){n.trigger("readable");break}}});n.unbind("readable.inlineEditable").bind("readable.inlineEditable",function(a,d){if(o!="read"){var c=b("#"+(this.id+"-input"));h.call(c,c.val(),d)}});l=!0}i.afterMakeEditable.call(this,d)}function h(a,c){c="undefined"===typeof c?!1:!0;void 0!=a&&null!=a?b(this).val(a):a=b(this).val();if(!(!1===c&&!1===i.beforeBackReadable.call(n.get(0),this,{changed:a!=r,old_text:r,new_text:a}))){o="read";
if(!i.placeholder||!g.call(n,this))if(i.allowEmpty||a)i.truncate?(n.data("real_text",a),n.text(a.length<i.truncate-3?a:a.substr(0,i.truncate-3)+"...")):!i.html?n.text(a):n.html(a),a||d.call(this);n.show();b(this).hide();b(i.editLink).show();!1===c&&i.afterBackReadable.call(n.get(0),this,{changed:a!=r,old_text:r})}}function j(b){switch(i.inputType){case "textarea":return'<textarea id="'+b+'" style="display:none;"></textarea>';default:return'<input type="text" id="'+b+'" style="display:none;">'}}function k(b){return function(){return b}}
function m(b){return!i.html?b.text():b.html()}if(this.length){var l=!1;if("string"==typeof a){if("setOption"==a){var i=this.data("inlineEditableSettings")||{};b.extend(!0,i,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(i.hold=k(i.hold));this.data("inlineEditableSettings",i)}return this}var p=this.data("inlineEditableSettings");this.data("inlineEditableSettings",b.extend({inputType:"text",inputClass:"",size:{height:null,width:null},minSize:{height:null,width:null},maxSize:{height:null,
width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},afterMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},p,a||{}));var i=this.data("inlineEditableSettings")||{},n=this,o="read",r="";"function"!==typeof i.hold&&(i.hold=k(i.hold));this.data("inited")||(i.truncate&&"boolean"==typeof i.truncate&&
(i.truncate=255),i.truncate&&(p=!i.placeholder||i.placeholder!==this.text()?this.text():"",this.data("real_text",p),this.text(p.length<i.truncate-3?p:p.substr(0,i.truncate-3)+"...")),i.placeholder&&d.call(this),i.editLink&&b(i.editLink).unbind("click.inlineEditable").bind("click.inlineEditable",function(){i.hold.call(n)||o!="edit"&&f.call(n.get(0))}),i.editOnItself&&this.unbind("click.inlineEditable").bind("click.inlineEditable",function(){i.hold.call(n)||o!="edit"&&f.call(this)}),this.unbind("editable.inlineEditable").bind("editable.inlineEditable",
function(){i.hold.call(n)||o!="edit"&&f.call(this)}),this.unbind("placeholder.inlineEditable").bind("placeholder.inlineEditable",function(a,c){c&&i.placeholder&&d.call(this);c||b(this).removeClass(i.placeholderClass)}),this.data("inited",!0));return this}}})(jQuery);(function(b){b.fn.photoStreamSlider=function(a){function c(){function a(c){function j(){a.execution=!1;var b="on"+i.charAt(0).toUpperCase()+i.slice(1),b=d[b];"function"==typeof b&&b.call(e);b=c.fn;"function"==typeof b&&b.call(e)}"string"==typeof c&&(c={direction:c,animate:!0});var i=c.direction||"forward",l=c.steps||h.length;if(!a.execution){a.execution=!0;var n=h.filter(":first").outerWidth()*l,q=h.length;if("forward"==i){var o=h.filter(":last").nextAll(":lt("+l+")"),l=o.length,o=o.filter(":last");
l&&(h.removeClass("visible"),o.prevAll(":lt("+(q-1)+")").addClass("visible"),o.addClass("visible"))}else o=h.filter(":first").prevAll(":lt("+l+")"),l=o.length,o=o.filter(":last"),l&&(h.removeClass("visible"),o.nextAll(":lt("+(q-1)+")").addClass("visible").show(),o.addClass("visible"));h=b("li.visible",f);q=f.position().left;"forward"==i?(l=m-k-p,q-=n,q=q>-l?q:-l):(q+=n,q=q<p?q:p);c.animate?f.animate({left:q},d.duration,j):(f.css({left:q}),j())}}var f=e.find(d.photoStream),h=b("li.visible",f),j=b("li",
f),k=h.filter(":first").outerWidth()*h.length,m=j.filter(":first").outerWidth()*j.length,l=d.height||j.filter(":first").outerHeight();f.parent().css({overflow:"hidden",height:l,position:"relative",padding:"4px 0",margin:0,width:k});for(var l=f.find("li:first"),i=h.filter(":first"),p=(i.outerWidth()-i.width())/2,n=0,o=l.outerWidth(),i=i.get(0);l.length&&l.get(0)!=i;)n+=o,l=l.next();f.css({position:"absolute",left:-(n-p),width:m});b(d.forwardLink).unbind("click").bind("click",function(){a("forward");
return!1});b(d.backwardLink).unbind("click").bind("click",function(){a("backward");return!1});e.unbind("append prepend").bind("append prepend",function(a,c){if("append"==a.type){for(var d=f.find("li:last"),g=b();d.hasClass("dummy");)g=g.add(d),d=d.prev("li");g.remove();f.append(c)}else{var d=b("<div></div>").html(c),g=d.find("li"),h=g.length*o;d.remove();for(var d=f.find("li:first"),k=b();d.hasClass("dummy");)k=k.add(d),d=d.next("li");k.remove();f.prepend(g)}j=f.find("li");m=j.filter(":first").outerWidth()*
j.length;f.css("width",m);"prepend"==a.type&&(f.is(":animated")&&f.stop(!1,!0),f.css("left",parseInt(f.css("left"))-h));f.find("li.selected").hasClass("visible")&&e.trigger("home",[null,!1])});e.unbind("forward backward").bind("forward backward",function(b,d){a({direction:b.type,steps:d.steps,animate:"undefined"!==typeof d.animate?d.animate:!0,fn:d.fn});var c=f.find("li.selected"),e="forward"==b.type?c.next("li:not(.dummy)"):c.prev("li:not(.dummy)");e.length&&(c.removeClass("selected"),e.addClass("selected"))});
e.unbind("home").bind("home",function(d,c,e){var d=parseInt(h.length/2),d=h.filter(":eq("+d+")"),f=d.nextAll(".selected:first"),j=d.prevAll(".selected:first"),k=0,i="";"function"!==typeof c&&(e=c);e="undefined"!==typeof e?e:!0;f.length?(i="forward",d.nextAll().each(function(){++k;if(b(this).hasClass("selected"))return!1})):j.length&&(i="backward",d.prevAll().each(function(){++k;if(b(this).hasClass("selected"))return!1}));i&&k?a({direction:i,steps:k,fn:c,animate:e}):"function"==typeof c&&c();return!1});
e.unbind("refresh").bind("refresh",function(){c()})}var d=b.extend({duration:200,height:48},a||{}),e=this;c()}})(jQuery);(function(b){b.product_dragndrop={handlers:{},options:{},init:function(b){this.options=b;b.collections&&(this.initDragCollections(),this.initDropCollections());b.products&&(this.initDragProducts(),this.initDropProducts());return this},bind:function(b,c){this.handlers[b]=c;return this},trigger:function(b){if("function"===typeof this.handlers[b])return this.handlers[b].apply(this,Array.prototype.slice.call(arguments,1))},initDragProducts:function(){var a=b("#product-list"),c=a.find(".product");c.find(".drag-handle").live("selectstart",
function(){document.onselectstart=function(){return!1};return!1});c.liveDraggable({opacity:0.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,containment:[0,0,b(window).width(),{toString:function(){return b(document).height()}}],start:function(a,c){document.ondragstart=function(){return!1};c.helper.data("scrollTop",b(document).scrollTop());b(document).bind("scroll",b.product_dragndrop._scrolHelper);b(".block.drop-target").addClass("drag-active")},handle:".drag-handle",stop:function(){document.ondragstart=
null;document.onselectstart=null;var a=b(this);a.find("input:checked").length||a.removeClass("selected");b(document).unbind("scroll",b.product_dragndrop._scrolHelper);b(".block.drop-target").removeClass("drag-active")},helper:function(){var d=1,c=a.find(".s-select-all");c.is(":checked")?d=c.attr("data-count"):(c=a.find(".product.selected"),c.length?-1!==c.index(this)?d=c.length:(b(this).trigger("select",!0),d=c.length+1):b(this).addClass("selected"));return'<div id="products-helper"><span class="indicator red">'+
d+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},drag:function(b,a){var c=b.originalEvent;a.position.left=c.pageX-20;a.position.top=c.pageY}})},initDropProducts:function(){b("#product-list .product").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(a,c){if(!b.product_dragndrop.trigger("is_product_sortable"))return!1;var d=b(this);if(!c.draggable.hasClass("product"))return!1;d.hasClass("last")?(c.draggable.extDragActivate=function(a){b.product_dragndrop._extDragActivate(a,
d)},b(document).bind("mousemove",c.draggable.extDragActivate)):d.addClass("drag-active")},out:function(a,c){if(!b.product_dragndrop.trigger("is_product_sortable"))return!1;b(this).removeClass("drag-active drag-active-last");c.draggable.extDragActivate&&b(document).unbind("mousemove",c.draggable.extDragActivate)},drop:function(a,c){if(!b.product_dragndrop.trigger("is_product_sortable"))return!1;var d=b(this);if(d.hasClass("selected"))return!1;var e=b("#product-list").find(".product.selected"),g=null;
d.hasClass("drag-active-last")||(g=d.attr("data-product-id"));d.hasClass("last")&&d.hasClass("drag-active-last")?(d.after(e).removeClass("drag-active drag-active-last last"),e.filter(":last").addClass("last")):d.before(e).removeClass("drag-active");d.removeClass("drag-active drag-active-last");c.draggable.extDragActivate&&b(document).unbind("mousemove",c.draggable.extDragActivate);e.trigger("select",!1);d=e.map(function(){return b(this).attr("data-product-id")}).toArray();b.product_dragndrop.trigger("move_product",
{product_ids:d,before_id:g,error:function(b){b&&console&&console.log(typeof b.errors!=="undefined"?b.errors:b)}})}})},initDragCollections:function(){var a=b("#wa-app .sidebar:first"),c=a.position(),d=a.width(),a=a.height();b(".s-collection-list li.dr").liveDraggable({containment:[c.left,c.top,c.left+d+0.25*d,c.top+a],refreshPositions:!0,revert:"invalid",helper:function(){var a=b(this),c=a.parents(".s-collection-list:first").find("ul:first"),a=a.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(c);
a.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>');return a},cursor:"move",cursorAt:{left:5},opacity:0.75,zIndex:9999,distance:5,start:function(){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},initDropCollections:function(){this.initDropBetweenCollections();this.initDropInsideCollections()},initDropBetweenCollections:function(){b(".s-collection-list li.drag-newposition").liveDroppable({greedy:!0,
tolerance:"pointer",over:function(a,c){var d=b(this);if(c.draggable.attr("data-type")!=d.attr("data-type"))return!1;d.addClass("active").parent().parent().addClass("drag-active")},out:function(a,c){var d=b(this);if(c.draggable.attr("data-type")!=d.attr("data-type"))return!1;d.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(a,c){var d=b(this);if(c.draggable.attr("data-type")!=d.attr("data-type"))return!1;(d.is(":animated")||d.hasClass("dragging"))&&d.stop().animate({height:"2px"},
300,null,function(){d.removeClass("dragging")});d.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(a,c){var d=b(this),e=c.draggable,g=e.attr("data-type");if(g!=d.attr("data-type"))return!1;var f=e.attr("id").split("-")[1],h=d.prev("li"),j=e.next(),k=e.prev();if(h.length&&h.attr("id")=="category-"+f&&!h.hasClass("dr-helper")||this==e.next().get(0))return!1;var m=e.parent("ul"),l=m.children("li.dr[id!=category-"+f+"]").length;d.after(j).after(e);l||(m.parent("li").children("i").hide(),
m.hide());h=e.parent().parent();if(h.is("li.dr")||h.is(".s-collection-list"))d=0,h.is(".s-collection-list")||(d=h.attr("id").split("-")[1]||0),h=e.nextAll("li.dr:first"),j=null,h.length&&(j=h.attr("id").split("-")[1]||null),b.product_dragndrop.trigger("move_list",{id:f,type:g,before_id:j,parent_id:d,success:function(){if(!l){m.parent("li").children("i").remove();m.remove()}},error:function(b){b&&console&&console.log(typeof b.errors!=="undefined"?b.errors:b);k.after(e.next()).after(e);if(!l){m.parent("li").children("i").show();
m.show()}}})}})},initDropInsideCollections:function(){b(".s-collection-list li.dr a").liveDroppable({tolerance:"pointer",greedy:!0,out:function(a,c){var d=c.draggable,e=b(this).parent();if(!d.hasClass("product")&&e.attr("data-type")!=d.attr("data-type"))return!1;d.hasClass("product")&&c.helper.find("span").show().end().find("i").hide();e.removeClass("drag-newparent")},over:function(a,c){var d=c.draggable,e=b(this).parent(),g=d.attr("data-type");if(!d.hasClass("product")&&g!=e.attr("data-type"))return!1;
"set"!=g&&e.addClass("drag-newparent");if(d.hasClass("product"))return e.hasClass("dynamic")?c.helper.find("span").hide().end().find("i").show():c.helper.find("span").show().end().find("i").hide(),!1;if(!d.hasClass("dynamic")&&e.hasClass("dynamic"))return c.helper.find("i.no-bw").show(),!1;c.helper.find("i.no-bw").hide();var f='.dr[id!="'+d.attr("id")+'"]',h=b(),d=function(b,a){if(!a.length)return b;b=b.add(a.nextUntil(f).filter("li.drag-newposition"));return 0<a.nextAll(f).length?b:arguments.callee(b,
a.parent().closest("li"))},g=e.prevAll(f+":first");if(0<g.length)var j=g.find(f),h=0<j.length?d(h,j.last()):d(h,g);else h=h.add(e.prevUntil(f).filter("li.drag-newposition"));var h=0<e.children("ul").children(f).length?h.add(e.children("ul").children("li.drag-newposition:first")):d(h,e),k=b(".drag-newposition:animated, .drag-newposition.dragging").not(h);k.stop().animate({height:"2px"},300,null,function(){k.removeClass("dragging")});h.stop().animate({height:"10px"},300,null,function(){h.addClass("dragging")})},
drop:function(a,c){var d=c.draggable,e=b(this).parent(),g=d.attr("data-type");if(!d.hasClass("product")&&("set"==g||e.attr("id")==d.attr("id")||g!=e.attr("data-type")))return!1;e.removeClass("drag-newparent");if(d.hasClass("product")){if(e.hasClass("dynamic"))return!1;var f=b("#product-list"),h={};if(f.find(".s-select-all").is(":checked"))h.whole_list=!0;else{var j=f.find(".product.selected");h.product_ids=j.map(function(){return b(this).attr("data-product-id")}).toArray()}b.product_dragndrop.trigger("add_to_list",
b.extend(h,{collection_param:e.attr("id").replace("-","_id="),success:function(b){h.whole_list?f.find(".s-select-all").trigger("select",!1):h.product_ids&&h.product_ids.length&&j.trigger("select",!1);b.data&&(e.find(".count:first").text(b.data.count),e.trigger("count_subtree"))}}));return!1}if(!d.hasClass("dynamic")&&e.hasClass("dynamic"))return!1;var k=d.attr("id").split("-")[1];if(e.attr("id")=="category-"+k)return!1;if(d.hasClass("product"))return b("#product-list").find(".product.selected").trigger("select",
!1),!1;var m,l=d.next(),i=d.prev();e.hasClass("drag-newposition")?m=e.parent("ul"):e.children("ul").length?m=e.children("ul"):(m=b('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+g+'"></li></ul>').appendTo(e),m.find(".drag-newposition").mouseover(),b('<i class="icon16 darr overhanging collapse-handler unapproved"></i>').insertBefore(e.children("a")));var p=d.parent("ul"),n=p.children("li.dr[id!=category-"+k+"]").length;m.append(d).append(l);n||(p.parent("li").children("i").hide(),
p.hide());e.is("li.dr")&&(m=e.attr("id").split("-")[1]||0,b.product_dragndrop.trigger("move_list",{id:k,type:g,parent_id:m,success:function(){if(!n){p.parent("li").children("i").remove();p.remove()}b(".s-collection-list .unapproved").removeClass("unapproved");e.trigger("count_subtree")},error:function(a){a&&console&&console.log(typeof a.errors!=="undefined"?a.errors:a);i.after(d).after(l);if(!n){p.parent("li").children("i").show();p.show()}b(".s-collection-list .unapproved").remove()}}))}})},_scrolHelper:function(){var a=
b("#products-helper"),c=a.data("scrollTop"),d=b(document).scrollTop();a.css("top",a.position().top+(c?d-c:50)+"px");a.data("scrollTop",d)},_extDragActivate:function(a,c){if(c.hasClass("last")){var d=a.pageX,e=a.pageY,g=c.width(),f=c.height(),h=c.offset();"thumbs"==b.product_dragndrop.options.view?d>h.left+0.5*g?c.removeClass("drag-active").addClass("drag-active-last"):d>h.left&&c.removeClass("drag-active-last").addClass("drag-active"):"table"==b.product_dragndrop.options.view&&(e>h.top+0.5*f?c.removeClass("drag-active").addClass("drag-active-last"):
e>h.top&&c.removeClass("drag-active-last").addClass("drag-active"));(e<h.top||e>h.top+f||d<h.left||d>h.left+g)&&c.removeClass("drag-active drag-active-last")}else c.addClass("drag-active")}}})(jQuery);(function(b){b.storage=new b.store;b.products={hash:"",list_hash:"",list_params:{},options:{view:"thumbs"},random:"",init:function(a){b.extend(this.options,a);this.initRouting();this.initSearch();this.initSidebar();this.initCollapsible()},data:{prev_action:null},initRouting:function(){"undefined"!=typeof b.History&&b.History.bind(function(){b.products.dispatch()});b.wa.errorHandler=function(a){return 403===a.status||404===a.status?(a=b(a.responseText),console.log(a),a=a.find(".dialog-content").length?
b('<div class="block double-padded"></div>').append(a.find(".dialog-content *")):b('<div class="block double-padded"></div>').append(a.find(":not(style)")),b("#s-content").empty().append(a),!1):!0};var a=window.location.hash;"#/"===a||!a?this.dispatch():b.wa.setHash(a)},dispatch:function(a){void 0===a&&(a=window.location.hash);this.hash=a=a.replace(/(^[^#]*#\/*|\/$)/g,"");try{if(a)if(a=a.split("/"),a[0]){for(var c="",d=a.length,e=0;e<a.length;e++){var g=a[e];if(2>e)if(0===e)c=g;else if("product"==
c||"tag"==c||"search"==c||"plugins"==c||"pages"==c||"stocks"==c){d=e;break}else if(parseInt(g,10)!=g&&-1==g.indexOf("="))c+=g.substr(0,1).toUpperCase()+g.substr(1);else{d=e;break}else{d=e;break}}var f=a.slice(d);this.preExecute(c,f);"function"==typeof this[c+"Action"]?(b.shop.trace("$.products.dispatch",[c+"Action",f]),this[c+"Action"].apply(this,f)):b.shop.error("Invalid action name:",c+"Action")}else this.preExecute(),this.defaultAction();else this.preExecute(),this.defaultAction()}catch(h){b.shop.error(h.message,
h)}},load:function(a,c){var d=Math.random();this.random=d;var e=this;b.get(a,function(a){if(e.random==d&&(b("#s-content").removeClass("bordered-left").html(a),b("html, body").animate({scrollTop:0},200),c))try{c.call(this)}catch(f){b.shop.error("$.products.load callback error: "+f.message,f)}})},addOptions:function(a){this.options=b.extend(this.options,a||{})},preExecute:function(a){try{if(this.data.prev_action&&this.data.prev_action!=a){var c=this.data.prev_action+"Termination";b.shop.trace("$.products.preExecute",
[c,a]);"function"==typeof this[c]&&this[c].apply(this,[])}this.data.prev_action=a}catch(d){b.shop.error("preExecute error: "+d.message,d)}},defaultAction:function(){this.productsAction()},buildProductsUrlComponent:function(b){return"view="+(b.view||this.options.view)+(b.category_id?"&category_id="+b.category_id:"")+(b.set_id?"&set_id="+b.set_id:"")+(b.tag?"&tag="+b.tag:"")+(b.sort?"&sort="+b.sort:"")+(b.order?"&order="+b.order:"")+(b.text?"&text="+b.text:"")+(b.edit?"&edit="+b.edit:"")+(b.hash?"&hash="+
b.hash:"")+(b.type_id?"&type_id="+b.type_id:"")},productsAction:function(){var a=Array.prototype.join.call(arguments,"/"),a=b.shop.helper.parseParams(a||"");a.view||(a.view=b.storage.get("shop/products/view")||this.options.view);b.storage.set("shop/products/view",a.view);this.list_hash=this.hash;this.list_params=a;this.load("?module=products&"+this.buildProductsUrlComponent(a))},productAction:function(a,c,d){var e=Array.prototype.slice.call(arguments).filter(function(b){return b.length}).join("/");
b.shop.trace("$.products.productAction",[e,arguments]);var g="?module=product";a&&(g+="&id="+a);"undefined"!=typeof b.product?b.product.dispatch(e):this.load(g,function(){b.product.dispatch(e)})},productTermination:function(){"undefined"!=typeof b.product&&b.product.termination()},reviewsAction:function(){this.load("?module=reviews")},stocksAction:function(b){this.load("?module=stocks"+(b?"&order="+b:""))},servicesAction:function(a){this.load("?module=services"+(a?"&id="+a:""),function(){b("#s-content").addClass("bordered-left")})},
initCollapsible:function(){var a=function(a,e){b(a).removeClass("darr").addClass("rarr");var g=c(a).hide();e||b.storage.set("shop/products/"+a.id+"/collapse",1);g=g.closest("li");"category"==g.attr("data-type")&&g.trigger("count_subtree",!0)},c=function(a){a=b(a).parent();return a.is("li")?a.find("ul:first"):a.next()};b(".collapse-handler").die("click").live("click",function(){if(b(this).hasClass("darr"))a(this);else{b(this).removeClass("rarr").addClass("darr");var d=c(this).show();b.storage.del("shop/products/"+
this.id+"/collapse");d=d.closest("li");"category"==d.attr("data-type")&&d.trigger("count_subtree",!1)}}).each(function(){b.storage.get("shop/products/"+this.id+"/collapse")&&a(this,!0)})},initSearch:function(){var a=function(){var a=this.value,d=b.products.hash.match(/[&\/](text=.*?&|text=.*)/),e=b.products.hash;d?(d=d[1],a?(a="&"==d.substr(-1)?"text="+encodeURIComponent(a)+"&":"text="+encodeURIComponent(a),e=e.replace(d,a)):("&"!=d.substr(-1)&&(d="[&/]"+d),e=e.replace(RegExp(d),""))):e=a?"products/"+
b.products.buildProductsUrlComponent(b.products.list_params)+"&text="+encodeURIComponent(a):"products/"+b.products.buildProductsUrlComponent(b.products.list_params);location.hash="#/"+e};b("#s-products-search").unbind("keydown").bind("keydown",function(c){if(13==c.keyCode)return a.call(this),b(this).autocomplete("close"),!1});b("#s-products-search").unbind("search").bind("search",function(){a.call(this);return!1});b("#s-products-search").autocomplete({source:"?action=autocomplete",minLength:3,delay:300,
select:function(a,d){b.wa.setHash("#/product/"+d.item.id);return!1}})},initSidebar:function(){var a=b("#s-sidebar");b.product_dragndrop.init({collections:!0}).bind("move_list",function(a){if(a.type){var d={id:a.id,type:a.type,parent_id:a.parent_id||0};a.before_id&&(d.before_id=a.before_id);b.products.jsonPost("?module=products&action=moveList",d,a.success,a.error)}else"function"===typeof a.error&&a.error("Unknown list type")});a.off("add",".s-collection-list ul").on("add",".s-collection-list ul",
function(a,d,e){var a=b(this),g=a.parents(".s-collection-list:first");a.prepend(tmpl("template-sidebar-list-item",{type:e,item:d})).show();g.find(".s-empty-list").hide();return!1});a.unbind("update").bind("update",function(a,d){for(var e in d){var g="#"+e+"-",f;for(f in d[e])b(g+f).find(".count:first").text(d[e][f].count)}return!1});b("#s-tag-cloud").unbind("update").bind("update",function(a,d){var e='<ul class="tags"><li class="block align-center">',g;for(g in d)var f=d[g],e=e+('<a href="#/products/tag='+
f.uri_name+'/" style="font-size: '+f.size+"%; opacity: "+f.opacity+'"  data-id="'+f.id+'"  class="s-product-list">'+f.name+"</a>");b("#s-tag-cloud").html(e+"</li></ul>").parents(".block:first").show();return!1});a.off("count_subtree",".s-collection-list li").on("count_subtree",".s-collection-list li",function(a,d){var e=b(this);"undefined"===typeof d&&(d=e.find("i.collapse-handler").hasClass("rarr"));var g=e.find(">.count:not(.subtree)"),f=e.find(">.subtree");f.length||(f=g.clone().addClass("subtree").hide(),
g.after(f));if(d){var h=parseInt(g.text(),10)||0;e.find("li.dr:not(.dynamic)>.count:not(.subtree)").each(function(){h=h+(parseInt(b(this).text(),10)||0)});f.text(h).show();g.hide()}else f.hide(),g.show();return!1})},jsonPost:function(a,c,d,e){b.shop.jsonPost(a,c,d,e)}}})(jQuery);(function(b){b.product={options:{duration:200,container_selector:"#shop-productprofile",message_selector:"#product-save-message",form_selector:"#s-product-save",update_delay:100},message:{submit:'<i class="icon16 loading"></i>',success:'<i class="icon16 yes"></i>',error:'<i class="icon16 no"></i>'},path:{id:null,mode:null,tab:null,tail:null,raw:null,params:{}},ajax:{random:null,target:null,link:null,save:!1,cached:{}},data:{main:{}},getData:function(b,c){return(this.data[b]||{})[c]},setData:function(b,
c,d){this.data[b]=this.data[b]||{};this.data[b][c]=d},changes:{},standalone_tabs:["images","services","pages","reviews"],init:function(b,c){this.setOptions(b,c)},setOptions:function(a,c){c?this[c+"_options"]=b.extend(this[c+"_options"]||{},a||{}):this.options=b.extend(this.options,a||{})},get:function(a){if(this.options[a+"_selector"])return b(this.options[a+"_selector"]);throw new exception("");},parsePath:function(a){var a=a.replace(/^.*#\//,"").replace(/(^\/|\/$)/,""),c=a.split("/"),d=c.pop(),
e={};d.match(/^[\w_\-]+=/)?e=b.shop.helper.parseParams(d):c.push(d);return{id:c[0]||"new",mode:c[1]||"profile",tab:c[1]?c[2]||"main":!1,tail:c.slice(3).join("/")||"",raw:a,params:e}},dispatch:function(a){"string"==typeof a&&(a=this.parsePath(a));var c=[];b.shop.trace("$.product.dispatch",[this.path,a,a.raw]);if(!this.path.id){var d=this.get("container");d.length&&(this.path.id=d.data("product-id"),c.push("load"))}if(this.path.id!=a.id)this.path.id&&c.push("blur"),c.push("load");else{d="undefined";
this.path.mode!=a.mode?(b.shop.trace("$.product.dispatch mode",this.path.mode+"->"+a.mode),this.path.mode&&this.path.tab?(b.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+a.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(this.path.mode+"Tab"+d+"Blur"),c.push(this.path.mode+"TabBlur"),c.push(this.path.mode+"Blur")):c.push("focus"),c.push(a.mode+"Init"),c.push(a.mode+"Focus")):this.path.tab&&a.tab!=this.path.tab&&(b.shop.trace("$.product.dispatch tabBlur",this.path.tab+
"->"+a.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(a.mode+"Tab"+d+"Blur"),c.push(a.mode+"TabBlur"));c.push(a.mode+"Action");var e=this.tabIsLoaded(a);a.tab&&(d=a.tab.substr(0,1).toUpperCase()+a.tab.substr(1));if(a.tab&&a.tab!=this.path.tab)if(b.shop.trace("$.product.dispatch tabFocus",this.path.tab+"->"+a.tab),e)c.push(a.mode+"TabShow"),c.push(a.mode+"TabInit"),c.push(a.mode+"Tab"+d+"Init"),c.push(a.mode+"TabFocus"),c.push(a.mode+"Tab"+d+"Focus");else{c.push(a.mode+
"TabFocus");var g=a.mode+"Tab"+d+"Load";this.isCallable(g)?c.push(g):c.push(a.mode+"TabLoad")}a.tab&&e&&c.push(a.mode+"Tab"+d+"Action")}for(d=0;d<c.length;d++)if(!1===this.call(c[d],[a]))return!1},termination:function(){var b=[];if(this.path.mode&&this.path.tab){var c=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1);b.push(this.path.mode+"Tab"+c+"Blur");b.push(this.path.mode+"TabBlur");b.push(this.path.mode+"Blur")}b.push("blur");for(c=0;c<b.length;c++)this.call(b[c],[])},isCallable:function(b){return"function"==
typeof this[b]},tabIsLoaded:function(a){return b("#s-product-edit-forms .s-product-form."+a.tab).length?!0:!1},call:function(a,c){var d=null,e=this.isCallable(a),c=c||[];b.shop.trace("$.product.call",[a,c,e]);if(e)try{d=this[a].apply(this,c)}catch(g){b.shop.error("Error at method $.product."+a+". Original message: "+g.message,g)}return d},load:function(a){var c=this.get("container");if(!c.length||c.data("product-id")!=a.id){var d=this,c="?module=product&id="+a.id;b.shop.trace("$.product.load product",
c);b.products.load(c,function(){d.dispatch(a)})}this.editTabMainData.sku_id="new"==a.id?-1:0;this.editTabMainData.stocks={}},focus:function(){b("*").off(".product");this.helper.init()},blur:function(){this.path.id=null;this.path.mode=null;this.path.tab=null;this.path.tail=null;b("*").off(".product");b("#mainmenu .s-level2").show();b("#s-product-edit-menu, #s-product-edit-save-panel").hide();b("#s-sidebar, #s-toolbar").show().animate({width:"200px"},"fast").queue(function(){b(this).dequeue()});b("#maincontent").animate({"margin-top":"84px"},
"fast");b("#s-content").animate({"margin-left":"200px"},"fast")},saveData:function(a,c,d){var e=this,g=e.get("form"),f="radio",h=g.find('input[name="product[sku_type]"]:first');h.is(":radio")?(sku_type=g.find('input[name="product[sku_type]"]:checked').val(),h=g.find('input[name="product[sku_type]"]')):(f="hidden",sku_type=h.val());if("1"==sku_type&&!b("#s-product-feature-superposition").find("input:checked:first").length)return"radio"==f&&(h.filter("[value=0]").attr("checked",!0),b.product.onSkuTypeChange(0)),
!1;waEditorUpdateSource({id:"s-product-description-content"});if(e.ajax.save)return setTimeout(function(){e.saveData(a,c,d)},100),!1;if(this.path.tab&&(f="editTab"+this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1)+"Save",!1===this.call(f)))return!1;e.ajax.save=!0;g.find(".s-price").find("input").each(function(){this.value=this.value.replace(/\s+/g,"")});b.shop.trace("$.product.saveData("+a+","+c+")");b(g).find(':input[name^="product["]:not(:disabled)').each(function(){var a=b(this).attr("type");
if(a!="text"&&a!="textarea")return true;this.defaultValue==this.value?b(this).attr("disabled",true).addClass("js-ajax-disabled"):b(this).hasClass("js-ajax-disabled")&&b(this).removeAttr("disabled").removeClass("js-ajax-disabled")});this.refresh("submit");b("#product-tags_tag").trigger(jQuery.Event("keypress",{which:13}));b.ajax({url:b(g).attr("action"),data:b(g).serialize(),dataType:"json",type:"post",success:function(g){if(g.status=="fail")e.refresh("error",g.errors);else if(g.data.redirect){b.shop.trace("$.product.saveData redirect",
g.data.redirect);window.location.href=g.data.redirect}else{e.refresh("success",g.data.message||"");b.shop.trace("$.product.saveData updateData",[a,c]);e.updateData(g.data,a,c);d&&typeof d=="function"&&d();if(e.path.tab){g="editTab"+e.path.tab.substr(0,1).toUpperCase()+e.path.tab.substr(1)+"Saved";if(e.call(g)===false)return false}}e.ajax.save=false},error:function(b,a){e.ajax.save=false;e.refresh("error",a)}});return!1},updateData:function(a,c,d){b.shop.trace("$.product.updateData("+c+","+d+")",a);
var e=b("#s-product-edit-forms .s-product-form.main"),g=this.path.id;if(!this.path.id||"new"==this.path.id){this.path.id=a.id;b(this.options.container_selector).data("product-id",this.path.id);var f="/product/"+this.path.id+"/";if(null!==c&&(c=c||this.path.mode||"profile"))if("profile"!=c&&(f+=c+"/"),null!==d&&(d=d||this.path.tab||""))"main"!=d.toLowerCase()&&(f+=d+"/");b.shop.trace("update location.hash="+f);var h=/#\/product\/new\//,j="#/product/"+this.path.id+"/";b("#shop-productprofile, #s-product-edit-menu, #s-product-edit-forms, #s-product-profile-page").find('[href*="#/product/new/"]').each(function(){b(this).attr("href",
b(this).attr("href").replace(h,j))});b("#s-product-edit-forms").find(':input[name="product[id]"]').val(this.path.id);window.location.hash=f}else this.path.id!=a.id&&b.shop.error("Abnormal product ID change",[this.path.id,a]);c=b("#shop-productprofile h1");c.find(".s-product-name:first").text(a.name);c.find(".s-product-id").show().text("id: "+a.id);document.title=a.name+b.product.options.title_suffix;e.find(':input[name="product[type_id]"]').parents(".value").data("type",a.type_id);c=b("#s-product-frontend-url");
d=b("#s-product-frontend-url-input");c.text(a.url);d.text(a.url);c.trigger("readable");c.parent().attr("href",a.frontend_url);b("#s-product-frontend-links").find("a").attr("href",a.frontend_url).text(a.frontend_url);this.editTabMainUpdate(a.raw||{},a.features_selectable_strings,g);e.find("select.s-product-categories").each(function(){var a=b(this),d=a.parent(),c=a.val();if("select"==c||"---"==c)c=b("#s-product-edit-forms .s-product-form.main select.s-product-categories"),1<c.length?d.remove():d.find(".s-product-delete-from-category").hide();
else if("create"==c){var e=d.find("input.val").val();"0"==e?(c=b("#s-product-edit-forms .s-product-form.main select.s-product-categories"),1<c.length?d.remove():(a.val(e),a.show().attr("disabled",!1),d.find("input.val").attr("disabled",!0),d.find(".s-new-category").hide(),d.find(".s-product-delete-from-category").hide())):(a.val(e),a.show().attr("disabled",!1),d.find("input.val").attr("disabled",!0),d.find(".s-new-category").hide(),d.find(".s-product-delete-from-category").show())}});b("#s-product-save table.s-product-skus > tbody > tr").each(function(){var d=
b(this).data("id");b(this).find("td.s-stock .s-product-stock-icon").each(function(){var c=b(this).data("stock");a.raw&&(a.raw.skus&&a.raw.skus[d]&&a.raw.skus[d].stock_icon[c])&&b(this).html(a.raw.skus[d].stock_icon[c])})});e.find("tr.js-sku-settings").each(function(){var d=b(this),c=d.attr("data-id");if((c=a.raw.skus[c])&&void 0!==c.file_name&&!c.file_name)d.find(".s-sku-attachment").hide(),d.find(".fileupload").show()});this.helper.checkChanges(this.get("form"),!0,a.raw||{});b("#s-product-edit-menu li a i.icon10.status-yellow-tiny").remove();
b("#s-product-edit-save-panel :submit").removeClass("yellow").addClass("green");"0"==a.raw.sku_type&&(e=b("#s-product-feature-superposition"),e.find("input[type=checkbox]").attr("checked",!1),g=e.find("ul.features li"),g.find(".count").text(""),g.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass("status-gray-tiny"),e=e.find(".superposition-count"),e.find(".options").text(""),e.find(".skus").text(""))},refresh:function(a,c){b(this.options.form_selector).find(':input[name^="product["]:disabled.js-ajax-disabled').each(function(){b(this).removeAttr("disabled").removeClass("js-ajax-disabled")});
var d=b(this.options.message_selector);d.removeClass("errormsg successmsg status").empty().show();this.timer&&clearTimeout(this.timer);var e=null;d.append(this.message[a]||"");switch(a){case "submit":d.addClass("status");break;case "error":d.addClass("errormsg");for(e=0;e<c.length;e++)d.append(c[e][0]);e=2E4;break;case "success":c&&d.addClass("successmsg").append(c),e=3E3,b("#s-product-edit-save-panel :submit").removeClass("yellow").addClass("green")}e&&(this.timer=setTimeout(function(){d.removeClass("errormsg successmsg status").empty().show()},
e))},editTabLoad:function(a,c){var d=this,e=b("#s-product-edit-forms .s-product-form."+a.tab);c||!e.length&&"new"==a.id?(b.shop.trace("product.profileTabHandler: create",[a.tab+" \u2014 create",a]),this.saveData(this.path.mode,a.tab,function(){a.tab&&d.call(a)})):this.editTabLoadContent(a)},editTabLoadContent:function(a,c){var d=this,a=a||this.path,e="?module=product&action="+a.tab+"&id="+a.id;a.tail&&"undefined"!=typeof a.tail&&(e+="&param[]="+a.tail.split("/").join("&param[]="));var g=Math.random();
this.ajax.random=g;var f=b("#s-product-edit-forms .s-product-form."+a.tab);f.length&&f.remove();b("#s-product-edit-forms > form").append(tmpl("template-productprofile-tab",{id:a.tab}));f=b("#s-product-edit-forms .s-product-form."+a.tab);this.ajax.target=f;this.ajax.link=b("#s-product-edit-menu li."+a.tab);b.shop.trace("$.product.editTabLoadContent",[a,e,c]);b.ajax({url:e,type:c?"POST":"GET",data:c||{},success:function(c,e){b.shop.trace("$.product.loadTab status="+e);if(d.ajax.random==g){f.empty().append(c);
d.ajax.target=null;d.ajax.link=null;var k="#/product/"+a.id+"/edit/";a.tab&&(k+=a.tab+"/");a.tail&&(k+=a.tail+"/");window.location.hash=k;d.dispatch(a)}}})},editTabInit:function(){b("html, body").animate({scrollTop:0},200);b("#shop-productprofile").find(".s-product-name").removeClass("editable")},editTabFocus:function(a){b("#s-product-edit-menu li."+a.tab).addClass("selected");this.refresh()},editTabBlur:function(a){if(a){var c=this,d=a.tab;-1!==this.standalone_tabs.indexOf(d)&&this.helper.checkChanges(this.get("form"),
!0)&&this.saveData(this.path.mode,d,function(){d&&c.call(a)});b("#s-product-edit-forms .s-product-form").hide();b("#s-product-edit-menu li.selected").removeClass("selected");this.path.tab=null;this.path.tail=null}},editTabShow:function(a){var c=b("#s-product-edit-forms .s-product-form."+a.tab);c.length?(c.show(),b.shop.trace("$.product.showTab",a),this.path.tab=a.tab):b.shop.error("$.product.showTab",a)},editClick:function(a){var c=a.attr("href").replace(/.*#\/product\/(\d+|new)\/edit\//,"").replace(/\/$/,
"").split("/"),d=[],e;if(c.length){b.shop.trace("$.product.editClick",c);for(var g,f="editTab";g=c.shift();)f+=g.substr(0,1).toUpperCase()+g.substr(1),g="function"==typeof this[f],b.shop.trace("$.settings.featuresClick try",[f,g,c]),!0===g&&(e=f,d=c.slice(0))}if(e){if(b.shop.trace("$.product.editClick",[e,d]),!a.hasClass("js-confirm")||confirm(a.attr("title")||"Are you sure?")){d.push(a);try{this[e].apply(this,d)}catch(h){b.shop.error("Error: "+h.message,h)}}}else b.shop.error("Not found js handler for link",
[e,a]);return!1},switchSubMenu:function(a){a=a||"default";b("#mainmenu .s-submenu > *").hide();b("#mainmenu .s-submenu .s-submenu-"+a).show()},profileFocus:function(){var a=this.options.duration,c=this;b("#s-product-edit-menu, #s-product-edit-save-panel").hide();c.switchSubMenu();b("#s-sidebar, #s-toolbar").show().animate({width:"200px"},a).queue(function(){b(this).dequeue();b("#s-product-edit-forms").hide();b("#s-product-profile-page, h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").show();
c.get("container").find(".back").attr("href","#/"+b.products.list_hash)});b("#maincontent").animate({"margin-top":"84px"},a);b("#s-content").animate({"margin-left":"200px"},a)},profileAction:function(){this.path.mode="profile"},disableSkus:function(a,c){var d=b(this.options.form_selector).find(".s-product-skus");a?c?d.find(".s-sku-virtual").hide().find("input").attr("disabled",!0):d.find(".s-sku-virtual").show().find("input").attr("disabled",!1):(c?d.hide():d.show(),d.find("input").attr("disabled",
c))},onSkuTypeChange:function(a){var c=b("#s-product-feature-superposition"),d=b(this.options.form_selector).find(".s-product-skus tbody");"1"==a?(c.show(),c.find("input").attr("disabled",!1),"new"==b.product.path.id?b.product.disableSkus(!1,!0):b.product.disableSkus(!0,!1)):(c.hide(),c.find("input").attr("disabled",!0),"new"==b.product.path.id?b.product.disableSkus(!1,!1):(b.product.disableSkus(!0,!0),d.find("tr:not(.s-sku-virtual)").length||(b.product.editTabMainSkuAdd(),d.find("tr:not(.s-sku-virtual):first").find('input[name="product[sku_id]"]').attr("checked",
!0))))},featureSelectableInit:function(){var a=b(this.options.form_selector),c=b("#s-product-feature-superposition"),d=a.find(".s-product-skus");a.on("change",'input[name="product[sku_type]"]',function(){b.product.onSkuTypeChange(this.value)});c.on("click","ul.features>li",function(){var a=b(this);a.parent().find("li.selected").removeClass("selected");a.addClass("selected");a=a.attr("data-feature-id");a=c.find(".feature-values[data-feature-id="+a+"]");c.find(".feature-values").hide();a.show();return!1});
c.on("change","ul.values>li input",function(){var a=b(this).parents("li:first").parent().find(">li input:checked").length,d=c.find("ul.features li.selected");d.find(".count").text(a||"");d.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass(a?"status-blue-tiny":"status-gray-tiny");var f=[];c.find("ul.features>li").each(function(){var a=b(this);(a=parseInt(a.find(".count").text(),10))&&f.push(a)});a=c.find(".superposition-count");if(f.length){a.find(".options").text(f.join(" x ")+" "+
$_("options"));for(var d=1,h=0,j=f.length;h<j;h+=1)d*=f[h];a.find(".skus").html('<span class="highlighted">'+$_("%d SKUs in total").replace("%d",d)+"</span>")}else a.find(".options").text(""),a.find(".skus").html("")});d.on("change","input, textarea",function(){var a=b(this);if("product[sku_id]"!=a.attr("name")&&(a=a.parents("tr:first"),a.length)){var c=parseInt(a.attr("data-id"),10);if(c){if(a.hasClass("js-sku-settings")&&(a=d.find("tr[data-id="+c+"]:first"),!a.length))return;a.find("input.s-input-virtual").val(0);
a.removeClass("s-sku-virtual");b("#s-product-view").find("tr[data-id="+c+"]").removeClass("s-sku-virtual")}}})},editInit:function(){if(!this.options.edit_rights)return location.hash="#/product/"+this.path.id+"/",!1;var a=b(this.options.form_selector);a.bind("submit.product",function(){return b.product.saveData("profile",null)});a.on("change.product, keyup.product","div.s-product-form:not(.ajax) :input",function(){b.product.helper.onChange(b(this).parents("div.s-product-form"))});a.on("change.product, keyup.product, keypress.product",
':input[name="product[name]"]',function(){b.product.helper.onNameChange(b(this),!1,b.product.options.update_delay||500)});var c=b("#product-tags");c.data("tags_input_init")||c.tagsInput({autocomplete_url:"?module=product&action=tagsAutocomplete",height:120,defaultText:""}).data("tags_input_init",!0);a.on("change.product",".s-product-currency",function(){var d=b(this).val();a.find(".s-product-currency").val(d);a.find(".s-product-currency-readonly").text(d);b("#s-product-currency-code").val(d)});a.on("change.product",
':input[name="product[type_id]"]',function(){return b.product.editTabMainTypeChange(b(this))});a.on("change",'select[name="product[status]"]',function(){"1"==b(this).val()?(b(this).prev().removeClass("no-bw").addClass("yes"),b(".s-product-status-text").hide()):(b(this).prev().removeClass("yes").addClass("no-bw"),b(".s-product-status-text").show())});this.featureSelectableInit()},editFocus:function(){var a=this.options.duration,c=this;b("h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").hide();
b("#s-sidebar, #s-toolbar").animate({width:0},a).queue(function(){b(this).hide();b(this).dequeue();b("#s-product-edit-menu, #s-product-edit-forms, #s-product-edit-save-panel").show();"new"!=c.path.id?c.get("container").find(".back").attr("href","#/product/"+c.path.id+"/"):c.get("container").find(".back").attr("href","#/"+b.products.list_hash);b("#s-product-profile-page").hide();c.switchSubMenu("productprofile")});b("#maincontent").animate({"margin-top":"40px"},a);b("#s-content").animate({"margin-left":0},
a);b("#s-product-edit-forms").on("click.edit-product","a.js-action",function(){return c.editClick(b(this))})},editBlur:function(){this.path.tab=!1;this.path.mode=!1;b(b.product.options.form_selector).off("submit.product");b(this.options.form_selector).off("change.product, keyup.product");b("#s-product-edit-forms").off("click.edit-product")},editAction:function(b){this.path.mode=b.mode},editTabMainData:{sku_id:-1,stocks:{}},editTabMainInit:function(a){b("#s-product-type").each(function(){b(this).parent().get(0)!=
document.body&&(b("body > #s-product-type").remove(),b(document.body).append(b(this)))});var c=b("#s-product-edit-forms .s-product-form.main"),d=this,e=c.find("table.s-product-skus:last > tbody");e.sortable({distance:5,helper:"original",items:"> tr",handle:"i.sort",opacity:0.75,tolerance:"pointer",update:function(a,c){var g=parseInt(b(c.item).data("id"),10),k=b(c.item).prev().data("id"),k=void 0===k?0:parseInt(k,10);d.editTabMainSkuSort(g,k,b(this));k=e.find('> tr.js-sku-settings[data-id="'+g+'"]');
k.length&&(k=k.detach(),b.shop.trace("detach",k),k&&(b.shop.trace("detach",e.find('> tr[data-id="'+g+'"]').length),e.find('> tr[data-id="'+g+'"]:first').after(k)))},start:function(){e.find("> tr.js-sku-settings").hide()},stop:function(){e.find("> tr.js-sku-settings").show()}});var g=b("#s-product-frontend-url");g.inlineEditable({editLink:"#s-product-frontend-url-edit-link",editOnItself:!1,minSize:{height:15,width:100},makeReadableBy:[],beforeMakeEditable:function(a){var d=b(this).parents("div:first"),
c=d.find("span.slash"),e=d.find("i.new-window");b(a).after(c);e.hide();d.find("span.s-frontend-base-url").html(d.find("a.s-frontend-base-url").hide().contents()).show()},beforeBackReadable:function(){var a=b(this),d=a.parents("div:first"),c=d.find("span.slash"),e=d.find("i.new-window");a.after(c);e.show();d.find("a.s-frontend-base-url").html(d.find("span.s-frontend-base-url").hide().contents()).show()}});parseInt(a.id,10)||g.trigger("editable");c.off("change.product","select.s-product-categories").on("change.product",
"select.s-product-categories",function(){var a=b(this),d=a.val(),c=a.parent(),e=c.find(".s-product-delete-from-category");parseInt(d,10)?e.show():e.hide();"create"==d?(c.find(".s-new-category").show(),c.find("input.val").attr("disabled",!1),a.hide().attr("disabled",!0).addClass("js-ignore-change")):c.find("input.val").val(parseInt(d,10)||0)});c.off("keydown.product","input.new-category").on("keydown.product","input.new-category",function(a){if(13==a.keyCode)return b(this).parent().find("input[type=button]").click(),
!1});c.off("click.product",".s-new-category input[type=button]").on("click.product",".s-new-category input[type=button]",function(){var a=b(this).parent(),d=a.parent(),c=a.find("input[name=new_category]"),e=c.val();b.shop.jsonPost("?module=products&action=saveListSettings&category_id=0&parent_id=0",{name:e},function(e){var g=d.find("select"),k=g.find("option.separator:first").show();b.when(k.after('<option class="category" value="'+e.data.id+'">'+e.data.name+"</option>")).then(function(){g.find("option:first").text($_("Please select a category"));
g.val(e.data.id).attr("disabled",!1).show().removeClass("js-ignore-change");a.find("input.val").val(e.data.id).attr("disabled",!0);a.hide();d.find(".s-product-delete-from-category").show();c.val("");b.product.helper.onTabChanged("main",!0);b("#s-product-save-button").removeClass("green").addClass("yellow");b("#s-category-list>ul").trigger("add",[e.data,"category"])})})});c.off("click.product",".s-product-delete-from-category").on("click.product",".s-product-delete-from-category",function(){var a=
b(this).parent(),d=a.find("select");1<b("#s-product-edit-forms .s-product-form.main select.s-product-categories").length?(d.attr("disabled",!0),a.remove()):(d.val("selected").attr("disabled",!1),a.find("input.val").val(0).attr("disabled",!0).parent().hide(),a.find(".s-product-delete-from-category").hide());return!1})},editTabMainAction:function(a){var c=!1,d=null;a&&a.params&&a.params.focus?(d=a.params.name||"",!d.length&&a.params.sku&&(d="product[skus]["+parseInt(a.params.sku,10)+"]",a.params.focus&&
(d+="["+a.params.focus+"]"),"stock"==a.params.focus&&(d+="["+(parseInt(a.params.stock,10)||0)+"]")),c=':input[name$="'+d.replace(/(\[|\]|\|\-)/g,"\\$1")+'"]:first'):a&&"new"==a.id&&(c=':input[name$="[name]"]:first');c&&(b.shop.trace("$.product.editTabMainFocus",[d,b(c).length]),setTimeout(function(){b(c).focus();window.location.hash="#/product/"+a.raw.replace(/\/focus=.*$/,"/")},100))},editTabMainBlur:function(){},editTabMainSave:function(){if(!1===this.call("editTabMainSkuEproductSave"))return!1},
helper:{options:{tab_changed:'<i class="icon10 status-yellow-tiny"></i>'},data:{url_helper:{url:"",name:"",timer:null}},init:function(){this.data.url_helper={url:"",name:"",timer:null}},onTabChanged:function(a,c){b.shop.trace("$.product.onChange id="+a+" changed="+c);b("#s-product-edit-menu li."+a+" .s-product-edit-tab-status").html(c?this.options.tab_changed:"")},type:function(a){return parseInt(a,10)||parseInt(b('#s-product-edit-forms .s-product-form.main :input[name="product[type_id]"]').val(),
10)||0},onNameChange:function(a,c,d){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var e=b(b.product.options.form_selector).find(':input[name="product[url]"]'),g=e.parent();if(b.product.path.id&&"new"!=b.product.path.id||e.val()!=this.data.url_helper.url)b.shop.trace("$.product.onNameChange stop "+this.data.url_helper.url+" != "+e.val()),b(b.product.options.form_selector).off(".product",':input[name="product[name]"]'),g.find(".js-url-helper").hide();else{c&&(g.find(".js-url-helper").length?
g.find(".js-url-helper").show():g.append('<i class="icon16 loading js-url-helper"></i>'));var f=this;this.data.url_helper.timer=setTimeout(function(){f.urlHelper(a,e,d)},d||500)}},onChange:function(a){var c=this.checkChanges(a.parents("form"),!1),d=this.getContainerId(a);b.shop.trace("$.product.onChange changed="+c);b("#s-product-edit-save-panel :submit").removeClass(c?"green":"yellow").addClass(c?"yellow":"green");c&&(c=this.checkChanges(a,!1));this.onTabChanged(d,c)},urlHelper:function(a,c){this.data.url_helper.timer&&
clearTimeout(this.data.url_helper.timer);var d={str:b(a).val()};b.shop.trace("$.product.urlHelper ",d);if(d.url!=this.data.url_helper.name){var e=this;this.data.url_helper.url=d.url;b.ajax({url:"?action=transliterate",data:d}).done(function(a){if((a=b.parseJSON(a))&&"ok"==a.status)e.data.url_helper.url=a.data,c.val(a.data),c.parent().find(".js-url-helper").hide()})}else c.parent().find(".js-url-helper").hide()},getValueByName:function(a,c){for(var d=a,e=c.replace(/\]/,"").split("[");e.shift();)if(void 0!==
d[c])d=d[c];else{d="";break}b.shop.trace("$.product.helper.getValueByName",[d,c,a]);return d},checkChanges:function(a,c){var d=!1,e=this,g=":input:not(.js-ignore-change)";if(a.hasClass("s-product-form")){if(a.hasClass("ajax"))return!1}else g=".s-product-form:not(.ajax) "+g;a.find(g).each(function(){var a=(b(this).attr("type")||this.tagName).toLowerCase();switch(a){case "input":case "text":case "textarea":this.defaultValue!=this.value&&(d=!0,c&&(this.defaultValue=this.value,e.updateInput(this.name,
this.value,"textarea"==a)));break;case "radio":case "checkbox":this.defaultChecked!=this.checked&&(d=!0,c&&(this.defaultChecked=this.checked));break;case "select":this.length&&b(this).find("option").each(function(){this.defaultSelected!=this.selected&&(d=!0,c&&(this.defaultSelected=this.selected));return c||!d});break;case "file":this.value&&(d=!0,c&&(this.value=null));break;case "reset":case "button":case "submit":break;case "hidden":break;default:b.shop.error("$.product.checkChanges unsupported type "+
a,[a,this])}!c&&d&&b.shop.trace("$.product.helper.checkChanges",[this,d]);return c||!d});return d},getContainerId:function(a){var a=(b(a).attr("class")||"").split(" "),c=!1,d;for(d in a)if("s-product-form"!=a[d]){c=a[d];break}return c},updateInput:function(a,c,d,e){if(a){var g=".s-"+a.replace(/\[(.+?)\]/g,"-$1")+"-input";b.shop.trace("update field: "+a+" "+g+" value="+c);d?b(g).html(c):b(g).text(c);e&&(a=b(g).attr("name"),a=a.replaceAll(/\[-[\d]+\]/,"["+e+"]"),b.shop.trace("$.product.helper.updateInput name",
[a]))}},count:function(b){var c=0,d;for(d in b)b.hasOwnProperty(d)&&c++;return c},loadScript:function(a){var c=a.replace(/^.*\//,""),d=10;b.product.ajax.cached[c]||b.ajax({url:wa_url+a,dataType:"script",cache:!0,complete:function(e,g){"success"==g?(b.product.ajax.cached[c]=!0,b.shop.trace("$.product.helper.loadScript loaded",[c,a])):(b.shop.trace("$.product.helper.loadScript error",[g,c]),d-=1,0<d&&setTimeout(function(){b.product.helper.loadScript(a)},200))}})}},multiSkus:function(a){var c=b("#s-product-edit-forms .s-product-form.main table.s-product-skus:first");
1<a?(c.find("thead tr").show(),c.find(".s-name,.s-sku-sort").show("slow"),2==a?c.find("> tbody:first > tr:first .s-name :input").focus():c.find("> tbody:first > tr:last .s-name :input").focus()):(c.find("thead tr").hide(),c.find(".s-name,.s-sku-sort").hide())},editTabMainSkuAdd:function(){try{var a=b("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),c=0;a.find(':input[name$="[price]"]').each(function(){c=Math.max(c,parseFloat(b(this).val())||0)});var d=0;
a.find(':input[name$="[purchase_price]"]').each(function(){d=Math.max(d,parseFloat(b(this).val())||0)});b.product.multiSkus(a.find("tr:not(.js-sku-settings)").length+1);var e={id:--b.product.editTabMainData.sku_id,sku:"",available:1,name:"",price:""+c,purchase_price:""+d,stock_icon:{"0":"<i class='icon10 status-green' ></i>"},stock:{},count:null};b.shop.trace("$.product.editTabMainSkuAdd",[b.product.editTabMainData.sku_id,e]);a.append(tmpl("template-sku-edit",{sku_id:b.product.editTabMainData.sku_id,
sku:e,stocks:this.getData("main","stocks")}));a.find(".s-product-currency").trigger("change")}catch(g){b.shop.error(g.message,g)}return!1},editTabMainSkuSort:function(a,c,d){try{b.post("?module=product&action=skuSort",{product_id:this.path.id,sku_id:a,after_id:c},function(a){b.shop.trace("$.product.editTabMainSkuSort result",a);a.error&&(b.shop.error("Error occurred while sorting product SKUs","error"),d.sortable("cancel"))},function(a){b.shop.trace("$.product.editTabMainSkuSort cancel",{data:a});
d.sortable("cancel");b.shop.error("Error occurred while sorting product SKUs","error")})}catch(e){b.shop.error(e.message,e)}return!1},editTabMainSkuDelete:function(a,c){var d=b("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),e=c.parents("tbody").find('> tr[data-id="'+a+'"]'),g=this;0<a?1<c.parents("tbody").find('tr[data-id]:not(.js-sku-settings):not([data-id^="-"])').length?b.ajax({url:"?module=product&action=skuDelete",data:{sku_id:a,product_id:this.path.id},
dataType:"json",type:"post",success:function(c){"fail"==c.status?g.refresh("error",c.errors):c.data.redirect?window.location.href=c.data.redirect:(g.refresh("success",c.data.message||"Success"),e.hide("normal",function(){e.remove();b('#s-product-view table.s-product-skus > tbody > tr[data-id="'+a+'"]').remove();b.product.multiSkus(d.find("tr:not(.js-sku-settings)").length)}),b("#s-product-edit-forms .s-product-form.main").find("input[name=product\\[sku_id\\]][value="+c.data.sku_id+"]").attr("checked",
!0))},error:function(b,a){g.refresh("error",a)}}):g.refresh("error",$_("At least one SKU per product must exists")):e.hide("normal",function(){e.remove();b('#s-product-view table.s-product-skus > tbody >tr[data-id="'+a+'"]').remove();b.product.multiSkus(d.find("tr:not(.js-sku-settings)").length)})},editTabMainCategoriesAdd:function(){var a=b("#s-product-edit-forms .s-product-form.main select.s-product-categories:last").parent(),c=a.clone(!1);c.find("select").val("select").attr("disabled",!1).show();
c.find("input.val").val(0).attr("disabled",!0).parent().hide();c.find(".s-product-delete-from-category").hide();a.after(c)},editTabMainSkuStock:function(a){var c=b("#s-product-sku-"+a);c.hide().find(":input:enabled").attr("disabled",!0);a=b("#s-product-sku-stock-"+a);a.show().find(":input:disabled").removeAttr("disabled");a.find(":input:first").val(c.find(":input:first").val())},editTabMainSkuSettings:function(a,c){c.hide();var d=c.parents("tr"),e=d.data(),g=this;b.when(d.after(tmpl("template-sku-settings",
{sku_id:a,sku:e}))).done(function(){var c;c="?module=product&action=skuSettings&product_id="+g.path.id;c+="&sku_id="+a;var e=b('#s-product-edit-forms .s-product-form.main tr.js-sku-settings[data-id="'+a+'"] > td:first');e.load(c,function(){d.find(':input[name$="[available]"]').remove();if(0<a){b.shop.trace("fileupload",[e.find(".fileupload").length,typeof e.find(".fileupload").fileupload]);try{var c=document.cookie.match(/(?:^|; )_csrf=([^;]*)/),g=c?decodeURIComponent(c[1]):"";e.find(".fileupload:first").fileupload({dropZone:null,
url:"?module=product&action=skuEproductUpload",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,start:function(){e.find(".fileupload:first").hide()},progress:function(a,d){b.shop.trace("fileupload progress",d);var c=e.find(".js-progressbar-container");c.show();c.find(".progressbar-inner:first").css("width",Math.round(100*d.loaded/d.total,0)+"%")},done:function(a,c){b.shop.trace("fileupload done",[c.result,typeof c.result]);var g=(c.result.files||[]).shift();e.find(".js-progressbar-container").hide();if(!g||
g.error)e.find(".error-message").text(g.error).show(),e.find(".fileupload:first").addClass("error").show();else{var f=e.find(".s-sku-attachment");f.find("input.s-input-file-name").val(g.name);f.find(".s-file-name").text(g.name);f.find(".s-file-size").text(g.size);f.find(".s-file-description").val("");f.find("input[type=checkbox]").attr("checked",!0);f.show();d.find("input.s-input-virtual").val(0)}},fail:function(a,d){b.shop.trace("fileupload fail",[d.textStatus,d.errorThrown]);e.find(".error-message").text("error").show().text(d.errorThrown||
"error");e.find(".js-progressbar-container").hide();e.find(".fileupload:first").addClass("error").show()},formData:{product_id:b.product.path.id,sku_id:a,_csrf:g}})}catch(f){b.shop.error("Exception "+f.message,f)}}})})},editTabMainSkuImageSelect:function(a,c,d){var a=d.parents("li:first"),e=a.hasClass("selected");d.parents("ul").find("li.selected").removeClass("selected");e?d.parents("div.value").find('input[name$="[image_id]"]').val(0):(a.addClass("selected"),d.parents("div.value").find('input[name$="[image_id]"]').val(c));
b.shop.trace("$.product.editTabMainSkuImageSelect",[d.parents("div.value"),d.parents("div.value").find(':input[name$="[image_id]"]')]);b.product.helper.onChange(d.parents("div.s-product-form"))},editTabMainSkuEproductSave:function(a){a=b("#s-product-edit-forms .s-product-form.main tr.js-sku-settings"+(a&&0<a?'[data-id="'+a+'"]':"")+" > td:first .fileupload");b.shop.trace("$.product.editTabMainSkuEproductSave",a.length);a.length&&a.fileupload("start")},editTabMainSkuEproductDelete:function(){},editTabMainLinkEdit:function(){return!1},
editTabMainTypeSelect:function(b){var c=b.parents("form").find(':input[name="product[type_id]"]').parents(".value");"main"==this.path.tab?b.hide():(c.find(".js-action").hide(),window.location.hash="/product/"+this.path.id+"/"+this.path.mode+"/");c.find(".js-type-name").hide();c.find(":input").show().focus();setTimeout(function(){c.find(":input").focus()},100)},editTabMainTypeChange:function(a){var c=a.parents(".value"),d=a.find(":selected:first"),e=d.val();b.shop.trace("debug",a);e!=c.data("type")?
(c.find(".js-type-icon").html(d.data("icon")),c.find(".js-type-name").html(d.text()),b("#s-product-edit-forms .s-product-form.features").length&&"undefined"!=typeof this.editTabFeaturesReload?this.editTabFeaturesReload(e):(a=b("#s-product-edit-menu > li.features > a"),a.attr("href",a.attr("href").replace(/\/features\/.*$/,"/features/"+e+"/")))):(a=b("#s-product-edit-menu > li.features > a"),a.attr("href",a.attr("href").replace(/\/features\/.*$/,"/features/")));e=b(this.options.form_selector);a=e.find('input[name="product[sku_type]"]:first');
sku_type=a.is(":radio")?e.find('input[name="product[sku_type]"]:checked').val():a.val();var e=b("#s-sku-type-field-group"),g=e.find(".s-base-price-selectable-currency").contents();e.load("?module=product&action=featuresSelectable&id="+b.product.path.id+"&type_id="+d.val()+"&sku_type="+sku_type,function(){b("#s-sku-type-field-group").find(".s-base-price-selectable-currency").append(g);b.product.featureSelectableInit()})},editTabMainUpdate:function(a,c,d){var e=b("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody"),
g=b("#s-product-view table.s-product-skus tbody");e.find('tr[data-id^="-"]').remove();g.find('tr[data-id^="-"]').remove();e.parents("table").find("tr:hidden").show();var f=[],h;for(h in a.skus||{})f.push(b.extend({id:h},a.skus[h]));f=f.sort(function(b,a){return b.sort-a.sort});h="";for(var j=0,k=f.length;j<k;j+=1)h+=tmpl("template-sku-edit",{sku_id:f[j].id,sku:f[j],stocks:this.getData("main","stocks"),checked:f[j].id==a.sku_id});e.html(h);e.find("select.s-product-currency").val(a.currency);e.parent().show();
this.multiSkus(e.find("tr:not(.js-sku-settings)").length);h="";j=0;for(k=f.length;j<k;j+=1)h+=tmpl("template-sku",{sku_id:f[j].id,sku:f[j],stocks:this.getData("main","stocks")});g.html(h);if(!d||"new"==d)d=b("#s-sku-type-field-group .s-sku-type-field-value"),e.parents("div.field:first").append(d);c&&(e=b("#s-product-feature-superposition .superposition-count"),e.find(".options").text(c.options),e.find(".skus").html('<span class="highlighted">'+c.skus+"</span>"));var m=/#\/product\/new\//,l="#/product/"+
a.id+"/";b("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody, #s-product-view table.s-product-skus tbody").find('[href*="#/product/new/"]').each(function(){b(this).attr("href",b(this).attr("href").replace(m,l))})},editTabDescriptionsInit:function(){var a=[];a.push("wa-content/js/elrte/elrte.min.js");a.push("wa-content/js/elrte/elrte-wa.js");"en"!=wa_lang&&a.push("wa-content/js/elrte/i18n/elrte."+wa_lang+".js");for(var c=0;c<a.length;c++)b.product.helper.loadScript(a[c])},editTabPagesInit:function(){var a=
[];a.push("wa-content/js/elrte/elrte.min.js");a.push("wa-content/js/elrte/elrte-wa.js");"en"!=wa_lang&&a.push("wa-content/js/elrte/i18n/elrte."+wa_lang+".js");for(var c=0;c<a.length;c++)b.product.helper.loadScript(a[c])},editTabDescriptionsBlur:function(){waEditorUpdateSource({id:"s-product-description-content"})},editTabDescriptionsAction:function(){var a=10;(function d(){try{if(b.product.ajax.cached["elrte-wa.js"]&&b.product.ajax.cached["elrte.min.js"]){var e=b("#s-product-description-content");
b("#s-product-description").html(tmpl("template-product-description",{description:e.val()}));e.remove();waEditorInit({id:"s-product-description-content",prefix:"s-product-description-",upload_url:"",lang:wa_lang,save_button:"s-product-save-button",change_callback:function(){if("descriptions"==b.product.path.tab)b.product.helper.onTabChanged(b.product.path.tab,!0)}})}else a-=1,0<a&&(b.shop.trace("$.product.editTabDescriptionsAction wait while js are loading",b.product.ajax),setTimeout(function(){d()},
500))}catch(g){console.error(g.message),console.dir(g.trace)}})()},profileInit:function(){wa_editor&&(wa_editor=void 0);if(this.options.edit_rights){var a=b("#shop-productprofile").find(".s-product-name");parseInt(this.path.id,10)?a.addClass("editable"):a.removeClass("editable");a.inlineEditable({minSize:{width:150},maxSize:{width:550},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){b("#s-edit-product").hide()},afterBackReadable:function(a,c){b("#s-edit-product").show();if(!c.changed)return!1;
b.shop.jsonPost("?module=product&action=save&id="+b.product.path.id,{update:{name:b(a).val()}},function(){document.title=b(a).val()+b.product.options.title_suffix})},hold:function(){return!b(this).hasClass("editable")}})}var c=this;setTimeout(function(){c.call("profileLazyInit",[])},2E3)},profileLazyInit:function(){b("#product-sales-plot").empty();b("#product-sku-plot").empty();sales_plot_data&&sales_plot_data.length?b.jqplot("product-sales-plot",sales_plot_data,{seriesColors:"#3b7dc0 #129d0e #a38717 #ac3562 #1ba17a #87469f #6b6b6b #686190 #b2b000 #00b1ab #76b300".split(" "),
grid:{borderWidth:0,shadow:!1,background:"#ffffff",gridLineColor:"#eeeeee"},series:[{color:"#129d0e",yaxis:"y2axis",shadow:!1,lineWidth:3,fill:!0,fillAlpha:0.1,fillAndStroke:!0,markerOptions:{show:!1},rendererOptions:{highlightMouseOver:!1}}],axes:{y2axis:{min:0,tickOptions:{markSize:0}},xaxis:{pad:1,showTicks:!1}},highlighter:{lineWidthAdjust:12.5}}):b("#product-sales-plot").remove();sku_plot_data&&sku_plot_data.length?b.jqplot("product-sku-plot",sku_plot_data,{seriesColors:"#0077CC #33BB11 #EE5500 #EEBB11 #44DDDD #6b6b6b #686190 #b2b000 #00b1ab #76b300".split(" "),
grid:{borderWidth:0,background:"#ffffff",shadow:!1},legend:{show:!0,location:"s"},seriesDefaults:{shadow:!1,renderer:b.jqplot.PieRenderer,rendererOptions:{padding:0,sliceMargin:1,showDataLabels:!1}}}):b("#product-sku-plot").remove()}}})(jQuery);(function(b){b.fn.rateWidget=function(a,c,d){function e(a){var d=0;this.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(d==a)return!1;d++;b(this).removeClass("star-empty").addClass("star")});this.attr("data-rate",a)}function g(b){return function(){return b}}var f,h=this;if(this&&this.length){if("string"==typeof a){if("getOption"==a&&"rate"==c)return parseInt(this.attr("data-rate"),10);if("setOption"==a&&("rate"==c&&(e.call(this,parseInt(d,10)),c={rate:d}),"object"===
typeof c&&c))f=this.data("rateWidgetSettings")||{},b.extend(f,c),"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(f.hold=g(f.hold));return this}this.data("rateWidgetSettings",b.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0},a||{}));if(!this.data("inited")){f=this.data("rateWidgetSettings");"function"!==typeof f.hold&&(f.hold=g(f.hold));h.attr("id")||h.attr("id",(""+Math.random()).substr(2));null!==f.rate&&h.attr("data-rate",f.rate);h.find("i:lt("+h.attr("data-rate")+
")").removeClass("star-empty").addClass("star");h.mouseover(function(a){if(!f.hold.call(h)){a=a.target;if(a.tagName=="I"){a=b(a);a.prevAll().removeClass("star star-empty").addClass("star-hover").end().removeClass("star star-empty").addClass("star-hover");a.nextAll().removeClass("star star-hover").addClass("star-empty")}}}).mouseleave(function(){f.hold.call(h)||e.call(h,h.attr("data-rate"))});h.click(function(a){if(!f.hold.call(h)){for(var d=a.target;d.tagName!="I";)if(d==this)return;var c=h.attr("data-rate"),
e=0;h.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){e++;b(this).removeClass("star-empty").addClass("star");if(this==d){if(c!=e){h.attr("data-rate",e);f.onUpdate(e)}return false}});return false}});if(f.withClearAction){var a="clear-"+b(this).attr("id"),j=b("#"+a);j.length||(h.after('<a href="javascript:void(0);" class="inline-link rate-clear" id="'+a+'" style="display:none;"><b><i>'+$_("clear")+"</b></i></a>"),j=b("#"+a));j.click(function(){if(!f.hold.call(h)){var b=
h.attr("data-rate");e.call(h,0);if(b!==0)f.onUpdate(0)}});var k;h.parent().mousemove(function(){if(!f.hold.call(h)){k&&clearTimeout(k);j.show(0)}}).mouseleave(function(){k=setTimeout(function(){f.hold.call(h)||j.hide(0)},150)})}this.unbind("clear").bind("clear",function(){e.call(h,0)});this.data("inited",!0);return this}}}})(jQuery);(function(b){b.product_reviews={container:null,sidebar_counter:null,statuses:{},form:null,hotkeys:{"alt+enter":{ctrl:!1,alt:!0,shift:!1,key:13},"ctrl+enter":{ctrl:!0,alt:!1,shift:!1,key:13},"ctrl+s":{ctrl:!0,alt:!1,shift:!1,key:17}},options:{},init:function(a){this.options=a;this.statuses=a.statuses;a.product_id&&(this.product_id=a.product_id);this.form=b("#s-review-add-form");this.sidebar_counter=b("#s-all-reviews").find(".count");a.container&&(this.container="object"===typeof a.container?a.container:
b(a.container),this.container.find(".s-reviews").off("click",".s-review-reply, .s-review-delete, .s-review-restore").on("click",".s-review-reply, .s-review-delete, .s-review-restore",function(){var d=b(this),c=d.parents("li:first"),c=parseInt(c.attr("data-id"),10)||0;if(d.hasClass("s-review-reply")){if(b.product_reviews.options.reply=="ignore")return;b.product_reviews.prepareAddingForm.call(d,b.product_reviews.form,c)}else d.hasClass("s-review-delete")?b.product_reviews.deleteReview(c,a.afterDelete):
d.hasClass("s-review-restore")&&b.product_reviews.restoreReview(c,a.afterRestore);return false}));this.product_id&&this.container.addClass("ajax");var c=function(){b.product_reviews.addReview("backend",a.afterAdd)};this.addHotkeyHandler("textarea","ctrl+enter",c);this.form.find("input.save").unbind("click").bind("click",c);this.initView();this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);b.product&&(b.product.editTabReviewsAction=function(a){a.tail&&setTimeout(function(){b.product_reviews.activeReplyToForm(a.tail)},
200)})},activeReplyToForm:function(a){var c=this.container.find(".s-reviews li[data-id="+a+"]");if(c.length){var d=c.find(".s-review-reply:first");this.prepareAddingForm.call(d,this.form,a);b(document).scrollTop(c.offset().top)}},initView:function(){if("reviews"==b.products.hash.substr(0,7)){var a=b("#s-sidebar");a.find("li.selected").removeClass("selected");a.find("#s-all-reviews").addClass("selected")}},initLazyLoad:function(a){var c=a.count,d=a.total_count,e=a.url||"?module=reviews",g=b(a.target||
".s-reviews:first ul:first");b(window).lazyLoad("stop");c<d&&(b(window).lazyLoad({container:g,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();b.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(a){var a=b("<div></div>").html(a),e=a.find(".s-reviews").children();c+=e.length;g.append(e);b(".lazyloading-progress-string").replaceWith(a.find(".lazyloading-progress-string"));b(".lazyloading-progress").replaceWith(a.find(".lazyloading-progress"));
c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),b(window).lazyLoad("wake"));a.remove()},"html")}}),b(".lazyloading-link").unbind("click").bind("click",function(){b(window).lazyLoad("force");return!1}))},prepareAddingForm:function(a,c){if(c)this.after(a),a.find(".rate a:first").hide();else{var d=b("#s-review-add li:first");d.find("form").length||d.append(a);a.find(".rate a:first").show()}b.product_reviews.clear(!1);b("input[name=parent_id]",a).val(c)},
addHotkeyHandler:function(b,c,d){var e=this.hotkeys[c];this.form.off("keydown",b).on("keydown",b,function(b){if(b.keyCode==e.key&&b.altKey==e.alt&&b.ctrlKey==e.ctrl&&b.shiftKey==e.shift)return d()})},addReview:function(a,c){var d=this.sidebar_counter;b.post("backend"==a||!a?"?module=reviews&action=add":"#",b.product_reviews.form.serialize(),function(a){if("fail"==a.status)b.product_reviews.clear(!1),b.product_reviews.showErrors(a.errors);else if("ok"!=a.status||!a.data.html)console&&console.log("Error occured.");
else{var g=b("input[name=parent_id]",b.product_reviews.form),f=b.product_reviews.form.parents(".s-review:first").parent("li"),h=a.data.html,j=b("ul:first",f),k=b.product_reviews.container;f.length||(k.show(),j=b("ul:first",k).show());j.length||(j=b('<ul class="menu-v with-icon"></ul>'),f.append(j));j.append(b('<li data-id="'+a.data.id+'" data-parent-id="'+a.data.parent_id+'"></li>').append(h));b("textarea",b.product_reviews.form).val("");f=b("#s-review-add");f.find("form").length||(f.append(b.product_reviews.form),
g.val(0));d.length&&d.text(parseInt(d.text(),10)+1);"function"===typeof c&&c(a);b.product_reviews.clear()}},"json").error(function(b){console&&console.log(b.responseText?"Error occured: "+b.responseText:"Error occured.")})},deleteReview:function(a,c){var d=this.container,e=this.sidebar_counter;b.post("?module=reviews&action=changeStatus",{review_id:a,status:this.statuses.deleted},function(b){if("ok"==b.status){var f=d.find("li[data-id="+a+"]").find("div:first");f.addClass("s-deleted");f.find(".s-review-delete").hide();
f.find(".s-review-restore").show();e.length&&e.text(parseInt(e.text(),10)-1);"function"===typeof c&&c(b)}},"json")},restoreReview:function(a){var c=this.container,d=this.sidebar_counter;b.post("?module=reviews&action=changeStatus",{review_id:a,status:this.statuses.published},function(b){"ok"==b.status&&(b=c.find("li[data-id="+a+"]").find("div:first"),b.removeClass("s-deleted"),b.find(".s-review-delete").show(),b.find(".s-review-restore").hide(),d.length&&d.text(parseInt(d.text(),10)+1),"function"===
typeof success&&success())},"json")},clear:function(a){a="undefined"===typeof a?!0:a;b(".errormsg",this.form).remove();b(".error",this.form).removeClass("error");b(".wa-captcha-refresh",this.form).click();a&&(b("input[name=captcha], textarea",this.form).val(""),b("input[name=rate]",this.form).val(0),b(".rate a:first",this.form).trigger("clear"))},showErrors:function(a){for(var c=0,d=a.length,e=a[c];c<d;e=a[++c])for(var g in e)b("[name="+g+"]",this.form).after(b('<em class="errormsg"></em>').text(e[g])).addClass("error")}}})(jQuery);(function(b){b.product_images={product_id:0,image:null,product_image:null,image_list:null,photo_stream:null,tail:null,options:{},init:function(a){this.options=a;this.product_id=a.product_id||0;this.image=a.image||null;this.options.placeholder=this.options.placeholder||null;var c=b("#s-product-edit-menu .images");this.image?setTimeout(function(){b.product_images.initImage()},200):this.initImageList(a);c.find(".hint").text(a.count||a.images&&a.images.length||0);b("#s-product-edit-forms .s-product-form.images").addClass("ajax");
b.product.editTabImagesAction=function(a){if(null!==b.product_images.tail){var c="?module=product&action=images&id="+a.id;if(a.tail&&(c+="&param[]="+a.tail,b.product_images.photo_stream&&b.product_images.photo_stream.length))var g=b.product_images.photo_stream.find(".s-stream-wrapper>ul"),c=c+("&ps[left]="+parseInt(g.css("left"),10)),c=c+("&ps[width]="+parseInt(g.css("width"),10));b.get(c,function(a){b("#s-product-edit-forms .s-product-form.images").html(a)})}b.product_images.tail=a.tail};b.product.editTabImagesBlur=
function(){b("#fileupload").fileupload("destroy")}},initImageList:function(a){this.image_list=b(a.image_list||"#s-product-image-list");this.image_list.html(tmpl("template-product-image-list",{images:a.images,placeholder:a.placeholder,type:a.type,product_id:this.product_id}));this.initListSortable();(!a.type||"thumbs"==a.type)&&this.initListEditable()},initImage:function(){b("#s-product-one-image").parent().width();this.photo_stream=b("#s-product-image-toolbar ul.s-photostream:first");var a=this.setImageDimensions();
b(window).unbind("resize.product_images").bind("resize.product_images",function(){b("#s-product-image").length||b(this).unbind("resize.product_images");var a=b.product_images.setImageDimensions();b.product_images.loupe.resize(a)});b("#s-product-image-description").inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:b.product_images.options.placeholder,minSize:{height:50,widht:600},size:{width:a.width},editLink:"#s-product-image-description-edit-link",
allowEmpty:!0,beforeMakeEditable:function(a){var c=b(this),d=this.id+"-button",e=b("#"+d);e.length||(a.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),b("#"+d).click(function(){c.trigger("readable")}));b("#"+this.id+"-hint").show();e.show().prev("br").hide()},afterBackReadable:function(a,c){var d=b(a).val(),e="#"+this.id+"-";b(e+"button").hide().prev("br").hide();b(e+"hint").hide();c.changed&&b.products.jsonPost("?module=product&action=imageSave",
{id:b.product_images.image.id,data:{description:d}})}});var c=this.photo_stream,d=c.find("li.selected");c.photoStreamSlider({backwardLink:"#s-product-image-toolbar .rewind",forwardLink:"#s-product-image-toolbar .ff",photoStream:"ul",duration:400});c.off("click","li.visible a").on("click","li.visible a",function(){var a=b(this).attr("href"),e=b(this).parent();d.removeClass("selected");d=e.addClass("selected");c.trigger("home",[function(){location.href=a}]);return!1});this.photo_stream=c;this.product_image=
b("#s-product-image");var e=b("#s-product-set-custom-badge");b(".s-product-image-actions").off("click","li").on("click","li",function(){var a=b(this),c=a.attr("data-action");switch(c){case "delete":b.product_images.deleteImage();break;case "rotate-right":b.product_images.rotateImage("right");break;case "rotate-left":b.product_images.rotateImage("left");break;case "set-badge":b.product_images.setBadge(a.attr("data-type"));break;case "set-custom-badge":e.data("type",a.attr("data-type"));e.show();break;
case "delete-badge":b.product_images.deleteBadge()}"set-custom-badge"!=c&&e.hide();return!1});e.find("input[type=button]").unbind("click").bind("click",function(){var a=b(this).parent();e.show();b.product_images.setBadge(e.data("type"),a.find("textarea[name=code]").val());return!1});a=this.image;b("#s-product-image-loupe").length&&b.product_images.loupe.init({original:{width:a.width,height:a.height,src:"?module=product&action=ImageDownload&id="+a.id},image:{width:this.product_image.width(),height:this.product_image.height(),
src:a.url_big,dom:this.product_image},animate:!(!a.dimensions.width||!a.dimensions.height)});var g=this;b("#s-restore-image-original").unbind("click").bind("click",function(){confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))&&(g.coverToggle(),b.products.jsonPost("?module=product&action=imageRestore",{id:g.image.id},function(a){b("#s-product-view").find("li[data-image-id="+g.image.id+"] img").attr("src",a.data.url_crop);
b("<img>").attr("src",a.data.url_big).load(function(){b(this).remove();b.products.dispatch("#/product/"+g.product_id+"/edit/images/"+g.image.id+"/");g.coverToggle()})},"json"))});var f=!1;b(document).unbind("keydown.product_images").bind("keydown.product_images",function(a){var d=b(a.target).prop("nodeName").toLowerCase(),a=a.keyCode;if(!f&&!("text"==d||"textarea"==d||37!=a&&39!=a)){if(39==a)return d=c.find("li.selected").next(),d.length&&!d.hasClass("dummy")&&(f=!0,location.href=d.find("a").attr("href")),
!1;if(37==a)return d=c.find("li.selected").prev(),d.length&&!d.hasClass("dummy")&&(f=!0,location.href=d.find("a").attr("href")),!1}})},setImageDimensions:function(){var a=b("#s-product-image"),c=b("#s-product-one-image").parent().width(),d=this.image.dimensions;d.width=parseInt(d.width,10);d.height=parseInt(d.height,10);var e={width:"",height:""};!isNaN(d.width)&&d.width<c?(e.width=d.width,isNaN(d.height)||(e.height=d.height)):e.width=c;a.css(e);return e},deleteImage:function(){var a=this,c=b("#s-product-image-delete-dialog");
c.waDialog({onSubmit:function(){c.trigger("close");a.coverToggle();var d=c.find("form");b.shop.jsonPost(d.attr("action"),d.serialize(),function(c){var d="#/product/"+a.product_id+"/edit/images/",f=a.photo_stream.find("li.selected"),h=f.next("li:not(.dummy)");h.length?d=h.find("a").attr("href"):(h=f.prev("li:not(.dummy)"),h.length&&(d=h.find("a").attr("href")));b(".s-product-image-crops").find("li[data-image-id="+c.data.id+"]").remove();a.coverToggle();location.href=d});return!1}})},rotateImage:function(a){var c=
this;c.coverToggle();b.products.jsonPost("?module=product&action=imageRotate&id="+c.image.id,{direction:a},function(a){b("#s-product-view").find("li[data-image-id="+c.image.id+"] img").attr("src",a.data.url_crop);b("<img>").attr("src",a.data.url_big).load(function(){b(this).remove();b.products.dispatch("#/product/"+c.product_id+"/edit/images/"+c.image.id+"/");c.coverToggle()})})},setBadge:function(a,c,d){b.shop.jsonPost("?module=product&action=badgeSet&id="+this.product_id,{code:c||a},function(c){b("#s-product-one-image").find(".top.right").html(c.data);
var g=b("#photo-organize-menu"),f=g.find("li.selected"),g=g.find("li[data-type="+a+"]");f.removeClass("selected").find(".small").text("");g.addClass("selected");"custom"!=a?(b("#s-product-set-custom-badge").hide(),g.find(".small").text(c.data)):b("#s-product-set-custom-badge").show();"function"===typeof d&&d(c)})},deleteBadge:function(){b.getJSON("?module=product&action=badgeDelete&id="+this.product_id,function(){b("#s-product-one-image").find(".top.right").html("");b("#photo-organize-menu").find("li.selected").removeClass("selected")})},
initListSortable:function(){this.image_list.sortable({distance:5,helper:"clone",items:"li",opacity:0.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},update:function(a,c){document.ondragstart=null;var d=b(this),e=b(c.item),g=parseInt(e.attr("data-image-id"),10),e=e.next(),f=null;e.length&&(f=parseInt(e.attr("data-image-id"),10));b.products.jsonPost("?module=product&action=imageMove",{id:g,before_id:f},function(){if("function"===typeof b.product_images.options.onSort)b.product_images.options.onSort(g,
f)},function(){d.sortable("cancel")})}})},coverToggle:function(){var a=b("#s-product-image-cover");if(a.is(":hidden")){var c=a.find(".loading");c.css({position:"absolute",left:parseInt((a.width()-c.width())/2,10)+"px",top:parseInt((a.height()-c.height())/2,10)+"px"});a.show()}else a.hide()},initListEditable:function(){this.image_list.off("click",".editable").on("click",".editable",function(){b(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",
placeholder:b.product_images.options.placeholder,minSize:{height:40},allowEmpty:!0,beforeMakeEditable:function(a){var c=b(this);a.css({"font-size":c.css("font-size"),"line-height":c.css("line-height")}).width(c.parents("li:first").find("img").width());var d=this.id+"-button",e=b("#"+d);e.length||(a.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),b("#"+d).click(function(){c.trigger("readable")}));b("#"+this.id+"-hint").show();
e.show()},afterBackReadable:function(a,c){var d=b(this),d=parseInt(d.parents("li:first").attr("data-image-id"),10),e=b(a).val(),g="#"+this.id+"-";b(g+"button").hide();b(g+"hint").hide();c.changed&&b.products.jsonPost("?module=product&action=imageSave",{id:d,data:{description:e}})}}).trigger("editable")})}}})(jQuery);(function(b){var a=[],c=[];b.fn.doAutosize=function(a){var c=b(this).data("minwidth"),g=b(this).data("maxwidth"),f="",h=b(this),j=b("#"+b(this).data("tester_id"));if(f!==(f=h.val()))f=f.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),j.html(f),j=j.width(),a=j+a.comfortZone>=c?j+a.comfortZone:c,j=h.width(),(a<j&&a>=c||a>c&&a<g)&&h.width(a)};b.fn.resetAutosize=function(a){var c=b(this).data("minwidth")||a.minInputWidth||b(this).width(),a=b(this).data("maxwidth")||a.maxInputWidth||
b(this).closest(".tagsinput").width()-a.inputPadding,g=b(this),f=b("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:g.css("fontSize"),fontFamily:g.css("fontFamily"),fontWeight:g.css("fontWeight"),letterSpacing:g.css("letterSpacing"),whiteSpace:"nowrap"}),h=b(this).attr("id")+"_autosize_tester";0<!b("#"+h).length&&(f.attr("id",h),f.appendTo("body"));g.data("minwidth",c);g.data("maxwidth",a);g.data("tester_id",h);g.css("width",c)};b.fn.addTag=function(d,e){e=jQuery.extend({focus:!1,
callback:!0},e);this.each(function(){var g=b(this).attr("id"),f=b(this).val().split(a[g]);""==f[0]&&(f=[]);d=jQuery.trim(d);var h;e.unique?(h=b(f).tagExist(d),!0==h&&b("#"+g+"_tag").addClass("not_valid")):h=!1;if(""!=d&&!0!=h&&(b("<span>").addClass("tag").append(b("<span>").text(d).append("\u00a0\u00a0"),b("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return b("#"+g).removeTag(escape(d))})).insertBefore("#"+g+"_addTag"),f.push(d),b("#"+g+"_tag").val(""),e.focus?b("#"+g+"_tag").focus():
b("#"+g+"_tag").blur(),b.fn.tagsInput.updateTagsField(this,f),e.callback&&(c[g]&&c[g].onAddTag)&&(h=c[g].onAddTag,h.call(this,d)),c[g]&&c[g].onChange)){var j=f.length;h=c[g].onChange;h.call(this,b(this),f[j-1])}});return!1};b.fn.removeTag=function(d){d=unescape(d);this.each(function(){var e=b(this).attr("id"),g=b(this).val().split(a[e]);b("#"+e+"_tagsinput .tag").remove();str="";for(var f=0;f<g.length;f++)g[f]!=d&&(str=str+a[e]+g[f]);b.fn.tagsInput.importTags(this,str);c[e]&&c[e].onRemoveTag&&c[e].onRemoveTag.call(this,
d)});return!1};b.fn.tagExist=function(a){return 0<=jQuery.inArray(a,b(this))};b.fn.importTags=function(a){id=b(this).attr("id");b("#"+id+"_tagsinput .tag").remove();b.fn.tagsInput.importTags(this,a)};b.fn.tagsInput=function(d){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},d);this.each(function(){e.hide&&
b(this).hide();var d=b(this).attr("id"),f=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},e);a[d]=f.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange)c[d]=[],c[d].onAddTag=e.onAddTag,c[d].onRemoveTag=e.onRemoveTag,c[d].onChange=e.onChange;var h='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';e.interactive&&(h=h+'<input id="'+d+'_tag" value="" data-default="'+e.defaultText+'" />');b(h+'</div><div class="tags_clear"></div></div>').insertAfter(this);
b(f.holder).css("width",e.width);b(f.holder).css("height",e.height);""!=b(f.real_input).val()&&b.fn.tagsInput.importTags(b(f.real_input),b(f.real_input).val());if(e.interactive){b(f.fake_input).val(b(f.fake_input).attr("data-default"));b(f.fake_input).css("color",e.placeholderColor);b(f.fake_input).resetAutosize(e);b(f.holder).bind("click",f,function(a){b(a.data.fake_input).focus()});b(f.fake_input).bind("focus",f,function(a){b(a.data.fake_input).val()==b(a.data.fake_input).attr("data-default")&&
b(a.data.fake_input).val("");b(a.data.fake_input).css("color","#000000")});if(void 0!=e.autocomplete_url){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];void 0!==jQuery.Autocompleter?(b(f.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),b(f.fake_input).bind("result",f,function(a,c){c&&b("#"+d).addTag(c[0]+"",{focus:!0,unique:e.unique})})):void 0!==jQuery.ui.autocomplete&&(b(f.fake_input).autocomplete(autocomplete_options),
b(f.fake_input).bind("autocompleteselect",f,function(a,c){b(a.data.real_input).addTag(c.item.value,{focus:!0,unique:e.unique});return!1}))}else b(f.fake_input).bind("blur",f,function(a){var c=b(this).attr("data-default");""!=b(a.data.fake_input).val()&&b(a.data.fake_input).val()!=c?a.data.minChars<=b(a.data.fake_input).val().length&&(!a.data.maxChars||a.data.maxChars>=b(a.data.fake_input).val().length)&&b(a.data.real_input).addTag(b(a.data.fake_input).val(),{focus:!0,unique:e.unique}):(b(a.data.fake_input).val(b(a.data.fake_input).attr("data-default")),
b(a.data.fake_input).css("color",e.placeholderColor));return!1});b(f.fake_input).bind("keypress",f,function(a){if(a.which==a.data.delimiter.charCodeAt(0)||13==a.which)return a.preventDefault(),a.data.minChars<=b(a.data.fake_input).val().length&&(!a.data.maxChars||a.data.maxChars>=b(a.data.fake_input).val().length)&&b(a.data.real_input).addTag(b(a.data.fake_input).val(),{focus:!0,unique:e.unique}),b(a.data.fake_input).resetAutosize(e),!1;a.data.autosize&&b(a.data.fake_input).doAutosize(e)});f.removeWithBackspace&&
b(f.fake_input).bind("keydown",function(a){if(8==a.keyCode&&""==b(this).val()){a.preventDefault();var a=b(this).closest(".tagsinput").find(".tag:last").text(),c=b(this).attr("id").replace(/_tag$/,""),a=a.replace(/[\s]+x$/,"");b("#"+c).removeTag(escape(a));b(this).trigger("focus")}});b(f.fake_input).blur();f.unique&&b(f.fake_input).keydown(function(a){(8==a.keyCode||String.fromCharCode(a.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&b(this).removeClass("not_valid")})}return!1});
return this};b.fn.tagsInput.updateTagsField=function(c,e){var g=b(c).attr("id");b(c).val(e.join(a[g]))};b.fn.tagsInput.importTags=function(d,e){b(d).val("");for(var g=b(d).attr("id"),f=e.split(a[g]),h=0;h<f.length;h++)b(d).addTag(f[h],{focus:!1,callback:!1});c[g]&&c[g].onChange&&c[g].onChange.call(d,d,f[h])}})(jQuery);(function(b){b.product_list={options:{},collection_hash:[],collection_param:"",total_count:0,sort:null,order:null,container:null,toolbar:null,sortable:!0,init:function(a){try{this.options=a;this.container=b("#product-list");this.toolbar=b("#s-product-list-toolbar");this.sidebar=b("#s-sidebar");var c=this.options.products;delete this.options.products;this.total_count=this.options.total_count||0;this.sortable="undefined"===typeof a.sortable?this.sortable:a.sortable;this.sort=a.sort||null;if(c&&a.view){try{this.container.append(tmpl("template-product-list-"+
this.options.view,{products:c,sort:this.sort},"table"==this.options.view))}catch(d){return console.log("Error: "+d.message),this}delete a.products}this.collection_hash=b.isArray(this.options.collection_hash)&&this.options.collection_hash.length?this.options.collection_hash:[];this.collection_param=this.options.collection_param?this.options.collection_param:"";a.order&&(this.order=a.order);this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);this.initSelecting();this.initView(this.options.view);
this.initDragndrop()}catch(e){b.shop.error("$.product_list.init error: "+e.message,e)}return this},initLazyLoad:function(a){var c=a.count,d=this.total_count;b(window).lazyLoad("stop");if(c<d){var e=this;b(window).lazyLoad({container:e.container,state:"undefined"===typeof a.auto||a.auto?"wake":"stop",hash:["","products"],load:function(){b(window).lazyLoad("sleep");b(".lazyloading-link").hide();b(".lazyloading-progress").show();b.get("?module=products&action=loadList&offset="+c+("&total_count="+d)+
(e.collection_param?"&"+e.collection_param:"")+(e.sort?"&sort="+e.sort:"")+(e.order?"&order="+e.order:""),function(a){if("ok"==a.status&&a.data.count){c+=a.data.count;var f=e.container;try{e.container.append(tmpl("template-product-list-"+e.options.view,{products:a.data.products,check_all:"table"==e.options.view?f.find(".s-select-all").attr("checked"):!1,sort:b.product_list.sort}))}catch(h){console.log("Error: "+h.message);b(window).lazyLoad("stop");return}f.find(".last").removeClass("last");f.find(".product:last").addClass("last");
b(".lazyloading-progress-string").text(a.data.progress.loaded+" "+a.data.progress.of);b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(a.data.progress.chunk);c>=d?(b(window).lazyLoad("stop"),b(".lazyloading-link").hide()):(b(".lazyloading-link").show(),b(window).lazyLoad("wake"))}else a.data&&!a.data.count?console&&(console.log("Count of again loaded products is 0"),b(".lazyloading-progress").hide()):(a.errors&&console&&console.log("Error when loading products: "+a.errors),b(window).lazyLoad("stop"))},
"json")}});b(".lazyloading-link").die("click").live("click",function(){b(window).lazyLoad("force");return!1})}},initSelecting:function(){var a=this.container,c=this.toolbar.find(".count"),d=a.find(".s-select-all"),e=function(){var b=parseInt(a.find(".product.selected").length,10);b?c.text(b).show():c.text("").hide()};b(document).keydown(function(b){16==b.keyCode&&(document.body.onselectstart=function(){return!1})}).keyup(function(b){16==b.keyCode&&(document.body.onselectstart=null)});a.off("select",
".product").on("select",".product",function(a,c,h){h=void 0!==h?need:!0;(void 0!==c?c:1)?b(this).addClass("selected").find("input:first").attr("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",!1),d.is(":checked")&&d.attr("checked",!1));h&&e();return!1});d.unbind("select").bind("select",function(d,e){var e=void 0!==e?e:!0,h=b(this);e?(h.attr("checked",!0),a.find(".product").trigger("select",!0,!1),c.text(h.attr("data-count")).show()):(h.attr("checked",!1),a.find(".product").trigger("select",
!1,!1),c.text("").hide())});a.off("click",".product input").on("click",".product input",function(c,f){var h=c.shiftKey,j=this.checked;f&&(h=f.shiftKey,j=f.checked);var k=b(this).parents(".product:first");j?k.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),k.removeClass("selected"));if(h&&j){(h=a.data("last_checked"))||(h=a.find(".product:first").trigger("select",!0));var m=k.prevAll(".selected[data-product-id="+h.attr("data-product-id")+"]"),l;if(m.length){l=k.prev();for(h=h.get(0);l.length&&
h!=l.get(0);)l.addClass("selected").find("input").attr("checked",!0),l=l.prev()}else if(m=k.nextAll(".selected[data-product-id="+h.attr("data-product-id")+"]"),m.length){l=k.next();for(h=h.get(0);l.length&&h!=l.get(0);)l.addClass("selected").find("input").attr("checked",!0),l=l.next()}!a.data("last_checked")&&!m.length&&h.trigger("selected",!1)}j&&a.data("last_checked",k);e()});if(b.browser.mozilla)a.off("click",".product label").on("click",".product label",function(a){if(a.shiftKey){var c=b(a.target);
b(c).is("label")||(c=b(c).parents("label:first"));c=b("#"+c.attr("for"));c.trigger("click",{shiftKey:a.shiftKey,checked:!c.attr("checked")})}})},initView:function(a){try{var c=this.container,d=this.sidebar;"table"==a&&c.find(".s-select-all").click(function(){b(this).trigger("select",this.checked)});var e="view="+a;d.find(".s-collection-list li.dr").each(function(){var a=b(this);a.find("a:first").attr("href","#/products/"+a.attr("id").replace("-","_id=")+"&"+e)});b("#s-products-search").val(this.options.text||
"");var g=b.product_list.collection_hash.join("-")||"s-all-products";b.shop.trace("$.product_list.initView",[a,g]);d.find("li.selected").removeClass("selected");var f=d.find("#"+g);0>=f.length&&window.location.hash&&(f=d.find('a[href="'+window.location.hash+'"]').parent());0>=f.length&&(f=d.find("#s-all-products"));f.addClass("selected").find(".count:first").text(this.total_count);d.off("click",".s-new-list").on("click",".s-new-list",function(){var a=b(this),c=a.attr("id"),d=0;c?a=c.replace("s-new-",
""):(d=a.parents("li.dr:first").attr("id").split("-"),a=d[0],d=d[1]);b.product_list.createListDialog(a,d,function(a,c){var d=b("#s-"+c+"-list").find("ul:first");if(parseInt(a.parent_id,10)){d=d.find("#"+c+"-"+a.parent_id);if(!d.find("li.dr").length){d.append('<ul class="menu-v with-icons dr"><li class="drag-newposition" data-type="'+c+'"></li></ul>');d.find(".drag-newposition").mouseover();d.find(">a").before('<i class="icon16 darr overhanging collapse-handler"></i>')}d=d.find("ul:first")}d.trigger("add",
[a,c])});return!1});b("#s-content").find(".sort").unbind("click").bind("click",function(){location.href=b(this).find("a").attr("href");return!1});var h=b("#s-embed-code");h.length&&h.inlineEditable({size:{width:h.width()+4},afterMakeEditable:function(b){b.trigger("select")}});this.initEditingControls();this.initToolbar()}catch(j){b.shop.error("$.product_list.initView error: "+j.message,j)}},initEditingControls:function(){var a=b("#s-product-list-title");a.hasClass("editable")&&(a.inlineEditable({minSize:{width:350},
maxSize:{width:600},size:{height:30},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){b(".s-product-list-manage").hide()},afterBackReadable:function(a,c){b(".s-product-list-manage").show();if(!c.changed)return!1;b.shop.jsonPost("?module=products&action=saveListSettings&"+b.product_list.collection_param+"&edit=name",{name:b(a).val()},function(a){b.product_list.sidebar.find("#"+b.product_list.collection_hash[0]+"-"+a.data.id).find(".name:first").html(a.data.name)})}}),"name"==this.options.edit&&
a.trigger("editable"));var c=b.product_list.collection_hash[0],a=b("#s-product-list-settings");a.length&&("category"==c||"set"==c)&&a.unbind("click").bind("click",function(){var a=b("#s-product-list-settings-dialog"),c=a.parent();a.length||(c=b("<div></div>").appendTo("body"));c.load("?module=dialog&action=productListSettings&"+b.product_list.collection_param,function(){b("#s-product-list-settings-dialog").waDialog({onSubmit:function(a){var c=a.find("form");b.shop.jsonPost(c.attr("action"),c.serializeArray(),
function(c){var d=b.product_list.collection_hash,e=location.hash.replace(d[0]+"_id="+d[1],d[0]+"_id="+c.data.id),f=b("#"+d.join("-"));f.find(".name:first").html(c.data.name);c.data.status=="0"?f.children("a").addClass("gray"):c.data.status=="1"&&f.children("a").removeClass("gray");f.find(".id:first").html(c.data.id);f.attr("id",d[0]+"-"+c.data.id);f.find("a").attr("href",e);location.hash!=e?location.hash=e:b.products.dispatch();a.trigger("close")},function(b){if(b&&b.errors){var b=b.errors,c;for(c in b)a.find("input[name="+
c+"]").addClass("error").parent().find(".errormsg").text(b[c]);return false}});return false}})});return false});a=b("#s-product-list-delete");a.length&&("category"==c||"set"==c)&&a.unbind("click").bind("click",function(){b("#s-product-list-delete-dialog").waDialog({disableButtonsOnSubmit:true,onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(){var a=b(this);a.find(".dialog-buttons i.loading").show();var e={hash:b.product_list.collection_hash.join("/")||"all",remove:["list"]};
a.find("input[name=s-delete-products]:checked").val()=="1"&&e.remove.push("products");b.product_list.remove(e,function(a){var d=b("#"+b.product_list.collection_hash.join("-")),e=d.prev(".drag-newposition"),j=b("#s-"+b.product_list.collection_hash[0]+"-list"),k=j.find("ul"),m;if(c=="set"){d.remove();e.remove()}else{m=d.find("ul:first");if(m.length){m.find(">li.drag-newposition:first").remove();d.hide();m.find(">li").each(function(){d.after(this)})}m=d.parents("ul:first");d.remove();e.remove();if(!m.find("li.dr").length&&
k.get(0)!=m.get(0)){m.parents("li:first").find("i.collapse-handler").remove();m.remove()}}if(k.find("li.dr:first").length){k.show();j.find(".s-empty-list").hide()}else{k.hide();j.find(".s-empty-list").show()}b.product_list.sidebar.trigger("update",a.data.lists);location.href="#/"});return false}});return false})},initDragndrop:function(){b.product_dragndrop.init({products:!0,view:this.options.view}).bind("move_product",function(a){b.shop.jsonPost("?module=product&action=move&"+b.product_list.collection_param,
{product_ids:a.product_ids,before_id:a.before_id||null},a.success,a.error)}).bind("is_product_sortable",function(){return b.product_list.sortable}).bind("add_to_list",function(a){var c={};a.whole_list?c.hash=b.product_list.collection_hash.join("/")||"all":c.product_id=a.product_ids;b.shop.jsonPost("?module=product&action=addToList&"+a.collection_param,c,a.success,a.error)})},initToolbar:function(){var a=this.toolbar;a.find("li").unbind("click").bind("click",function(){var a=b(this).attr("data-action"),
c=b.product_list.getSelectedProducts("delete"!=a);if(!c.count)return alert($_("Please select at least one product")),!1;"new-set"!=a&&("category"==a?b.product_list.categoriesDialog(c):"set"==a?b.product_list.setsDialog(c):"type"==a?b.product_list.typesDialog(c):"assign-tags"==a?b.product_list.assignTagsDialog(c):"delete"==a?b.product_list.deleteProductsDialog(c):"delete-from-set"==a&&"set"==b.product_list.collection_hash[0]?b.product_list.deleteFromSet(c):"delete-from-category"==a&&"category"==b.product_list.collection_hash[0]?
b.product_list.deleteFromCategory(c):"export"==a&&b.product_list.exportProducts(c,b(this).attr("data-plugin")));return!1});var c=b("#mainmenu").height(),d=a.find(":first").offset().top-c;b(document).bind("scroll",function(){b(this).scrollTop()>d?a.addClass("s-fixed").css({top:c}):a.removeClass("s-fixed")})},getSelectedProducts:function(a){var a=a||!1,c={count:0};if(this.container.find(".s-select-all").attr("checked")){var d=b.product_list.collection_hash.join("/")||"all";a?c.serialized=[{name:"hash",
value:d}]:c.hash=d;c.count=this.total_count}else a?c.serialized=b.product_list.container.find(".product.selected").map(function(){c.count+=1;return{name:"product_id[]",value:b(this).attr("data-product-id")}}).toArray():c.product_id=b.product_list.container.find(".product.selected").map(function(){c.count+=1;return b(this).attr("data-product-id")}).toArray();return c},categoriesDialog:function(a){var c=b("#s-categories"),d=this.sidebar,e=this.container;c.length&&c.parent().remove();b("<div></div>").appendTo("body").load("?module=dialog&action=categories",
function(){b("#s-categories").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=b(this);c.find(".dialog-content h1 span").text("("+a.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_category_name]").val("");c.find("input[name=new_category]").attr("checked",!1)},onSubmit:function(c){var f=c.find("form");f.find(".dialog-buttons i.loading").show();b.shop.jsonPost(f.attr("action"),f.serializeArray().concat(a.serialized),function(a){a.data.new_category&&b("#s-category-list ul:first").trigger("add",
[a.data.new_category,"category","#/products/category_id="+a.data.new_category+"&view="+b.product_list.options.view]);a.data.categories&&(d.trigger("update",[{category:a.data.categories}]),e.find(".s-select-all:first").trigger("select",!1));f.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},setsDialog:function(a){var c=b("#s-sets"),d=this.sidebar,e=this.container;c.length&&c.parent().remove();b("<div></div>").appendTo("body").load("?module=dialog&action=sets",function(){b("#s-sets").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){var c=b(this);c.find(".dialog-content h1 span").text("("+a.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_set_name]").val("");c.find("input[name=new_set]").attr("checked",!1)},onSubmit:function(c){var f=c.find("form");f.find(".dialog-buttons i.loading").show();b.shop.jsonPost(f.attr("action"),f.serializeArray().concat(a.serialized),function(a){a.data.new_set&&b("#s-set-list ul:first").trigger("add",[a.data.new_set,"set","#/products/set_id="+a.data.new_set+
"&view="+b.product_list.options.view]);a.data.sets&&(d.trigger("update",[{set:a.data.sets}]),e.find(".s-select-all:first").trigger("select",!1));f.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},assignTagsDialog:function(a){var c=b("#s-assign-tags");c.length&&c.remove();b.post("?module=dialog&action=assignTags",a.serialized,function(c){b("body").append(c);b("#s-assign-tags").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=b(this);c.find(".dialog-content h1 span").text("("+
a.count+")").show();c.find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var d=b(this);d.find(".dialog-buttons i.loading").show();b.shop.jsonPost(d.attr("action"),d.serializeArray().concat(a.serialized),function(a){a.data.cloud&&b("#s-tag-cloud").trigger("update",[a.data.cloud]);c.trigger("close");b.products.dispatch()},function(){c.trigger("close")});return!1}})})},typesDialog:function(a){var c=b("#s-types"),d=this.container,e=this.sidebar,g=function(){b("#s-types").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var f=b(this);f.find(".dialog-buttons i.loading").show();b.shop.jsonPost(f.attr("action"),f.serializeArray().concat(a.serialized),function(a){e.trigger("update",{type:a.data.types});d.find(".s-select-all:first").trigger("select",!1);f.find("input:checked").attr("checked",!1);c.trigger("close");b.products.dispatch()});return!1}})},f=c.parent();c.length?g():(f=b("<div></div>").appendTo("body"),f.load("?module=dialog&action=types",
g))},deleteFromSet:function(a){0<a.count&&b.shop.jsonPost("?module=products&action=deleteFromSet&id="+this.collection_hash[1],a.serialized,function(){b.products.dispatch()})},deleteFromCategory:function(a){0<a.count&&b.shop.jsonPost("?module=products&action=deleteFromCategory&id="+this.collection_hash[1],a.serialized,function(){b.products.dispatch()})},deleteProductsDialog:function(a){var c=b("#s-product-list-delete-products-dialog"),d=c.parent();c.length||(d=b("<div></div>").appendTo("body"));d.load("?module=dialog&action=productsDelete&count="+
a.count,function(){b("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){b(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){b(this).find(".dialog-buttons i.loading").show();b.product_list.remove(b.extend(a,{remove:["products"]}),function(a){b.product_list.sidebar.trigger("update",a.data.lists);b.products.dispatch();c.trigger("close")});return!1}})})},createListDialog:function(a,c,d){var e=b("#s-product-list-create-dialog"),g=e.parent();
e.length||(g=b("<div></div>").appendTo("body"));g.load("?module=dialog&action=productListCreate&type="+a+"&parent_id="+c,function(){b("#s-product-list-create-dialog").waDialog({onSubmit:function(c){var e=c.find("form");b.shop.jsonPost(e.attr("action"),e.serializeArray(),function(e){"function"===typeof d&&d(e.data,a);location.href="#/products/"+a+"_id="+e.data.id+"&view="+b.product_list.options.view;c.trigger("close")},function(a){if(a&&a.errors){var a=a.errors,b;for(b in a)c.find("input[name="+b+
"]").addClass("error").parent().find(".errormsg").text(a[b]);return!1}});return!1}})})},exportProducts:function(a,b){for(var d=[],e;e=a.serialized.pop();)e.name&&"product_id[]"==e.name&&d.push(parseInt(e.value,10));d.length&&(d="?action=importexport#/"+b+("/hash/id/"+d.join(",")),window.location=d)},remove:function(a,c){var d={},e;a.product_id?e=function(){100>=a.product_id.length&&(d.get_lists=!0);d.product_id=a.product_id.splice(0,100);b.shop.jsonPost("?module=products&action=deleteList",d,function(b){a.product_id.length?
e():typeof c==="function"&&c(b)})}:(d.hash=a.hash||this.collection_hash.join("/")||"all",d.remove=b.isArray(a.remove)&&a.remove.length?a.remove:["list"],1==d.remove.length&&"list"==d.remove[0]?e=function(){b.shop.jsonPost("?module=products&action=deleteList",d,c)}:(d.count=100,e=function(){b.shop.jsonPost("?module=products&action=deleteList",d,function(a){0<a.data.rest_count&&null!=a.data.rest_count?e():"function"===typeof c&&c(a)})}));e()}}})(jQuery);
