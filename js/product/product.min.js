(function(a){var b=function(a,d,e){var f=!/[^\w\-\.:]/.test(a)?!e?b.cache[a]=b.cache[a]||b(b.load(a)):b.cache[a]=b(b.load(a)):new Function(b.arg+",tmpl","var _e=tmpl.encode"+b.helper+",_s='"+a.replace(b.regexp,b.func)+"';return _s;");return d?f(d,b):function(a){return f(a,b)}};b.cache={};b.load=function(a){var b=document.getElementById(a),e=/<\\\/(\w+)/g;if(!b&&console)throw{message:"template with id="+a+" not found"};return b?("textarea"==b.tagName.toLowerCase()?b.value:document.getElementById(a).innerHTML).replace(e,
"</$1"):null};b.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;b.func=function(a,b,e,f,g,h){if(b)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[a]||"\\"+a;if(e)return"="===e?"'+_e("+f+")+'":"'+("+f+"||'')+'";if(g)return"';";if(h)return"_s+='"};b.encReg=/[<>&"'\x00]/g;b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};b.encode=function(a){return String(a||"").replace(b.encReg,function(a){return b.encMap[a]||""})};b.arg="o";b.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return b}):a.tmpl=b})(this);(function(a){a.fn.lazyLoad=function(b){function c(){if(d.stopped)this.onscroll=null;else if(!d.stopped&&!d.loading&&h(f,e)<=d.distance){if(null!==d.hash){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===d.hash.indexOf(a)){this.onscroll=null;return}}d.load()}}if("stop"==b){var d=this.data("lazyLoadSettings");d&&(d.stopped=!0)}else if("sleep"==b){if(d=this.data("lazyLoadSettings"))d.loading=!0}else if("wake"==b){if(d=this.data("lazyLoadSettings"))d.loading=!1}else if("force"==b)(d=
this.data("lazyLoadSettings"))&&(d.loading||d.load());else{this.data("lazyLoadSettings",a.extend({distance:50,load:function(){},container:f,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},b||{}));d=this.data("lazyLoadSettings");d.loading=!1;d.stopped=!1;var e=this,f="string"===typeof d.container?a(d.container):d.container;null!==d.hash&&!a.isArray(d.hash)&&(d.hash=[d.hash]);a.fn.lazyLoad.call(e,d.state);var g=setTimeout(function(){if(d.stopped)clearTimeout(g);
else{if(d.hash!==null){var a=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(d.hash.indexOf(a)===-1){clearTimeout(g);return}}if(d.loading)g=setTimeout(arguments.callee,350);else{h(f,e);if(h(f,e)<=d.distance){d.load();g=setTimeout(arguments.callee,350)}else{e.get(0).onscroll=c;clearTimeout(g)}}}},350),h="function"===typeof d.distanceBetweenBottoms?d.distanceBetweenBottoms:function(a,b,d){return a.position().top+a.outerHeight()-(d||0)-(b.scrollTop()+b.height())}}}})(jQuery);$.fn.liveDraggable=function(a){this.each(function(){var a=$(this);a.data("init_draggable")&&a.die("mouseover",a.data("init_draggable"))});this.die("mouseover").live("mouseover",function(){var b=$(this);b.data("init_draggable")||b.data("init_draggable",arguments.callee).draggable(a)})};
$.fn.liveDroppable=function(a){this.each(function(){var a=$(this);a.data("init_droppable")&&a.die("mouseover",a.data("init_droppable"))});var b=function(){var b=$(this);b.data("init_droppable")||(b.data("init_droppable",arguments.callee).droppable(a),b.mouseover())};b.call(this);this.die("mouseover",b).live("mouseover",b)};(function(a){a.fn.inlineEditable=function(b,c){function d(){m(a(this))||a(this).addClass(k.placeholderClass).text(k.placeholder)}function e(){m(a(this))==k.placeholder&&a(this).text("").removeClass(k.placeholderClass)}function f(b){return!a(b).val()?(a(this).text(k.placeholder).addClass(k.placeholderClass),!0):!1}function g(){n="edit";this.id=this.id||(""+Math.random()).slice(2);var b=this.id+"-input",d=a("#"+b);d.length||(o.after(j(b)),d=a("#"+b));d.addClass(k.inputClass);var b=d,c=o,f=k.size.height||
c.height(),c=k.size.width||1.5*c.width(),f=k.minSize.height&&f<k.minSize.height?k.minSize.height:f,c=k.minSize.width&&c<k.minSize.width?k.minSize.width:c,f=k.maxSize.height&&f>k.maxSize.height?k.maxSize.height:f,c=k.maxSize.width&&c>k.maxSize.width?k.maxSize.width:c;b.height(f);b.width(c);k.placeholder&&m(a(this))==k.placeholder&&e.call(o);k.beforeMakeEditable.call(this,d);r=k.truncate?o.data("real_text"):m(o);d.val(r).show().focus();o.hide();a(k.editLink).hide();if(!l){for(var g=[],i=[],b=0,f=k.makeReadableBy.length;b<
f;++b)c=k.makeReadableBy[b],"blur"==c&&d.blur(function(){n!="read"&&h.call(this)}),"enter"==c&&g.push(13),"esc"==c&&g.push(27);b=0;for(f=k.updateBy.length;b<f;++b)c=k.updateBy[b],"alt+enter"==c&&i.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==c&&i.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==c&&i.push({ctrl:!0,alt:!1,shift:!1,key:17});g.length&&d.keydown(function(a){~g.indexOf(a.keyCode)&&!a.ctrlKey&&!a.altKey&&!a.shiftKey&&n!="read"&&h.call(this,a.keyCode==27?r:null);if(i.length)for(var b in i){var d=
i[b];if(a.keyCode==d.key&&a.ctrlKey==d.ctrl&&a.altKey==d.alt&&a.shiftKey==d.shift){o.trigger("readable");break}}});o.unbind("readable.inlineEditable").bind("readable.inlineEditable",function(b,d){if(n!="read"){var c=a("#"+(this.id+"-input"));h.call(c,c.val(),d)}});l=!0}k.afterMakeEditable.call(this,d)}function h(b,c){c="undefined"===typeof c?!1:!0;void 0!=b&&null!=b?a(this).val(b):b=a(this).val();if(!(!1===c&&!1===k.beforeBackReadable.call(o.get(0),this,{changed:b!=r,old_text:r,new_text:b}))){n="read";
if(!k.placeholder||!f.call(o,this))if(k.allowEmpty||b)k.truncate?(o.data("real_text",b),o.text(b.length<k.truncate-3?b:b.substr(0,k.truncate-3)+"...")):!k.html?o.text(b):o.html(b),b||d.call(this);o.show();a(this).hide();a(k.editLink).show();!1===c&&k.afterBackReadable.call(o.get(0),this,{changed:b!=r,old_text:r})}}function j(a){switch(k.inputType){case "textarea":return'<textarea id="'+a+'" style="display:none;"></textarea>';default:return'<input type="text" id="'+a+'" style="display:none;">'}}function i(a){return function(){return a}}
function m(a){return!k.html?a.text():a.html()}if(this.length){var l=!1;if("string"==typeof b){if("setOption"==b){var k=this.data("inlineEditableSettings")||{};a.extend(!0,k,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(k.hold=i(k.hold));this.data("inlineEditableSettings",k)}return this}var q=this.data("inlineEditableSettings");this.data("inlineEditableSettings",a.extend({inputType:"text",inputClass:"",size:{height:null,width:null},minSize:{height:null,width:null},maxSize:{height:null,
width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},afterMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},q,b||{}));var k=this.data("inlineEditableSettings")||{},o=this,n="read",r="";"function"!==typeof k.hold&&(k.hold=i(k.hold));this.data("inited")||(k.truncate&&"boolean"==typeof k.truncate&&
(k.truncate=255),k.truncate&&(q=!k.placeholder||k.placeholder!==this.text()?this.text():"",this.data("real_text",q),this.text(q.length<k.truncate-3?q:q.substr(0,k.truncate-3)+"...")),k.placeholder&&d.call(this),k.editLink&&a(k.editLink).unbind("click.inlineEditable").bind("click.inlineEditable",function(){k.hold.call(o)||n!="edit"&&g.call(o.get(0))}),k.editOnItself&&this.unbind("click.inlineEditable").bind("click.inlineEditable",function(){k.hold.call(o)||n!="edit"&&g.call(this)}),this.unbind("editable.inlineEditable").bind("editable.inlineEditable",
function(){k.hold.call(o)||n!="edit"&&g.call(this)}),this.unbind("placeholder.inlineEditable").bind("placeholder.inlineEditable",function(b,c){c&&k.placeholder&&d.call(this);c||a(this).removeClass(k.placeholderClass)}),this.data("inited",!0));return this}}})(jQuery);(function(a){a.fn.photoStreamSlider=function(b){function c(){function b(c){function j(){b.execution=!1;var a="on"+k.charAt(0).toUpperCase()+k.slice(1),a=d[a];"function"==typeof a&&a.call(e);a=c.fn;"function"==typeof a&&a.call(e)}"string"==typeof c&&(c={direction:c,animate:!0});var k=c.direction||"forward",l=c.steps||h.length;if(!b.execution){b.execution=!0;var o=h.filter(":first").outerWidth()*l,n=h.length;if("forward"==k){var s=h.filter(":last").nextAll(":lt("+l+")"),l=s.length,s=s.filter(":last");
l&&(h.removeClass("visible"),s.prevAll(":lt("+(n-1)+")").addClass("visible"),s.addClass("visible"))}else s=h.filter(":first").prevAll(":lt("+l+")"),l=s.length,s=s.filter(":last"),l&&(h.removeClass("visible"),s.nextAll(":lt("+(n-1)+")").addClass("visible").show(),s.addClass("visible"));h=a("li.visible",g);n=g.position().left;"forward"==k?(l=m-i-q,n-=o,n=n>-l?n:-l):(n+=o,n=n<q?n:q);c.animate?g.animate({left:n},d.duration,j):(g.css({left:n}),j())}}var g=e.find(d.photoStream),h=a("li.visible",g),j=a("li",
g),i=h.filter(":first").outerWidth()*h.length,m=j.filter(":first").outerWidth()*j.length,l=d.height||j.filter(":first").outerHeight();g.parent().css({overflow:"hidden",height:l,position:"relative",padding:"4px 0",margin:0,width:i});for(var l=g.find("li:first"),k=h.filter(":first"),q=(k.outerWidth()-k.width())/2,o=0,n=l.outerWidth(),k=k.get(0);l.length&&l.get(0)!=k;)o+=n,l=l.next();g.css({position:"absolute",left:-(o-q),width:m});a(d.forwardLink).unbind("click").bind("click",function(){b("forward");
return!1});a(d.backwardLink).unbind("click").bind("click",function(){b("backward");return!1});e.unbind("append prepend").bind("append prepend",function(b,d){if("append"==b.type){for(var c=g.find("li:last"),f=a();c.hasClass("dummy");)f=f.add(c),c=c.prev("li");f.remove();g.append(d)}else{var c=a("<div></div>").html(d),f=c.find("li"),h=f.length*n;c.remove();for(var c=g.find("li:first"),i=a();c.hasClass("dummy");)i=i.add(c),c=c.next("li");i.remove();g.prepend(f)}j=g.find("li");m=j.filter(":first").outerWidth()*
j.length;g.css("width",m);"prepend"==b.type&&(g.is(":animated")&&g.stop(!1,!0),g.css("left",parseInt(g.css("left"))-h));g.find("li.selected").hasClass("visible")&&e.trigger("home",[null,!1])});e.unbind("forward backward").bind("forward backward",function(a,c){b({direction:a.type,steps:c.steps,animate:"undefined"!==typeof c.animate?c.animate:!0,fn:c.fn});var d=g.find("li.selected"),e="forward"==a.type?d.next("li:not(.dummy)"):d.prev("li:not(.dummy)");e.length&&(d.removeClass("selected"),e.addClass("selected"))});
e.unbind("home").bind("home",function(c,d,e){var c=parseInt(h.length/2),c=h.filter(":eq("+c+")"),g=c.nextAll(".selected:first"),j=c.prevAll(".selected:first"),i=0,m="";"function"!==typeof d&&(e=d);e="undefined"!==typeof e?e:!0;g.length?(m="forward",c.nextAll().each(function(){++i;if(a(this).hasClass("selected"))return!1})):j.length&&(m="backward",c.prevAll().each(function(){++i;if(a(this).hasClass("selected"))return!1}));m&&i?b({direction:m,steps:i,fn:d,animate:e}):"function"==typeof d&&d();return!1});
e.unbind("refresh").bind("refresh",function(){c()})}var d=a.extend({duration:200,height:48},b||{}),e=this;c()}})(jQuery);(function(a){a.product_dragndrop={handlers:{},options:{},init:function(a){this.options=a;a.collections&&(this.initDragCollections(),this.initDropCollections());a.products&&(this.initDragProducts(),this.initDropProducts());return this},bind:function(a,c){this.handlers[a]=c;return this},trigger:function(a){if("function"===typeof this.handlers[a])return this.handlers[a].apply(this,Array.prototype.slice.call(arguments,1))},initDragProducts:function(){var b=a("#product-list"),c=b.find(".product:not(.s-alien)");
c.find(".drag-handle").live("selectstart",function(){document.onselectstart=function(){return!1};return!1});c.liveDraggable({opacity:0.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,containment:[0,0,a(window).width(),{toString:function(){return a(document).height()}}],start:function(b,c){document.ondragstart=function(){return!1};c.helper.data("scrollTop",a(document).scrollTop());a(document).bind("scroll",a.product_dragndrop._scrolHelper);a(".block.drop-target").addClass("drag-active")},
handle:".drag-handle",stop:function(){document.ondragstart=null;document.onselectstart=null;var b=a(this);b.find("input:checked").length||b.removeClass("selected");a(document).unbind("scroll",a.product_dragndrop._scrolHelper);a(".block.drop-target").removeClass("drag-active")},helper:function(){var c=1,e=b.find(".s-select-all");e.is(":checked")?c=e.attr("data-count"):(e=b.find(".product.selected"),e.length?-1!==e.index(this)?c=e.length:(a(this).trigger("select",!0),c=e.length+1):a(this).addClass("selected"));
return'<div id="products-helper"><span class="indicator red">'+c+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},drag:function(a,b){var c=a.originalEvent;b.position.left=c.pageX-20;b.position.top=c.pageY}})},initDropProducts:function(){a("#product-list .product").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(b,c){if(!a.product_dragndrop.trigger("is_product_sortable"))return!1;var d=a(this);if(d.hasClass("s-alien")||!c.draggable.hasClass("product"))return!1;
d.hasClass("last")?(c.draggable.extDragActivate=function(b){a.product_dragndrop._extDragActivate(b,d)},a(document).bind("mousemove",c.draggable.extDragActivate)):d.addClass("drag-active")},out:function(b,c){if(!a.product_dragndrop.trigger("is_product_sortable"))return!1;a(this).removeClass("drag-active drag-active-last");c.draggable.extDragActivate&&a(document).unbind("mousemove",c.draggable.extDragActivate)},drop:function(b,c){if(!a.product_dragndrop.trigger("is_product_sortable"))return!1;var d=
a(this);if(d.hasClass("selected"))return!1;var e=a("#product-list").find(".product.selected"),f=null;d.hasClass("drag-active-last")||(f=d.attr("data-product-id"));d.hasClass("last")&&d.hasClass("drag-active-last")?(d.after(e).removeClass("drag-active drag-active-last last"),e.filter(":last").addClass("last")):d.before(e).removeClass("drag-active");d.removeClass("drag-active drag-active-last");c.draggable.extDragActivate&&a(document).unbind("mousemove",c.draggable.extDragActivate);e.trigger("select",
!1);d=e.map(function(){return a(this).attr("data-product-id")}).toArray();a.product_dragndrop.trigger("move_product",{product_ids:d,before_id:f,error:function(a){a&&console&&console.log(typeof a.errors!=="undefined"?a.errors:a)}})}})},initDragCollections:function(){var b=a("#wa-app .sidebar:first"),c=b.position(),d=b.width(),b=b.height();a(".s-collection-list li.dr").liveDraggable({containment:[c.left,c.top,c.left+1.25*d,c.top+1.25*b],refreshPositions:!0,revert:"invalid",helper:function(){var b=a(this),
c=b.parents(".s-collection-list:first").find("ul:first"),b=b.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(c);b.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>');return b},cursor:"move",cursorAt:{left:5},opacity:0.75,zIndex:9999,distance:5,start:function(){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},initDropCollections:function(){this.initDropBetweenCollections();
this.initDropInsideCollections()},initDropBetweenCollections:function(){a(".s-collection-list li.drag-newposition").liveDroppable({greedy:!0,tolerance:"pointer",over:function(b,c){var d=a(this);if(c.draggable.attr("data-type")!=d.attr("data-type"))return!1;d.addClass("active").parent().parent().addClass("drag-active")},out:function(b,c){var d=a(this);if(c.draggable.attr("data-type")!=d.attr("data-type"))return!1;d.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(b,
c){var d=a(this);if(c.draggable.attr("data-type")!=d.attr("data-type"))return!1;(d.is(":animated")||d.hasClass("dragging"))&&d.stop().animate({height:"2px"},300,null,function(){d.removeClass("dragging")});d.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(b,c){var d=a(this),e=c.draggable,f=e.attr("data-type");if(f!=d.attr("data-type"))return!1;var g=function(a){a=a.split("-");a.shift();return a.join("-")},h=g(e.attr("id")),j=d.prev("li"),i=e.next(),m=e.prev();if(j.length&&
j.attr("id")=="category-"+h&&!j.hasClass("dr-helper")||this==e.next().get(0))return!1;var l=e.parent("ul"),k=l.children("li.dr[id!=category-"+h+"]").length,q=parseInt(g(l.parent().attr("id")),10)||0;d.after(i).after(e);d=e.parent().parent();if(d.is("li.dr")||d.is(".s-collection-list")){var o=0;d.is(".s-collection-list")||(o=parseInt(g(d.attr("id")),10)||0);d=e.nextAll("li.dr:first");j=null;d.length&&(j=g(d.attr("id"))||null);!k&&q!==o&&(l.parent("li").children("i").hide(),l.hide());a.product_dragndrop.trigger("move_list",
{id:h,type:f,before_id:j,parent_id:o,success:function(){if(!k&&q!==o){l.parent("li").children("i").remove();l.remove();a.categories_tree.setCollapsed(q)}},error:function(a){a&&console&&console.log(typeof a.errors!=="undefined"?a.errors:a);m.after(e.next()).after(e);if(!k){l.parent("li").children("i").show();l.show()}}})}}})},initDropInsideCollections:function(){a(".s-collection-list li.dr a").liveDroppable({tolerance:"pointer",greedy:!0,out:function(b,c){var d=c.draggable,e=a(this).parent();if(!d.hasClass("product")&&
e.attr("data-type")!=d.attr("data-type"))return!1;d.hasClass("product")&&c.helper.find("span").show().end().find("i").hide();e.removeClass("drag-newparent")},over:function(b,c){var d=c.draggable,e=a(this).parent(),f=d.attr("data-type");if(!d.hasClass("product")&&f!=e.attr("data-type"))return!1;"set"!=f&&e.addClass("drag-newparent");if(d.hasClass("product"))return e.hasClass("dynamic")?c.helper.find("span").hide().end().find("i").show():c.helper.find("span").show().end().find("i").hide(),!1;if(!d.hasClass("dynamic")&&
e.hasClass("dynamic"))return c.helper.find("i.no-bw").show(),!1;c.helper.find("i.no-bw").hide();var g='.dr[id!="'+d.attr("id")+'"]',h=a(),d=function(a,b){if(!b.length)return a;a=a.add(b.nextUntil(g).filter("li.drag-newposition"));return 0<b.nextAll(g).length?a:arguments.callee(a,b.parent().closest("li"))},f=e.prevAll(g+":first");if(0<f.length)var j=f.find(g),h=0<j.length?d(h,j.last()):d(h,f);else h=h.add(e.prevUntil(g).filter("li.drag-newposition"));var h=0<e.children("ul").children(g).length?h.add(e.children("ul").children("li.drag-newposition:first")):
d(h,e),i=a(".drag-newposition:animated, .drag-newposition.dragging").not(h);i.stop().animate({height:"2px"},300,null,function(){i.removeClass("dragging")});h.stop().animate({height:"10px"},300,null,function(){h.addClass("dragging")})},drop:function(b,c){var d=c.draggable,e=a(this).parent(),f=d.attr("data-type");if(!d.hasClass("product")&&("set"==f||e.attr("id")==d.attr("id")||f!=e.attr("data-type")))return!1;e.removeClass("drag-newparent");if(d.hasClass("product")){if(e.hasClass("dynamic"))return!1;
var g=a("#product-list"),h={};if(g.find(".s-select-all").is(":checked"))h.whole_list=!0;else{var j=g.find(".product.selected");h.product_ids=j.map(function(){return a(this).attr("data-product-id")}).toArray()}a.product_dragndrop.trigger("add_to_list",a.extend(h,{collection_param:e.attr("id").replace("-","_id="),success:function(a){h.whole_list?g.find(".s-select-all").trigger("select",!1):h.product_ids&&h.product_ids.length&&j.trigger("select",!1);a.data&&(e.find(">.counters .count:not(.subtree)").text(a.data.count),
e.find(">.counters .subtree").text(a.data.total_count))}}));return!1}if(!d.hasClass("dynamic")&&e.hasClass("dynamic"))return!1;var i=d.attr("id").split("-")[1];if(e.attr("id")=="category-"+i)return!1;if(d.hasClass("product"))return a("#product-list").find(".product.selected").trigger("select",!1),!1;var m=parseInt(e.attr("id").split("-")[1],10)||0,l=null,k=d.next(),q=d.prev(),o=!1;e.hasClass("drag-newposition")?l=e.parent("ul"):e.children("ul").length?l=e.children("ul"):e.find(">i.collapse-handler-ajax").length||
(l=a('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+f+'"></li></ul>').appendTo(e),l.find(".drag-newposition").mouseover(),a('<i class="icon16 darr overhanging collapse-handler-ajax unapproved" id="'+f+"-"+m+'-handler"></i>').insertBefore(e.children("a")),o=!0);var n=d.parent("ul"),r=n.children("li.dr[id!=category-"+i+"]").length,t=parseInt(n.parent().attr("id").split("-")[1],10)||0;l&&l.append(d).append(k);!r&&t!==m&&(n.parent("li").children("i").hide(),
n.hide());e.is("li.dr")&&a.product_dragndrop.trigger("move_list",{id:i,type:f,parent_id:m,success:function(b){if(!r&&t!==m){n.parent("li").children("i").remove();n.remove();a.categories_tree.setCollapsed(t)}if(l){a(".s-collection-list .unapproved").removeClass("unapproved");o?a.categories_tree.setExpanded(m):e.trigger("count_subtree")}else{d.remove();k.remove();e.trigger("update_counters",b.data.count||{})}},error:function(b){b&&console&&console.log(typeof b.errors!=="undefined"?b.errors:b);q.after(d).after(k);
if(!r){n.parent("li").children("i").show();n.show()}a(".s-collection-list .unapproved").remove()}})}})},_scrolHelper:function(){var b=a("#products-helper"),c=b.data("scrollTop"),d=a(document).scrollTop();b.css("top",b.position().top+(c?d-c:50)+"px");b.data("scrollTop",d)},_extDragActivate:function(b,c){if(c.hasClass("last")){var d=b.pageX,e=b.pageY,f=c.width(),g=c.height(),h=c.offset();"thumbs"==a.product_dragndrop.options.view?d>h.left+0.5*f?c.removeClass("drag-active").addClass("drag-active-last"):
d>h.left&&c.removeClass("drag-active-last").addClass("drag-active"):"table"==a.product_dragndrop.options.view&&(e>h.top+0.5*g?c.removeClass("drag-active").addClass("drag-active-last"):e>h.top&&c.removeClass("drag-active-last").addClass("drag-active"));(e<h.top||e>h.top+g||d<h.left||d>h.left+f)&&c.removeClass("drag-active drag-active-last")}else c.addClass("drag-active")}}})(jQuery);(function(a){var b=function(a){var b=/^category-(.*?)-handler$/;return b.test(a.attr("id"))?a.attr("id").replace(b,function(a,b){return parseInt(b,10)||0}):0},c=function(a){if(b(a))a=a.parents("li:not(.drag-newposition):first"),d=c=a.find("ul:first");else var a=a.parent(),c=a.next(),d=c.find("ul:first");return{parent:a,target:c,ul:d}},d=function(a,b){var d=c(a);"category"==d.parent.attr("data-type")&&d.parent.trigger("count_subtree",!1);a.removeClass("rarr").addClass("darr");d.target.show();"function"===
typeof b&&b(a)},e=function(a,b){var c=a.parent.find(".loading:first"),d=a.parent.find(".counters");b?(c.show(),d.hide()):(c.hide(),d.show())},f=function(d,e){var f=c(d);"category"==f.parent.attr("data-type")&&f.parent.trigger("count_subtree",!0);d.removeClass("darr").addClass("rarr");f.target.hide();"function"===typeof e&&e(d);a.get("?action=categoryExpand&id="+b(d)+"&collapsed=1")},g=function(f,g){if(!f.data("loading_content")){var i=c(f);i.parent.find(".loading:first");i.ul.length?d(f,g):e(i,!0);
var m=!i.ul.length;f.data("loading_content",m);a.get("?action=categoryExpand&id="+b(f)+(m?"&tree=1":""),function(a){m&&(i.target.length?i.target.append(a):i.parent.append(a),e(i,!1),d(f,g),f.data("loading_content",!1))})}};a.categories_tree={init:function(){a("#s-category-list-handler").parent().parent().off("click",".collapse-handler-ajax").on("click",".collapse-handler-ajax",function(){var b=a(this);b.hasClass("darr")?f(b):g(b)})},collapse:function(b,c){b=a(b);b.hasClass("darr")?f(b,c):"function"===
typeof c&&c(b)},expand:function(b,c){b=a(b);b.hasClass("rarr")?g(b,c):"function"===typeof c&&c(b)},setExpanded:function(b){a.get("?action=categoryExpand&id="+b)},setCollapsed:function(b){a.get("?action=categoryExpand&id="+b+"&collapsed=1")},getHandlerByCategoryId:function(b){var c=a();return c=(b=parseInt(b,10)||0)?a("#category-"+b+"-handler"):a("#s-category-list-handler")}}})(jQuery);(function(a){Array.prototype.filter||(Array.prototype.filter=function(a,c){var d=this.length;if("function"!=typeof a)throw new TypeError;for(var e=[],f=0;f<d;f++)if(f in this){var g=this[f];a.call(c,g,f,this)&&e.push(g)}return e});a.storage=new a.store;a.products={hash:"",list_hash:"",list_params:{},options:{view:"thumbs"},random:"",init:function(b){a.extend(this.options,b);this.initRouting();this.initSearch();this.initSidebar();a.categories_tree.init();this.initCollapsible()},data:{prev_action:null},
initRouting:function(){typeof a.History!="undefined"&&a.History.bind(function(){a.products.dispatch()});a.wa.errorHandler=function(b){if(b.status===403||b.status===404){b=a(b.responseText);console.log(b);b=b.find(".dialog-content").length?a('<div class="block double-padded"></div>').append(b.find(".dialog-content *")):a('<div class="block double-padded"></div>').append(b.find(":not(style)"));a("#s-content").empty().append(b);return false}return true};var b=window.location.hash;b==="#/"||!b?this.dispatch():
a.wa.setHash(b)},dispatch:function(b){if(b===void 0)b=window.location.hash;this.hash=b=b.replace(/(^[^#]*#\/*|\/$)/g,"");try{if(b){b=b.split("/");if(b[0]){for(var c="",d=b.length,e=0;e<b.length;e++){var f=b[e];if(e<2)if(e===0)c=f;else if(c=="product"||c=="tag"||c=="search"||c=="plugins"||c=="pages"||c=="stocks"){d=e;break}else if(parseInt(f,10)!=f&&f.indexOf("=")==-1)c=c+(f.substr(0,1).toUpperCase()+f.substr(1));else{d=e;break}else{d=e;break}}var g=b.slice(d);this.preExecute(c,g);if(typeof this[c+
"Action"]=="function"){a.shop.trace("$.products.dispatch",[c+"Action",g]);this[c+"Action"].apply(this,g)}else a.shop.error("Invalid action name:",c+"Action")}else{this.preExecute();this.defaultAction()}}else{this.preExecute();this.defaultAction()}}catch(h){a.shop.error(h.message,h)}},load:function(b,c){var d=Math.random();this.random=d;var e=this;a.get(b,function(b){if(e.random==d){a("#s-content").removeClass("bordered-left").html(b);a("html, body").animate({scrollTop:0},200);if(c)try{c.call(this)}catch(g){a.shop.error("$.products.load callback error: "+
g.message,g)}}})},addOptions:function(b){this.options=a.extend(this.options,b||{})},preExecute:function(b){try{if(this.data.prev_action&&this.data.prev_action!=b){var c=this.data.prev_action+"Termination";a.shop.trace("$.products.preExecute",[c,b]);typeof this[c]=="function"&&this[c].apply(this,[])}this.data.prev_action=b}catch(d){a.shop.error("preExecute error: "+d.message,d)}},defaultAction:function(){this.productsAction()},buildProductsUrlComponent:function(a){return"view="+(a.view||this.options.view)+
(a.category_id?"&category_id="+a.category_id:"")+(a.set_id?"&set_id="+a.set_id:"")+(a.tag?"&tag="+a.tag:"")+(a.sort?"&sort="+a.sort:"")+(a.order?"&order="+a.order:"")+(a.text?"&text="+a.text:"")+(a.edit?"&edit="+a.edit:"")+(a.hash?"&hash="+a.hash:"")+(a.type_id?"&type_id="+a.type_id:"")},productsAction:function(){var b=Array.prototype.join.call(arguments,"/"),b=a.shop.helper.parseParams(b||"");if(!b.view)b.view=a.storage.get("shop/products/view")||this.options.view;a.storage.set("shop/products/view",
b.view);this.list_hash=this.hash;this.list_params=b;this.load("?module=products&"+this.buildProductsUrlComponent(b))},productAction:function(b,c,d){var e=Array.prototype.slice.call(arguments).filter(function(a){return a.length}).join("/");a.shop.trace("$.products.productAction",[e,arguments]);var f="?module=product";b&&(f=f+("&id="+b));typeof a.product!="undefined"?a.product.dispatch(e):this.load(f,function(){a.product.dispatch(e)})},productTermination:function(){typeof a.product!="undefined"&&a.product.termination()},
reviewsAction:function(){this.load("?module=reviews")},stocksAction:function(a){this.load("?module=stocks"+(a?"&order="+a:""))},servicesAction:function(b){this.load("?module=services"+(b?"&id="+b:""),function(){a("#s-content").addClass("bordered-left");typeof a.products.afterServicesAction==="function"&&a.products.afterServicesAction()})},initCollapsible:function(){var b=function(b,e){a(b).removeClass("darr").addClass("rarr");c(b).hide();e||a.storage.set("shop/products/"+b.id+"/collapse",1)},c=function(b){b=
a(b).parent();return b.is("li")?b.find("ul:first"):b.next()};a(".collapse-handler").die("click").live("click",function(){if(a(this).hasClass("darr"))b(this);else{c(this).show();a(this).removeClass("rarr").addClass("darr");a.storage.del("shop/products/"+this.id+"/collapse")}}).each(function(){a.storage.get("shop/products/"+this.id+"/collapse")&&b(this,true)})},initSearch:function(){var b=function(){var b=this.value,d=a.products.hash.match(/[&\/](text=.*?&|text=.*)/),e=a.products.hash;if(d){d=d[1];
if(b){b=d.substr(-1)=="&"?"text="+encodeURIComponent(b)+"&":"text="+encodeURIComponent(b);e=e.replace(d,b)}else{d.substr(-1)!="&"&&(d="[&/]"+d);e=e.replace(RegExp(d),"")}}else if(b){delete a.products.list_params.text;e="products/"+a.products.buildProductsUrlComponent(a.products.list_params)+"&text="+encodeURIComponent(b)}else e="products/"+a.products.buildProductsUrlComponent(a.products.list_params);location.hash="#/"+e};a("#s-products-search").unbind("keydown").bind("keydown",function(c){if(c.keyCode==
13){b.call(this);a(this).autocomplete("close");return false}});a("#s-products-search").unbind("search").bind("search",function(){b.call(this);return false});a("#s-products-search").autocomplete({source:"?action=autocomplete",minLength:3,delay:300,select:function(b,d){a.wa.setHash("#/product/"+d.item.id);return false}})},initSidebar:function(){var b=a("#s-sidebar");a.product_dragndrop.init({collections:true}).bind("move_list",function(b){if(b.type){var c={id:b.id,type:b.type,parent_id:b.parent_id||
0};if(b.before_id)c.before_id=b.before_id;a.products.jsonPost("?module=products&action=moveList",c,b.success,b.error)}else typeof b.error==="function"&&b.error("Unknown list type")});b.off("add",".s-collection-list ul").on("add",".s-collection-list ul",function(b,c,f,g){var b=a(this),h=b.parents(".s-collection-list:first"),j=a("<ul></ul>");j.append(tmpl("template-sidebar-list-item",{type:f,item:c}));var c=j.children(":not(.drag-newposition):first"),f=c.attr("id"),f=b.find("#"+f),i=j.children();f.length?
g&&f.replaceWith(c):b.prepend(i).show();i.each(function(){var b=a(this);b.hasClass("dr")?b.find("a").mouseover():b.mouseover()});b.find(".drag-newposition").css({height:"2px"}).removeClass("dragging");h.find(".s-empty-list").hide();j.remove();return false});b.unbind("update").bind("update",function(b,c){for(var f in c)if(f=="all")a("#s-all-products").find(".count:first").text(c[f].count);else{var g="#"+f+"-",h;for(h in c[f])a(g+h).find(".count:first").text(c[f][h].count)}return false});a("#s-tag-cloud").unbind("update").bind("update",
function(b,c){var f='<ul class="tags"><li class="block align-center">',g;for(g in c)var h=c[g],f=f+('<a href="#/products/tag='+h.uri_name+'/" style="font-size: '+h.size+"%; opacity: "+h.opacity+'"  data-id="'+h.id+'"  class="s-product-list">'+h.name+"</a>");a("#s-tag-cloud").html(f+"</li></ul>").parents(".block:first").show();return false});b.off("count_subtree",".s-collection-list li").on("count_subtree",".s-collection-list li",function(b,c){var f=a(this);typeof c==="undefined"&&(c=f.find("i.collapse-handler-ajax").hasClass("rarr"));
var g=f.find(">.counters .count:not(.subtree)"),h=f.find(">.counters .subtree");if(!h.length){h=g.clone().addClass("subtree").hide();g.after(h)}if(c){var j=parseInt(g.text(),10)||0;f.find("li.dr:not(.dynamic)>.counters .count:not(.subtree)").each(function(){j=j+(parseInt(a(this).text(),10)||0)});h.text(j).show();g.hide();g.hide();h.show()}else{h.hide();g.show()}return false});b.off("update_counters",".s-collection-list li").on("update_counters",".s-collection-list li",function(b,c){var f=a(this),
g=f.find(">.count:not(.subtree)"),f=f.find(">.subtree");if(!f.length){f=g.clone().addClass("subtree").hide();g.after(f)}typeof c.item!=="undefined"&&g.text(parseInt(c.item,10)||0);typeof c.subtree!=="undefined"&&f.text(parseInt(c.subtree,10)||0);return false});var c=b.find("#s-category-list-widen-arrows");c.find("a.arrow").unbind("click").bind("click",function(){var d=b.attr("class"),e=0,f=d.match(/left([\d]{2,3})px/);if(f&&f[1]&&(e=parseInt(f[1]))){f=e+(a(this).is(".right")?50:-50);f=Math.max(Math.min(f,
400),200);if(f!=e){c.css({width:f.toString()+"px"});e=["left"+e+"px","left"+f+"px"];b.attr("class",d.replace(e[0],e[1]));b.css("width","");var g=a("#s-content"),d=g.attr("class");g.attr("class",d.replace(e[0],e[1]));g.css("margin-left","");a.product&&a.product.setOptions({sidebar_width:f});a.shop.jsonPost("?action=sidebarSaveWidth",{width:f})}}return false})},jsonPost:function(b,c,d,e){a.shop.jsonPost(b,c,d,e)}}})(jQuery);(function(a){a.product={options:{duration:200,container_selector:"#shop-productprofile",message_selector:"#product-save-message",form_selector:"#s-product-save",update_delay:100},message:{submit:'<i class="icon16 loading"></i>',success:'<i class="icon16 yes"></i>',error:'<i class="icon16 no"></i>'},path:{id:null,mode:null,tab:null,tail:null,raw:null,params:{}},ajax:{random:null,target:null,link:null,save:!1,cached:{}},data:{main:{}},getData:function(a,c){return(this.data[a]||{})[c]},setData:function(a,
c,d){this.data[a]=this.data[a]||{};this.data[a][c]=d},changes:{},standalone_tabs:["images","services","pages","reviews"],init:function(a,c){this.setOptions(a,c)},setOptions:function(b,c){c?this[c+"_options"]=a.extend(this[c+"_options"]||{},b||{}):this.options=a.extend(this.options,b||{});this.options.sidebar_width=this.options.sidebar_width||250},get:function(b){if(this.options[b+"_selector"])return a(this.options[b+"_selector"]);throw new exception("");},parsePath:function(b){var b=b.replace(/^.*#\//,
"").replace(/(^\/|\/$)/,""),c=b.split("/"),d=c.pop(),e={};d.match(/^[\w_\-]+=/)?e=a.shop.helper.parseParams(d):c.push(d);return{id:c[0]||"new",mode:c[1]||"profile",tab:c[1]?c[2]||"main":!1,tail:c.slice(3).join("/")||"",raw:b,params:e}},dispatch:function(b){"string"==typeof b&&(b=this.parsePath(b));var c=[];a.shop.trace("$.product.dispatch",[this.path,b,b.raw]);if(!this.path.id){var d=this.get("container");d.length&&(this.path.id=d.data("product-id"),c.push("load"))}if(this.path.id!=b.id)this.path.id&&
c.push("blur"),c.push("load");else{d="undefined";this.path.mode!=b.mode?(a.shop.trace("$.product.dispatch mode",this.path.mode+"->"+b.mode),this.path.mode&&this.path.tab?(a.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+b.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(this.path.mode+"Tab"+d+"Blur"),c.push(this.path.mode+"TabBlur"),c.push(this.path.mode+"Blur")):c.push("focus"),c.push(b.mode+"Init"),c.push(b.mode+"Focus")):this.path.tab&&b.tab!=this.path.tab&&
(a.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+b.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(b.mode+"Tab"+d+"Blur"),c.push(b.mode+"TabBlur"));c.push(b.mode+"Action");var e=this.tabIsLoaded(b);b.tab&&(d=b.tab.substr(0,1).toUpperCase()+b.tab.substr(1));if(b.tab&&b.tab!=this.path.tab)if(a.shop.trace("$.product.dispatch tabFocus",this.path.tab+"->"+b.tab),e)c.push(b.mode+"TabShow"),c.push(b.mode+"TabInit"),c.push(b.mode+"Tab"+d+"Init"),c.push(b.mode+"TabFocus"),
c.push(b.mode+"Tab"+d+"Focus");else{c.push(b.mode+"TabFocus");var f=b.mode+"Tab"+d+"Load";this.isCallable(f)?c.push(f):c.push(b.mode+"TabLoad")}b.tab&&e&&c.push(b.mode+"Tab"+d+"Action")}for(d=0;d<c.length;d++)if(!1===this.call(c[d],[b]))return!1},termination:function(){var a=[];if(this.path.mode&&this.path.tab){var c=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1);a.push(this.path.mode+"Tab"+c+"Blur");a.push(this.path.mode+"TabBlur");a.push(this.path.mode+"Blur")}a.push("blur");for(c=
0;c<a.length;c++)this.call(a[c],[])},isCallable:function(a){return"function"==typeof this[a]},tabIsLoaded:function(b){return a("#s-product-edit-forms .s-product-form."+b.tab).length?!0:!1},call:function(b,c){var d=null,e=this.isCallable(b),c=c||[];a.shop.trace("$.product.call",[b,c,e]);if(e)try{d=this[b].apply(this,c)}catch(f){a.shop.error("Error at method $.product."+b+". Original message: "+f.message,f)}return d},load:function(b){var c=this.get("container");if(!c.length||c.data("product-id")!=b.id){var d=
this,c="?module=product&id="+b.id;a.shop.trace("$.product.load product",c);a.products.load(c,function(){d.dispatch(b)})}this.editTabMainData.sku_id="new"==b.id?-1:0;this.editTabMainData.stocks={}},focus:function(){a("*").off(".product");this.helper.init()},blur:function(){this.path.id=null;this.path.mode=null;this.path.tab=null;this.path.tail=null;a("*").off(".product");a("#mainmenu .s-level2").show();a("#s-product-edit-menu, #s-product-edit-save-panel").hide();a("#s-sidebar").show().animate({width:a.product.options.sidebar_width},
"fast").queue(function(){a(this).dequeue()});a("#s-toolbar").show().animate({width:"200px"});a("#maincontent").animate({"margin-top":"84px"},"fast");a("#s-content").animate({"margin-left":a.product.options.sidebar_width},"fast")},saveData:function(b,c,d){var e=this,f=e.get("form"),g,h="radio",j=f.find('input[name="product[sku_type]"]:first');j.is(":radio")?(g=f.find('input[name="product[sku_type]"]:checked').val(),j=f.find('input[name="product[sku_type]"]')):(h="hidden",g=j.val());if("1"==g&&!a("#s-product-feature-superposition").find("input:checked:first").length)return"radio"==
h&&(j.filter("[value=0]").attr("checked",!0),a.product.onSkuTypeChange(0)),!1;if(e.ajax.save)return setTimeout(function(){e.saveData(b,c,d)},100),!1;if(this.path.tab&&(g="editTab"+this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1)+"Save",!1===this.call(g)))return!1;e.ajax.save=!0;this.editorUpdateSource({id:"s-product-description-content"});f.find(".s-price").find("input").each(function(){this.value=this.value.replace(/\s+/g,"")});a.shop.trace("$.product.saveData("+b+","+c+")");a(f).find(':input[name^="product["]:not(:disabled)').each(function(){var b=
a(this).attr("type");if(b!="text"&&b!="textarea")return true;this.defaultValue==this.value?a(this).attr("disabled",true).addClass("js-ajax-disabled"):a(this).hasClass("js-ajax-disabled")&&a(this).removeAttr("disabled").removeClass("js-ajax-disabled")});this.refresh("submit");a("#product-tags_tag").trigger(jQuery.Event("keypress",{which:13}));a.ajax({url:a(f).attr("action"),data:a(f).serialize(),dataType:"json",type:"post",success:function(f){if(f.status=="fail")e.refresh("error",f.errors);else if(f.data.redirect){a.shop.trace("$.product.saveData redirect",
f.data.redirect);window.location.href=f.data.redirect}else{e.refresh("success",f.data.message||"");a.shop.trace("$.product.saveData updateData",[b,c]);e.updateData(f.data,b,c);d&&typeof d=="function"&&d();if(e.path.tab){f="editTab"+e.path.tab.substr(0,1).toUpperCase()+e.path.tab.substr(1)+"Saved";if(e.call(f)===false)return false}}e.ajax.save=false},error:function(a,b){e.ajax.save=false;e.refresh("error",b)}});return!1},updateData:function(b,c,d){a.shop.trace("$.product.updateData("+c+","+d+")",b);
var e=a("#s-product-edit-forms .s-product-form.main"),f=this.path.id;if(!this.path.id||"new"==this.path.id){this.path.id=b.id;a(this.options.container_selector).data("product-id",this.path.id);var g="/product/"+this.path.id+"/";if(null!==c&&(c=c||this.path.mode||"profile"))if("profile"!=c&&(g+=c+"/"),null!==d&&(d=d||this.path.tab||""))"main"!=d.toLowerCase()&&(g+=d+"/");a.shop.trace("update location.hash="+g);var h=/#\/product\/new\//,j="#/product/"+this.path.id+"/";a("#shop-productprofile, #s-product-edit-menu, #s-product-edit-forms, #s-product-profile-page").find('[href*="#/product/new/"]').each(function(){a(this).attr("href",
a(this).attr("href").replace(h,j))});a("#s-product-edit-forms").find(':input[name="product[id]"]').val(this.path.id);window.location.hash=g}else this.path.id!=b.id&&a.shop.error("Abnormal product ID change",[this.path.id,b]);c=a("#shop-productprofile h1");c.find(".s-product-name:first").text(b.name);c.find(".s-product-id").show().text("id: "+b.id);document.title=b.name+a.product.options.title_suffix;e.find(':input[name="product[type_id]"]').parents(".value").data("type",b.type_id);b.frontend_url?
(c=a("#s-product-frontend-url"),d=a("#s-product-frontend-url-input"),c.text(b.url),d.val(b.url),c.trigger("readable"),c.parent().attr("href",b.frontend_url),c.parents("div.value:first").find(".s-frontend-base-url").each(function(){if("A"==this.tagName){var c=a(this),d=c.children();c.text(b.fontend_base_url).append(d)}else a(this).text(b.fontend_base_url)}),a(".s-product-frontend-url-not-empty").show(),a(".s-product-frontend-url-empty").hide(),a("#s-product-frontend-links").find("a").attr("href",b.frontend_url).text(b.frontend_url)):
(a(".s-product-frontend-url-not-empty").hide(),a(".s-product-frontend-url-empty").show());this.editTabMainUpdate(b.raw||{},b.features_selectable_strings,f);e.find("select.s-product-categories").each(function(){var b=a(this),c=b.parent(),d=b.val();if(d=="select"||d=="---"){d=a("#s-product-edit-forms .s-product-form.main select.s-product-categories");d.length>1?c.remove():c.find(".s-product-delete-from-category").hide()}else if(d=="create"){var e=c.find("input.val").val();if(e=="0"){d=a("#s-product-edit-forms .s-product-form.main select.s-product-categories");
if(d.length>1)c.remove();else{b.val(e);b.show().attr("disabled",false);c.find("input.val").attr("disabled",true);c.find(".s-new-category").hide();c.find(".s-product-delete-from-category").hide()}}else{b.val(e);b.show().attr("disabled",false);c.find("input.val").attr("disabled",true);c.find(".s-new-category").hide();c.find(".s-product-delete-from-category").show()}}});a("#s-product-save table.s-product-skus > tbody > tr").each(function(){var c=a(this).data("id");a(this).find("td.s-stock .s-product-stock-icon").each(function(){var d=
a(this).data("stock");b.raw&&(b.raw.skus&&b.raw.skus[c]&&b.raw.skus[c].stock_icon[d])&&a(this).html(b.raw.skus[c].stock_icon[d])})});e.find("tr.js-sku-settings").each(function(){var c=a(this),d=c.attr("data-id");if((d=b.raw.skus[d])&&d.file_name!==void 0&&!d.file_name){c.find(".s-sku-attachment").hide();c.find(".fileupload").show()}});this.helper.checkChanges(this.get("form"),!0,b.raw||{});a("#s-product-edit-menu li a i.icon10.status-yellow-tiny").remove();a("#s-product-edit-save-panel :submit").removeClass("yellow").addClass("green");
"0"==b.raw.sku_type&&(e=a("#s-product-feature-superposition"),e.find("input[type=checkbox]").attr("checked",!1),f=e.find("ul.features li"),f.find(".count").text(""),f.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass("status-gray-tiny"),e=e.find(".superposition-count"),e.find(".options").text(""),e.find(".skus").text(""))},refresh:function(b,c){a(this.options.form_selector).find(':input[name^="product["]:disabled.js-ajax-disabled').each(function(){a(this).removeAttr("disabled").removeClass("js-ajax-disabled")});
var d=a(this.options.message_selector);d.removeClass("errormsg successmsg status").empty().show();this.timer&&clearTimeout(this.timer);var e=null;d.append(this.message[b]||"");switch(b){case "submit":d.addClass("status");break;case "error":d.addClass("errormsg");for(e=0;e<c.length;e++)d.append(c[e][0]);e=2E4;break;case "success":c&&d.addClass("successmsg").append(c),e=3E3,a("#s-product-edit-save-panel :submit").removeClass("yellow").addClass("green")}e&&(this.timer=setTimeout(function(){d.removeClass("errormsg successmsg status").empty().show()},
e))},editTabLoad:function(b,c){var d=this,e=a("#s-product-edit-forms .s-product-form."+b.tab);c||!e.length&&"new"==b.id?(a.shop.trace("product.profileTabHandler: create",[b.tab+" \u2014 create",b]),this.saveData(this.path.mode,b.tab,function(){b.tab&&d.call(b)})):this.editTabLoadContent(b)},editTabLoadContent:function(b,c){var d=this,b=b||this.path,e="?module=product&action="+b.tab+"&id="+b.id;b.tail&&"undefined"!=typeof b.tail&&(e+="&param[]="+b.tail.split("/").join("&param[]="));var f=Math.random();
this.ajax.random=f;var g=a("#s-product-edit-forms .s-product-form."+b.tab);g.length&&g.remove();a("#s-product-edit-forms > form").append(tmpl("template-productprofile-tab",{id:b.tab}));g=a("#s-product-edit-forms .s-product-form."+b.tab);this.ajax.target=g;this.ajax.link=a("#s-product-edit-menu li."+b.tab);a.shop.trace("$.product.editTabLoadContent",[b,e,c]);a.ajax({url:e,type:c?"POST":"GET",data:c||{},success:function(c,e){a.shop.trace("$.product.loadTab status="+e);if(d.ajax.random==f){g.empty().append(c);
d.ajax.target=null;d.ajax.link=null;var i="#/product/"+b.id+"/edit/";b.tab&&(i+=b.tab+"/");b.tail&&(i+=b.tail+"/");window.location.hash=i;d.dispatch(b)}}})},editTabInit:function(){a("html, body").animate({scrollTop:0},200);a("#shop-productprofile").find(".s-product-name").removeClass("editable")},editTabFocus:function(b){a("#s-product-edit-menu li."+b.tab).addClass("selected");this.refresh()},editTabBlur:function(b){if(b){var c=this,d=b.tab;-1!==this.standalone_tabs.indexOf(d)&&this.helper.checkChanges(this.get("form"),
!0)&&this.saveData(this.path.mode,d,function(){d&&c.call(b)});a("#s-product-edit-forms .s-product-form").hide();a("#s-product-edit-menu li.selected").removeClass("selected");this.path.tab=null;this.path.tail=null}},editTabShow:function(b){var c=a("#s-product-edit-forms .s-product-form."+b.tab);c.length?(c.show(),a.shop.trace("$.product.showTab",b),this.path.tab=b.tab):a.shop.error("$.product.showTab",b)},editClick:function(b){var c=b.attr("href").replace(/.*#\/product\/(\d+|new)\/edit\//,"").replace(/\/$/,
"").split("/"),d=[],e;if(c.length){a.shop.trace("$.product.editClick",c);for(var f,g="editTab";f=c.shift();)g+=f.substr(0,1).toUpperCase()+f.substr(1),f="function"==typeof this[g],a.shop.trace("$.settings.featuresClick try",[g,f,c]),!0===f&&(e=g,d=c.slice(0))}if(e){if(a.shop.trace("$.product.editClick",[e,d]),!b.hasClass("js-confirm")||confirm(b.attr("title")||"Are you sure?")){d.push(b);try{this[e].apply(this,d)}catch(h){a.shop.error("Error: "+h.message,h)}}}else a.shop.error("Not found js handler for link",
[e,b]);return!1},switchSubMenu:function(b){b=b||"default";a("#mainmenu .s-submenu > *").hide();a("#mainmenu .s-submenu .s-submenu-"+b).show()},profileFocus:function(){var b=this.options.duration,c=this;a("#s-product-edit-menu, #s-product-edit-save-panel").hide();c.switchSubMenu();a("#s-sidebar").show().animate({width:a.product.options.sidebar_width});a("#s-toolbar").show().animate({width:"200px"},b).queue(function(){a(this).dequeue();a("#s-product-edit-forms").hide();a("#s-product-profile-page, h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").show();
c.get("container").find(".back").attr("href","#/"+a.products.list_hash)});a("#maincontent").animate({"margin-top":"84px"},b);a("#s-content").animate({"margin-left":a.product.options.sidebar_width},b);a("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(a(this))})},profileAction:function(){this.path.mode="profile"},disableSkus:function(b,c){var d=a(this.options.form_selector).find(".s-product-skus");b?c?d.find(".s-sku-virtual").hide().find("input").attr("disabled",
!0):d.find(".s-sku-virtual").show().find("input").attr("disabled",!1):(c?d.hide():d.show(),d.find("input").attr("disabled",c))},onSkuTypeChange:function(b){var c=a("#s-product-feature-superposition-field-group"),d=a(this.options.form_selector).find(".s-product-skus tbody");"1"==b?(c.show(),c.find("input").attr("disabled",!1),"new"==a.product.path.id?a.product.disableSkus(!1,!0):a.product.disableSkus(!0,!1)):(c.hide(),c.find("input").attr("disabled",!0),"new"==a.product.path.id?a.product.disableSkus(!1,
!1):(a.product.disableSkus(!0,!0),d.find("tr:not(.s-sku-virtual)").length||(a.product.editTabMainSkuAdd(),d.find("tr:not(.s-sku-virtual):first").find('input[name="product[sku_id]"]').attr("checked",!0))))},featureSelectableInit:function(){var b=a(this.options.form_selector),c=a("#s-product-feature-superposition"),d=b.find(".s-product-skus"),e=a.product.getSkyType();a.product.onSkuTypeChange(e);b.on("change",'input[name="product[sku_type]"]',function(){a.product.onSkuTypeChange(this.value)});c.on("click",
"ul.features>li",function(){var b=a(this);b.parent().find("li.selected").removeClass("selected");b.addClass("selected");b=b.attr("data-feature-id");b=c.find(".feature-values[data-feature-id="+b+"]");c.find(".feature-values").hide();b.show();return!1});c.on("change","ul.values>li input",function(){var b=a(this).parents("li:first").parent().find(">li input:checked").length,d=c.find("ul.features li.selected");d.find(".count").text(b||"");d.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass(b?
"status-blue-tiny":"status-gray-tiny");var e=[];c.find("ul.features>li").each(function(){var b=a(this);(b=parseInt(b.find(".count").text(),10))&&e.push(b)});b=c.find(".superposition-count");if(e.length){b.find(".options").text(e.join(" x ")+" "+$_("options"));for(var d=1,j=0,i=e.length;j<i;j+=1)d*=e[j];b.find(".skus").html('<span class="highlighted">'+$_("%d SKUs in total").replace("%d",d)+"</span>")}else b.find(".options").text(""),b.find(".skus").html("")});d.on("change","input, textarea",function(){var b=
a(this);if("product[sku_id]"!=b.attr("name")&&(b=b.parents("tr:first"),b.length)){var c=parseInt(b.attr("data-id"),10);if(c){if(b.hasClass("js-sku-settings")&&(b=d.find("tr[data-id="+c+"]:first"),!b.length))return;b.find("input.s-input-virtual").val(0);b.removeClass("s-sku-virtual");a("#s-product-view").find("tr[data-id="+c+"]").removeClass("s-sku-virtual")}}})},editInit:function(){a("#s-product-edit-forms").unbind("keydown.product").bind("keydown.product",function(b){if(a(b.target).is(":input")&&
b.ctrlKey&&83==b.keyCode)return a("#s-product-save-button").click(),!1});a.shop.makeFlexibleInput("s-product-meta-title");if(!this.options.edit_rights)return window.location.hash="#/product/"+this.path.id+"/",!1;var b=a(this.options.form_selector);b.bind("submit.product",function(){return a.product.saveData("profile",null)});b.on("change.product, keyup.product","div.s-product-form:not(.ajax) :input",function(){a.product.helper.onChange(a(this).parents("div.s-product-form"))});b.on("change.product, keyup.product, keypress.product",
':input[name="product[name]"]',function(){a.product.helper.onNameChange(a(this),!1,a.product.options.update_delay||500)});var c=a("#product-tags");c.data("tags_input_init")||c.tagsInput({autocomplete_url:"?module=product&action=tagsAutocomplete",height:120,defaultText:""}).data("tags_input_init",!0);b.on("change.product",".s-product-currency",function(){var c=a(this).val();b.find(".s-product-currency").val(c);b.find(".s-product-currency-readonly").text(c);a("#s-product-currency-code").val(c)});b.on("change.product",
':input[name="product[type_id]"]',function(){return a.product.editTabMainTypeChange(a(this))});b.on("change",'select[name="product[status]"]',function(){"1"==a(this).val()?(a(this).prev().removeClass("no-bw").addClass("yes"),a(".s-product-status-text").hide()):(a(this).prev().removeClass("yes").addClass("no-bw"),a(".s-product-status-text").show())});this.featureSelectableInit()},editFocus:function(){var b=this.options.duration,c=this;a("h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").hide();
a("#s-sidebar, #s-toolbar").animate({width:0},b).queue(function(){a(this).hide();a(this).dequeue();a("#s-product-edit-menu, #s-product-edit-forms, #s-product-edit-save-panel").show();"new"!=c.path.id?c.get("container").find(".back").attr("href","#/product/"+c.path.id+"/"):c.get("container").find(".back").attr("href","#/"+a.products.list_hash);a("#s-product-profile-page").hide();c.switchSubMenu("productprofile")});a("#maincontent").animate({"margin-top":"40px"},b);a("#s-content").animate({"margin-left":0},
b);a("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(a(this))})},editBlur:function(){this.path.tab=!1;this.path.mode=!1;a(a.product.options.form_selector).off("submit.product");a(this.options.form_selector).off("change.product, keyup.product");a("#s-product-edit-forms").off("click.edit-product")},editAction:function(a){this.path.mode=a.mode},editTabMainData:{sku_id:-1,stocks:{}},editTabMainInit:function(b){a("#s-product-type").each(function(){a(this).parent().get(0)!=
document.body&&(a("body > #s-product-type").remove(),a(document.body).append(a(this)))});var c=a("#s-product-edit-forms .s-product-form.main"),d=this,e=c.find("table.s-product-skus:last > tbody");e.sortable({distance:5,helper:"original",items:"> tr",handle:"i.sort",opacity:0.75,tolerance:"pointer",update:function(b,c){var f=parseInt(a(c.item).data("id"),10),i=a(c.item).prev().data("id"),i=void 0===i?0:parseInt(i,10);d.editTabMainSkuSort(f,i,a(this));i=e.find('> tr.js-sku-settings[data-id="'+f+'"]');
i.length&&(i=i.detach(),a.shop.trace("detach",i),i&&(a.shop.trace("detach",e.find('> tr[data-id="'+f+'"]').length),e.find('> tr[data-id="'+f+'"]:first').after(i)))},start:function(){e.find("> tr.js-sku-settings").hide()},stop:function(){e.find("> tr.js-sku-settings").show()}});var f=a("#s-product-frontend-url");f.inlineEditable({editLink:"#s-product-frontend-url-edit-link",editOnItself:!1,minSize:{height:15,width:100},makeReadableBy:[],beforeMakeEditable:function(b){var c=a(this).parents("div:first"),
d=c.find("span.slash"),e=c.find("i.new-window");a(b).after(d);e.hide();c.find("span.s-frontend-base-url").html(c.find("a.s-frontend-base-url").hide().contents()).show()},beforeBackReadable:function(){var b=a(this),c=b.parents("div:first"),d=c.find("span.slash"),e=c.find("i.new-window");b.after(d);e.show();c.find("a.s-frontend-base-url").html(c.find("span.s-frontend-base-url").hide().contents()).show()}});parseInt(b.id,10)||f.trigger("editable");"new"==b.id&&a.product_list&&(a.isArray(a.product_list.collection_hash)&&
"category"==a.product_list.collection_hash[0])&&c.find("select.s-product-categories").val(a.product_list.collection_hash[1]);c.off("change.product","select.s-product-categories").on("change.product","select.s-product-categories",function(){var b=a(this),c=b.val(),d=b.parent(),e=d.find(".s-product-delete-from-category");parseInt(c,10)?e.show():e.hide();"create"==c?(d.find(".s-new-category").show(),d.find("input.val").attr("disabled",!1),b.hide().attr("disabled",!0).addClass("js-ignore-change")):d.find("input.val").val(parseInt(c,
10)||0)});c.off("keydown.product","input.new-category").on("keydown.product","input.new-category",function(b){if(13==b.keyCode)return a(this).parent().find("input[type=button]").click(),!1});c.off("click.product",".s-new-category input[type=button]").on("click.product",".s-new-category input[type=button]",function(){var b=a(this).parent(),c=b.parent(),d=b.find("input[name=new_category]"),e=d.val();a.shop.jsonPost("?module=products&action=saveListSettings&category_id=0&parent_id=0",{name:e},function(e){var f=
c.find("select"),i=f.find("option.separator:first").show();a.when(i.after('<option class="category" value="'+e.data.id+'">'+e.data.name+"</option>")).then(function(){f.find("option:first").text($_("Please select a category"));f.val(e.data.id).attr("disabled",!1).show().removeClass("js-ignore-change");b.find("input.val").val(e.data.id).attr("disabled",!0);b.hide();c.find(".s-product-delete-from-category").show();d.val("");a.product.helper.onTabChanged("main",!0);a("#s-product-save-button").removeClass("green").addClass("yellow");
a("#s-category-list>ul").trigger("add",[e.data,"category"])})})});c.off("click.product",".s-product-delete-from-category").on("click.product",".s-product-delete-from-category",function(){var b=a(this).parent(),c=b.find("select");1<a("#s-product-edit-forms .s-product-form.main select.s-product-categories").length?(c.attr("disabled",!0),b.remove()):(c.val("selected").attr("disabled",!1),b.find("input.val").val(0).attr("disabled",!0).parent().hide(),b.find(".s-product-delete-from-category").hide());
return!1})},editTabMainAction:function(b){var c=!1,d=null;b&&b.params&&b.params.focus?(d=b.params.name||"",!d.length&&b.params.sku&&(d="product[skus]["+parseInt(b.params.sku,10)+"]",b.params.focus&&(d+="["+b.params.focus+"]"),"stock"==b.params.focus&&(d+="["+(parseInt(b.params.stock,10)||0)+"]")),c=':input[name$="'+d.replace(/(\[|\]|\|\-)/g,"\\$1")+'"]:first'):b&&"new"==b.id&&(c=':input[name$="[name]"]:first');c&&(a.shop.trace("$.product.editTabMainFocus",[d,a(c).length]),setTimeout(function(){a(c).focus();
window.location.hash="#/product/"+b.raw.replace(/\/focus=.*$/,"/")},100))},editTabMainBlur:function(){},editTabMainSave:function(){if(!1===this.call("editTabMainSkuEproductSave"))return!1},helper:{options:{tab_changed:'<i class="icon10 status-yellow-tiny"></i>'},data:{url_helper:{url:"",name:"",timer:null}},init:function(){this.data.url_helper={url:"",name:"",timer:null}},onTabChanged:function(b,c){a.shop.trace("$.product.onChange id="+b+" changed="+c);a("#s-product-edit-menu li."+b+" .s-product-edit-tab-status").html(c?
this.options.tab_changed:"")},type:function(b){return parseInt(b,10)||parseInt(a('#s-product-edit-forms .s-product-form.main :input[name="product[type_id]"]').val(),10)||0},onNameChange:function(b,c,d){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var e=a(a.product.options.form_selector).find(':input[name="product[url]"]'),f=e.parent();if(a.product.path.id&&"new"!=a.product.path.id||e.val()!=this.data.url_helper.url)a.shop.trace("$.product.onNameChange stop "+this.data.url_helper.url+
" != "+e.val()),a(a.product.options.form_selector).off(".product",':input[name="product[name]"]'),f.find(".js-url-helper").hide();else{c&&(f.find(".js-url-helper").length?f.find(".js-url-helper").show():f.append('<i class="icon16 loading js-url-helper"></i>'));var g=this;this.data.url_helper.timer=setTimeout(function(){g.urlHelper(b,e,d)},d||500)}},onChange:function(b){var c=this.checkChanges(b.parents("form"),!1),d=this.getContainerId(b);a.shop.trace("$.product.onChange changed="+c);a("#s-product-edit-save-panel :submit").removeClass(c?
"green":"yellow").addClass(c?"yellow":"green");c&&(c=this.checkChanges(b,!1));this.onTabChanged(d,c)},urlHelper:function(b,c){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var d={str:a(b).val()};a.shop.trace("$.product.urlHelper ",d);if(d.url!=this.data.url_helper.name){var e=this;this.data.url_helper.url=d.url;a.ajax({url:"?action=transliterate",data:d}).done(function(b){if((b=a.parseJSON(b))&&"ok"==b.status)e.data.url_helper.url=b.data,c.val(b.data),c.parent().find(".js-url-helper").hide()})}else c.parent().find(".js-url-helper").hide()},
getValueByName:function(b,c){for(var d=b,e=c.replace(/\]/,"").split("[");e.shift();)if(void 0!==d[c])d=d[c];else{d="";break}a.shop.trace("$.product.helper.getValueByName",[d,c,b]);return d},checkChanges:function(b,c){var d=!1,e=this,f=":input:not(.js-ignore-change)";if(b.hasClass("s-product-form")){if(b.hasClass("ajax"))return!1}else f=".s-product-form:not(.ajax) "+f;b.find(f).each(function(){var b=(a(this).attr("type")||this.tagName).toLowerCase();switch(b){case "input":case "text":case "textarea":this.defaultValue!=
this.value&&(d=!0,c&&(this.defaultValue=this.value,e.updateInput(this.name,this.value,"textarea"==b)));break;case "radio":case "checkbox":this.defaultChecked!=this.checked&&(d=!0,c&&(this.defaultChecked=this.checked));break;case "select":this.length&&a(this).find("option").each(function(){this.defaultSelected!=this.selected&&(d=!0,c&&(this.defaultSelected=this.selected));return c||!d});break;case "file":this.value&&(d=!0,c&&(this.value=null));break;case "reset":case "button":case "submit":break;case "hidden":break;
default:a.shop.error("$.product.checkChanges unsupported type "+b,[b,this])}!c&&d&&a.shop.trace("$.product.helper.checkChanges",[this,d]);return c||!d});return d},getContainerId:function(b){var b=(a(b).attr("class")||"").split(" "),c=!1,d;for(d in b)if("s-product-form"!=b[d]){c=b[d];break}return c},updateInput:function(b,c,d,e){if(b){var f=".s-"+b.replace(/\[(.+?)\]/g,"-$1")+"-input";a.shop.trace("update field: "+b+" "+f+" value="+c);b=a(f);b.is("input,textarea")?b.val(c):d?b.html(c):b.text(c);e&&
(c=a(f).attr("name"),c=c.replaceAll(/\[-[\d]+\]/,"["+e+"]"),a.shop.trace("$.product.helper.updateInput name",[c]))}},count:function(a){var c=0,d;for(d in a)a.hasOwnProperty(d)&&c++;return c},loadScript:function(b){var c=b.replace(/^.*\//,""),d=10;a.product.ajax.cached[c]||a.ajax({url:wa_url+b,dataType:"script",cache:!0,complete:function(e,f){"success"==f?(a.product.ajax.cached[c]=!0,a.shop.trace("$.product.helper.loadScript loaded",[c,b])):(a.shop.trace("$.product.helper.loadScript error",[f,c]),
d-=1,0<d&&setTimeout(function(){a.product.helper.loadScript(b)},200))}})}},multiSkus:function(b){var c=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first");1<b?(c.find("thead tr").show(),c.find(".s-name,.s-sku-sort").show("slow"),2==b?c.find("> tbody:first > tr:first .s-name :input").focus():c.find("> tbody:first > tr:last .s-name :input").focus()):(c.find("thead tr").hide(),c.find(".s-name,.s-sku-sort").hide())},editTabMainSkuAdd:function(){try{var b=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),
c=0;b.find(':input[name$="[price]"]').each(function(){c=Math.max(c,parseFloat(a(this).val())||0)});var d=0;b.find(':input[name$="[purchase_price]"]').each(function(){d=Math.max(d,parseFloat(a(this).val())||0)});a.product.multiSkus(b.find("tr:not(.js-sku-settings)").length+1);var e={id:--a.product.editTabMainData.sku_id,sku:"",available:1,name:"",price:""+c,purchase_price:""+d,stock_icon:{"0":"<i class='icon10 status-green' ></i>"},stock:{},count:null};a.shop.trace("$.product.editTabMainSkuAdd",[a.product.editTabMainData.sku_id,
e]);b.append(tmpl("template-sku-edit",{sku_id:a.product.editTabMainData.sku_id,sku:e,stocks:this.getData("main","stocks")}));b.find(".s-product-currency").trigger("change")}catch(f){a.shop.error(f.message,f)}return!1},editTabMainSkuSort:function(b,c,d){try{a.post("?module=product&action=skuSort",{product_id:this.path.id,sku_id:b,after_id:c},function(b){a.shop.trace("$.product.editTabMainSkuSort result",b);b.error&&(a.shop.error("Error occurred while sorting product SKUs","error"),d.sortable("cancel"))},
function(b){a.shop.trace("$.product.editTabMainSkuSort cancel",{data:b});d.sortable("cancel");a.shop.error("Error occurred while sorting product SKUs","error")})}catch(e){a.shop.error(e.message,e)}return!1},editTabMainProductDelete:function(){var b=a("#s-product-list-delete-products-dialog"),c=b.parent();b.length||(c=a("<div></div>").appendTo("body"));c.load("?module=dialog&action=productsDelete&count=1",function(){a("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},
onSubmit:function(b){a(this).find(".dialog-buttons i.loading").show();a.shop.jsonPost("?module=products&action=deleteList",{product_id:[a.product.path.id],get_lists:1},function(c){a.product_list&&a("#s-sidebar").trigger("update",c.data.lists);b.trigger("close");window.location.hash="#/products/"});return!1}})});return!1},editTabMainSkuDelete:function(b,c){var d=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),e=c.parents("tbody").find('> tr[data-id="'+
b+'"]'),f=this;0<b?1<c.parents("tbody").find('tr[data-id]:not(.js-sku-settings):not([data-id^="-"])').length?a.ajax({url:"?module=product&action=skuDelete",data:{sku_id:b,product_id:this.path.id},dataType:"json",type:"post",success:function(c){"fail"==c.status?f.refresh("error",c.errors):c.data.redirect?window.location.href=c.data.redirect:(f.refresh("success",c.data.message||"Success"),e.hide("normal",function(){e.remove();a('#s-product-view table.s-product-skus > tbody > tr[data-id="'+b+'"]').remove();
a.product.multiSkus(d.find("tr:not(.js-sku-settings)").length)}),a("#s-product-edit-forms .s-product-form.main").find("input[name=product\\[sku_id\\]][value="+c.data.sku_id+"]").attr("checked",!0))},error:function(a,b){f.refresh("error",b)}}):f.refresh("error",$_("At least one SKU per product must exists")):e.hide("normal",function(){e.remove();a('#s-product-view table.s-product-skus > tbody >tr[data-id="'+b+'"]').remove();a.product.multiSkus(d.find("tr:not(.js-sku-settings)").length)})},editTabMainCategoriesAdd:function(){var b=
a("#s-product-edit-forms .s-product-form.main select.s-product-categories:last").parent(),c=b.clone(!1);c.find("select").val("select").attr("disabled",!1).show();c.find("input.val").val(0).attr("disabled",!0).parent().hide();c.find(".s-product-delete-from-category").hide();b.after(c)},editTabMainSkuStock:function(b){var c=a("#s-product-sku-"+b);c.hide().find(":input:enabled").attr("disabled",!0);b=a("#s-product-sku-stock-"+b);b.show().find(":input:disabled").removeAttr("disabled");b.find(":input:first").val(c.find(":input:first").val())},
editTabMainSkuSettings:function(b,c){c.hide();var d=c.parents("tr"),e=d.data(),f=this;a.when(d.after(tmpl("template-sku-settings",{sku_id:b,sku:e}))).done(function(){var c;c="?module=product&action=skuSettings&product_id="+f.path.id;c+="&sku_id="+b;var e=a('#s-product-edit-forms .s-product-form.main tr.js-sku-settings[data-id="'+b+'"] > td:first');e.load(c,function(){d.find(':input[name$="[available]"]').remove();if(0<b){a.shop.trace("fileupload",[e.find(".fileupload").length,typeof e.find(".fileupload").fileupload]);
try{var c=document.cookie.match(/(?:^|; )_csrf=([^;]*)/),f=c?decodeURIComponent(c[1]):"";e.find(".fileupload:first").fileupload({dropZone:null,url:"?module=product&action=skuEproductUpload",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,start:function(){e.find(".fileupload:first").hide()},progress:function(b,c){a.shop.trace("fileupload progress",c);var d=e.find(".js-progressbar-container");d.show();d.find(".progressbar-inner:first").css("width",Math.round(100*c.loaded/c.total,0)+"%")},done:function(b,
c){a.shop.trace("fileupload done",[c.result,typeof c.result]);var f=(c.result.files||[]).shift();e.find(".js-progressbar-container").hide();if(!f||f.error)e.find(".error-message").text(f.error).show(),e.find(".fileupload:first").addClass("error").show();else{var g=e.find(".s-sku-attachment");g.find("input.s-input-file-name").val(f.name);g.find(".s-file-name").text(f.name);g.find(".s-file-size").text(f.size);g.find(".s-file-description").val("");g.find("input[type=checkbox]").attr("checked",!0);g.show();
d.find("input.s-input-virtual").val(0)}},fail:function(b,c){a.shop.trace("fileupload fail",[c.textStatus,c.errorThrown]);e.find(".error-message").text("error").show().text(c.errorThrown||"error");e.find(".js-progressbar-container").hide();e.find(".fileupload:first").addClass("error").show()},formData:{product_id:a.product.path.id,sku_id:b,_csrf:f}})}catch(g){a.shop.error("Exception "+g.message,g)}}})})},editTabMainSkuImageSelect:function(b,c,d){var b=d.parents("li:first"),e=b.hasClass("selected"),
f=d.parents("div.value:first");f.find("ul.s-product-image-crops li.selected").removeClass("selected");e?f.find('input[name$="[image_id]"]').val(0):(b.addClass("selected"),f.find('input[name$="[image_id]"]').val(c));a.shop.trace("$.product.editTabMainSkuImageSelect",[f,f.find(':input[name$="[image_id]"]')]);a.product.helper.onChange(d.parents("div.s-product-form"))},editTabMainSkuEproductSave:function(b){b=a("#s-product-edit-forms .s-product-form.main tr.js-sku-settings"+(b&&0<b?'[data-id="'+b+'"]':
"")+" > td:first .fileupload");a.shop.trace("$.product.editTabMainSkuEproductSave",b.length);b.length&&b.fileupload("start")},editTabMainSkuEproductDelete:function(){},editTabMainLinkEdit:function(){return!1},editTabMainTypeSelect:function(a){var c=a.parents("form").find(':input[name="product[type_id]"]').parents(".value");"main"==this.path.tab?a.hide():(c.find(".js-action").hide(),window.location.hash="/product/"+this.path.id+"/"+this.path.mode+"/");c.find(".js-type-name").hide();c.find(":input").show().focus();
setTimeout(function(){c.find(":input").focus()},100)},getSkyType:function(){var b=a(this.options.form_selector),c=b.find('input[name="product[sku_type]"]:first'),d="";return d=c.is(":radio")?b.find('input[name="product[sku_type]"]:checked').val():c.val()},editTabMainTypeChange:function(b){var c=b.parents(".value"),d=b.find(":selected:first"),e=d.val();a.shop.trace("debug",b);e!=c.data("type")?(c.find(".js-type-icon").html(d.data("icon")),c.find(".js-type-name").html(d.text()),a("#s-product-edit-forms .s-product-form.features").length&&
"undefined"!=typeof this.editTabFeaturesReload?this.editTabFeaturesReload(e):(b=a("#s-product-edit-menu > li.features > a"),b.attr("href",b.attr("href").replace(/\/features\/.*$/,"/features/"+e+"/")))):(b=a("#s-product-edit-menu > li.features > a"),b.attr("href",b.attr("href").replace(/\/features\/.*$/,"/features/")));var e=a.product.getSkyType(),f=a("#s-sku-type-field-group .s-base-price-selectable-currency").contents();a.get("?module=product&action=featuresSelectable&id="+a.product.path.id,{type_id:d.val(),
sku_type:e},function(b){var c=a("<div></div>");c.html(b);c.find(".s-base-price-selectable-currency").append(f);a("#s-sku-type-field-group").replaceWith(a("#s-sku-type-field-group",c));a("#s-product-feature-superposition-field-group").replaceWith(a("#s-product-feature-superposition-field-group",c));a.product.featureSelectableInit()})},editTabMainUpdate:function(b,c,d){var e=a("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody"),f=a("#s-product-view table.s-product-skus tbody");
e.find('tr[data-id^="-"]').remove();f.find('tr[data-id^="-"]').remove();e.parents("table").find("tr:hidden").show();var g=[],h;for(h in b.skus||{})g.push(a.extend({id:h},b.skus[h]));g=g.sort(function(a,b){return a.sort-b.sort});h="";for(var j=0,i=g.length;j<i;j+=1)h+=tmpl("template-sku-edit",{sku_id:g[j].id,sku:g[j],stocks:this.getData("main","stocks"),checked:g[j].id==b.sku_id});e.html(h);e.find("select.s-product-currency").val(b.currency);e.parent().show();this.multiSkus(e.find("tr:not(.js-sku-settings)").length);
h="";j=0;for(i=g.length;j<i;j+=1)h+=tmpl("template-sku",{sku_id:g[j].id,sku:g[j],stocks:this.getData("main","stocks")});f.html(h);(!d||"new"==d)&&e.parents("div.field-group:first").after(a("#s-sku-type-field-group"));c&&(d=a("#s-product-feature-superposition .superposition-count"),d.find(".options").text(c.options),d.find(".skus").html('<span class="highlighted">'+c.skus+"</span>"));var m=/#\/product\/new\//,l="#/product/"+b.id+"/";a("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody, #s-product-view table.s-product-skus tbody").find('[href*="#/product/new/"]').each(function(){a(this).attr("href",
a(this).attr("href").replace(m,l))})},editTabDescriptionsInit:function(){var b=[];b.push("wa-content/js/elrte/elrte.min.js");b.push("wa-content/js/elrte/elrte-wa.js");"en"!=wa_lang&&b.push("wa-content/js/elrte/i18n/elrte."+wa_lang+".js");for(var c=0;c<b.length;c++)a.product.helper.loadScript(b[c])},editTabPagesInit:function(){var b=[];b.push("wa-content/js/elrte/elrte.min.js");b.push("wa-content/js/elrte/elrte-wa.js");"en"!=wa_lang&&b.push("wa-content/js/elrte/i18n/elrte."+wa_lang+".js");for(var c=
0;c<b.length;c++)a.product.helper.loadScript(b[c])},editorUpdateSource:function(a){waEditorUpdateSource(a);wa_editor&&(this.description=wa_editor.getValue())},editTabDescriptionsBlur:function(){this.editorUpdateSource({id:"s-product-description-content"})},editTabDescriptionsAction:function(){var b=10;(function d(){try{if(a.product.ajax.cached["elrte-wa.js"]&&a.product.ajax.cached["elrte.min.js"]){var e=a("#s-product-description");e.html(tmpl("template-product-description",{description:a("#s-product-description-content").val()}));
setTimeout(function(){waEditorInit({id:"s-product-description-content",prefix:"s-product-description-",upload_url:"",lang:wa_lang,save_button:"s-product-save-button",change_callback:function(){if("descriptions"==a.product.path.tab)a.product.helper.onTabChanged(a.product.path.tab,!0)}});var b=e.find("iframe"),d=b.parents(".workzone"),f=d.height(),i=b.contents().find("body").prop("scrollHeight");i>f&&(d.height(i),b.height(i),e.find(".CodeMirror-scroll").height(i))},200)}else b-=1,0<b&&(a.shop.trace("$.product.editTabDescriptionsAction wait while js are loading",
a.product.ajax),setTimeout(function(){d()},500))}catch(f){console.error(f.message),console.dir(f.trace)}})()},profileInit:function(){wa_editor&&(wa_editor=void 0);if(this.options.edit_rights){var b=a("#shop-productprofile").find(".s-product-name");parseInt(this.path.id,10)?b.addClass("editable"):b.removeClass("editable");var c=this.get("form");b.inlineEditable({minSize:{width:150},maxSize:{width:550},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){a("#s-edit-product").hide()},afterBackReadable:function(b,
d){a("#s-edit-product").show();if(!d.changed)return!1;a.shop.jsonPost("?module=product&action=save&id="+a.product.path.id,{update:{name:a(b).val()}},function(){var d=a(b).val();document.title=d+a.product.options.title_suffix;c.find('input[name="product[name]"]').val(d)})},hold:function(){return!a(this).hasClass("editable")}})}var d=this;setTimeout(function(){d.call("profileLazyInit",[])},2E3)},profileLazyInit:function(){a("#product-sales-plot").empty().length&&a("#product-sku-plot").empty().length&&
(sales_plot_data&&sales_plot_data.length?a.jqplot("product-sales-plot",sales_plot_data,{seriesColors:"#3b7dc0 #129d0e #a38717 #ac3562 #1ba17a #87469f #6b6b6b #686190 #b2b000 #00b1ab #76b300".split(" "),grid:{borderWidth:0,shadow:!1,background:"#ffffff",gridLineColor:"#eeeeee"},series:[{color:"#129d0e",yaxis:"y2axis",shadow:!1,lineWidth:3,fill:!0,fillAlpha:0.1,fillAndStroke:!0,markerOptions:{show:!1},rendererOptions:{highlightMouseOver:!1}}],axes:{y2axis:{min:0,tickOptions:{markSize:0}},xaxis:{pad:1,
showTicks:!1}},highlighter:{lineWidthAdjust:12.5}}):a("#product-sales-plot").remove(),sku_plot_data&&sku_plot_data.length&&sku_plot_data[0]&&sku_plot_data[0].length?a.jqplot("product-sku-plot",sku_plot_data,{seriesColors:"#0077CC #33BB11 #EE5500 #EEBB11 #44DDDD #6b6b6b #686190 #b2b000 #00b1ab #76b300".split(" "),grid:{borderWidth:0,background:"#ffffff",shadow:!1},legend:{show:!0,location:"s"},seriesDefaults:{shadow:!1,renderer:a.jqplot.PieRenderer,rendererOptions:{padding:0,sliceMargin:1,showDataLabels:!1}}}):
a("#product-sku-plot").remove())}}})(jQuery);(function(a){a.fn.rateWidget=function(b,c,d){function e(b){var c=0;this.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(c==b)return!1;c++;a(this).removeClass("star-empty").addClass("star")});this.attr("data-rate",b)}function f(a){return function(){return a}}var g,h=this;if(this&&this.length){if("string"==typeof b){if("getOption"==b&&"rate"==c)return parseInt(this.attr("data-rate"),10);if("setOption"==b&&("rate"==c&&(e.call(this,parseInt(d,10)),c={rate:d}),"object"===
typeof c&&c))g=this.data("rateWidgetSettings")||{},a.extend(g,c),"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(g.hold=f(g.hold));return this}this.data("rateWidgetSettings",a.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0},b||{}));if(!this.data("inited")){g=this.data("rateWidgetSettings");"function"!==typeof g.hold&&(g.hold=f(g.hold));h.attr("id")||h.attr("id",(""+Math.random()).substr(2));null!==g.rate&&h.attr("data-rate",g.rate);h.find("i:lt("+h.attr("data-rate")+
")").removeClass("star-empty").addClass("star");h.mouseover(function(b){if(!g.hold.call(h)){b=b.target;if(b.tagName=="I"){b=a(b);b.prevAll().removeClass("star star-empty").addClass("star-hover").end().removeClass("star star-empty").addClass("star-hover");b.nextAll().removeClass("star star-hover").addClass("star-empty")}}}).mouseleave(function(){g.hold.call(h)||e.call(h,h.attr("data-rate"))});h.click(function(b){if(!g.hold.call(h)){for(var c=b.target;c.tagName!="I";)if(c==this)return;var d=h.attr("data-rate"),
e=0;h.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){e++;a(this).removeClass("star-empty").addClass("star");if(this==c){if(d!=e){h.attr("data-rate",e);g.onUpdate(e)}return false}});return false}});if(g.withClearAction){var b="clear-"+a(this).attr("id"),j=a("#"+b);j.length||(h.after('<a href="javascript:void(0);" class="inline-link rate-clear" id="'+b+'" style="display:none;"><b><i>'+$_("clear")+"</b></i></a>"),j=a("#"+b));j.click(function(){if(!g.hold.call(h)){var a=
h.attr("data-rate");e.call(h,0);if(a!==0)g.onUpdate(0)}});var i;h.parent().mousemove(function(){if(!g.hold.call(h)){i&&clearTimeout(i);j.show(0)}}).mouseleave(function(){i=setTimeout(function(){g.hold.call(h)||j.hide(0)},150)})}this.unbind("clear").bind("clear",function(){e.call(h,0)});this.data("inited",!0);return this}}}})(jQuery);(function(a){a.product_reviews={container:null,sidebar_counter:null,statuses:{},form:null,hotkeys:{"alt+enter":{ctrl:!1,alt:!0,shift:!1,key:13},"ctrl+enter":{ctrl:!0,alt:!1,shift:!1,key:13},"ctrl+s":{ctrl:!0,alt:!1,shift:!1,key:17}},options:{},init:function(b){this.options=b;this.statuses=b.statuses;b.product_id&&(this.product_id=b.product_id);this.form=a("#s-review-add-form");this.sidebar_counter=a("#s-all-reviews").find(".count");b.container&&(this.container="object"===typeof b.container?b.container:
a(b.container),this.container.find(".s-reviews").off("click",".s-review-reply, .s-review-delete, .s-review-restore").on("click",".s-review-reply, .s-review-delete, .s-review-restore",function(){var c=a(this),e=c.parents("li:first"),e=parseInt(e.attr("data-id"),10)||0;if(c.hasClass("s-review-reply")){if(a.product_reviews.options.reply=="ignore")return;a.product_reviews.prepareAddingForm.call(c,a.product_reviews.form,e)}else c.hasClass("s-review-delete")?a.product_reviews.deleteReview(e,b.afterDelete):
c.hasClass("s-review-restore")&&a.product_reviews.restoreReview(e,b.afterRestore);return false}));this.product_id&&this.container.addClass("ajax");var c=function(){a.product_reviews.addReview("backend",b.afterAdd)};this.addHotkeyHandler("textarea","ctrl+enter",c);this.form.find("input.save").unbind("click").bind("click",c);this.initView();this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);a.product&&(a.product.editTabReviewsAction=function(b){b.tail&&setTimeout(function(){a.product_reviews.activeReplyToForm(b.tail)},
200)})},activeReplyToForm:function(b){var c=this.container.find(".s-reviews li[data-id="+b+"]");if(c.length){var d=c.find(".s-review-reply:first");this.prepareAddingForm.call(d,this.form,b);a(document).scrollTop(c.offset().top)}},initView:function(){if("reviews"==a.products.hash.substr(0,7)){var b=a("#s-sidebar");b.find("li.selected").removeClass("selected");b.find("#s-all-reviews").addClass("selected")}},initLazyLoad:function(b){var c=b.count,d=b.total_count,e=b.url||"?module=reviews",f=a(b.target||
".s-reviews:first ul:first");a(window).lazyLoad("stop");c<d&&(a(window).lazyLoad({container:f,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();a.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(b){var b=a("<div></div>").html(b),e=b.find(".s-reviews").children();c+=e.length;f.append(e);a(".lazyloading-progress-string").replaceWith(b.find(".lazyloading-progress-string"));a(".lazyloading-progress").replaceWith(b.find(".lazyloading-progress"));
c>=d?(a(window).lazyLoad("stop"),a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),a(window).lazyLoad("wake"));b.remove()},"html")}}),a(".lazyloading-link").unbind("click").bind("click",function(){a(window).lazyLoad("force");return!1}))},prepareAddingForm:function(b,c){if(c)this.after(b),b.find(".rate a:first").hide();else{var d=a("#s-review-add li:first");d.find("form").length||d.append(b);b.find(".rate a:first").show()}a.product_reviews.clear(!1);a("input[name=parent_id]",b).val(c)},
addHotkeyHandler:function(a,c,d){var e=this.hotkeys[c];this.form.off("keydown",a).on("keydown",a,function(a){if(a.keyCode==e.key&&a.altKey==e.alt&&a.ctrlKey==e.ctrl&&a.shiftKey==e.shift)return d()})},addReview:function(b,c){var d=this.sidebar_counter;a.post("backend"==b||!b?"?module=reviews&action=add":"#",a.product_reviews.form.serialize(),function(b){if("fail"==b.status)a.product_reviews.clear(!1),a.product_reviews.showErrors(b.errors);else if("ok"!=b.status||!b.data.html)console&&console.log("Error occured.");
else{var f=a("input[name=parent_id]",a.product_reviews.form),g=a.product_reviews.form.parents(".s-review:first").parent("li"),h=b.data.html,j=a("ul:first",g),i=a.product_reviews.container;g.length||(i.show(),j=a("ul:first",i).show());j.length||(j=a('<ul class="menu-v with-icon"></ul>'),g.append(j));j.append(a('<li data-id="'+b.data.id+'" data-parent-id="'+b.data.parent_id+'"></li>').append(h));a("textarea",a.product_reviews.form).val("");g=a("#s-review-add");g.find("form").length||(g.append(a.product_reviews.form),
f.val(0));d.length&&d.text(parseInt(d.text(),10)+1);"function"===typeof c&&c(b);a.product_reviews.clear()}},"json").error(function(a){console&&console.log(a.responseText?"Error occured: "+a.responseText:"Error occured.")})},deleteReview:function(b,c){var d=this.container,e=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.deleted},function(a){if("ok"==a.status){var g=d.find("li[data-id="+b+"]").find("div:first");g.addClass("s-deleted");g.find(".s-review-delete").hide();
g.find(".s-review-restore").show();e.length&&e.text(parseInt(e.text(),10)-1);"function"===typeof c&&c(a)}},"json")},restoreReview:function(b){var c=this.container,d=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.published},function(a){"ok"==a.status&&(a=c.find("li[data-id="+b+"]").find("div:first"),a.removeClass("s-deleted"),a.find(".s-review-delete").show(),a.find(".s-review-restore").hide(),d.length&&d.text(parseInt(d.text(),10)+1),"function"===
typeof success&&success())},"json")},clear:function(b){b="undefined"===typeof b?!0:b;a(".errormsg",this.form).remove();a(".error",this.form).removeClass("error");a(".wa-captcha-refresh",this.form).click();b&&(a("input[name=captcha], textarea",this.form).val(""),a("input[name=rate]",this.form).val(0),a(".rate a:first",this.form).trigger("clear"))},showErrors:function(b){for(var c=0,d=b.length,e=b[c];c<d;e=b[++c])for(var f in e)a("[name="+f+"]",this.form).after(a('<em class="errormsg"></em>').text(e[f])).addClass("error")}}})(jQuery);(function(a){a.product_images={product_id:0,image:null,product_image:null,image_list:null,photo_stream:null,tail:null,options:{},init:function(b){this.options=b;this.product_id=b.product_id||0;this.image=b.image||null;this.options.placeholder=this.options.placeholder||null;var c=a("#s-product-edit-menu .images");this.image?setTimeout(function(){a.product_images.initImage()},200):this.initImageList(b);c.find(".hint").text(b.count||b.images&&b.images.length||0);a("#s-product-edit-forms .s-product-form.images").addClass("ajax");
a.product.editTabImagesAction=function(b){if(null!==a.product_images.tail){var c="?module=product&action=images&id="+b.id;if(b.tail&&(c+="&param[]="+b.tail,a.product_images.photo_stream&&a.product_images.photo_stream.length))var f=a.product_images.photo_stream.find(".s-stream-wrapper>ul"),c=c+("&ps[left]="+parseInt(f.css("left"),10)),c=c+("&ps[width]="+parseInt(f.css("width"),10));a.get(c,function(b){a("#s-product-edit-forms .s-product-form.images").html(b)})}a.product_images.tail=b.tail};a.product.editTabImagesBlur=
function(){a("#fileupload").fileupload("destroy")}},initImageList:function(b){this.image_list=a(b.image_list||"#s-product-image-list");this.image_list.html(tmpl("template-product-image-list",{images:b.images,placeholder:b.placeholder,type:b.type,product_id:this.product_id}));this.initListSortable();(!b.type||"thumbs"==b.type)&&this.initListEditable()},initImage:function(){a("#s-product-one-image").parent().width();this.photo_stream=a("#s-product-image-toolbar ul.s-photostream:first");var b=this.setImageDimensions();
a(window).unbind("resize.product_images").bind("resize.product_images",function(){a("#s-product-image").length||a(this).unbind("resize.product_images");var b=a.product_images.setImageDimensions();a.product_images.loupe.resize(b)});a("#s-product-image-description").inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:a.product_images.options.placeholder,minSize:{height:50,widht:600},size:{width:b.width},editLink:"#s-product-image-description-edit-link",
allowEmpty:!0,beforeMakeEditable:function(b){var c=a(this),d=this.id+"-button",e=a("#"+d);e.length||(b.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),a("#"+d).click(function(){c.trigger("readable")}));a("#"+this.id+"-hint").show();e.show().prev("br").hide()},afterBackReadable:function(b,c){var d=a(b).val(),e="#"+this.id+"-";a(e+"button").hide().prev("br").hide();a(e+"hint").hide();c.changed&&a.products.jsonPost("?module=product&action=imageSave",
{id:a.product_images.image.id,data:{description:d}})}});var c=this.photo_stream,d=c.find("li.selected");c.photoStreamSlider({backwardLink:"#s-product-image-toolbar .rewind",forwardLink:"#s-product-image-toolbar .ff",photoStream:"ul",duration:400});c.off("click","li.visible a").on("click","li.visible a",function(){var b=a(this).attr("href"),e=a(this).parent();d.removeClass("selected");d=e.addClass("selected");c.trigger("home",[function(){location.href=b}]);return!1});this.photo_stream=c;this.product_image=
a("#s-product-image");var e=a("#s-product-set-custom-badge");a(".s-product-image-actions").off("click","li").on("click","li",function(){var b=a(this),c=b.attr("data-action");switch(c){case "delete":a.product_images.deleteImage();break;case "rotate-right":a.product_images.rotateImage("right");break;case "rotate-left":a.product_images.rotateImage("left");break;case "set-badge":a.product_images.setBadge(b.attr("data-type"));break;case "set-custom-badge":e.data("type",b.attr("data-type"));e.show();break;
case "delete-badge":a.product_images.deleteBadge()}"set-custom-badge"!=c&&e.hide();return!1});e.find("input[type=button]").unbind("click").bind("click",function(){var b=a(this).parent();e.show();a.product_images.setBadge(e.data("type"),b.find("textarea[name=code]").val());return!1});b=this.image;a("#s-product-image-loupe").length&&a.product_images.loupe.init({original:{width:b.width,height:b.height,src:"?module=product&action=ImageDownload&id="+b.id},image:{width:this.product_image.width(),height:this.product_image.height(),
src:b.url_big,dom:this.product_image},animate:!(!b.dimensions.width||!b.dimensions.height)});var f=this;a("#s-restore-image-original").unbind("click").bind("click",function(){confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))&&(f.coverToggle(),a.products.jsonPost("?module=product&action=imageRestore",{id:f.image.id},function(b){a("#s-product-view").find("li[data-image-id="+f.image.id+"] img").attr("src",b.data.url_crop);
a("<img>").attr("src",b.data.url_big).load(function(){a(this).remove();a.products.dispatch("#/product/"+f.product_id+"/edit/images/"+f.image.id+"/");f.coverToggle()})},"json"))});var g=!1;a(document).unbind("keydown.product_images").bind("keydown.product_images",function(b){var d=a(b.target).prop("nodeName").toLowerCase(),b=b.keyCode;if(!g&&!("text"==d||"textarea"==d||37!=b&&39!=b)){if(39==b)return d=c.find("li.selected").next(),d.length&&!d.hasClass("dummy")&&(g=!0,location.href=d.find("a").attr("href")),
!1;if(37==b)return d=c.find("li.selected").prev(),d.length&&!d.hasClass("dummy")&&(g=!0,location.href=d.find("a").attr("href")),!1}})},setImageDimensions:function(){var b=a("#s-product-image"),c=a("#s-product-one-image").parent().width(),d=this.image.dimensions;d.width=parseInt(d.width,10);d.height=parseInt(d.height,10);var e={width:"",height:""};!isNaN(d.width)&&d.width<c?(e.width=d.width,isNaN(d.height)||(e.height=d.height)):e.width=c;b.css(e);return e},deleteImage:function(){var b=this,c=a("#s-product-image-delete-dialog");
c.waDialog({onSubmit:function(){c.trigger("close");b.coverToggle();var d=c.find("form");a.shop.jsonPost(d.attr("action"),d.serialize(),function(c){var d="#/product/"+b.product_id+"/edit/images/",g=b.photo_stream.find("li.selected"),h=g.next("li:not(.dummy)");h.length?d=h.find("a").attr("href"):(h=g.prev("li:not(.dummy)"),h.length&&(d=h.find("a").attr("href")));a(".s-product-image-crops").find("li[data-image-id="+c.data.id+"]").remove();b.coverToggle();location.href=d});return!1}})},rotateImage:function(b){var c=
this;c.coverToggle();a.products.jsonPost("?module=product&action=imageRotate&id="+c.image.id,{direction:b},function(b){a("#s-product-view").find("li[data-image-id="+c.image.id+"] img").attr("src",b.data.url_crop);a("<img>").attr("src",b.data.url_big).load(function(){a(this).remove();a.products.dispatch("#/product/"+c.product_id+"/edit/images/"+c.image.id+"/");c.coverToggle()})})},setBadge:function(b,c,d){a.shop.jsonPost("?module=product&action=badgeSet&id="+this.product_id,{code:c||b},function(c){a("#s-product-one-image").find(".top.right").html(c.data);
var f=a("#photo-organize-menu"),g=f.find("li.selected"),f=f.find("li[data-type="+b+"]");g.removeClass("selected").find(".small").text("");f.addClass("selected");"custom"!=b?(a("#s-product-set-custom-badge").hide(),f.find(".small").text(c.data)):a("#s-product-set-custom-badge").show();"function"===typeof d&&d(c)})},deleteBadge:function(){a.getJSON("?module=product&action=badgeDelete&id="+this.product_id,function(){a("#s-product-one-image").find(".top.right").html("");a("#photo-organize-menu").find("li.selected").removeClass("selected")})},
initListSortable:function(){this.image_list.sortable({distance:5,helper:"clone",items:"li",opacity:0.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},update:function(b,c){document.ondragstart=null;var d=a(this),e=a(c.item),f=parseInt(e.attr("data-image-id"),10),e=e.next(),g=null;e.length&&(g=parseInt(e.attr("data-image-id"),10));a.products.jsonPost("?module=product&action=imageMove",{id:f,before_id:g},function(){if("function"===typeof a.product_images.options.onSort)a.product_images.options.onSort(f,
g)},function(){d.sortable("cancel")})}})},coverToggle:function(){var b=a("#s-product-image-cover");if(b.is(":hidden")){var c=b.find(".loading");c.css({position:"absolute",left:parseInt((b.width()-c.width())/2,10)+"px",top:parseInt((b.height()-c.height())/2,10)+"px"});b.show()}else b.hide()},initListEditable:function(){this.image_list.off("click",".editable").on("click",".editable",function(){a(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",
placeholder:a.product_images.options.placeholder,minSize:{height:40},allowEmpty:!0,beforeMakeEditable:function(b){var c=a(this);b.css({"font-size":c.css("font-size"),"line-height":c.css("line-height")}).width(c.parents("li:first").find("img").width());var d=this.id+"-button",e=a("#"+d);e.length||(b.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),a("#"+d).click(function(){c.trigger("readable")}));a("#"+this.id+"-hint").show();
e.show()},afterBackReadable:function(b,c){var d=a(this),d=parseInt(d.parents("li:first").attr("data-image-id"),10),e=a(b).val(),f="#"+this.id+"-";a(f+"button").hide();a(f+"hint").hide();c.changed&&a.products.jsonPost("?module=product&action=imageSave",{id:d,data:{description:e}})}}).trigger("editable")})}}})(jQuery);(function(a){var b=[],c=[];a.fn.doAutosize=function(b){var c=a(this).data("minwidth"),f=a(this).data("maxwidth"),g="",h=a(this),j=a("#"+a(this).data("tester_id"));if(g!==(g=h.val()))g=g.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),j.html(g),j=j.width(),b=j+b.comfortZone>=c?j+b.comfortZone:c,j=h.width(),(b<j&&b>=c||b>c&&b<f)&&h.width(b)};a.fn.resetAutosize=function(b){var c=a(this).data("minwidth")||b.minInputWidth||a(this).width(),b=a(this).data("maxwidth")||b.maxInputWidth||
a(this).closest(".tagsinput").width()-b.inputPadding,f=a(this),g=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),h=a(this).attr("id")+"_autosize_tester";0<!a("#"+h).length&&(g.attr("id",h),g.appendTo("body"));f.data("minwidth",c);f.data("maxwidth",b);f.data("tester_id",h);f.css("width",c)};a.fn.addTag=function(d,e){e=jQuery.extend({focus:!1,
callback:!0},e);this.each(function(){var f=a(this).attr("id"),g=a(this).val().split(b[f]);""==g[0]&&(g=[]);d=jQuery.trim(d);var h;e.unique?(h=a(g).tagExist(d),!0==h&&a("#"+f+"_tag").addClass("not_valid")):h=!1;if(""!=d&&!0!=h&&(a("<span>").addClass("tag").append(a("<span>").text(d).append("\u00a0\u00a0"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+f).removeTag(escape(d))})).insertBefore("#"+f+"_addTag"),g.push(d),a("#"+f+"_tag").val(""),e.focus?a("#"+f+"_tag").focus():
a("#"+f+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,g),e.callback&&(c[f]&&c[f].onAddTag)&&(h=c[f].onAddTag,h.call(this,d)),c[f]&&c[f].onChange)){var j=g.length;h=c[f].onChange;h.call(this,a(this),g[j-1])}});return!1};a.fn.removeTag=function(d){d=unescape(d);this.each(function(){var e=a(this).attr("id"),f=a(this).val().split(b[e]);a("#"+e+"_tagsinput .tag").remove();str="";for(var g=0;g<f.length;g++)f[g]!=d&&(str=str+b[e]+f[g]);a.fn.tagsInput.importTags(this,str);c[e]&&c[e].onRemoveTag&&c[e].onRemoveTag.call(this,
d)});return!1};a.fn.tagExist=function(b){return 0<=jQuery.inArray(b,a(this))};a.fn.importTags=function(b){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,b)};a.fn.tagsInput=function(d){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},d);this.each(function(){e.hide&&
a(this).hide();var d=a(this).attr("id"),g=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},e);b[d]=g.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange)c[d]=[],c[d].onAddTag=e.onAddTag,c[d].onRemoveTag=e.onRemoveTag,c[d].onChange=e.onChange;var h='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';e.interactive&&(h=h+'<input id="'+d+'_tag" value="" data-default="'+e.defaultText+'" />');a(h+'</div><div class="tags_clear"></div></div>').insertAfter(this);
a(g.holder).css("width",e.width);a(g.holder).css("height",e.height);""!=a(g.real_input).val()&&a.fn.tagsInput.importTags(a(g.real_input),a(g.real_input).val());if(e.interactive){a(g.fake_input).val(a(g.fake_input).attr("data-default"));a(g.fake_input).css("color",e.placeholderColor);a(g.fake_input).resetAutosize(e);a(g.holder).bind("click",g,function(b){a(b.data.fake_input).focus()});a(g.fake_input).bind("focus",g,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&
a(b.data.fake_input).val("");a(b.data.fake_input).css("color","#000000")});if(void 0!=e.autocomplete_url){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(g.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),a(g.fake_input).bind("result",g,function(b,c){c&&a("#"+d).addTag(c[0]+"",{focus:!0,unique:e.unique})})):void 0!==jQuery.ui.autocomplete&&(a(g.fake_input).autocomplete(autocomplete_options),
a(g.fake_input).bind("autocompleteselect",g,function(b,c){a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:e.unique});return!1}))}else a(g.fake_input).bind("blur",g,function(b){var c=a(this).attr("data-default");""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=c?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:e.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),
a(b.data.fake_input).css("color",e.placeholderColor));return!1});a(g.fake_input).bind("keypress",g,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||13==b.which)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:e.unique}),a(b.data.fake_input).resetAutosize(e),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(e)});g.removeWithBackspace&&
a(g.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();var b=a(this).closest(".tagsinput").find(".tag:last").text(),c=a(this).attr("id").replace(/_tag$/,""),b=b.replace(/[\s]+x$/,"");a("#"+c).removeTag(escape(b));a(this).trigger("focus")}});a(g.fake_input).blur();g.unique&&a(g.fake_input).keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&a(this).removeClass("not_valid")})}return!1});
return this};a.fn.tagsInput.updateTagsField=function(c,e){var f=a(c).attr("id");a(c).val(e.join(b[f]))};a.fn.tagsInput.importTags=function(d,e){a(d).val("");for(var f=a(d).attr("id"),g=e.split(b[f]),h=0;h<g.length;h++)a(d).addTag(g[h],{focus:!1,callback:!1});c[f]&&c[f].onChange&&c[f].onChange.call(d,d,g[h])}})(jQuery);(function(a){a.product_list={options:{},collection_hash:[],collection_param:"",total_count:0,category_count:0,sort:null,order:null,container:null,toolbar:null,sortable:!0,init:function(b){try{this.options=b;this.container=a("#product-list");this.toolbar=a("#s-product-list-toolbar");this.sidebar=a("#s-sidebar");var c=this.options.products;delete this.options.products;this.total_count=this.options.total_count||0;this.category_count=parseInt(this.options.category_count,10);isNaN(this.category_count)&&
(this.category_count=this.total_count);this.sortable="undefined"===typeof b.sortable?this.sortable:b.sortable;this.sort=b.sort||null;if(c&&b.view){try{this.container.append(tmpl("template-product-list-"+this.options.view,{products:c,sort:this.sort},"table"==this.options.view)),this.container.trigger("append_product_list",[c])}catch(d){return console.log("Error: "+d.message),this}delete b.products}this.collection_hash=a.isArray(this.options.collection_hash)&&this.options.collection_hash.length?this.options.collection_hash:
[];this.collection_param=this.options.collection_param?this.options.collection_param:"";b.order&&(this.order=b.order);this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);this.initSelecting();this.initView(this.options.view);this.initDragndrop()}catch(e){a.shop.error("$.product_list.init error: "+e.message,e)}return this},initLazyLoad:function(b){var c=b.count,d=this.total_count;a(window).lazyLoad("stop");if(c<d){var e=this;a(window).lazyLoad({container:e.container,state:"undefined"===
typeof b.auto||b.auto?"wake":"stop",hash:["","products"],load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();a.get("?module=products&action=loadList&offset="+c+("&total_count="+d)+(e.collection_param?"&"+e.collection_param:"")+(e.sort?"&sort="+e.sort:"")+(e.order?"&order="+e.order:""),function(b){if("ok"==b.status&&b.data.count){c+=b.data.count;var g=e.container;try{e.container.append(tmpl("template-product-list-"+e.options.view,{products:b.data.products,
check_all:"table"==e.options.view?g.find(".s-select-all").attr("checked"):!1,sort:a.product_list.sort})),e.container.trigger("append_product_list",[b.data.products])}catch(h){console.log("Error: "+h.message);a(window).lazyLoad("stop");return}g.find(".last").removeClass("last");g.find(".product:last").addClass("last");a(".lazyloading-progress-string").text(b.data.progress.loaded+" "+b.data.progress.of);a(".lazyloading-progress").hide();a(".lazyloading-chunk").text(b.data.progress.chunk);c>=d?(a(window).lazyLoad("stop"),
a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),a(window).lazyLoad("wake"))}else b.data&&!b.data.count?console&&(console.log("Count of again loaded products is 0"),a(".lazyloading-progress").hide()):(b.errors&&console&&console.log("Error when loading products: "+b.errors),a(window).lazyLoad("stop"))},"json")}});a(".lazyloading-link").die("click").live("click",function(){a(window).lazyLoad("force");return!1})}},initSelecting:function(){var b=this.container,c=this.toolbar.find(".count"),
d=b.find(".s-select-all"),e=function(){var a=parseInt(b.find(".product.selected").length,10);a?c.text(a).show():c.text("").hide()};a(document).keydown(function(a){16==a.keyCode&&(document.body.onselectstart=function(){return!1})}).keyup(function(a){16==a.keyCode&&(document.body.onselectstart=null)});b.off("select",".product").on("select",".product",function(b,c,h){h=void 0!==h?need:!0;(void 0!==c?c:1)?a(this).addClass("selected").find("input:first").attr("checked",!0):(a(this).removeClass("selected").find("input:first").attr("checked",
!1),d.is(":checked")&&d.attr("checked",!1));h&&e();return!1});d.unbind("select").bind("select",function(d,e){var e=void 0!==e?e:!0,h=a(this);e?(h.attr("checked",!0),b.find(".product").trigger("select",!0,!1),c.text(h.attr("data-count")).show()):(h.attr("checked",!1),b.find(".product").trigger("select",!1,!1),c.text("").hide())});b.off("click",".product input").on("click",".product input",function(c,g){var h=c.shiftKey,j=this.checked;g&&(h=g.shiftKey,j=g.checked);var i=a(this).parents(".product:first");
j?i.addClass("selected"):(d.is(":checked")&&d.attr("checked",!1),i.removeClass("selected"));if(h&&j){(h=b.data("last_checked"))||(h=b.find(".product:first").trigger("select",!0));var m=i.prevAll(".selected[data-product-id="+h.attr("data-product-id")+"]"),l;if(m.length){l=i.prev();for(h=h.get(0);l.length&&h!=l.get(0);)l.addClass("selected").find("input").attr("checked",!0),l=l.prev()}else if(m=i.nextAll(".selected[data-product-id="+h.attr("data-product-id")+"]"),m.length){l=i.next();for(h=h.get(0);l.length&&
h!=l.get(0);)l.addClass("selected").find("input").attr("checked",!0),l=l.next()}!b.data("last_checked")&&!m.length&&h.trigger("selected",!1)}j&&b.data("last_checked",i);e()});if(a.browser.mozilla)b.off("click",".product label").on("click",".product label",function(b){if(b.shiftKey){var c=a(b.target);a(c).is("label")||(c=a(c).parents("label:first"));c=a("#"+c.attr("for"));c.trigger("click",{shiftKey:b.shiftKey,checked:!c.attr("checked")})}})},initView:function(b){try{var c=this.container,d=this.sidebar;
"table"==b&&c.find(".s-select-all").click(function(){a(this).trigger("select",this.checked)});var e="view="+b;d.find(".s-collection-list li.dr").each(function(){var b=a(this);b.find("a:first").attr("href","#/products/"+b.attr("id").replace("-","_id=")+"&"+e)});a("#s-products-search").val(this.options.text||"");var f=a.product_list.collection_hash.join("-")||"s-all-products";a.shop.trace("$.product_list.initView",[b,f]);d.find("li.selected").removeClass("selected");var g=d.find("#"+f);0>=g.length&&
window.location.hash&&(g=d.find('a[href="'+window.location.hash+'"]').parent());0>=g.length&&(g=d.find("#s-all-products"));g.addClass("selected").find(".count:first").text(this.category_count);d.off("click",".s-new-list").on("click",".s-new-list",function(){var b=a(this),c=b.attr("id"),d=0;c?b=c.replace("s-new-",""):(d=b.parents("li.dr:first").attr("id").split("-"),b=d[0],d=d[1]);a.product_list.createListDialog(b,d,function(b,c){var d=a("#s-"+c+"-list"),e=d.find("ul:first");if(!e.length){d.prepend('<ul class="menu-v with-icons"><li class="drag-newposition" data-type="'+
c+'"></li></ul>');d.find(".drag-newposition").mouseover();e=d.find("ul:first")}var f=parseInt(b.parent_id,10)||0,d=a.categories_tree.getHandlerByCategoryId(f),g=function(){if(f){var d=e.find("#"+c+"-"+b.parent_id);if(!d.find(">.collapse-handler-ajax").length){d.append('<ul class="menu-v with-icons dr"><li class="drag-newposition" data-type="'+c+'"></li></ul>');d.find(".drag-newposition").mouseover();d.find(">a").before('<i class="icon16 darr overhanging collapse-handler-ajax" id="'+c+"-"+f+'-handler"></i>');
a.categories_tree.setExpanded(f)}e=d.find("ul:first")}e.trigger("add",[b,c])};c=="category"?a.categories_tree.expand(d,function(){g()}):g()});return!1});a("#s-content").find(".sort").unbind("click").bind("click",function(){location.href=a(this).find("a").attr("href");return!1});var h=a("#s-embed-code");h.length&&h.inlineEditable({size:{width:h.width()+4},afterMakeEditable:function(a){a.trigger("select")}});this.initEditingControls();this.initToolbar()}catch(j){a.shop.error("$.product_list.initView error: "+
j.message,j)}},initEditingControls:function(){var b=a("#s-product-list-title");b.hasClass("editable")&&(b.inlineEditable({minSize:{width:350},maxSize:{width:600},size:{height:30},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){a(".s-product-list-manage").hide()},afterBackReadable:function(b,c){a(".s-product-list-manage").show();if(!c.changed)return!1;a.shop.jsonPost("?module=products&action=saveListSettings&"+a.product_list.collection_param+"&edit=name",{name:a(b).val()},function(b){a.product_list.sidebar.find("#"+
a.product_list.collection_hash[0]+"-"+b.data.id).find(".name:first").html(b.data.name)})}}),"name"==this.options.edit&&b.trigger("editable"));var c=a.product_list.collection_hash[0],b=a("#s-product-list-settings");b.length&&("category"==c||"set"==c)&&b.unbind("click").bind("click",function(){a.product_list.settingsListDialog();return false});b=a("#s-product-list-delete");b.length&&("category"==c||"set"==c)&&b.unbind("click").bind("click",function(){a("#s-product-list-delete-dialog").waDialog({disableButtonsOnSubmit:true,
onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(){var b=a(this);b.find(".dialog-buttons i.loading").show();var e={hash:a.product_list.collection_hash.join("/")||"all",remove:["list"]};b.find("input[name=s-delete-products]:checked").val()=="1"&&e.remove.push("products");var f=function(){a.product_list.remove(e,function(b){var d=a("#"+a.product_list.collection_hash.join("-")),e=d.prev(".drag-newposition"),f=a("#s-"+a.product_list.collection_hash[0]+"-list"),m=f.find("ul"),
l;if(c=="set"){d.remove();e.remove()}else{l=d.find("ul:first");if(l.length){l.find(">li.drag-newposition:first").remove();d.hide();l.find(">li").each(function(){d.after(this)})}l=d.parents("ul:first");d.remove();e.remove();if(!l.find("li.dr").length&&m.get(0)!=l.get(0)){l.parents("li:first").find("i.collapse-handler").remove();l.remove()}}if(m.find("li.dr:first").length){m.show();f.find(".s-empty-list").hide()}else{m.hide();f.find(".s-empty-list").show()}a.product_list.sidebar.trigger("update",b.data.lists);
b.data.old_parent_category&&(typeof b.data.old_parent_category.children_count!=="undefined"&&!parseInt(b.data.old_parent_category.children_count,10))&&a("#category-"+b.data.old_parent_category.id+"-handler").remove();location.href="#/"})},b=a("#"+a.product_list.collection_hash.join("-")+"-handler");b.length?a.categories_tree.expand(b,function(a){a.parent().find("ul:first").hide();f()}):f();return false}});return false})},initCategoryDescriptionWysiwyg:function(b){var c=10,d=function(b){return a.ajax({url:b,
dataType:"script",cache:!0})},e=function(){var a=b.find(".field.description");a.find("i").hide();a.find(".s-editor-core-wrapper").show();waEditorInit({id:"s-category-description-content",prefix:"s-category-description-",upload_url:"",lang:"{$lang}"})},f=function(){0<c?(console&&console.log("Coudn't init editor. Error when loading proper js files. Try again."),g(),c-=1):console&&console.error("Coudn't init editor. Error when loading proper js files")},g="en"!=wa_lang?function(){a.when(d(wa_url+"wa-content/js/elrte/elrte.min.js"),
d(wa_url+"wa-content/js/elrte/elrte-wa.js"),d(wa_url+"wa-content/js/elrte/i18n/elrte."+wa_lang+".js")).then(e,f)}:function(){a.when(d(wa_url+"wa-content/js/elrte/elrte.min.js"),d(wa_url+"wa-content/js/elrte/elrte-wa.js")).then(e,f)};g()},initDragndrop:function(){a.product_dragndrop.init({products:!0,view:this.options.view}).bind("move_product",function(b){a.shop.jsonPost("?module=product&action=move&"+a.product_list.collection_param,{product_ids:b.product_ids,before_id:b.before_id||null},b.success,
b.error)}).bind("is_product_sortable",function(){return a.product_list.sortable}).bind("add_to_list",function(b){var c={};b.whole_list?c.hash=a.product_list.collection_hash.join("/")||"all":c.product_id=b.product_ids;a.shop.jsonPost("?module=product&action=addToList&"+b.collection_param,c,b.success,b.error)})},initToolbar:function(){var b=this.toolbar;b.find("li").unbind("click.product_list").bind("click.product_list",function(){var b=a(this).attr("data-action");if(b){var c=a.product_list.getSelectedProducts("delete"!=
b);if(!c.count)return alert($_("Please select at least one product")),!1;"new-set"!=b&&("category"==b?a.product_list.categoriesDialog(c):"set"==b?a.product_list.setsDialog(c):"type"==b?a.product_list.typesDialog(c):"assign-tags"==b?a.product_list.assignTagsDialog(c):"delete"==b?a.product_list.deleteProductsDialog(c):"delete-from-set"==b&&"set"==a.product_list.collection_hash[0]?a.product_list.deleteFromSet(c):"delete-from-category"==b&&"category"==a.product_list.collection_hash[0]?a.product_list.deleteFromCategory(c):
"export"==b&&a.product_list.exportProducts(c,a(this).attr("data-plugin")));return!1}});var c=a("#mainmenu").height(),d=b.find(":first").offset().top-c;a(document).bind("scroll",function(){a(this).scrollTop()>d?b.addClass("s-fixed").css({top:c}):b.removeClass("s-fixed")})},getSelectedProducts:function(b){var b=b||!1,c={count:0};if(this.container.find(".s-select-all").attr("checked")){var d=a.product_list.collection_hash.join("/")||"all";b?c.serialized=[{name:"hash",value:d}]:c.hash=d;c.count=this.total_count}else b?
c.serialized=a.product_list.container.find(".product.selected").map(function(){c.count+=1;return{name:"product_id[]",value:a(this).attr("data-product-id")}}).toArray():c.product_id=a.product_list.container.find(".product.selected").map(function(){c.count+=1;return a(this).attr("data-product-id")}).toArray();return c},categoriesDialog:function(b){var c=a("#s-categories"),d=this.sidebar,e=this.container;c.length&&c.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=categories",
function(){a("#s-categories").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=a(this);c.find(".dialog-content h1 span").text("("+b.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_category_name]").val("");c.find("input[name=new_category]").attr("checked",!1)},onSubmit:function(c){var g=c.find("form");g.find(".dialog-buttons i.loading").show();a.shop.jsonPost(g.attr("action"),g.serializeArray().concat(b.serialized),function(b){b.data.new_category&&a("#s-category-list ul:first").trigger("add",
[b.data.new_category,"category","#/products/category_id="+b.data.new_category+"&view="+a.product_list.options.view]);b.data.categories&&(d.trigger("update",[{category:b.data.categories}]),e.find(".s-select-all:first").trigger("select",!1));g.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},setsDialog:function(b){var c=a("#s-sets"),d=this.sidebar,e=this.container;c.length&&c.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=sets",function(){a("#s-sets").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){var c=a(this);c.find(".dialog-content h1 span").text("("+b.count+")").show();c.find(".dialog-buttons i.loading").hide();c.find("input[name=new_set_name]").val("");c.find("input[name=new_set]").attr("checked",!1)},onSubmit:function(c){var g=c.find("form");g.find(".dialog-buttons i.loading").show();a.shop.jsonPost(g.attr("action"),g.serializeArray().concat(b.serialized),function(b){b.data.new_set&&a("#s-set-list ul:first").trigger("add",[b.data.new_set,"set","#/products/set_id="+b.data.new_set+
"&view="+a.product_list.options.view]);b.data.sets&&(d.trigger("update",[{set:b.data.sets}]),e.find(".s-select-all:first").trigger("select",!1));g.find("input:checked").attr("checked",!1);c.trigger("close")});return!1}})})},assignTagsDialog:function(b){var c=a("#s-assign-tags");c.length&&c.remove();a.post("?module=dialog&action=assignTags",b.serialized,function(c){a("body").append(c);a("#s-assign-tags").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var c=a(this);c.find(".dialog-content h1 span").text("("+
b.count+")").show();c.find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var d=a(this);d.find(".dialog-buttons i.loading").show();a.shop.jsonPost(d.attr("action"),d.serializeArray().concat(b.serialized),function(b){b.data.cloud&&a("#s-tag-cloud").trigger("update",[b.data.cloud]);c.trigger("close");a.products.dispatch()},function(){c.trigger("close")});return!1}})})},typesDialog:function(b){var c=a("#s-types"),d=this.container,e=this.sidebar,f=function(){a("#s-types").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){var f=a(this);f.find(".dialog-buttons i.loading").show();a.shop.jsonPost(f.attr("action"),f.serializeArray().concat(b.serialized),function(b){e.trigger("update",{type:b.data.types});d.find(".s-select-all:first").trigger("select",!1);f.find("input:checked").attr("checked",!1);c.trigger("close");a.products.dispatch()});return!1}})},g=c.parent();c.length?f():(g=a("<div></div>").appendTo("body"),g.load("?module=dialog&action=types",
f))},deleteFromSet:function(b){0<b.count&&a.shop.jsonPost("?module=products&action=deleteFromSet&id="+this.collection_hash[1],b.serialized,function(){a.products.dispatch()})},deleteFromCategory:function(b){0<b.count&&a.shop.jsonPost("?module=products&action=deleteFromCategory&id="+this.collection_hash[1],b.serialized,function(){a.products.dispatch()})},deleteProductsDialog:function(b){var c=a("#s-product-list-delete-products-dialog"),d=c.parent();c.length||(d=a("<div></div>").appendTo("body"));d.load("?module=dialog&action=productsDelete&count="+
b.count,function(){a("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(c){a(this).find(".dialog-buttons i.loading").show();a.product_list.remove(a.extend(b,{remove:["products"]}),function(b){a.product_list.sidebar.trigger("update",b.data.lists);a.products.dispatch();c.trigger("close")});return!1}})})},_iframePost:function(b,c,d){var e=b.attr("id")+"-iframe";a("#"+e).length||b.after("<iframe id="+
e+" name="+e+" style='display:none;'></iframe>");var f=a("#"+e);b.attr("target",e);f.one("load",function(){try{var b=a(this).contents().find("body").html(),e=a.parseJSON(b)}catch(f){d(b);return}"ok"==e.status?c(e):d(e)})},settingsListDialog:function(){var b=a("#s-product-list-settings-dialog");p=b.length?b.parent():a("<div></div>").appendTo("body");p.load("?module=dialog&action=productListSettings&"+a.product_list.collection_param,function(){var b=a("#s-product-list-create-dialog");b.length&&(b.parent().remove(),
b.remove());a("#s-product-list-settings-dialog").waDialog({onLoad:function(){a("#s-category-description-content").length&&a.product_list.initCategoryDescriptionWysiwyg(a(this));a("#s-product-list-name").focus()},onSubmit:function(b){var c=a(this),f=function(c){var e=a.product_list.collection_hash,f=location.hash.replace(e[0]+"_id="+e[1],e[0]+"_id="+c.data.id),g=a("#"+e.join("-"));g.find(".name:first").html(c.data.name);c.data.status=="0"?g.children("a").addClass("gray"):c.data.status=="1"&&g.children("a").removeClass("gray");
g.find(".id:first").html(c.data.id);g.attr("id",e[0]+"-"+c.data.id);g.find("a").attr("href",f);location.hash!=f?location.hash=f:a.products.dispatch();b.trigger("close")},g=function(a){if(a&&a.errors){var a=a.errors,c;for(c in a)b.find("input[name="+c+"]").addClass("error").parent().find(".errormsg").text(a[c]);return false}};a("#s-category-description-content").length&&waEditorUpdateSource({id:"s-category-description-content"});if(c.find("input:file").length)a.product_list._iframePost(c,f,g);else{a.shop.jsonPost(c.attr("action"),
c.serialize(),f,g);return false}}})})},createListDialog:function(b,c,d){var e=a("#s-product-list-create-dialog");p=e.length?e.parent():a("<div></div>").appendTo("body");p.load("?module=dialog&action=productListCreate&type="+b+"&parent_id="+c,function(){var c=a("#s-product-list-settings-dialog");c.length&&(c.parent().remove(),c.remove());a("#s-product-list-create-dialog").waDialog({onLoad:function(){a("#s-category-description-content").length&&a.product_list.initCategoryDescriptionWysiwyg(a(this));
a("#s-c-product-list-name").focus()},onSubmit:function(c){var e=a(this),f=function(e){typeof d==="function"&&d(e.data,b);location.href="#/products/"+b+"_id="+e.data.id+"&view="+a.product_list.options.view;c.trigger("close")},i=function(a){if(a&&a.errors){var a=a.errors,b;for(b in a)c.find("input[name="+b+"]").addClass("error").parent().find(".errormsg").text(a[b]);return false}};a("#s-category-description-content").length&&waEditorUpdateSource({id:"s-category-description-content"});if(e.find("input:file").length)a.product_list._iframePost(e,
f,i);else{a.shop.jsonPost(e.attr("action"),e.serialize(),f,i);return false}}})})},exportProducts:function(a,c){for(var d=[],e,f=!1;e=a.serialized.pop();)e.name&&("product_id[]"==e.name?d.push(parseInt(e.value,10)):"hash"==e.name&&(f=e.value));e="?action=importexport#/"+c;f?window.location=e+("/hash/"+f):d.length&&(e+="/hash/id/"+d.join(","),window.location=e)},remove:function(b,c){var d={},e;b.product_id?e=function(){100>=b.product_id.length&&(d.get_lists=!0);d.product_id=b.product_id.splice(0,100);
a.shop.jsonPost("?module=products&action=deleteList",d,function(a){b.product_id.length?e():typeof c==="function"&&c(a)})}:(d.hash=b.hash||this.collection_hash.join("/")||"all",d.remove=a.isArray(b.remove)&&b.remove.length?b.remove:["list"],1==d.remove.length&&"list"==d.remove[0]?e=function(){a.shop.jsonPost("?module=products&action=deleteList",d,c)}:(d.count=100,e=function(){a.shop.jsonPost("?module=products&action=deleteList",d,function(a){0<a.data.rest_count&&null!=a.data.rest_count?e():"function"===
typeof c&&c(a)})}));e()}}})(jQuery);
